# Generalizations of the Karatsuba Algorithm for Efficient Implementations

Andr´e Weimerskirch and Christof Paar

Communication Security Group Department of Electrical Engineering & Information Sciences Ruhr-Universit¨at Bochum, Germany email: {weika, cpaar}@crypto.rub.de

#### Abstract

In this work we generalize the classical Karatsuba Algorithm (KA) for polynomial multiplication to (i) polynomials of arbitrary degree and (ii) recursive use. We determine exact complexity expressions for the KA and focus on how to use it with the least number of operations. We develop a rule for the optimum order of steps if the KA is used recursively. We show how the usage of dummy coefficients may improve performance. Finally we provide detailed information on how to use the KA with least cost, and also provide tables that describe the best possible usage of the KA for polynomials up to a degree of 127. Our results are especially useful for efficient implementations of cryptographic and coding schemes over fixed-size fields like GF(p <sup>m</sup>).

Keywords: polynomial multiplication, Karatsuba Algorithm, finite fields, cryptography, coding theory

### 1 Introduction

Multiplying two polynomials efficiently is an important issue in a variety of applications, including signal processing, cryptography and coding theory. The present paper provides a generalization and detailed analysis of the algorithm by Karatsuba [2] to multiply two polynomials which was introduced in 1962. The Karatsuba Algorithm (KA) saves coefficient multiplications at the cost of extra additions compared to the schoolbook or ordinary multiplication method. We consider the KA to be efficient if the total cost of using it is less than the cost of the ordinary method. If we assume that we know the cost ratio between one multiplication and one addition we can decide which method is more efficient.

In order to simplify the problem we assume that the maximum degree of the two polynomials which are multiplied is identical. Knuth [3] gives a brief introduction on how to multiply polynomials in a fast way. He demonstrates an algorithm very similar to the KA which he calls "digital method", and achieves a complexity of O(n2 √ 2 log n log n) for very large polynomials. Another well known fast approach for polynomial multiplication is the Fast Fourier Transform (FFT). A theoretical upper bound for very large numbers can be shown as O(n log n log log n). A comprehensive survey of different methods to multiply polynomials was given by Bernstein [1]. Assuming that the polynomials represent elements of a Galois Field GF(p <sup>m</sup>) we could use the KA to multiply two elements of the finite field and reduce the resulting polynomial afterwards. Another approach is shown by Lempel, Seroussi and Winograd in [4] and by Winograd in [7]. They demonstrate algorithms which perform a modular multiplication and derive asymptotical lower bounds for these.

While many algorithms have lower asymptotic complexity than the KA the later one shows better performance for polynomials of small degree as they are used in many applications. In this paper we show in detail how to use the KA in an efficient way, both iteratively and recursively. We provide methods and tables to ease this task, and give a detailed count of the numbers of elementary additions and multiplications needed. We also show that for many polynomials using the KA needs less multiplications and additions than the schoolbook method. The work is organized as follows. Section 2 introduces the KA. Section 3 extends the KA for polynomials of arbitrary degree in one iteration, and Section 4 enhances the KA to recursive use. Section 5 describes the complexity of the KA when using it for squaring. Section 6 improves the KA by using dummy coefficients, and Section 7 provides the conclusion.

### 2 Preliminaries: Karatsuba Algorithm

Let R be a ring. Let A(x) and B(x) be degree-d polynomials over R. The Karatsuba Algorithm (KA) describes a method to multiply two polynomials with coefficients in R. There are two ways to derive the KA: the Chinese Remainder Theorem [1] and simple algebraic transformations. The KA can easily be applied recursively for polynomials which have 2<sup>i</sup> coefficients. But first we show an example of the schoolbook method.

#### 2.1 Schoolbook Method

The usual way to multiply two polynomials is often called the schoolbook method. Consider two degree-d polynomials with n = d + 1 coefficients:

$$A(x) = \sum_{i=0}^{d} a_i x^i, \ B(x) = \sum_{i=0}^{d} b_i x^i$$

Then the product C(x) = A(x) B(x) is calculated as

$$C(x) = \sum_{i=0}^{d} x^{i} \cdot \left(\sum_{s+t=i; s, t \ge 0} a_{s} b_{t}\right) = \sum_{i=0}^{d} \sum_{j=0}^{d} a_{i} b_{j} x^{i+j}$$
(1)

The polynomial C(x) can be obtained with n <sup>2</sup> multiplications and (n − 1)<sup>2</sup> additions.

#### 2.2 KA for Degree-1 Polynomials

The KA for degree-1 polynomials was introduced by Karatsuba in [2]. We will now develop the KA through simple algebraic manipulations. Consider two degree-1 polynomials A(x) and B(x).

$$A(x) = a_1 x + a_0, \ B(x) = b_1 x + b_0$$

Let D0, D1, D0,<sup>1</sup> be auxiliary variables with

$$D_0 = a_0b_0, D_1 = a_1b_1, D_{0,1} = (a_0 + a_1)(b_0 + b_1)$$

Then the polynomial C(x) = A(x) B(x) can be calculated in the following way:

$$C(x) = D_1 x^2 + (D_{0,1} - D_0 - D_1)x + D_0$$

We need four additions and three multiplications to compute C(x). Using the schoolbook method we need four multiplications and one addition, thus we save one multiplication and need three extra additions.

For application in practice, e.g., multi-precision multiplication we are interested in the particular value of the ratio between the cost of one multiplication and one addition for which the KA is efficient. Let r be the ratio between the cost of one multiplication and one addition on a specific implementation platform. Then r = tm/t<sup>a</sup> where t<sup>m</sup> and t<sup>a</sup> denote the cost of one multiplication and one addition, respectively. The cost for the schoolbook method c<sup>s</sup> can be calculated as c<sup>s</sup> = 1t<sup>a</sup> + 4tm. The cost of the KA can be similarly obtained as c<sup>k</sup> = 4t<sup>a</sup> + 3tm. We want to know the ratio r when the cost of the KA is less than for the schoolbook method. Therefore we obtain c<sup>k</sup> < c<sup>s</sup> ⇔ 4t<sup>a</sup> + 3t<sup>m</sup> < 1t<sup>a</sup> + 4t<sup>m</sup> ⇔ 3 < r. If the ratio between the cost of one multiplication and one addition is greater than three it is more efficient to use the KA.

#### 2.3 Recursive KA for Polynomials of Degree 2 <sup>i</sup> − 1

The KA can be applied in a recursive way as shown in Algorithm 1. This is straightforward for polynomials whose number of coefficients n is a power of 2. To apply the algorithm both polynomials are split into a lower and an upper half.

$$A(x) = A_u(x)x^{n/2} + A_l(x), \ B(x) = B_u(x)x^{n/2} + B_l(x)$$

These halfs are used as before, i.e., as if they were coefficients. The algorithm becomes recursive if it is applied again to multiply these polynomial halfs. The next iteration step splits these polynomials again in half. The algorithm eventually terminates after t steps. In the final step the polynomials degenerate into single coefficients. Since every step exactly halves the number of coefficients, the algorithm terminates after t = log<sup>2</sup> n steps. Let #MUL and #ADD be the number of multiplications and additions in the underlying ring. Then the complexity to multiply two polynomials with n coefficients is as follows [6]:

$$\#\text{MUL} = n^{\log_2 3}$$

$$\#\text{ADD} \le 6n^{\log_2 3} - 8n + 2$$

Algorithm 1 Recursive KA, C = KA(A, B)

INPUT: Polynomials A(x) and B(x)

OUTPUT: C(x) = A(x) B(x)

N = max(degree(A), degree(B)) + 1

if N == 1 return A · B

Let A(x) = Au(x) x N/<sup>2</sup> + Al(x)

and B(x) = Bu(x) x N/<sup>2</sup> + Bl(x)

D<sup>0</sup> = KA(A<sup>l</sup> , Bl)

D<sup>1</sup> = KA(Au, Bu)

D0,<sup>1</sup> = KA(A<sup>l</sup> + Au, B<sup>l</sup> + Bu)

return D1x <sup>N</sup> + (D0,<sup>1</sup> − D<sup>0</sup> − D1)x N/<sup>2</sup> + D<sup>0</sup>

### 3 One-Iteration KA for Polynomials of Arbitrary Degree

As mentioned above it is straightforward to apply the KA to polynomials which have 2<sup>i</sup> , i positive integer, coefficients (if i > 1, we apply the KA recursively). However, it is not obvious how to apply the KA to polynomials with a number of coefficients which has the form  $2^j$  n, with j a non-negative integer and n an odd integer, n > 1. Even though the original trick can be applied j times, the problem of multiplying polynomials with n coefficients remains. In particular if j = 0, i.e., if the number of coefficients is odd, the classical KA cannot be applied in a straight forward manner. We start by giving a simple example. Then a general algorithm is provided, followed by a complexity analysis.

#### 3.1 KA for Degree-2 Polynomials

Consider two degree-2 polynomials:

$$A(x) = a_2x^2 + a_1x + a_0, \ B(x) = b_2x^2 + b_1x + b_0$$

with the auxiliary variables

$$D_0 = a_0b_0, \ D_1 = a_1b_1, \ D_2 = a_2b_2$$

 $D_{0.1} = (a_0 + a_1)(b_0 + b_1), \ D_{0.2} = (a_0 + a_2)(b_0 + b_2), \ D_{1.2} = (a_1 + a_2)(b_1 + b_2)$

C(x) = A(x) B(x) is computed with an extended version of the KA

$$C(x) = D_2 x^4 + (D_{1,2} - D_1 - D_2)x^3 + (D_{0,2} - D_2 - D_0 + D_1)x^2 + (D_{0,1} - D_1 - D_0)x + D_0$$

We need 13 additions and 6 multiplications. Using the schoolbook method we needs 4 additions and 9 multiplications. Let us take a look at the ratio r. We obtain  $c_k < c_s \Leftrightarrow 13t_a + 6t_m < 4t_a + 9t_m \Leftrightarrow 3 < r$ . If r > 3 it is more efficient to use the KA for degree-2 polynomials.

#### 3.2 KA for Polynomials of Arbitrary Degree

The following algorithm describes a method to multiply two arbitrary polynomials with n coefficients using a one-iteration KA.

**Algorithm 2** Consider two degree-d polynomials with n = d + 1 coefficients

$$A(x) = \sum_{i=0}^{d} a_i x^i, \ B(x) = \sum_{i=0}^{d} b_i x^i$$

Compute for each i = 0, ..., n-1

$$D_i := a_i b_i \tag{2}$$

Calculate for each  $i=1,\ldots,2n-3$  and for all s and t with s+t=i and  $t>s\geq 0$

$$D_{s,t} := (a_s + a_t) \ (b_s + b_t) \tag{3}$$

Then C(x) = A(x)  $B(x) = \sum_{i=0}^{2n-2} c_i x^i$  can be computed as

$$c_0 = D_0 \tag{4}$$

$$c_{2n-2} = D_{n-1} (5)$$

$$c_{i} = \begin{cases} \sum_{s+t=i; t>s \geq 0} D_{s,t} - \sum_{s+t=i; n>t>s \geq 0} (D_{s} + D_{t}) & \text{for odd } i, \ 0 < i < 2n-2 \\ \sum_{s+t=i; t>s \geq 0} D_{s,t} - \sum_{s+t=i; n>t>s \geq 0} (D_{s} + D_{t}) + D_{i/2} & \text{for even } i, \ 0 < i < 2n-2 \end{cases}$$

Correctness of the algorithm First we prove (6) for odd i and then for even i. Using (1) we obtain

$$c_i = \sum_{s+t=i; s, t > 0} a_s b_t$$

Now consider some  $D_{s,t}$ . Each  $D_{s,t}$  is calculated as  $(a_s + a_t)$   $(b_s + b_t) = a_s b_s + a_s b_t + a_t b_s + a_t b_t$  with s + t = i and  $t > s \ge 0$ . The sum  $\sum_j D_{s,t}$  consists of all combinations of coefficients  $a_s b_t$  with s + t = i and  $s \ne t$ , and all  $a_s b_s$  and  $a_t b_t$  where s, t are summands of i = s + t. We must subtract all of the latter products, which were denoted by  $D_s$ .

$$\sum_{j} D_{s,t} = \sum_{s+t=i; t>s \ge 0} (a_s b_s + a_s b_t + a_t b_s + a_t b_t) = \sum_{s+t=i; t>s \ge 0} (a_s b_t + a_t b_s) + \sum_{s+t=i; t>s \ge 0} (a_s b_s + a_t b_t)$$

This can be re-written as

$$\sum_{j} D_{s,t} = \sum_{s+t=i; t>s \ge 0} a_s b_t + \sum_{s+t=i; t>s \ge 0} a_s b_s = c_i + \sum_{s+t=i; t>s \ge 0} D_s$$

with  $s \neq t$  for odd i. For even i there are two products  $a_s b_s$  for s = t = i/2 in the sum  $D_{s,t}$ , such that we have to take care of the extra product:

$$\sum_{j} D_{s,t} = \sum_{s+t=i;t>s>0} a_s b_t + \sum_{s+t=i;t>s>0} a_s b_s = (c_i - D_{i/2}) + \sum_{s+t=i;t>s>0} D_s$$

These equations can easily be transformed to (6). Equations (4) and (5) are special cases of (6) for even i, which ends the proof.

#### 3.3 Complexity of KA for Arbitrary Polynomials

In order to determine the number of additions and multiplications we first analyze the number of auxiliary variables  $D_i$  and  $D_{s,t}$ , denoted by  $\#D_i$  and  $\#D_{s,t}$ .

**Lemma 1** Let A(x), B(x) and C(x) be defined as in Algorithm 1, and the variables  $D_i$  and  $D_{s,t}$  as defined in (2) and (3), respectively. The numbers of auxiliary variables is then given as:

$$#D_{i} = n$$

$$#D_{s,t} = \frac{1}{2}n^{2} - \frac{1}{2}n$$

$$#D = #D_{i} + #D_{s,t} = \frac{1}{2}n^{2} + \frac{1}{2}n$$

**Proof** We calculate for each i = 0, ..., n-1 an auxiliary variable  $D_i$ , therefore we need n variables  $D_i$ . The number of variables  $D_{s,t}$  can be determined as follows. Each  $D_{s,t}$  describes one pair of coefficients  $a_s$ ,  $a_t$ . Each possible pair occurs once. Therefore the number of possible pairs out of n elements is  $\binom{n}{2}$  and we obtain  $D_{s,t} = \binom{n}{2} = \frac{1}{2}n^2 - \frac{1}{2}n$ .

Corollary 1 Let #MUL and #ADD be the number of multiplications and additions, respectively, needed to multiply two polynomials with n coefficients using the KA. Then using the extended KA we need one multiplication for determining each variable  $D_i$  and  $D_{s,t}$ , which results in

$$\#MUL = \frac{1}{2}n^2 + \frac{1}{2}n$$

|    | K    | A    | schoo |      |   |
|----|------|------|-------|------|---|
| n  | #MUL | #ADD | #MUL  | #ADD | r |
| 2  | 3    | 4    | 4     | 1    | 3 |
| 3  | 6    | 13   | 9     | 4    | 3 |
| 5  | 15   | 46   | 25    | 16   | 3 |
| 7  | 28   | 99   | 49    | 36   | 3 |
| 11 | 66   | 265  | 121   | 100  | 3 |

Table 1: Comparison of the KA and the schoolbook method for small primes.

multiplications.

We need two additions to obtain an auxiliary variable  $D_{s,t}$  resulting in 2  $\#D_{s,t}$  additions. Furthermore, we need 2 additions to determine  $c_{n-2}$ ,  $c_{n-3}$ ,  $c_1$  and  $c_2$ , 5 additions for  $c_{n-4}$ ,  $c_{n-5}$ ,  $c_3$  and  $c_4$  and so on. So we need  $4 \cdot (3i-1)$  additions for determining all  $c_i$  (one term must be removed for  $i = \frac{n}{2}$ ). For each even i we need a further addition. This results in

$$#ADD = 2#D_{s,t} + 4\sum_{i=1}^{(n-1)/2} (3i-1) - (3\frac{n-1}{2} - 1) + (n-1) - 1 = \frac{5}{2}n^2 - \frac{7}{2}n + 1$$

For large n, the one-iteration KA approaches  $0.5 n^2$  coefficient multiplications, which is about half as many as the schoolbook method. The number of additions approaches  $2.5 n^2$ , which is more than the  $n^2$  of the schoolbook method. Note that KA is efficient if the ratio between multiplication and addition on a given platform is larger than 3. This is due to the fact that

$$c_k < c_s \Leftrightarrow (1/2n^2 + 1/2n)t_m + (5/2n^2 - 7/2n + 1)t_a < n^2t_m + (n-1)^2t_a \Leftrightarrow r > 3$$

Since r = 3 for n = 2 this is a sharp bound.

For short polynomials, especially for those with a prime number of coefficients (where a recursive application of the basic KA is not straightforward), the method can yield complexities which are relevant in applications. Table 1 shows a few expected values.

## 4 Recursive Application of the KA

We can use the KA in a recursive way to decrease the number of operations. First we show the complexity of a simple extension to the basic recursive KA. Then we show how two polynomials with  $n \cdot m$  coefficients can be multiplied using a simple one-step recursion of the KA. We will divide the polynomial into m polynomials each with n coefficients and use the KA for m polynomials, i.e., we consider the original polynomial to have m coefficients. To multiply these, the KA for n coefficients is used in the recursive step. We will write "KA for  $n \cdot m$ " coefficients to mean that the KA for m coefficients was used on polynomials with n coefficients. These n coefficient polynomials, in turn, are multiplied using the KA for n coefficients. Furthermore we will determine a method to multiply polynomials with  $\prod_{i=1}^{j} n_i$  coefficients by recursion.

#### 4.1 Recursive KA for Arbitrary Polynomials

If the number of coefficients n is no power of 2 Algorithm 1 is slightly altered by splitting the polynomials into a lower part of  $\lceil N/2 \rceil$  coefficients and upper part of  $\lceil N/2 \rceil$  coefficients. We call

this the simple recursive KA. In this case the KA is less efficient than for powers of 2. A lower bound for the number of operations is given by the complexity of the KA for n = 2<sup>i</sup> coefficients as described in Section 2.3. Thus the lower bound for the number of multiplications is #MULlow = n log<sup>2</sup> 3 whereas the lower bound for the number of additions is #ADDlow = 6n log2<sup>3</sup> − 8n + 2. We obtain the upper bound by empirical tests as #MULup = 1.39 n log<sup>2</sup> 3 . When applying the one-iteration KA for two and three coefficients as basis of the recursion, i.e. when applying the KA for two and three coefficients as final recursion step by adding the recursion basis #MUL<sup>3</sup> = 6, the upper bound improves to #MULup = 1.24 n log<sup>2</sup> 3 . When applying the one-iteration KA for two, three, and nine coefficients as basis of the recursion, the upper bound further improves to

$$\#MUL_{up} = 1.20 \ n^{\log_2 3}.$$

The number of additions in the worst case, i.e., the upper bound can be obtained in a similar fashion.

$$\# ADD_{1} = 0, \ \# ADD_{2} = 4$$

$$\# ADD_{n} = 2 \# ADD_{\lceil n/2 \rceil} + \# ADD_{\lfloor n/2 \rfloor} + 2 \lfloor n/2 \rfloor$$
recursive application of KA calculation of  $D_{s,t}$

$$+ 2 \lfloor n/2 \rfloor + 2 \lceil n/2 \rceil - 2 + 2 \lceil n/2 \rceil - 2$$
addition of auxiliary variables overlaps
$$= 2 \# ADD_{\lceil n/2 \rceil} + \# ADD_{\lfloor n/2 \rfloor} + 4(n-1)$$

When applying the one-iteration KA for two and three coefficients as basis of the recursion, the anchor #ADD<sup>3</sup> = 13 is included. An upper bound of additions is then obtained as

$$\#ADD_{up} = 7 n^{\log_2 3}.$$

#### 4.2 KA for Degree-5 Polynomials

Consider the two polynomials

$$A(x) = a_5 x^5 + a_4 x^4 + a_3 x^3 + a_2 x^2 + a_1 x + a_0$$
$$B(x) = b_5 x^5 + b_4 x^4 + b_3 x^3 + b_2 x^2 + b_1 x + b_0$$

Then A(x) and B(x) can be written as

$$A(x) = A_1(x)x^3 + A_0, \ B(x) = B_1(x)x^3 + B_0$$

with

$$A_1(x) = a_5 x^2 + a_4 x + a_3, \ A_0(x) = a_2 x^2 + a_1 x + a_0$$

 $B_1(x) = b_5 x^2 + b_4 x + b_3, \ B_0(x) = b_2 x^2 + b_1 x + b_0$

Now we apply the KA for degree-1 polynomials. Notice that the coefficients of the polynomials Ai(x) and Bi(x) are themselves polynomials and the multiplications of these coefficients result in further applications of the KA for degree-2 polynomials. In the following, we drop the notation <sup>00</sup>(x) <sup>00</sup> for convenience.

$$D_0 = A_0 B_0, \ D_1 = A_1 B_1, \ D_{0,1} = (A_0 + A_1) \ (B_0 + B_1)$$

| Method             | Multiplications #MUL | Additions #ADD |
|--------------------|----------------------|----------------|
| KA for $3 \cdot 2$ | 18                   | 59             |
| KA for $2 \cdot 3$ | 18                   | 61             |

Table 2: Costs for multiplying degree-5 polynomials.

Thus, we obtain

$$C(x) = D_1 x^6 + (D_{0,1} - D_0 - D_1)x^3 + D_0$$

The KA for degree-1 polynomials needs four additions and three multiplications of degree-2 polynomials. Each multiplication is solved by the KA for degree-2 polynomials for which we need 13 additions and 6 multiplications. The number of additions must be carefully analyzed. In order to determine the auxiliary variables  $D_{s,t}$  we need two additions of degree-3 polynomials. Two degree-d polynomials can be added by adding all n = d + 1 coefficients. Furthermore two degree-5 polynomials have to be added. Notice that there are some overlaps resulting in four further additions. As an example for the overlaps look at  $D_0$  and  $(D_{0,1} - D_0 - D_1)x^3$ . The first polynomial has degree-4, the second one degree-7. To determine  $c_3$  and  $c_4$  we have to add coefficients from the first and second polynomial. Overall we need 18 multiplications and 59 additions.

For polynomials with 6 coefficients the KA is not unique. Above, we first applied the KA for 2 and then for 3 coefficients. One can also first use the KA for 3 and then for 2 coefficients. The needed operations can be calculated with similar arguments as above. The number of operations for both possibilities are depicted in Table 2. The first example is for the KA for  $3 \cdot 2$ , meaning that first the KA for 2 polynomials where the coefficients themselves are polynomials with 3 coefficients is used. The second example is the KA for  $2 \cdot 3$  in which case the KA is used for polynomials for 3 polynomials where the coefficients themselves are polynomials with 2 coefficients. Notice that the number of multiplications is the same for both approaches. We will see that this is always true. We will also show that it is always more efficient to apply the KA for  $n \cdot m$  than for  $m \cdot n$  if n > m.

#### 4.3 KA for Polynomials with $n \cdot m$ Coefficients

This section analyzes the complexity of the KA with a single step recursion. Let  $A(x) = \sum_{i=0}^{nm-1} a_i x^i$ . This can be written as  $A(x) = \sum_{s=0}^{m-1} A_s(x) x^{ns}$  where  $A_s(x)$  are degree-(n-1) polynomials. B(x) can be written in the same way. The KA is applied to the polynomials A(x) and B(x) that are considered to have m coefficients. In the recursive step the KA is applied to the polynomials with n coefficients and merged at the end. The number of additions needed for the KA for polynomials with n coefficients is denoted by  $\# ADD_n$ , the number of multiplications with  $\# MUL_n$ . Let  $\# (D_{s,t})_n$  be the number of auxiliary variables  $D_{s,t}$  needed for the KA for n coefficients. When applying the KA for m coefficients, we need  $\# MUL_m$  multiplications. Each one of these m multiplications requires  $\# MUL_n$  multiplications. This results in

$$\#\text{MUL}_{n \cdot m} = \#\text{MUL}_m \cdot \#\text{MUL}_n = \left(\frac{1}{2}m^2 + \frac{1}{2}m\right) \cdot \left(\frac{1}{2}n^2 + \frac{1}{2}n\right)$$

Notice that the order of the recursion does not make any difference thus far.

The number of additions is achieved from the recursive application of the KA: the number of additions to build the variables  $D_{s,t}$ , the additions of the variables  $D_i$  and  $D_{s,t}$  and the number of overlaps. For each recursive application of the KA we need  $\#ADD_n$  additions, overall  $\#MUL_m \cdot \#ADD_n$  additions. We need two additions for polynomials with n coefficients to build a variable  $D_{s,t}$ , altogether  $2n \cdot (\#D_{s,t})_m$  additions. Furthermore  $(\#ADD_m - 2(\#D_{s,t})_m)$  additions of the

variables  $D_{s,t}$  are needed, each of it having (2n-1) coefficients. Finally we have to consider the overlaps resulting in  $((2m-1)\cdot(2n-1)-(2nm-1))$  additions. Overall we obtain

#ADD<sub>n·m</sub> = #MUL<sub>m·#</sub>ADD<sub>n</sub> +
$$2n \cdot (\#D_{s,t})_m$$
recursive application of KA calculation of  $D_{s,t}$
+  $(2n-1) \cdot (\#ADD_m - 2(\#D_{s,t})_m)$  +  $((2m-1) \cdot (2n-1) - (2nm-1))$
addition of auxiliary variables overlaps

This results in

$$\#ADD_{n \cdot m} = \frac{5}{4}m^2n^2 + \frac{5}{4}mn^2 + \frac{9}{4}m^2n - \frac{23}{4}mn - m^2 + m + 1$$
 (7)

Now we will prove that it is more efficient to use the KA for  $n \cdot m$  with  $n \ge m$ . Since the number of multiplications is identical we only have to prove that this holds for the number of additions.

**Lemma 2** Let  $n \ge m$  and  $n, m \ge 2$ . The number of additions for the KA for  $n \cdot m$  is not greater than the number of additions for the KA for  $m \cdot n$ , i.e.,  $\#ADD_{n \cdot m} \le \#ADD_{m \cdot n}$ .

**Proof** Let  $n \geq m \geq 2$ . Assume that  $\#ADD_{m \cdot n} < \#ADD_{n \cdot m}$ . Then

$$\frac{5}{4}m^{2}n^{2} + \frac{5}{4}nm^{2} + \frac{9}{4}n^{2}m - \frac{23}{4}nm - n^{2} + n + 1$$

$$< \frac{5}{4}m^{2}n^{2} + \frac{5}{4}mn^{2} + \frac{9}{4}m^{2}n - \frac{23}{4}nm - m^{2} + m + 1$$

$$\Rightarrow \frac{5}{4}nm^{2} + \frac{9}{4}m^{2}m - n^{2} + n + 1 < \frac{5}{4}mn^{2} + \frac{9}{4}m^{2}n - m^{2} + m + 1$$

$$\Rightarrow n^{2}(m-1) - n(m-1)(m+1) < (m-1)(-m)$$

$$\Rightarrow (1-n) \cdot (m-n) < 0 \Rightarrow m-n > 0 \Rightarrow n < m$$

This is a contradiction and hence  $\#ADD_{n \cdot m} \leq \#ADD_{m \cdot n}$  for  $n \geq m$ .

### 4.4 KA for Polynomials with $\prod_{i=1}^{j} n_i$ Coefficients

We will determine the number of additions and multiplications needed when using the KA recursively for arbitrary polynomials with  $\prod_{i=1}^{j} n_i$  coefficients. We call this KA version the general recursive KA. To be exact, we consider polynomials with a maximum degree of  $\prod_{i=1}^{j} n_i - 1$ . Consider two such polynomials A(x) and B(x) with  $\prod_{i=1}^{j} n_i$  coefficients. First we write  $A(x) = \sum_{s=0}^{n_j-1} A_s x^{s} \cdot \prod_{i=1}^{j-1} n_i$  as polynomial with  $n_j$  coefficients  $A_i$  and do the same for B(x). Each of these "coefficients" is itself a polynomial with  $\prod_{i=1}^{j-1} n_i$  coefficients. Then we use the KA for  $n_j$ . To obtain the number of multiplications we repeatedly apply the KA. The method introduced in Section 4.3 for  $n \cdot m$  coefficients is a special case of this one.

In each application of the KA there are  $\#MUL_{n_i}$  multiplications needed

$$\#\text{MUL}_{\prod_{i=1}^{j} n_i} = \prod_{i=1}^{j} \left(\frac{1}{2} n_i^2 + \frac{1}{2} n_i\right) = \left(\frac{1}{2}\right)^j \prod_{i=1}^{j} n_i (n_i + 1)$$
 (8)

Again, the number of multiplications is independent of the order of the recursion. The number of additions can be developed as follows. We introduce a term  $w_l$ ,  $l = 1 \dots j$ , where j is the recursion depth, which describes the number of additions for one recursive application. This includes the

additions to build  $D_{s,t}$ , to add all auxiliary variables, and it takes into account the overlaps. We comprise the last three points to

$$w_{l} = w_{(\prod_{i=1}^{l-1} n_{i})n_{l}} = 2 \prod_{i=1}^{l-1} n_{i} \cdot (\#D_{s,t})_{n_{l}}$$

$$\text{calculation of } D_{s,t}$$

$$+ (2 \prod_{i=1}^{l-1} n_{i} - 1) \cdot (\#ADD_{n_{l}} - 2(\#D_{s,t})_{n_{l}})) + ((2n_{l} - 1) \cdot (2 \prod_{i=1}^{l-1} n_{i} - 1) - (2 \prod_{i=1}^{l} n_{i} - 1))$$

$$\text{addition of auxiliary variables}$$
overlaps

describing the number of additions for the KA for  $n_l$  polynomials with  $\prod_{i=1}^{l-1} n_i$  coefficients without looking at the recursion. This can be simplified to

$$w_l = 4 \cdot \prod_{i=1}^{l} n_i \cdot (n_l - 1) - \frac{3}{2} n_l^2 + \frac{1}{2} n_l + 1$$

Moreover we need to look at the additions required for the recursion and define the number of additions recursively

$$\#ADD_{\prod_{i=1}^{j} n_i} = w_j + \#MUL_{n_j} \cdot \#ADD_{\prod_{i=1}^{j-1} n_i}$$

with initial condition

$$\#ADD_{n_1} = \frac{5}{2}n_1^2 - \frac{7}{2}n_1 + 1.$$

Using (7) this recursion can be transformed to

$$\#ADD_{\prod_{i=1}^{j} n_i} = \prod_{i=3}^{j} \#MUL_{n_i} \cdot \#ADD_{n_1 \cdot n_2} + \sum_{l=3}^{j-1} (\prod_{i=l+1}^{j} \#MUL_{n_i} \cdot w_l) + w_j$$

or

$$\#ADD_{\prod_{i=1}^{j} n_i} = \prod_{i=2}^{j} \#MUL_{n_i} \cdot \#ADD_{n_1} + \sum_{l=2}^{j-1} (\prod_{i=l+1}^{j} \#MUL_{n_i} \cdot w_l) + w_j$$
 (9)

**Theorem 1** Let  $n_i$  be integer values with  $n_i \geq 2$ . Then the application of the KA for  $\prod_{i=1}^{j} n_i$  is most efficient (i.e., it needs the least number of additions and multiplications) for a permutation of  $(n_i)_{i \in \{1,...,j\}}$  with  $n_i \geq n_{i+1}$  for  $1 \leq i \leq j-1$ .

**Proof** The number of multiplications is independent of the order of the recursion steps and needs not to be considered. Let  $n_1, \ldots, n_j$  be a sequence n with  $n_i \leq n_{i+1}$  for  $i = 1, \ldots, j-1$ . Let t = s+1 and  $n'_1, \ldots, n'_j$  be another sequence n' with  $n'_s = n_t, n'_t = n_s$  and  $n'_i = n_i$  otherwise. We will show that the recursive KA for the sequence n' needs at least the same number of additions as the recursive KA for the sequence n. Since each sequence can be determined by changing adjacent elements, i.e., elements which are next to each other, the recursive KA for the original sequence n is most efficient. We only look at  $j \geq 3$ . For j = 2 see Lemma 2.

Let  $w_i'$  be the value  $w_{(\prod_{j=1}^{i-1} n_j')n_i'}$ . To compare the number of additions we only look at the values that differ in the two sequences. Then  $w_s' \leq w_s$ ,  $w_s \leq w_t$ ,  $w_t \leq w_t'$ ,  $w_t' \leq w_s'$  and  $w_i = w_i'$  otherwise. Furthermore  $n_s' = n_t$ ,  $n_t' = n_s$ ,  $n_s' \leq n_t'$  and  $n_t \leq n_s$ . We want to prove by applying (9) that

$$\#ADD_{\prod_{i=1}^{j} n_i} \leq \#ADD_{\prod_{i=1}^{j} n'_i}$$

Since most of the values in the sequence are identical we only have to prove that

$$w'_{s} \# MUL_{n_{j}} \# MUL_{n_{j-1}} \cdot \ldots \cdot \# MUL_{n'_{s+1}} + w'_{t} \# MUL_{n_{j}} \# MUL_{n_{j-1}} \cdot \ldots \cdot \# MUL_{n'_{t+1}}$$

  $\geq w_{s} \# MUL_{n_{j}} \# MUL_{n_{j-1}} \cdot \ldots \cdot \# MUL_{n_{s+1}} + w_{t} \# MUL_{n_{j}} \# MUL_{n_{j-1}} \cdot \ldots \cdot \# MUL_{n_{t+1}}$

We note that n 0 <sup>s</sup>+1 = n 0 <sup>t</sup> and n 0 <sup>t</sup>+1 = nt+1. We simplify this to

$$w_s' \cdot \#\text{MUL}_{n_t'} \ge w_s \cdot \#\text{MUL}_{n_t}$$

and obtain

$$(4(n_{1} \cdot n_{2} \cdot \ldots \cdot n_{s-1} \cdot n'_{s}) \cdot (n'_{s} - 1) - \frac{3}{2}n'_{s}^{2} + \frac{1}{2}n'_{s} + 1) \cdot (\frac{1}{2}n'_{t}^{2} + \frac{1}{2}n_{t})$$

$$\geq (4(n_{1} \cdot n_{2} \cdot \ldots \cdot n_{s-1} \cdot n_{s}) \cdot (n_{s} - 1) - \frac{3}{2}n_{s}^{2} + \frac{1}{2}n_{s} + 1) \cdot (\frac{1}{2}n_{t}^{2} + \frac{1}{2}n_{t})$$

$$\Leftrightarrow (4(n_{1} \cdot n_{2} \cdot \ldots \cdot n_{s-1} \cdot n_{t}) \cdot (n_{t} - 1) - \frac{3}{2}n_{t}^{2} + \frac{1}{2}n_{t} + 1) \cdot (\frac{1}{2}n_{s}^{2} + \frac{1}{2}n_{s})$$

$$\geq (4(n_{1} \cdot n_{2} \cdot \ldots \cdot n_{s-1} \cdot n_{s}) \cdot (n_{s} - 1) - \frac{3}{2}n_{s}^{2} + \frac{1}{2}n_{s} + 1) \cdot (\frac{1}{2}n_{t}^{2} + \frac{1}{2}n_{t})$$

This can be simplified to

$$n_{s} \cdot n_{t} \cdot \left(\frac{1}{4}n_{s} - \frac{3}{4}n_{t}\right) - n_{s}^{2} + n_{s} \ge n_{t} \cdot n_{s} \cdot \left(\frac{1}{4}n_{t} - \frac{3}{4}n_{s}\right) - n_{t}^{2} + n_{t}$$

$$\Leftrightarrow n_{s}^{2}n_{t} - n_{t}^{2}n_{s} + n_{t}^{2} - n_{s}^{2} - n_{s} - n_{t} \ge 0$$

$$\Leftrightarrow (n_{s} - n_{t}) \cdot (n_{s}n_{t} + 1 - n_{t} - n_{s}) \ge 0$$

Since n<sup>s</sup> ≥ n<sup>t</sup> ≥ 2 and nsn<sup>t</sup> > n<sup>t</sup> + n<sup>s</sup> for ns, n<sup>t</sup> ≥ 2 this is always true. ✷

#### 4.5 How to Apply KA with the Least Cost

It was shown above that for a sequence <sup>n</sup><sup>i</sup> the KA for <sup>Q</sup> <sup>i</sup> n<sup>i</sup> coefficients is most efficient when n<sup>i</sup> ≥ ni+1. We will now show that it is more efficient to apply the KA recursively than only once. Let k be the non-prime number of coefficients. Since k is not prime it can be written as k = n · m and n, m 6= k. We compare using the KA for k and for n · m coefficients. Since we use the KA recursively proving that the one-step recursion is more efficient than no recursion results immediately in the law to use the KA for the factorization of k with multiple prime factors.

Theorem 2 Let k = Q i pi <sup>e</sup><sup>i</sup> with <sup>p</sup><sup>i</sup> prime. Then the general recursive KA for <sup>Q</sup> i Qe<sup>i</sup> <sup>j</sup>=1 p<sup>i</sup> with p<sup>i</sup> ≥ pi+1 results in the least number of operations.

Proof Let n ≥ m ≥ 2. First we compare the number of multiplications of the KA for k and n · m = k coefficients.

#MUL<sub>k</sub> =
$$\frac{1}{2}(nm)^2 + \frac{1}{2}nm$$

#MUL<sub>n·m</sub> =  $\frac{1}{4}(n^2 + n)(m^2 + m)$

We will show that #MULn·<sup>m</sup> ≤ #MUL<sup>k</sup>

$$\frac{1}{4}n^2m^2 + \frac{1}{4}nm^2 + \frac{1}{4}n^2m + \frac{1}{4}nm \le \frac{1}{2}n^2m^2 + \frac{1}{2}nm$$

$$\Leftrightarrow \frac{1}{4}nm^2 + \frac{1}{4}n^2m \le \frac{1}{4}n^2m^2 + \frac{1}{4}nm \Leftrightarrow m+n \le nm+1$$

Since  $m+n \leq mn$  for  $n,m \geq 2$  this is true. Now we compare the number of additions.

#ADD<sub>k</sub> =
$$\frac{5}{2}n^2m^2 - \frac{7}{2}nm + 1$$

#ADD<sub>n·m</sub> =  $\frac{5}{4}n^2m^2 + \frac{5}{4}n^2m + \frac{9}{4}m^2n - \frac{23}{4}mn - m^2 + m + 1$

Then

$$\#ADD_{n \cdot m} \le \#ADD_k \Leftrightarrow 5n^2 + 9mn - 4m + 4 \le 5n^2m + 9n$$

This can be proven by induction on n with arbitrary m.

Basis  $n = 2, m \le n$  implies m = 2:

$$5 \cdot 4 + 9 \cdot 2m - 4m + 4 = 24 + 14m = 52 \le 58 = 20m + 18 = 5 \cdot 4m + 18$$

Assume the assertion holds for  $k \leq n$ . Then we prove it for n+1

$$5(n+1)^2 + 9m(n+1) - 4m + 4 = 5n^2 + 9mn - 4m + 4 + 10n + 5 + 9m \le 5n^2m + 9n + 10n + 5 + 9m \le 5n^2m + 9n + 9 + 10(n+m) + m \le 5n^2m + 9n + 9 + 10nm + m \le 5(n+1)^2m + 9(n+1)$$

П

This results in a simple rule on how to use the general recursive KA: use the factorization of a number k with multiple prime factors combined with an increasing sequence of steps, i.e., KA for  $k = \prod_{i=1}^{j} n_i$  with  $n_i \geq n_{i+1}$ , e.g.,  $2 \cdot 2 \cdot 3 \cdot 5$  for polynomials with 60 coefficients. However, a number of intermediate results has to be stored due to the recursive nature. This might reduce the efficiency for small-sized polynomials. As we showed in Section 3.3 the threshold value r for the KA to be efficient is always 3 for the one-iteration KA. Since we proved that the recursive KA is more efficient than the one-iteration KA it is obvious that  $r \leq 3$  always holds. Appendix A displays the least number of operations needed to multiply two polynomials with the KA for polynomials with  $n \in [2,128]$  coefficients. There are two sections. The first one displays numbers for the general recursive KA as described in Section 4.4 while the second one describes numbers for the simple recursive KA as introduced in Section 4.1. The first column "n" displays the number of coefficients of the polynomials. The second column "distribution" displays how to use the KA for n coefficients (as mentioned above these are the prime factors in declining order). The next columns denote the number of multiplications and additions. The following column gives the ratio

$$r = \frac{\text{\#ADD} - (n-1)^2}{n^2 - \text{\#MUL}}.$$

If the time ratio r' between a multiplication and an addition on a given platform is larger than this r, then the KA is efficient. Note that very small values occur for values of n which largest prime factor is still small, while negative values for r occur if the KA needs less multiplications and additions than the schoolbook method. The very last column "opt(r)" describes which KA version results in a better value r, i.e., has smaller r. We use this as an indicator for a better performance. One can see that the simple recursive KA often outperforms the general recursive KA, especially when n has not only small prime factors. When the number of coefficients is unknown at implementation time or changes permanently it is wise to use the simple recursive KA since it is more efficient in most cases and easier to implement. There are more variants of the KA that might be considered for a fixed-size polynomial multiplication. For example, instead of using the one-iteration KA for

| p | #ADD                                               |
|---|----------------------------------------------------|
| 2 | log2<br>3 −<br>6n<br>8n<br>+ 2                     |
| 3 | 29<br>11<br>log3<br>6 −<br>n<br>8n<br>+<br>5<br>5  |
| 5 | 39<br>17<br>log5<br>15 −<br>n<br>8n<br>+<br>7<br>7 |
| 7 | 49<br>23<br>log7<br>28 −<br>n<br>8n<br>+<br>9<br>9 |

Table 3: Values #MUL<sup>n</sup> for n = p j .

n = 31 coefficients you can use the recursive KA and split the 31 coefficient polynomial into two polynomials of 15 and 16 coefficients, respectively. Alternatively you could split the 31 coefficient polynomial into three parts of 10, 10, and 11 coefficients, respectively. In the next recursion step the polynomials are again split in two or three parts, and so on.

Note that it might be more efficient to use a combination of the KA and the schoolbook method. For example, take a look at n = 8 with the distribution [2 2 2] in Appendix A. Let us consider a platform with r <sup>0</sup> = 2. Since r <sup>0</sup> > r = 1.38 it is more efficient to use the KA. However the threshold value for n = [2 2] is r = 2.14. Therefore it is most efficient to first use the KA for polynomials with 2 coefficients where the coefficients themselves are polynomials with 4 coefficients. These polynomials are then multiplied by the schoolbook method, and not by the recursive KA.

### 4.6 Complexity of KA

In this section we will analyze the asymptotic complexity of the KA. To simplify this we assume that the number of coefficients n is a power of some integer number, i.e., n = p j . The number of multiplications can be determined by

$$\#\mathrm{MUL}_n = (\frac{1}{2}p^2 + \frac{1}{2}p)^j = (\frac{1}{2}p^2 + \frac{1}{2}p)^{\log_p n} = n^{\log_p(\frac{1}{2}p^2 + \frac{1}{2}p)}$$
(10)

For very large p this converges to (1/2)<sup>j</sup> n 2 , for small p, especially p = 2 we derive a complexity of n log<sup>2</sup> 3 . As shown in Section 4.1 an upper bound of the simple recursive KA for arbitrary n is 1.20log<sup>2</sup> <sup>3</sup> .

The number of additions is not as easily obtained. The number can be obtained by (9). Table 3 shows the number of additions needed for some values of p. We obtain for #ADD a complex formula

$$#ADD_{n} = \left(1/2 p^{2} + 1/2 p\right)^{j-1} \left(5/2 p^{2} - 7/2 p + 1\right) + 4 p^{j} (p-1) - 3/2 p^{2} + 1/2 p + 1 + 1/2 (p+1)$$

$$\cdot \left(1/2 p^{2} + 1/2 p\right)^{j} \left(3 p^{2} \left(2 \frac{1}{p(p+1)}\right)^{j} + 2 \left(2 \frac{1}{p(p+1)}\right)^{j} p - 8 p \left(2 (p+1)^{-1}\right)^{j} - 16 \left(2 (p+1)^{-1}\right)^{j}\right)$$

$$\cdot (p+2)^{-1} - 1/2 (p+1) \left(1/2 p^{2} + 1/2 p\right)^{j} \left(-52 (p+1)^{-2} + 8 \frac{1}{p(p+1)^{2}} - 32 \frac{p}{(p+1)^{2}}\right) (p+2)^{-1}$$

This expression can be written as

$$#ADD_n = a \cdot n^{\log_p(\frac{1}{2}p^2 + \frac{1}{2}p)} - 8n + b$$
(11)

with a and b some positive number smaller than n (actually a ≤ 6 and b ≤ 3). For very large p (11) converges to

$$\lim_{p \to \infty} \#ADD_n = \lim_{p \to \infty} 5n^{\log_p(\frac{1}{2}p^2 + \frac{1}{2}p)} - 8n + 3 = 5n^2 - 8n + 3$$

Note that for small p and large j the number of multiplications and additions is smaller compared to the schoolbook method that requires (n − 1)<sup>2</sup> additions. For large integer numbers of p (10) converges to a complexity of n 2 .

### 5 Squaring with KA

The KA can be applied to squaring polynomials by simply replacing all the coefficient multiplications by coefficient squarings while keeping the additions. Although there is no special form of a squaring KA there still might be a performance gain compared to the ordinary squaring method which requires n squarings, n(n − 1)/2 multiplications and (n − 1)<sup>2</sup> additions. However, this varies for different platforms and depends on the ratio in time between a squaring and a multiplication. Let ta, t<sup>s</sup> and t<sup>m</sup> be the time for an addition, a squaring and a multiplication, respectively. Let r = tm/t<sup>a</sup> be the ratio between a multiplication and an addition as before, and let c<sup>k</sup> and c<sup>s</sup> be the cost of the KA and schoolbook method, respectively. For the comparison we use the upper bound complexity of the KA as stated in Section 4.1. We obtain

$$c_k < c_s \Leftrightarrow 1.20n^{\log_2 3} t_s + 7n^{\log_2 3} t_a < nt_s + n(n-1)/2t_m + (n-1)^2 t_a$$

We want to present the two extreme scenarios. In the first one a squaring comes for free, e.g., as it almost is the case for binary fields. Thus t<sup>s</sup> = 0 such that we obtain

$$r > \frac{7n^{\log_2 3} - n^2 + 2n - 1}{(n^2 - n)/2}$$

Let r <sup>0</sup> be the right side term. If r > r<sup>0</sup> then it is efficient to use KA instead of the schoolbook squaring method. For r = 10, i.e. a multiplication takes as long as 10 additions, the Squaring KA outperforms the schoolbook squaring method for n >= 4 if a squaring is for free and a multiplication does not perform faster than an addition. For r = 2, the Squaring KA outperforms the schoolbook method for n >= 24.

The second scenario is the case when a squaring takes as long as a multiplication, i.e., t<sup>s</sup> = tm. Then we obtain

$$r > \frac{7n^{\log_2 3} - n^2 + 2n - 1}{n/2(n+1) - 1.20n^{\log_2 3}}$$

Again let r <sup>0</sup> be the right side term. In this case, for n >= 3 the KA Squaring outperforms the schoolbook method if r = 10, and for n >= 21 it outperforms the schoolbook method if r = 2. If r = 1, i.e. a multiplication takes as long as an addition, then the KA Squaring outperforms the schoolbook squaring method for n >= 44.

Clearly, if t<sup>s</sup> = a t<sup>m</sup> with 0 < a < 1 then the range where KA Squaring outperforms the schoolbook method are in a similar range as above. Hence, one needs first to consider the ratio r in order to estimate the superior squaring method.

### 6 Improvement by Using Dummy Coefficients

To improve the KA we can use dummy coefficients, i.e. prefix zero coefficients, to reduce the number of operations. In Appendix A we observe that the general recursive KA for 11 coefficients needs more operations than the one for 12. Assume A(x) and B(x) are polynomials with 11 coefficients, i.e., of degree 10. Just by adding a dummy coefficient a<sup>11</sup> and b<sup>11</sup> with a<sup>11</sup> = b<sup>11</sup> = 0 we can reduce the total number of operations from 331 to 275. Furthermore it can be observed that the added coefficients imply that there are some computations in the algorithm which do not need to be done. Whenever  $a_{11}$  or  $b_{11}$  occurs in the computation we do not need to compute the result. We will show this for an example for polynomials with 11 coefficients.

Let  $A(x) = \sum_{i=0}^{10} a_i \cdot x^i$  and  $B(x) = \sum_{i=0}^{10} b_i \cdot x^i$  be two degree-10 polynomials. Then  $A'(x) = \sum_{i=0}^{11} a_i \cdot x^i$  and  $B'(x) = \sum_{i=0}^{11} b_i \cdot x^i$  with  $a_{11} = b_{11} = 0$  are two degree-11 polynomials with  $A(x) \cdot B(x) = A'(x) \cdot B'(x)$ . We will apply the KA recursively for polynomials with 12 coefficients (in the sequence 3 - 2 - 2). First we rewrite the polynomials:

$$A'(x) = A_1^{(1)} \cdot x^6 + A_0^{(1)}, \ B'(x) = B_1^{(1)} \cdot x^6 + B_0^{(1)}$$

and use the KA for degree-1 polynomials:

$$D_0^{(1)} = A_0^{(1)} \cdot B_0^{(1)}, \ D_1^{(1)} = A_1^{(1)} \cdot B_1^{(1)}, \ D_0^{(1)} = (A_0^{(1)} + A_1^{(1)}) \cdot (B_0^{(1)} + B_1^{(1)})$$

 $D_0^{(1)}$  and  $D_{0,1}^{(1)}$  are computed as usual and only the computation of  $D_1^{(1)}$  saves some operations (note that  $D_1^{(1)}$  has 10 and not 12 coefficients). Now we compute  $D_1^{(1)}$ .

$$D_1^{(1)} = A_1^{(1)} \cdot B_1^{(1)}$$

For the second iteration we divide the polynomials once more

$$A_1^{(1)} = A_1^{(2)} \cdot x^3 + A_0^{(2)}, \ B_1^{(1)} = B_1^{(2)} \cdot x^3 + B_0^{(2)}$$

and obtain the auxiliary variables:

$$D_0^{(2)} = A_0^{(2)} \cdot B_0^{(2)}, \ D_1^{(2)} = A_1^{(2)} \cdot B_1^{(2)}, \ D_{0,1}^{(2)} = (A_0^{(2)} + A_1^{(2)}) \cdot (B_0^{(2)} + B_1^{(2)})$$

As above,  $D_0^{(2)}$  and  $D_{0,1}^{(2)}$  do not change compared to the usual computation. To compute  $D_1^{(2)}$  we need the KA for 2 coefficients instead of 3. Furthermore we save 2 additions to compute each  $D_{0,1}^{(1)}$  and  $D_{0,1}^{(2)}$  because  $A_1^{(1)}$  and  $B_1^{(1)}$  have only 5 coefficients,  $A_1^{(2)}$  and  $B_1^{(2)}$  only 2. To obtain the result we have to compute

$$D_1^{(1)} = A_1^{(1)} \cdot B_1^{(1)} = D_1^{(2)} \cdot x^6 + (D_{0,1}^{(2)} - D_0^{(2)} - D_1^{(2)}) \cdot x^3 + D_0^{(2)}$$

Since  $D_1^{(2)}$  has only 4 coefficients instead of 6 we save another 2 additions. To obtain the desired result we compute

$$A'(x) \cdot B'(x) = D_1^{(1)} \cdot x^{12} + (D_{0,1}^{(1)} - D_0^{(1)} - D_1^{(1)}) \cdot x^6 + D_0^{(1)}$$

We save another 2 additions because  $D_1^{(1)}$  has only 10 coefficients instead of 12. So altogether we derive

$$\#MUL'_{11} = \#MUL_{12} - \#MUL_{3} + \#MUL_{2} = 54 - 6 + 3 = 51$$

 $\#ADD'_{11} = \#ADD_{12} - \#ADD_{3} + \#ADD_{2} - 4 \cdot 2 = 221 - 13 + 4 - 8 = 204$

and

$$\#MUL'_{11} + \#ADD'_{11} = 51 + 204 = 255$$

compared to

$$\#MUL_{11} + \#ADD_{11} = 331$$

for the general recursive KA.

Note that computing D<sup>1</sup> (1) by using the KA for 5 coefficients requires the same amount of operations. This simple approach can be enhanced by adding one or more dummy coefficients and using this approach recursively.

Now observe that the number of multiplications is exactly the same as it is for the simple recursive KA for 11 coefficients while the number of additions is slightly less. Without a formal proof we can state that the usage of dummy coefficients combined with the general recursive KA only results in a slight performance gain compared to the simple recursive KA. This is due to the fact that the simple recursive KA for n coefficients always needs less operations than the KA for n + 1 coefficients because of the algorithm's construction. Since the simple recursive KA is more efficient than the general recursive KA we can only expect a slight performance gain.

### 7 Concluding Remarks

In this article we demonstrated several recursive algorithms to multiply two arbitrary polynomials by means of the Karatsuba Algorithm. We analyzed the complexity of these algorithms and described how to apply them most efficiently. In most cases the simple recursive KA yields the most efficient computation. By adding dummy coefficients the complexity might be slightly decreased.

### References

- [1] D. J. Bernstein. Multidigit Multiplication for Mathematicians. Advances in Applied Mathematics, to appear.
- [2] A. Karatsuba and Y. Ofman. Multiplication of Multidigit Numbers on Automata. Soviet Physics - Doklady, 7 (1963), 595-596.
- [3] D. E. Knuth. The Art of Computer Programming. Volume 2: Seminumerical Algorithms. Addison-Wesley, Reading, Massachusetts, 3rd edition, 1997.
- [4] A. Lempel, G. Seroussi and S. Winograd. On the Complexity of Multiplication in Finite Fields. Theoretical Computer Science, 22 (1983), 285-296.
- [5] H. J. Nussbaumer. Fast Fourier Transform and Convolution Algorithms, 2nd Edition. Springer-Verlag, Berlin, Heidelberg, New York, 1982.
- [6] C. Paar. Efficient VLSI Architecture for Bit Parallel Computation in Galois Fields. PhD Thesis, Institute for Experimental Mathematics, University of Essen, Germany, 1994.
- [7] S. Winograd. Some Bilinear Forms Whose Multiplicative Complexity Depends on the Field of Constants. Mathematical Systems Theory, 10 (1977), 169-180.

### A Complexity of KA

| opt(r)               | П            |        | 0 simple rec<br>9 simple rec |       | 0 simple rec          | _       |             | 5 simple rec        |        |            | _          | si.        |         |            | 0 simple rec |        |            | _          | _          | _            | simple rec |            |            |            |            | 5 simple rec                | ·is                     |            |            |             | 2 simple rec |            |         | 2 simple rec |            |            | .5 simple rec              |            | _       | .7 simple rec             |            |            | 9 simple rec |            | _           | simple rec            |            |            |              |
|----------------------|--------------|--------|------------------------------|-------|-----------------------|---------|-------------|---------------------|--------|------------|------------|------------|---------|------------|--------------|--------|------------|------------|------------|--------------|------------|------------|------------|------------|------------|-----------------------------|-------------------------|------------|------------|-------------|--------------|------------|---------|--------------|------------|------------|----------------------------|------------|---------|---------------------------|------------|------------|--------------|------------|-------------|-----------------------|------------|------------|--------------|
| Recursive KA         | #ADD r       |        |                              |       | 5136 0.10 $5252 0.09$ |         |             | 5792 0.07           | -      |            |            |            |         |            | 6710 0.00    |        |            | _          | 7086 -0.05 | 7128 -0.07   |            |            |            |            | _          | 7739 -0.15                  | 8215 -0.13              |            |            | 8823 -0.12  | 9203 -0.12   | _          |         | 9671 -0.12   |            |            | 10167 -0.15<br>10243 -0.16 |            |         | 10665 -0.17 $10817 -0.18$ |            |            | 11217 -0.19  |            | 11435 -0.22 | 11615 -0.22           | -          |            | 11853 -0.25  |
| Simple Re            | Г            |        | 921<br>945 4                 |       | 1017 5                |         | 1101        |                     |        |            | 1197 6     |            | 1215    |            |              | 1323 6 |            |            | 1371       |              | _          | _          |            |            |            | 1455                        |                         |            |            | 1674 8      |              |            | 1782 9  |              | 1878       |            | 1914                       |            |         | 2016                      |            |            |              |            |             | 2130                  |            |            | 2160 1       |
|                      | Н            | 0.49   | 3.00                         | 1.09  | 3.00                  | 0.01    | 3.00        | 0.34                | 0.65   | 0.84       | 0.47       | 3.00       | -0.01   | 0.03       | 3.00         | 0.13   | 0.86       | 1.43       | 1.07       | 0.20         | 3.00       | 0.80       | 0.64       | 1.06       | 1.43       | 0.84                        | 3.00                    | 0.36       | 0.30       | 0.09        | 0.44         | 3.00       | 0.18    | 0.24         | 3.00       | -0.11      | 3.00                       | 1.05       | -0.08   | 3.00                      | 0.82       | 0.62       | 0.28         | 0.75       | -0.13       | 1.42                  | 1.05       | 090        | 0.02         |
| ive KA               | 13451        | 5789   | 10989                        | 7999  | 6309                  | 5069    | 13068       | 6925                | 8277   | 9199       | 8015       | 15327      | 6166    | 19701      | 12504        | 7583   | 11286      | 13759      | 12697      | 10403        | 8333       | 12699      | 12091      | 14503      | 16449      | 7730                        | 23184                   | 12025      | 11839      | 10488       | 13547        | 26163      | 12130   | 12895        | 28249      | 10415      | 29322                      | 20641      | 11499   | 31528                     | 20451      | 19162      | 16339        | 21379      | 12623       | 22155                 | 25333      | 01010      | 17006        |
| General Recursive    | #MUL         | 1188   | 2278<br>1377                 | 1656  | 1260                  | 972     | 2701        | 1350                | 1710   | 1848       | 1638       | 3160       | 1215    | 1296       | 3486         | 1512   | 2295       | 2838       | 2610       | 1782         | 1620       | 2548       | 2484       | 2976       | 3384       | 1458                        | 4753                    | 2352       | 2376       | 2025        | 2754         | 5356       | 2457    | 2520         | 5778       | 1944       | 5995                       | 4218       | 2268    | 3420                      | 4140       | 3915       | 3276         | 4284       | 2430        | 4356                  | 5166       | 7787       | 4404<br>9976 |
| Ger                  |              | [1132] | [ 67 ] $[ 17 2 2 ]$          | [233] | [752]                 | [33222] | [73]        | [57.2]              | [1922] | [ 11 7 ]   | [ 13 3 2 ] | [ 62 ]     | [52222] | [3333]     | [ 41 2 ]     | [7322] | [175]      | [ 43 2 ]   | 293]       | [ 11 2 2 2 ] | [5332]     | [137]      | [2322]     | [313]      | 47.2       | [ 195]<br>[ 2 3 3 3 3 3 3 ] | [ 5 2 2 2 2 ]<br>[ 97 ] | [772]      | [1133]     | [5522]      | [ 101 ]      | [ 103 ]    | [13222] | [753]        | [ 3.2 ]    | [33322]    | [ 109 ]                    | [373]      | [72222] | [ 113 ]                   | [235]      | [2922]     | [1333]       | [ 17 7 ]   | [53222]     | [ 11 11 ]<br>[ 61 2 ] | [413]      | [0010]     | [ 31.2.2 ]   |
| u                    |              | 99     | 67                           | 69    | 70                    | 72      | 73          | 7.5                 | 92     | 22         | 78         | 79         | 80      | x 6        | % %<br>% %   | 84     | 85         | 98         | 87         | x 5          | 60         | 91         | 92         | 93         | 94         | 6<br>6<br>8                 | 96                      | 86         | 66         | 100         | 102          | 103        | 104     | 105          | 107        | 108        | 109                        | 111        | 112     | 113                       | 115        | 116        | 117          | 119        | 120         | 121                   | 123        | 70         | 124          |
| opt(r)               |              | ednaj  | equal                        | equal | equal<br>simple rec   | equal   | general rec | equal<br>simple rec | edual  | simple rec | simple rec | simple rec | equal   | simple rec | general rec  | equal  | simple rec | simple rec | simple rec | equal        | simple rec | simple rec | simple rec | simple rec | simple rec | simple rec                  | simple rec              | simple rec | simple rec | general rec | simple rec   | simple rec | edual   | simple rec   | simple rec | simple rec | simple rec                 | simple rec | edual   | simple rec                | simple rec | simple rec | simple rec   | simple rec | simple rec  | simple rec            | simple rec | eimple rec | simple rec   |
| . KA                 | r            | 3.00   | 3.00                         | 3.00  | 1.89                  | 1.38    | 2.00        | 1.49                | 1.11   | 1.29       | 1.11       | 0.99       | 0.77    | 1.1I       | 1.08         | 0.89   | 0.89       | 0.77       | 0.68       | 0.55         | 0.07       | 0.61       | 0.53       | 0.52       | 0.45       | 0.39                        | 0.48                    | 0.50       | 0.52       | 0.48        | 0.50         | 0.42       | 0.36    | 0.38         | 0.33       | 0.28       | 0.26                       | 0.18       | 0.13    | 0.21                      | 0.21       | 0.19       | 0.19         | 0.15       | 0.11        | 0.12                  | 0.09       | 900        | 0.00         |
| Simple Recursive KA  | #ADD         | 4,     | 13                           | 46    |                       | 100     | 148         | 204                 | 221    | 277        | 307        | 341        | 360     | 460        | 212          | 2000   | 662        | 969        | 734        | 755          | 931        | 995        | 1029       | 1101       | 1139       | 1307                        | 1408                    | 1512       | 1620       | 1676        | 1852         | 1916       | 1950    | 2082         | 2222       | 2260       | 2340                       | 2428       | 2453    | 2689                      | 2933       | 2997       | 3129         | 3269       | 3307        | 3531                  | 3611       | 3653       | 0000         |
| Simp                 | #MUL         | e .    | <br>                         | 15    | 18                    | 27      | 39          | 5.15                | 54     | 99         | 72         | 28         | 81      | 105        | 129          | 135    | 147        | 153        | 159        | 162          | 198        | 210        | 216        | 228        | 234        | 240                         | 291                     | 315        | 339        | 351         | 387          | 399        | 405     | 429          | 453        | 459        | 471                        | 483        | 486     | 534<br>485                | 282        | 594        | 618          | 642        | 648         | 684                   | 969        | 202        | 1 - 1        |
|                      | r            | 3.00   | 3.00                         | 3.00  | 3.00                  | 1.38    | 1.67        | 3.00                | 1.11   | 3.00       | 1.61       | 1.40       | 0.77    | 3.00       | 3.00         | 0.89   | 1.29       | 1.53       | 3.00       | 1.25         | 1.50       | 0.71       | 0.80       | 3.00       | 0.68       | 3.00                        | 1.18                    | 1.48       | 1.06       | 0.38        | 1.48         | 1.15       | 0.36    | 3.00         | 3.00       | 0.72       | 1.49                       | 3.00       | 0.13    | 0.97                      | 1.12       | 0.69       | 3.00         | 0.94       | 0.28        | 1.11                  | 3.00       | 0.50       | 000          |
| sive KA              | #ADD         | 4;     | 13                           | 46    | 200                   | 100     | 139         | 265                 | 221    | 378        | 349        | 385        | 360     | 664        | 485<br>837   | 208    | 751        | 879        | 1243       | 755          | 1234       | 1039       | 1155       | 2002       | 1271       | 1200                        | 1843                    | 2124       | 2011       | 1595        | 2659         | 2569       | 1950    | 4060         | 4473       | 2809       | 3909                       | 5359       | 2453    | 3364                      | 4381       | 3906       | 6838         | 4821       | 3685        | 5467                  | 8497       | 4049       | 0000         |
| General Recursive KA | #MUL         | 8      | <u>ა</u> ი                   | 15    | 2 8<br>8 8<br>8 8     | 27      | 36          | 66                  | 54     | 91         | 84         | 06         | 81      | 153        | 190          | 135    | 168        | 198        | 276        | 162          | 273        | 216        | 252        | 435        | 270        | 496<br>043                  | 396                     | 459        | 420        | 324         | 570          | 546        | 405     | 861          | 946        | 594        | 540<br>828                 | 1128       | 486     | 784                       | 918        | 819        | 1431         | 066        | 756         | 1305                  | 1770       | 018        | 1801         |
| Ger                  | distribution | [2]    | [3]<br>[22]                  |       | [ 3 2 ]<br>[ 7 ]      | [222]   | (S)         | [ 3 2 ]             | [322]  | [ 13 ]     | [72]       | [53]       | [2222]  | [ 17 ]     | [332]        | [522]  | [73]       | [112]      | [ 23 ]     | [3222]       | [32]       | [333]      | [722]      | [ 29 ]     | [532]      | [31]                        | 11 3                    | [ 17 2 ]   | [75]       | [3322]      | [ 37 ]       | [133]      | [5222]  | [41]         | [ 43 ]     | [1122]     | [533]                      | [ 47 ]     | [3222]  | [77]                      | [173]      | [1322]     | [53]         | [ 11 5 ]   | [7222]      | [ 19 3 ]<br>[ 29 2 ]  | [ 59 ]     | [5322]     |              |
| п                    |              | 2 0    | w 4                          | 20.0  | 9 1                   | · ∞     | 6 5         | 11                  | 12     | 13         | 14         | 15         | 16      | ).T        | x 5          | 20     | 21         | 22         | 533        | 4 7          | 96         | 27         | 28         | 59         | 30         | 33                          | 333                     | 34         | 35         | 36          | , oc         | 30         | 40      | 41           | 43         | 44         | 45                         | 47         | 84      | 49                        | 51         | 25         | დ <u>გ</u>   | 55         | 26          | . oc.                 | 59         | 9          | 5 5          |