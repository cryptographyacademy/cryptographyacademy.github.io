# Another Look at Square Roots and Traces (and Quadratic Equations) in Fields of Even Characteristic

# Roberto Maria Avanzi

Faculty of Mathematics and Horst G¨ortz Institute for IT-Security Ruhr University Bochum, Germany Roberto.Avanzi@ruhr-uni-bochum.de

Abstract. We discuss irreducible polynomials that can be used to speed up square root extraction in fields of characteristic two. We call such polynomials square root friendly. The obvious applications are to point halving methods for elliptic curves and divisor halving methods for hyperelliptic curves.

Irreducible polynomials P(X) such that the square root ζ of a zero x of P(X) is a sparse polynomial are considered and those for which ζ has minimal degree are characterized. We reveal a surprising connection between the minimality of this degree and the extremality of the the number of trace one elements in the polynomial base associated to P(X). We also show how to improve the speed of solving quadratic equations and that the increase in the time required to perform modular reduction is marginal and does not affect performance adversely. Experimental results confirm that the new polynomials mantain their promises; These results generalize work by Fong et al. to polynomials other than trinomials. Point halving gets a speed-up of 20% and the performance of scalar multiplication based on point halving is improved by at least 11%.

Keywords: Binary fields, Polynomial basis, Square root extraction, Trace computation, Quadratic equations, Point halving, Divisor halving.

# 1 Introduction

The main topics of this paper are square root extraction and trace computation in binary fields, even though also the solution of quadratic equations is briefly considered.

In [19] it is shown that square root extraction can be accelerated if a suitable irreducible trinomial is used to define a field extension of F2.

Let P(X) be the irreducible polynomial of degree d used to define the extension field F<sup>2</sup> <sup>d</sup> /F2. If the polynomial in X representing the square root of a zero x in F<sup>2</sup> <sup>d</sup> has low weight and/or degree, then general square roots can be extracted in F<sup>2</sup> <sup>d</sup> efficiently. In this case we call P(X) square root friendly. (This definition will be made more precise later.)

We give here sufficient conditions for an irreducible polynomial of odd degree d to yield a low weight  $\sqrt{x}$ . In particular, we give examples of pentanomials and heptanomials, but in at least one case, that of  $\mathbb{F}_{2^{233}}$ , that can be defined by trinomials, we show how one can perform square root computations even faster than in [19].

Since the main motivation comes from elliptic curve cryptography (cf. [9, 20]), in particular from point halving based methods for scalar multiplication, we recall here the involved concepts.

Let E be an elliptic curve defined over  $\mathbb{F}_{2^d}$  by a Weierstrass equation

$$E: Y^2 + XY = X^3 + aX^2 + b$$

with  $a, b \in \mathbb{F}_{2^d}$  and having a subgroup  $G \leq E(\mathbb{F}_{2^d})$  of large prime order. Given a point  $\mathbf{P} \in G$  point halving [22, 27], consists in computing the unique point  $\mathbf{R}$  whose double is  $\mathbf{P}$ . Halving is an automorphism of G. To perform this operation one needs to solve a quadratic equation of the form  $\lambda^2 + \lambda + \alpha = 0$  for  $\lambda$ , extract a square root, perform two multiplications, a trace computation, and some additions. We refer the reader to [22, 27, 19] for details, including the usage of halving in place of doubling in scalar multiplication algorithms. According to [19], halving is about two times faster than doubling.

Birkner [13] has a divisor halving formula for genus two curves based on the Lange-Stevens doubling formulae [24]. Birkner and Thériault [14] deal with genus three divisors. The performance of all known halving formulæ depends (to a variable degree) on the performance of square root extraction. Further uses of point halving to speed up scalar multiplication on (elliptic) Koblitz Curves [23] are found in [7, 10] and [11].

The paper is divided in two parts, the first one about mathematical aspects (Section 2) and the second part about implementation issues and performance (Section 3).

In §2.1 we give background material about square roots, In §2.2 we classify the odd degree polynomials with low degree  $\sqrt{x}$  and consider the trace spectra of the corresponding polynomial bases. §2.3 deals with the even degree polynomials. A somewhat surprising observation stemming from the results in §§2.2 and 2.3 is that polynomials with low degree  $\sqrt{x}$  substantially coincide with those characterised by a maximal or minimal number of trace one elements in the associated polynomial basis.

Polynomials for several binary fields used for cryptographic applications are presented in § 2.4, together with observations about the scarcity of other types of polynomials with similar properties, a result about the existence of square root friendly trinomials, a conjecture about the degrees of the non-leading terms of square root friendly polynomials, and a theorem that supports the conjecture itself.

Finally, we move to practical aspects. Not only square root extraction is implemented (§ 3.1), but also the computation of traces over  $\mathbb{F}_2$  (§ 3.2) and solving quadratic equations in  $\mathbb{F}_{2^d}$  (§ 3.3). These routines are benchmarked showing gains, whereas multiplication and squaring either experience a negligible slowdown or even a minimal speedup. The costs of various elliptic curve group operations and scalar multiplication algorithms using different reduction polynomials for the definition field are also given. The discussion of these results (§ 3.4) also provides the conclusion to the paper. In particular, we prove that a performance gain of around 20% can be expected for the point halving alone, with a speed increase in excess of 11% for scalar multiplication.

**Acknowledgement.** The author is grateful to Peter Birkner, Toni Bluher, Darrel Hankerson, Alfred Menezes, and Nicolas Thériault for useful discussions. The author also wishes to thank Christian Dobrick for lending him his MacBook.

### 2 Mathematics

#### 2.1 Background

Let P(X) be an irreducible polynomial of *odd* degree d, and the field  $\mathbb{F}_{2^d}$  be constructed as  $\mathbb{F}_2[X]/(P(X))$ . Let x be a zero of P(X) in  $\mathbb{F}_{2^d}$ . We consider here polynomial basis representation because we are solely concerned with software applications.

Whereas with a normal basis [4] a square root computation is just a shift of the bits internal representation of the field element by one position, whose cost is basically negligible with respect to that of a multiplication, matters are different with polynomial bases. Even the cost of a squaring becomes no longer negligible. Indeed, if  $\alpha = \sum_{i=0}^{d-1} a_i x^i$ , then  $\alpha^2 = \sum_{i=0}^{d-1} a_i x^{2i}$  need to be reduced modulo P(X). The costs are low, but cannot be completely ignored.

Things are more complicated for square roots. Even though squaring just consists in "spacing" the bits of the original element with zeros, the bits of a generic field element cannot be just "compressed". Using Fermat's little theorem  $\alpha^{2^d} = \alpha$ , we can compute  $\sqrt{\alpha} = \alpha^{2^{d-1}}$ . This requires d-1 squarings, and for large d the cost is that of several field multiplications. In fact, it can be faster to change to a normal basis (we

need only to store the change-of-base matrix: the conversion time is then approximately equivalent to one field multiplication, and this method requires to store  $O(d^2)$  bits [21] – see also [18]), perform the square root extraction in that representation, then convert back to polynomial basis.

A more efficient method stems from the observation that  $\sqrt{\alpha}$  can be expressed in terms of  $\zeta := \sqrt{x}$ . If

$$\alpha = \sum_{i=0}^{d-1} a_i x^i$$

we separate the even exponents from the odd exponents

$$\alpha = \sum_{i=0}^{(d-1)/2} a_{2i} x^{2i} + \sum_{i=0}^{(d-3)/2} a_{2i+1} x^{2i+1} = (\alpha_{\text{even}})^2 + x \cdot (\alpha_{\text{odd}})^2$$

where

$$\alpha_{\text{even}} = \sum_{i=0}^{(d-1)/2} a_{2i} x^i$$
 and  $\alpha_{\text{odd}} = \sum_{i=0}^{(d-3)/2} a_{2i+1} x^i$

and, since square root in a field of even characteristic is a linear operation:

$$\sqrt{\alpha} = \alpha_{\text{even}} + \zeta \cdot \alpha_{\text{odd}} \tag{1}$$

Therefore, once  $\zeta$  has been computed on a per-field basis, the computation of a generic square root is reduced to "bits extraction and packing", a "rectangular" multiplication of a degree  $\leq d-1$  polynomial  $\zeta$  with a polynomial  $\sum_{i=0}^{(d-3)/2} a_{2i+1}x^i$  of degree  $\leq (d-1)/2$  in x, and a modular reduction. Intuitively, the cost should approach a half of the cost of a field multiplication and this is confirmed by the analysis in [19, 22].

### 2.2 Square-Root Friendly Polynomials (Mostly Odd Degree)

Let the extension degree d be odd. The speed of square root computation depends on the efficiency of the multiplication of a generic polynomial of degree  $\leq (d-1)/2$  by  $\zeta = \sqrt{x}$ . Now, if  $\zeta$  as a polynomial is x is very sparse, for example of weight two or four (i.e. it has just two or four nonzero terms), then this product can be computed by a few shift and XOR operations. In [19] two types of trinomials have been shown that allow this. The kind that interests us is

$$P(X) = X^d + X^m + 1$$

with m odd. Then  $x = x^{d+1} + x^{m+1}$  with d+1 and m+1 even, and

$$\zeta = x^{(d+1)/2} + x^{(m+1)/2} ,$$

and P(X) is square root friendly. In fact, this idea is much more general. Assume the irreducible polynomial P(X) defining  $\mathbb{F}_{2^d}$  over  $\mathbb{F}_2$  has form

$$P(X) = X \cdot \mathcal{U}(X)^2 + 1 \tag{2}$$

where  $\mathcal{U}$  is a polynomial of degree (d-1)/2 and even weight w (hence P(X) has weight w+1). Then,  $\zeta$  has a very simple form in  $\mathbb{F}_{2^d}$ : from  $x^2 \cdot \mathcal{U}(x)^2 + x = 0$  we obtain

$$\zeta = x \cdot \mathcal{U}(x) .$$

and  $\zeta$  is represented by a polynomial of degree 1 + (d-1)/2 = (d+1)/2 and weight w. Furthermore, note that the *polynomial* product

$$\zeta \cdot \sum_{i=0}^{(d-3)/2} a_{2i+1} x^i$$

has degree bounded by (d+1)/2+(d-3)/2=d-1, therefore no polynomial reduction is required if a square root is computed by formula (1). Hence, irreducible polynomials of form (2) are square root friendly.

Note that the low degree of  $\zeta$  not only guarantees that no modular reduction is necessary, but puts also a bound on the complexity of the multiplication by  $\zeta$  (even though its sparseness has an even bigger influence). It is therefore interesting to ask whether there are irreducible polynomials P(X) that lead to a  $\zeta$  of even lower degree. This cannot happen, and requiring the degree of the polynomial representing  $\zeta$  to be at most (d+1)/2 in fact almost characterizes the polynomials (2).

**Theorem 1.** Let the field extension  $\mathbb{F}_{2^d}/\mathbb{F}_2$  be defined by an irreducible polynomial P(X) of odd degree d, and let x be a zero of P(X) in  $\mathbb{F}_{2^d}$ . Suppose that  $\zeta := \sqrt{x}$  is a polynomial of degree at most (d+1)/2 in x.

Then the degree of  $\zeta$  is exactly (d+1)/2 and either

- (i)  $P(X) = 1 + X \cdot \mathcal{U}(X)^2$  and  $\zeta = x \cdot \mathcal{U}(x)$  for some  $\mathcal{U}(X) \in \mathbb{F}_2[X]$  of degree exactly (d-1)/2; or
- (ii)  $P(X) = 1 + (X+1) \cdot X^2 \cdot W(X)^2$  and  $\zeta = 1 + (x+1) \cdot x \cdot W(x)$  for some  $W(X) \in \mathbb{F}_2[X]$  of degree exactly (d-3)/2.

*Proof.* Let  $\zeta = \mathcal{V}(x)$  where  $\mathcal{V}(X) \in \mathbb{F}_2[X]$ . Suppose that  $\deg \mathcal{V} \leq (d-1)/2$ . Then the relation  $\zeta = \mathcal{V}(x)$  implies  $\mathcal{V}(x)^2 + x = 0$  and thus x would be a zero of the polynomial  $\mathcal{V}(X)^2 + X$  of degree at most d-1, contradicting the fact that x has degree d.

From now on let deg  $\mathcal{V} = (d+1)/2$ .

If  $X \mid \mathcal{V}(X)$ , then x is a root of  $1 + \mathcal{V}(X)^2/X$  that has degree d and is therefore equal to P(X). We are in the first case with  $\mathcal{U}(X) = \mathcal{V}(X)/X$ .

Now let  $X \nmid \mathcal{V}(X)$ , which implies  $\mathcal{V}(0) = 1$ . Since x is a root of  $X + \mathcal{V}(X)^2$  it is  $P(X) \mid X + \mathcal{V}(X)^2$  and and  $(X+1) \cdot P(X) = (X + \mathcal{V}(X)^2)$ . We add X+1 to both sides of the last equality and exploit the linearity of squaring to get  $(X+1) \cdot (1+P(X)) = (1+\mathcal{V}(X))^2$ . In turn this implies that X+1 divides  $1+\mathcal{V}(X)$ , and since  $X \mid 1+P(X)$ , also X divides  $1+\mathcal{V}(X)$ . Hence we are in the second case.

**Definition 1.** An irreducible polynomial of form (2) is called a special square root friendly (SSRF) polynomial of type I.

An irreducible polynomial

$$P(X) = 1 + (X+1) \cdot X^2 \cdot W(X)^2$$
 (3)

for some  $W(X) \in \mathbb{F}_2[X]$  of degree exactly (d-3)/2 is called a special square root friendly polynomial of type II.

Example 1. The irreducible polynomial  $X^{163} + X^{57} + X^{49} + X^{29} + 1$  is of type I, and the corresponding  $\zeta$  has weight four. On the other hand, the standard NIST polynomial [26]  $X^{163} + X^7 + X^6 + X^3 + 1$  defines a  $\zeta$  of weight 79 (cf. Appendix A).

We do not know whether there are other families of irreducible polynomials which are not trinomials, not of one of the forms (2) or (3), and for which  $\sqrt{x}$  has small weight. Even for trinomials  $X^d + X^m + 1$  with even m one has to check on a case by case basis, but examples are known [19].

Still, SSRF polynomials abound: see § 2.4.

Remark 1. Changing polynomial is easy without introducing incompatibilities in cryptographic applications: we just change the base used for representation of the field elements before and after the bulk of the computation. In general the cost of one conversion is, as as for the conversion between normal and polynomial bases, about one field multiplication. Therefore this overhead is essentially negligible with respect to the full cost of a scalar multiplication, that is in the order of magnitude of hundreds to thousands of field multiplications (see for example § 5.3 of [5]).

Remark 2. The cost of a square root extraction implemented by using the sparse version of  $\zeta$  offered by the above polynomials can be roughly estimated using, for example, already published results. For example in [19], Example 3.12, the NIST-recommended trinomial

$$P(X) = X^{233} + X^{74} + 1 (4)$$

for the finite field  $\mathbb{F}_{2^{233}}$  is used. Even though the term  $X^{74}$  does not have an odd exponent,  $\zeta$  has a sparse representation

$$\zeta = (x^{32} + x^{117} + x^{191})(x^{37} + 1)$$
.

By this, finding a root via equation (1) requires roughly 1/8 of the time of a field multiplication. As we shall show in the next section we can choose

$$P(X) = X^{233} + X^{159} + 1$$

and in this case

$$\zeta = x^{117} + x^{80}$$
.

The number of shift operations and XOR operations required to multiply by  $\zeta$  is thus reduced. Furthermore, as already remarked, there is no need to perform a reduction modulo P(X) while with non-square root friendly polynomials this is always necessary, even with the polynomial (4). Implementation results show the cost of a square root to be less than 9% of that of a multiplication. See § 3.4 for precise results.

Remark 3. Similar formulæ for cube root computations are found in [1] – their results are easily partially generalised to any odd characteristic.

Remark 4. Type I SSRF polynomials enjoy another very useful property. In [2] it is proved: If  $\mathbb{F}_{2^d}$  is defined by an irreducible polynomial P(X) whose non constant terms all have odd exponents, then the trace of a field element  $\alpha$  represented as  $\sum_{i=0}^{d-1} a_i x^i$  with respect to the polynomial basis induced by P(X) is its constant term  $a_0$ . In other words, the only traceone element in the polynomial basis defined by P(X) is 1. This is very important in the applications: for instance, as remarked in the Introduction, a trace computation is necessary to halve a point. It is especially fortunate that the same family of polynomials makes both square roots and trace computations faster. Type II SSRF polynomials do not enjoy this property, however they are not relevant for the applications, as we shall see at the beginning of Subsection 2.4. It is interesting to observe

that this type of polynomials was also investigated in [2], because all element of the polynomial basis, except at most for 1, have trace one, but the connection to the type I SSRF polynomials, due to the common minimality of degree of  $\sqrt{x}$ , is new and surprising. The following theorem is (a slight extension of) Theorem 10 from [2]. For the reader's convenience, we provide also a proof (omitted in [2]).

**Definition 2.** Let P(X) be be any irreducible polynomial of degree d over  $\mathbb{F}_2$ , and x a zero of P(X) in  $\mathbb{F}_{2^d}$

In what follows by the trace  $\operatorname{Tr}$  on  $\mathbb{F}_{2^d}$  we shall always understand the trace from  $\mathbb{F}_{2^d}$  to  $\mathbb{F}_2$ .

The trace spectrum of P(X) is the vector formed by the traces of the elements of the polynomial basis of  $\mathbb{F}_{2^d}/\mathbb{F}_2$  associated to P(X), i.e.  $[\text{Tr}(1), \text{Tr}(x), \text{Tr}(x^2), \dots, \text{Tr}(x^{d-1})]$

**Theorem 2 ([2, Theorem 10]).** Let  $P(X) = \sum_{i=0}^{d} a_{d-i} X^i$  be an irreducible polynomial over  $\mathbb{F}_2$  of degree d (with  $a_0 = a_d = 1$ ) and let x be a zero of P(X) in  $\mathbb{F}_{2^d}$ .

If d is odd, then Tr(1) = 1, otherwise Tr(1) = 0.

 $\operatorname{Tr}(\alpha^k) = 1$  for all  $1 \leq k < d$  if and only if  $a_{2i} = a_{2i+1}$  for i with  $0 \leq i \leq \lfloor d/2 \rfloor - 1$ .

*Proof.* We begin by recalling a few known facts. Let  $P(X) = X^d + a_1 X^{d-1} + \ldots + a_{d-1} X + a_d$  be an irreducible polynomial of degree d over  $\mathbb{F}_2$ , and let x a zero of P(X) in  $\mathbb{F}_{2^d}$ . Define

$$s_k = \text{Tr}(\alpha^k) \quad \text{for } 0 \le k < d .$$
 (5)

Then by Newton's identity [25, Theorem 1.75], we have

$$s_k + s_{k-1}a_1 + s_{k-2}a_2 + \ldots + s_1a_{k-1} + ka_k = 0$$
 (6)

for  $1 \le k < d$ .

From the definition of the trace we see at once that  $\text{Tr}(1) = d \mod 2$ . Suppose first that  $s_k = 1$  for all  $1 \leq k < d$ . From identity (6) with k = 1 it follows that  $s_1 + a_1 = 0$ , i.e.  $a_1 = 1$ . Now consider  $a_{2i}$  and suppose that for  $0 \leq j < i$  we have  $a_{2j} = a_{2j+1}$  (this is true for j = 0). From (6) with k = 2i we see that

$$s_{2i} + s_{2i-1}a_1 + s_{2i-2}a_2 + s_{2i-3}a_3 + \dots + s_2a_{2i-2} + s_1a_{2i-1} + 2ia_{2i} = 0$$

or, in other words

$$(1+a_1)+(a_2+a_3)+\ldots+(a_{2i-2}+a_{2i-1})+2ia_{2i}=0$$
.

Since  $a_1 = 1$  and  $a_{2j} = a_{2j+1}$ , for all j with  $0 \le j < i$  we see that the last relation reduces to  $2ia_{2i} = 0$ , that is satisfied for all values of  $a_{2i}$ . Then, consider again (6), but this time with k = 2i + 1

$$s_{2i+1} + s_{2i}a_1 + \ldots + s_3a_{2i-2} + s_2a_{2i-1} + s_1a_{2i} + (2i+1)a_{2i+1} = 0$$
.

Then

$$(1+a_1) + (a_2+a_3) + \ldots + (a_{2i-2}+a_{2i-1}) + a_{2i} + (2i+1)a_{2i+1} = 0$$

that becomes  $a_{2i} + (2i + 1)a_{2i+1} = 0$ , in other words  $a_{2i} = a_{2i+1}$ .

By following the above arguments in the inverse order, it is easy to see that if P(X) satisfies  $a_{2i} = a_{2i+1}$  then  $s_k = 1$  for all  $1 \le k < d$ .

Note that the above theorem holds for all d, i.e. it is not restricted to odd d. In § 2.3 we investigate the even degree case.

### 2.3 Square-Root Friendly Polynomials of Even Degree

Since, as already remarked, Theorem 2 holds also for even degree d, in this Subsection we shall consider the case where the degree d of the extension is even. Square roots can be computed in an entirely analogous way to the odd degree case by suitably defining  $\alpha_{\text{even}}$  and  $\alpha_{\text{odd}}$ . In this case, the polynomials defining  $\alpha_{\text{even}}$  and  $\alpha_{\text{odd}}$  both have degree (d-2)/2.

**Theorem 3.** Let  $X^d + X^m + 1$  with d even, m odd and m < d be an irreducible polynomial over  $\mathbb{F}_2$ , and x a zero of P(X) in  $\mathbb{F}_{2^d} = \mathbb{F}_2[X]/(P(X))$ . Then

$$\sqrt{x} = x^{\frac{2d-m+1}{2}} + x^{\frac{d-m+1}{2}} + x^{\frac{m+1}{2}} . \tag{7}$$

If m = d/2 (with m odd) note that  $\sqrt{x} = x^{\frac{3}{4}d + \frac{1}{2}}$ .

The proof is a simple verification. In [2] it is proved that there are  $\lfloor (d-1)/(d-m) \rfloor$  ones in the trace spectrum of  $X^d + X^m + 1$ . It is  $\text{Tr}(x^i) = 1$  for  $0 \le i < d$  if and only if  $(d-m) \mid i$ .

In particular, if  $m \leq d/2$  there is exactly one trace one element, namely  $x^{d-m}$ . These trinomials, if they exist, are good for trace computation as well as square root extraction – even though in the last case modular reduction of the product  $\zeta \cdot \alpha_{\rm odd}$  will be necessary, unless m=1, in which case  $\zeta=x^{d/2}+1$ . Since trinomials do not exist for all extension degrees, we need to characterize generic polynomials with good properties. This is done in the next theorem.

**Theorem 4.** Let d be even, and let the field extension  $\mathbb{F}_{2^d}/\mathbb{F}_2$  be defined by P(X) an irreducible polynomial of degree d. Suppose that  $\zeta = \sqrt{x} = \mathcal{V}(x)$  where  $\mathcal{V}(X) \in \mathbb{F}_2[X]$  is a polynomial of degree d/2.

Then  $P(X) = \mathcal{V}(X)^2 + X$  with  $\mathcal{V}$  of even weight and  $\mathcal{V}(0) = 1$ . Furthermore, the only trace equal to 1 in the spectrum of P(X) is  $\text{Tr}(x^{d-1})$ .

Proof. If  $\sqrt{x} = \mathcal{V}(x)$  with  $\mathcal{V}(X) \in \mathbb{F}_2[X]$  and  $\deg(\mathcal{V}) = d/2$ , then upon squaring the relation  $\sqrt{x} = \mathcal{V}(x)$  we obtain  $\mathcal{V}(x)^2 + x = 0$ . Since x is a root of  $\mathcal{V}(X)^2 + X$  and of the irreducible polynomial P(X) of the same degree, we see that  $P(X) = \mathcal{V}(X)^2 + X$ . The other properties of  $\mathcal{V}$  are now immediate. The statement about the trace spectrum is a simple application of identity (6).

Since  $\deg(\mathcal{V}) = d/2$  we have that  $\zeta \cdot \alpha_{\text{odd}}$  has degree d-1 and thus does not need to be reduced. The polynomials described in the last two theorems are this good for trace and square root computation. This prompts us to make the following definition.

**Definition 3.** A special square root friendly trinomial of type III is an irreducible trinomial of form  $X^d + X^m + 1$  with d even, m odd, and  $m \leq d/2$ .

A special square root friendly polynomial of type IV is an irreducible polynomial P(X) that can be written in the form  $p(X) = \mathcal{V}(X)^2 + X$  with  $\mathcal{V} \in \mathbb{F}_2[X]$ .

Even degree irreducible polynomials with only one odd degree exponent have been considered in [2]: The type IV SSRF polynomials are yet another example of polynomials investigated in the context of sparse trace spectra that re-appear when low degree square roots are considered.

By allowing flexibility in the choice of the weight, we can safely conjecture that we can find polynomials of every even degree. There are trinomials, such as  $X^{46}+X+1$ , for which  $\sqrt{x}=x^{23}+1$ , as well as pentanomials, like  $X^{48}+X^{38}+X^4+X+1$ , for which  $\sqrt{x}=x^{24}+x^{19}+x^2+1$ , and heptanomials like  $X^{206}+X^{104}+X^8+X^4+X^2+X+1$  with  $\sqrt{x}=x^{103}+x^{52}+x^4+x^2+x+1$ .

Increasing the degree of  $\mathcal{V}(X)$  even just by one is enough to obtain trace spectra that are no longer extremal, even though they still show an interesting periodicity.

**Theorem 5.** Let d be even, and let the field extension  $\mathbb{F}_{2^d}/\mathbb{F}_2$  be defined by P(X) an irreducible polynomial of degree d. Suppose that  $\zeta = \sqrt{x} = \mathcal{V}(x)$  where  $\mathcal{V}(X) \in \mathbb{F}_2[X]$  is a polynomial of degree d/2 + 1. Then

$$\mathcal{V}(X) = (X^2 + X + 1) \cdot X \cdot \mathcal{W}(X) + X + 1 \tag{8}$$

and

$$P(X) = (X^2 + X + 1) \cdot X^2 \cdot W(X)^2 + 1 \tag{9}$$

for a suitable polynomial W(X) of degree d/2-1 and even weight. The trace spectrum of P(X) is periodic and equal to  $[0,1,1,0,1,1,\ldots]$ .

*Proof.* If  $\sqrt{x} = \mathcal{V}(x)$  with  $\mathcal{V}(X) \in \mathbb{F}_2[X]$  and  $\deg(\mathcal{V}) = d/2 + 1$ . We obtain this that either  $\mathcal{V}(X)^2 + X = (X^2 + 1) \cdot P(X)$ , or  $\mathcal{V}(X)^2 + X = (X^2 + X + 1) \cdot P(X)$ . In the first case it would be  $X^2 + 1 \mid \mathcal{V}(X)^2 + X$  but since  $X^2 + 1 \mid X^{2i} + 1$  for all i this would imply  $X^2 + 1 \mid \mathcal{V}(1) + X$  which is impossible by degree considerations.

Therefore  $X^2 + X + 1 \mid \mathcal{V}(X)^2 + X$ , which implies that  $X^2 + X + 1$  divides  $\mathcal{V}(X)^2 + X^2 + 1 = (\mathcal{V}(X) + X + 1)^2$ , and thus  $\mathcal{V}(X) + X + 1$ . We can write  $\mathcal{V}(X) = (X^2 + X + 1) \cdot \mathcal{W}_0(X) + X + 1$  and  $P(X) = (X^2 + X + 1) \cdot \mathcal{W}_0(X)^2 + 1$  with  $\mathcal{W}_0(X)$  of even weight and  $X \mid \mathcal{W}_0(X)$ . We obtain (8) and (9) with  $\mathcal{W}_0 = X \cdot \mathcal{W}$ .

The proof of the values of trace spectrum is a straightforward application of identity (6).

#### 2.4 Existence and Degrees of the Terms

With applications in sight, let us focus again on SSRF polynomial of odd degree. Such polynomials are easy to find. For example, for extension degree d=163, a simple Magma [16] script determined all 713 (special) type I SSRF pentanomials of degree 163 in less than one minute.

But, there are no type II SSRF pentanomials of degree 163. The first (in lexycographic order) heptanomial of degree 163 is  $X^{163} + X^{162} + X^{59} + X^{58} + X^3 + X^2 + 1$  However, Type II SSRF trinomials and pentanomials exist. For type II,  $1 + X^{126} + X^{127}$  is a type II trinomial with  $\zeta = 1 + x^{63} + x^{64}$ . For fields not defined by trinomials, we know only a few type II pentanomials. For degree 43, for example, we have  $X^{43} + X^{42} + X^{29} + X^{28} + 1$ , for which of course  $\zeta = x^{22} + x^{21} + x^{15} + x^{14} + 1$ . For prime degrees under 500 for which no irreducible trinomial exists (but pentanomials exist), the only *prime* degrees for which type II SSRF pentanomials exist are: 13, 43, 59, 101, 109, 157, 173, 181, 269, 311, 397, 461, and 491.

The difficulty in finding type II SSRF polynomials is not a concern. For the applications, the most important SSRF polynomials are those of Type I, because in general they have reasonably low degree sediment (the sediment of an univariate is obtained by removing its leading term). A type II SSRF polynomial of degree d has form  $X^d + X^{d-1} + \ldots + 1$  and in general reduction modulo these polynomials is not efficient.

One way of finding good ones would be to try to find a type II SSRF polynomial P(X) of maximum weight, for which  $(X + 1) \cdot P(X)$  has low weight, and mimic the reduction procedures explained in [3]. Since pentanomials are in practice always found, this approach is only interesting if we find  $(X + 1) \cdot P(X)$  of weight four. If

$$P_{d,m}(X) = 1 + \sum_{\substack{1 \le i \le d-1 \\ i \ne m}} X^{2i} + X^{2i+1}$$

for any d and  $\leq m \leq (d-3)/2$ , we see that  $(X+1) \cdot P_{d,m}(X)$  has weight four only if m=1. Then  $P_{d,1}(X)$  is irreducible and of prime degree for d=31, 97, 151, 577, 7879 and for no other degree below 10000. In the first four cases, irreducible trinomials exist, and degree 7879 requires a pentanomial.

In Table 1 we list (Type I) SSRF polynomials of several degrees. The degrees have been taken from the NIST list of recommended binary curves and from the extension degrees used in [12]. All these extension degrees are interesting because they are either used in standards for elliptic curve cryptography or they represent good choices for extension degrees for defining hyperelliptic curve for cryptographic applications.

When no trinomial is available, a pentanomial is listed. We always report the polynomial with least degree sediment. Only in a handful of cases is the SSRF polynomial with least degree sediment the same as the standard one, i.e. the irreducible polynomial with least degree sediment but without the restriction on being square root friendly.

We first note that if an irreducible trinomial of a given odd degree exists, then we can always find one which is square root friendly.

**Theorem 6.** Let d be an odd positive integer. If an irreducible trinomial  $P(X) = X^d + X^m + 1$  over  $\mathbb{F}_2$  of degree d exists, then P(X) can be chosen of form (2), i.e. where the exponent m of the middle term is odd.

Proof. Let  $X^d + X^m + 1$  be an irreducible trinomial with d > m > 0 and m even. Then it is easy to prove that the polynomial  $X^d + X^{d-m} + 1$  is also irreducible – but d - m is odd. In fact, let q(X) be a monic polynomial over  $\mathbb{F}_2$  with q(X) = 1, i.e. non-vanishing constant term. Let  $q^*(X) = X^{\deg q}q(X^{-1})$  be the reciprocal polynomial of q(X). It is easy to see that  $q^*$  is a monic polynomial with non-vanishing constant term. Then, a factorization q(X) = g(X)h(X) implies  $q^*(X) = g^*(X)h^*(X)$ . Applying this result to  $q(X) = X^d + X^{d-m} + 1$  proves that it must be irreducible, otherwise  $P(X) = q^*(X)$  would be also reducible.

| Degree | Irreducible tri/pentanomial              | $\zeta = \sqrt{x}$ $x^{24} + x^{3}$ $x^{27} + x^{10} + x^{9} + x^{8}$ | Standard? |
|--------|------------------------------------------|-----------------------------------------------------------------------|-----------|
| 47     | $X^{47} + X^5 + 1$                       | $x^{24} + x^3$                                                        | Yes       |
| 53     | $X^{53} + X^{19} + X^{17} + X^{15} + 1$  |                                                                       | No        |
| 59     | $X^{59} + X^{21} + X^{17} + X^{15} + 1$  | $x^{30} + x^{11} + x^9 + x^8$                                         | No        |
| 67     | $X^{67} + X^{25} + X^{17} + X^5 + 1$     | $x^{34} + x^{13} + x^9 + x^3$                                         | No        |
| 71     | $X^{71} + X^9 + 1$                       | $x^{36} + x^5$                                                        | No        |
| 73     | $X^{73} + X^{25} + 1$                    | $x^{37} + x^{13}$                                                     | Yes       |
| 79     | $X^{79} + X^9 + 1$                       | $x^{40} + x^5$                                                        | Yes       |
| 83     | $X^{83} + X^{29} + X^{25} + X^3 + 1$     | $x^{42} + x^{15} + x^{13} + x^2$                                      | No        |
| 89     | $X^{89} + X^{51} + 1$                    | $x^{45} + x^{26}$                                                     | No        |
| 97     | $X^{97} + X^{33} + 1$                    | $x^{49} + x^{17}$                                                     | No        |
| 101    | $X^{101} + X^{35} + X^{31} + X^3 + 1$    | $x^{51} + x^{18} + x^{16} + x^2$                                      | No        |
| 107    | $X^{107} + X^{37} + X^{33} + X^{23} + 1$ | $x^{54} + x^{19} + x^{17} + x^{12}$                                   | No        |
| 109    | $X^{109} + X^{43} + X^{41} + X^{23} + 1$ | $x^{55} + x^{22} + x^{21} + x^{12}$                                   | No        |
| 127    | $X^{127} + X + 1$                        | $x^{64} + x$                                                          | Yes       |
| 131    | $X^{131} + X^{45} + X^{41} + X^9 + 1$    | $x^{66} + x^{23} + x^{21} + x^5$                                      | No        |
| 137    | $X^{137} + X^{21} + 1$                   | $x^{69} + x^{11}$                                                     | Yes       |
| 139    | $X^{139} + X^{53} + X^{33} + X^{25} + 1$ | $x^{70} + x^{27} + x^{17} + x^{13}$                                   | No        |
| 149    | $X^{149} + X^{51} + X^{47} + X^9 + 1$    | $x^{75} + x^{26} + x^{24} + x^5$                                      | No        |
| 157    | $X^{157} + X^{55} + X^{47} + X^{11} + 1$ | $x^{79} + x^{28} + x^{24} + x^6$                                      | No        |
| 163    | $X^{163} + X^{57} + X^{49} + X^{29} + 1$ | $x^{82} + x^{29} + x^{25} + x^{15}$                                   | No        |
| 179    | $X^{179} + X^{61} + X^{57} + X^{41} + 1$ | $x^{90} + x^{31} + x^{29} + x^{21}$                                   | No        |
| 199    | $X^{199} + X^{67} + 1$                   | $x^{100} + x^{34}$                                                    | No        |
| 211    | $X^{211} + X^{73} + X^{69} + X^{35} + 1$ | $x^{106} + x^{37} + x^{35} + x^{18}$                                  | No        |
| 233    | $X^{233} + X^{159} + 1$                  | $x^{117} + x^{80}$                                                    | No        |
| 239    | $X^{239} + X^{81} + 1$                   | $x^{120} + x^{41}$                                                    | No        |
| 251    | $X^{251} + X^{89} + X^{81} + X^3 + 1$    | $x^{126} + x^{45} + x^{41} + x^2$                                     | No        |
| 269    | $X^{269} + X^{91} + X^{87} + X^{61} + 1$ | $x^{135} + x^{46} + x^{44} + x^{31}$                                  | No        |
| 283    | $X^{283} + X^{97} + X^{89} + X^{87} + 1$ | $x^{142} + x^{49} + x^{45} + x^{44}$                                  | No        |
| 409    | $X^{409} + X^{87} + 1$                   | $x^{205} + x^{44}$                                                    | Yes       |
| 571    | $X^{571} + X^{193} + X^{185} + X^5 + 1$  | $x^{286} + x^{97} + x^{93} + x^3$                                     | No        |

Table 1. Some special square root friendly trinomials and pentanomials.

Existence results for pentanomial-defined fields are still an open question. However, on the basis of Table 1 and further experimental results, we found further evidence for an observation of Ahmadi and Menezes: In [2] they list irreducible pentanomials P(X) having only non-constant terms with odd exponent for which the sediment has lowest degree, and observe that if  $d \equiv \pm 3 \pmod{8}$ , the degree of the sediment is at least d/3, whereas if  $d \equiv \pm 1 \pmod{8}$ , then the degree of the sediment is usually quite small. In fact, if a trinomial exists for degree d, then a square-root friendly pentanomial with a sediment of degree much lower than d/3 usually also exists.

For the extension degrees for which there are no trinomials we computed not only the SSRF pentanomials but also the *heptanomials* with smallest degree sediment – the idea was, that perhaps one can find good

| Degree | Irreducible heptanomial                                     | $\zeta = \sqrt{x}$                            |
|--------|-------------------------------------------------------------|-----------------------------------------------|
| 53     | $X^{53} + X^{19} + X^{15} + X^5 + X^3 + X + 1$              | $x^{27} + x^{10} + x^8 + x^3 + x^2 + x$       |
| 59     | $X^{59} + X^{21} + X^{17} + X^{13} + X^3 + X + 1$           | $x^{30} + x^{11} + x^9 + x^7 + x^2 + x$       |
| 67     | $X^{67} + X^{25} + X^{17} + X^7 + X^3 + X + 1$              | $x^{34} + x^{13} + x^9 + x^4 + x^2 + x$       |
| 83     | $X^{83} + X^{29} + X^{25} + X^7 + X^5 + X^3 + 1$            | $x^{42} + x^{15} + x^{13} + x^4 + x^3 + x^2$  |
| 101    | $X^{101} + X^{35} + X^{31} + X^9 + X^7 + X + 1$             | $x^{51} + x^{18} + x^{16} + x^5 + x^4 + x$    |
| 107    | $X^{107} + X^{37} + X^{33} + X^{15} + X^9 + X^7 + 1$        | $x^{54} + x^{19} + x^{17} + x^8 + x^5 + x^4$  |
| 109    | $X^{109} + X^{39} + X^{31} + X^9 + X^5 + X^3 + 1$           | $x^{55} + x^{20} + x^{16} + x^5 + x^3 + x^2$  |
| 131    | $X^{131} + X^{45} + X^{41} + X^{13} + X^{9} + X + 1$        | $x^{66} + x^{23} + x^{21} + x^7 + x^5 + x$    |
| 139    | $X^{139} + X^{49} + X^{41} + X^7 + X^5 + X^3 + 1$           | $x^{70} + x^{25} + x^{21} + x^4 + x^3 + x^2$  |
| 149    | $X^{149} + X^{51} + X^{47} + X^9 + X^7 + X + 1$             | $x^{75} + x^{26} + x^{24} + x^5 + x^4 + x$    |
| 157    | $X^{157} + X^{55} + X^{47} + X^{15} + X^9 + X^3 + 1$        | $x^{79} + x^{28} + x^{24} + x^8 + x^5 + x^2$  |
| 163    | $X^{163} + X^{57} + X^{49} + X^{15} + X^9 + X + 1$          | $x^{82} + x^{29} + x^{25} + x^8 + x^5 + x$    |
| 179    | $X^{179} + X^{61} + X^{57} + X^{13} + X^9 + X^5 + 1$        | $x^{90} + x^{31} + x^{29} + x^7 + x^5 + x^3$  |
| 211    | $X^{211} + X^{73} + X^{65} + X^{13} + X^{11} + X^3 + 1$     | $x^{106} + x^{37} + x^{33} + x^7 + x^6 + x^2$ |
| 251    | $X^{251} + X^{85} + X^{81} + X^7 + X^5 + X^3 + 1$           | $x^{126} + x^{43} + x^{41} + x^4 + x^3 + x^2$ |
| 269    | $X^{269} + X^{91} + X^{87} + X^{15} + X^{13} + X^{11} + 1$  | $x^{135} + x^{46} + x^{44} + x^8 + x^7 + x^6$ |
| 283    | $X^{283} + X^{97} + X^{89} + X^{13} + X^9 + X + 1$          | $x^{142} + x^{49} + x^{45} + x^7 + x^5 + x$   |
| 571    | $X^{571} + X^{193} + X^{185} + X^{15} + X^{11} + X^{3} + 1$ | $x^{286} + x^{97} + x^{93} + x^8 + x^6 + x^2$ |

Table 2. Some special square root friendly heptanomials.

heptanomials with a lower degree sediment than the best pentanomials, to improve modular reduction: they are given in Table 2. Similar searches for polynomials with nine and eleven terms have been performed. We immediately observe here that sediment degree differences are very limited, so the heptanomials do not bring advantages. The same observation applies to polynomials with nine or eleven terms. A pattern in the distribution of degrees of the second term of the sediment of SSRF polynomials up to degree 3000 and with up to eleven terms prompts us to formulate the following conjecture:

Conjecture 1. Let d be an odd positive integer, and c be the minimum of the degrees of the sediments of all square root friendly polynomials of degree d. Further, let c' be the minimum of the degrees of the second highest degree term of all the sediments of degree c of square root friendly polynomials of degree d. Then

$$3c - d = c - c' = \begin{cases} 8 & \text{if } d \equiv 1 \pmod{3} \\ 4 & \text{if } d \equiv 2 \pmod{3} \end{cases}$$
.

A first result in this direction has already been proved by Bluher [15] using a result of Swan [28] (that in fact goes back to Stickelberger). Her result is: The odd degree polynomial  $P(X) = X^d + \sum_{i \in \mathcal{S}} X^i + 1$  in  $\mathbb{F}_2[X]$ ,

where  $S \subset \{i : i \text{ odd}, 0 < i < d/3\} \cup \{i : i \equiv d \pmod{4}, 0 < i < d\}$ has no repeated roots; if  $d = \pm 1 \pmod{8}$ , then f has an odd number of irreducible factors; and if  $d = \pm 3 \pmod{8}$ , then f has an even number of irreducible factors. In fact, by adapting the proof given in [3] of Bluher's result, it is possible to prove the following theorem:

**Theorem 7.** Let d be an odd positive integer and the polynomial  $P(X) \in \mathbb{F}_2[x]$  have degree d and satisfy one of the following conditions:

1. If
$$d \equiv 1 \pmod{3}$$
, then  $P(X)$  is either of the form
$$-X^{d} + X^{\frac{d+8}{3}} + \sum_{j \in J} X^{j} + 1 \text{ where } J = \left\{j : j \text{ odd, } 1 \leq j < \frac{d-19}{3}\right\}$$

$$- \text{ or } X^{d} + \sum_{j \in J'} X^{j} + 1 \text{ where } J' = \left\{j : j \text{ odd, } 1 \leq j \leq \frac{d+5}{3}\right\};$$
2. If  $d \equiv 2 \pmod{3}$ , then  $P(X)$  is either of the form
$$-X^{d} + X^{\frac{d+4}{3}} + \sum_{j \in J} X^{j} + 1 \text{ where } J = \left\{j : j \text{ odd, } 1 \leq j \leq \frac{d-11}{3}\right\}$$

$$- \text{ or } X^{d} + \sum_{j \in J'} X^{j} + 1 \text{ where } J' = \left\{j : j \text{ odd, } 1 \leq j \leq \frac{d+1}{3}\right\}.$$

Then P(X) is square-free. Furthermore, if  $d \equiv \pm 1 \mod 8$  then P(X) has an odd number of irreducible factors, whereas  $d \equiv \pm 3 \mod 8$  then P(X) has an even number of irreducible factors and therefore must be reducible.

Remark 5. We already mentioned in Remark 4 that in [2] the polynomials we study are proven to permit efficient computation of traces. In Conjecture 9 of [2] it is also speculated that if an irreducible pentanomial of degree d exists, then an irreducible pentanomial of the same degree defining a polynomial basis with only one trace-one element also exists. In the similar vein we could try to restrict our Conjecture 1 to pentanomials, but we have the following example for degree 1987:

$$X^{1987} + X^{665} + X^{661} + X^{549} + 1$$
.

This polynomial has minimal degree sediment, and the sediment has minimal degree second term among all irreducible pentanomials with minimal degree sediment. We have  $d \equiv 1 \pmod{3}$  and 3c - d = 8, but the second term of the sediment has degree 661, not 657. On the other hand, with heptanomials we find following irreducible

$$X^{1987} + X^{665} + X^{657} + X^{25} + X^{21} + X^{9} + 1$$
.

and we know of no other irreducibles of the form

$$X^{1987} + X^c + X^{c'} + other lower odd degree terms + 1$$

with c smaller than 665 or with c = 665 and c' smaller than 657.

# 3 Practical Aspects

For several binary fields F<sup>2</sup> <sup>d</sup> we implemented a few operations, including (but not only) multiplication, squaring, square roots, and also trace and half-trace computations (the latter is used for solving quadratic equations). For multiplication and squaring we implemented generic routines as well as routines that have been optimized for each degree, by (partially) unrolling all loops and avoiding superfluous operations, especially those involving most significant bits of operands that are known to be zero. For example, the routines for 83 and 89 bit fields, as well as those for 193 and 191 bit fields are different and have different performance, despite the fact that in the first two examples the inputs all fit in 3 words of 32 bits, and in the second they all fit in 6 words. Our implementation was written in the C programming language, the compiler used was gcc version 4.0.1. In fact the new routines are an extension of the library described in [8] (some performance discrepances are due to the fact that some other routines have been improved in the meantime) and as such in the current version processes the operands with a 32-bit granularity.

Depending on the nature of the chosen reduction polynomial we implemented some routines such as modular reduction and square root extraction in different ways. In a few cases we implement the same field twice using two different reduction polynomials in order to compare the different situations.

# 3.1 Extracting a Square Root

To implement square root extraction of a field element α we use formula (1): the only part that changes between different implementations is how the multiplication ζ ·αodd is realized. Furthermore, among the square root friendly polynomials we only consider the SSRF polynomials of type I.

To compute αeven and αodd from α we use a 16-bit to 8-bit lookup table to compress the bits. Using a trick due to Robert Harley, this table is stored in 256 consecutive bytes by compressing the input i as (i + i >> 7) & 0xff.

If the reduction polynomial P(X) is not SSRF of type I, then the Hamming weight of the square root is counted at the time of initialization of the library - hence only once. If this weight is low enough then a simple routine that XORs together shifted copies of αodd according to which bits in ζ are set is used. If the weight is higher than a certain threshold, then a comb binary polynomial multiplication method is used, where the precomputations relative to  $\zeta$  are performed only once, at initialization time. A reduction modulo P(X) is then performed, if necessary.

By means of this we can always keep the time of the multiplication  $\zeta$  ·  $\alpha_{\rm odd}$  to just under a half of the time of a *generic* field multiplication: Note, however, that this time can be substantially higher than the time required for the per-field, ad-hoc optimized implementation of multiplication, as our experimental results in § 3.4 show.

In the case where the degree d reduction polynomial P(X) is square root friendly, we also have a simple routine that XORs together shifted copies of  $\alpha_{\text{odd}}$  according to which bits in  $\zeta$  are set, but since the weight is very low and known, the routine can be unrolled completely. Furthermore, as already mentioned, in this case no modular reduction is necessary. This routine is the one that delivers the best performance.

#### 3.2 Trace Computation

We follow here [19] and [2]. For generic binary fields, to compute the trace we use the fact that it is linear. In other words, once we have computed the trace spectrum, to determined the trace of an element  $\alpha \in \mathbb{F}_{2^d}$ ,  $\alpha = \sum_{i=0}^{d-1} a_i x^i$  where the  $a_i \in \mathbb{F}_2$ , we compute

$$\operatorname{Tr}(\alpha) = \sum_{i=0}^{d-1} a_i \operatorname{Tr}(x^i) .$$

The latter sum can be implemented by a componentwise multiplication (hence, a logical AND operation) of the bit vector representing the element  $\alpha$  with a bit vector whose *i*-th component (starting with the zeroth component!) is the trace of  $x^i$ , called the *trace vector*, followed by a bit count modulo 2. Both operations can be performed very efficiently. The trace vector is of course computed once for each field.

However, when a square root friendly polynomial is used to represent the field  $\mathbb{F}_d$  with d odd, the trace vector contains just one bit set, namely the least significant bit, and  $\operatorname{Tr}(\alpha) = a_0$ .

We therefore implemented two different routines: the first one uses a trace vector and the second one just polls the value of a single bit.

### 3.3 Solving Quadratic Equations (Half-Traces)

In order to solve quadratic equations of the form

$$\lambda^2 + \lambda = \alpha \tag{10}$$

for  $\lambda \in \mathbb{F}_{2^d}$  where  $\alpha \in \mathbb{F}_{2^d}$  we implement just one generic routine, that takes the element c as an input as well as a precomputed table.

The half-trace operator on  $\mathbb{F}_{2^d}$  (d odd) is defined as

$$H(\alpha) = \sum_{i=0}^{(d-1)/2} \alpha^{2^{2i}}$$

and it is easily verified that it is  $\mathbb{F}_2$ -linear, and that  $H(\alpha)$  satisfies  $H(\alpha)^2 + H(\alpha) = \alpha + \text{Tr}(\alpha)$ . Therefore, in order to solve equation (10) we first have to check whether  $\text{Tr}(\alpha) = 0$ . Only in that case (10) is solvable: Then we compute the half-trace  $H(\alpha)$  of  $\alpha$  and  $H(\alpha)$ ,  $H(\alpha) + 1$  are the solutions.

One optimization consists in removing the coefficients of even powers of x as detailed in [19]: We write  $H(\alpha) = H(\alpha') + \beta$  where  $\alpha'$  has fewer nonzero coefficients than  $\alpha$ . This can be done by observing that  $H(x^{2i}) = H(x^i) + x^{2i} + \text{Tr}(x^{2i})$ . We can thus reduce the amount of stored half-traces of powers of x by half.

Our approach differs from the one in [19] in that we do not make ad-hoc attempts to minimize memory requirements. Instead, we reduce the number of half-traces to be accumulated by increasing the amount of precomputations. We compute and store  $H(\ell_0 x^{8i+1} + \ell_1 x^{8i+3} + \ell_2 x^{8i+5} + \ell_3 x^{8i+7})$  for all  $i \geq 0$  such that  $8i+1 \leq d-2$  and all  $(\ell_0, \ell_1, \ell_2, \ell_3) \in \mathbb{F}_2^4 \setminus \{(0,0,0,0)\}$  such that the degree of the argument of H is at most d-2. By means of this we reduce by a factor 32/15 the expected number of table lookups and additions of half-traces.

### 3.4 Results, Conclusions

We benchmarked our implementation. Table 3 collects the timings of our routines on a PowerPC G4 running at 1.5 Ghz. (Table 4 shows the timings of the same 32-bit code on on an Intel Core 2 Duo CPU running at 1.83 Ghz.) Several field operations are timed, and the costs relative to a field multiplication are provided. The reduction polynomials are given as well as if they are square root friendly or not.

We have chosen degrees in various more or less evenly spaced ranges to fulfil the following requirements: the "classical" extension degrees 163, 191, and 233 must be included, fields around integer submultiples of these sizes should also be taken into account (that's the reason for degrees in the ranges 40-50 and 80-100, and 127), and we should provide examples of fields where the "standard" polynomial (either in the sense that it comes from standard documents, or that it is the most common one used for

| Field | Reduction         | Sqrt |       | Operation Timings (µsec) |             |      |       |      | Costs relative to one Mul |             |       |       |       |
|-------|-------------------|------|-------|--------------------------|-------------|------|-------|------|---------------------------|-------------|-------|-------|-------|
|       | (Bits) Polynomial | Frnd | Mul   | Sqr                      | Inv         | Sqrt | Trace | Eq   | Sqr                       | Inv         | Sqrt  | Trace | Eq    |
| 41    | 41,3,0            | Yes  | .084  | .013                     | .448        | .015 | .007  | .129 | .160                      | 5.340       | .178  | .078  | 1.536 |
| 43    | 43,6,4,3,0        | No   | .090  | .016                     | .453        | .327 | .020  | .128 | .179                      | 5.010       | 3.619 | .227  | 1.422 |
| 43    | 43,17,9,5,0       | Yes  | .090  | .017                     | .454        | .018 | .007  | .126 | .186                      | 5.029       | .196  | .072  | 1.400 |
| 47    | 47,5,0            | Yes  | .089  | .013                     | .478        | .015 | .007  | .128 | .150                      | 5.344       | .167  | .083  | 1.438 |
| 83    | 83,7,4,2,0        | No   | .212  | .030                     | .915        | .383 | .023  | .191 | .141                      | 4.313       | 1.806 | .107  | .901  |
| 83    | 83,29,25,3,0      | Yes  | .214  | .045                     | .925        | .054 | .007  | .192 | .209                      | 4.316       | .254  | .034  | .897  |
| 89    | 89,38,0           | No   | .253  | .023                     | .958        | .354 | .023  | .200 | .089                      | 3.782       | 1.398 | .092  | .791  |
| 89    | 89,51,0           | Yes  | .253  | .024                     | .958        | .025 | .007  | .201 | .093                      | 3.782       | .098  | .027  | .794  |
| 97    | 97,6,0            | No   | .311  | .028                     | 1.598       | .401 | .025  | .256 | .091                      | 5.139       | 1.289 | .081  | .823  |
| 97    | 97,33,0           | Yes  | .304  | .024                     | 1.576       | .028 | .006  | .252 | .080                      | 5.191       | .091  | .020  | .829  |
| 127   | 127,1,0           | Yes  | .418  | .053                     | 1.814       | .062 | .007  | .288 | .127                      | 4.345       | .149  | .016  | .689  |
| 163   | 163,7,6,3,0       | No   | .819  | .086                     | 5.317       | .679 | .033  | .388 | .105                      | 6.491       | .829  | .040  | .474  |
| 163   | 163,57,49,29,0    | Yes  | .821  | .090                     | 5.327       | .095 | .007  | .391 | .110                      | 6.491       | .116  | .009  | .476  |
| 191   | 191,9,0           | Yes  | .896  | .083                     | 5.804       | .093 | .008  | .429 | .093                      | 6.474       | .104  | .009  | .479  |
| 223   | 223,33,0          | Yes  | 1.198 |                          | .098 12.865 | .113 | .006  | .501 |                           | .082 10.737 | .094  | .005  | .418  |
| 233   | 233,74,0          | No   | 1.336 |                          | .101 14.599 | .918 | .037  | .582 |                           | .076 10.925 | .687  | .028  | .436  |
| 233   | 233,159,0         | Yes  | 1.330 |                          | .090 14.593 | .117 | .006  | .584 |                           | .068 10.971 | .088  | .005  | .439  |

Table 3. Operations in some Binary Fields on a PowerPC G4 running at 1.5 Ghz. Mul, Sqr, Inv, Sqrt, Tr and Eq denote multiplication, squaring, field inversion, square root extraction, trace and half-trace computation respectively.

computations in computer algebra systems) already is square root friendly as well as cases where it is not – in the latter scenario we also choose a second defining polynomial that is SSRF of type I. Furthermore, all these combination of cases should happen with trinomial defined fields as well as when pentanomials are used. The "submultiples" ranges are relevant because of Trace Zero Varieties coming from elliptic curves [17, 6], and future investigation will consider the use of point and divisor halving for these algebraic groups.

Our implementation shows some interesting results.

- 1. The claims made in [19] about the speed of optimized square root extraction for fields defined by suitable trinomials are extended to pentanomials. Our results show for fields of 163, 191, and 233 bits an even further reduced Sqrt/Mul ratio. The gain with respect to generic implementations of square roots ranges from 8 to 20, and it is higher for smaller fields (a recurring theme, cf. [8]).
- 2. Multiplication and squaring may get marginally slower because the SSRF polynomials usually do not have minimal degree sediments, and thus the reduction routine is more complex. The differences are minimal, field squaring paying a slightly higher toll than field multiplication. – the reason is the higher relative increase of complexity for a simple routine such as squaring, which in turn causes, for instance, less efficient register coloring in the C compiler. The complexity in-

| Field  | Reduction      | Sqrt |      | Operation Timings ( $\mu$ sec) |        |      |       |      | Costs relative to one Mul |        |       |       |       |
|--------|----------------|------|------|--------------------------------|--------|------|-------|------|---------------------------|--------|-------|-------|-------|
| (Bits) | Polynomial     | Frnd | Mul  | Sqr                            | Inv    | Sqrt | Trace | Eq   | Sqr                       | Inv    | Sqrt  | Trace | Eq    |
| 41     | 41,3,0         | Yes  | .061 | .012                           | 1.367  | .020 | .009  | .067 | .203                      | 22.569 | .338  | .154  | 1.108 |
| 43     | 43,6,4,3,0     | No   | .065 | .017                           | 1.383  | .227 | .018  | .067 | .257                      | 21.214 | 3.486 | .271  | 1.029 |
| 43     | 43,17,9,5,0    | Yes  | .067 | .017                           | 1.405  | .024 | .009  | .067 | .250                      | 20.950 | .361  | .139  | 1.000 |
| 47     | 47,5,0         | Yes  | .063 | .012                           | 1.491  | .021 | .009  | .067 | .194                      | 23.532 | .338  | .147  | 1.059 |
| 83     | 83,7,4,2,0     | No   | .184 | .037                           | 2.744  | .277 | .017  | .126 | .198                      | 14.877 | 1.503 | .091  | .685  |
| 83     | 83,29,25,3,0   | Yes  | .181 | .036                           | 2.752  | .034 | .009  | .126 | .198                      | 15.195 | .185  | .049  | .698  |
| 89     | 89,38,0        | No   | .203 | .035                           | 2.869  | .265 | .017  | .133 | .172                      | 14.103 | 1.302 | .082  | .654  |
| 89     | 89,51,0        | Yes  | .205 | .040                           | 2.849  | .037 | .010  | .132 | .197                      | 13.923 | .180  | .049  | .645  |
| 97     | 97,6,0         | No   | .224 | .031                           | 3.690  | .284 | .018  | .187 | .137                      | 16.448 | 1.267 | .081  | .831  |
| 97     | 97,33,0        | Yes  | .235 | .049                           | 3.651  | .037 | .009  | .185 | .209                      | 15.536 | .157  | .038  | .787  |
| 127    | 127,1,0        | Yes  | .308 | .038                           | 4.378  | .043 | .009  | .217 | .124                      | 14.225 | .140  | .030  | .703  |
| 163    | 163,7,6,3,0    | No   | .468 | .067                           | 6.891  | .449 | .019  | .317 | .142                      | 14.734 | .960  | .040  | .677  |
| 163    | 163,57,49,29,0 | Yes  | .473 | .070                           | 6.891  | .073 | .009  | .315 | .149                      | 14.560 | .154  | .020  | .665  |
| 191    | 191,9,0        | Yes  | .658 | .059                           | 7.609  | .063 | .007  | .354 | .089                      | 11.568 | .096  | .011  | .538  |
| 223    | 223,33,0       | Yes  | .854 | .066                           | 10.846 | .078 | .009  | .420 | .077                      | 12.699 | .092  | .010  | .492  |
| 233    | 233,74,0       | No   | .952 | .086                           | 12.175 | .597 | .021  | .464 | .090                      | 12.787 | .627  | .022  | .488  |
| 233    | 233,159,0      | Yes  | .944 | .089                           | 12.355 | .081 | .008  | .464 | .094                      | 13.084 | .086  | .008  | .492  |

Table 4. Operations in some Binary Fields on an Intel Core 2 Duo running at 1.83 Ghz.

crease in the reduction routine is relatively small, see for instance Appendix B – in particular with respect to the number of machine operations required to perform a multiplication.

Sometimes a small performance improvement (presumably due to randomness) is observed. Field inversion and half-trace computation are unaffected by the choice of polynomial.

- 3. Computing traces with type I SSRF polynomials takes nearly negligible time.
- 4. In [19] computing an half-trace requires approximately 2/3 the time of a field multiplication, but for fields of the same sizes our ratios are often lower than 1/2, because we use a lot of precomputations.

In Table 5 we give estimates of the costs relative to one field multiplication of elliptic curve group addition, doubling, halving and scalar multiplication using various algorithms. We have used the operations counts from [5, § 5.2], but the ratios between field operations come from our Table 3 for the Power PC G4. We can see that the use of type I SSRF polynomials has a noticeable impact on scalar multiplication performance based on point halving. Point halving alone is sped up by about 20%, and the whole scalar multiplication by about 14% for curves defined over  $\mathbb{F}_{2^{163}}$  and by 11% if the base field is  $\mathbb{F}_{2^{233}}$ . These improvements are much larger that the difference in field multiplication performance (a 2.5 ‰ loss for  $\mathbb{F}_{2^{163}}$ , a 4.5 ‰ gain for  $\mathbb{F}_{2^{233}}$ ). Similar improvements can be achieved on the Yao-like scalar multiplication algorithms from [5].

| Field  |      |                |       | Group Operations | Scalar Multiplication |                |        |        |
|--------|------|----------------|-------|------------------|-----------------------|----------------|--------|--------|
|        | Sqrt | Affine Coords. |       | Mixed A + LD     |                       | Affine Coords. | Mixed  |        |
| Degree | Frnd | Add,Dbl        | Hlv   | mixed A          | Dbl                   | D & A          | H & A  | D & A  |
| 163    | N    | 8.596          | 3.343 | 8.525            | 5.175                 | 1550.3         | 834.5  | 1137.2 |
| 163    | Y    | 8.601          | 2.601 | 8.550            | 5.200                 | 1551.4         | 715.0  | 1141.1 |
| 191    | Y    | 8.567          | 2.592 | 8.465            | 5.115                 | 1801.3         | 825.0  | 1310.7 |
| 233    | N    | 13.001         | 3.151 | 8.380            | 5.030                 | 3369.4         | 1291.0 | 1588.6 |
| 233    | Y    | 13.039         | 2.532 | 8.340            | 4.990                 | 3379.2         | 1149.4 | 1579.8 |

Table 5. Costs of elliptic curve group operations and scalar multiplication relative to those of a field multiplication. Add, resp. Dbl, Hlv mean Addition, resp. Doubling, Halving, and D & A, resp. H & A means windowed scalar multiplication based on Double-and-Add, resp. Halve-and-Add. Scalar multiplications methods use affine coordinates as well as mixed affine-Lopez-Dahab coordinates.

Square root friendly polynomials should be used when implementing formulæ that make heavy use of square root extraction in fields of characteristic two. For solving quadratic equations then we advise to increase the amount of precomputed half-traces to improve performance. In particular, the improvements in scalar multiplication performance based on point halving obtained in [19] by using special trinomial can be carried over to fields defined by pentanomials. Around 20% can be expected for the point halving alone, with an impact of 11% to 14% on the entire scalar multiplication.

# References

- 1. O. Ahmadi, D. Hankerson, and A. Menezes. Formulas for cube roots in F3<sup>m</sup>. Discrete Applied Math. 155 (3), 260–270, 2007.
- 2. O. Ahmadi, and A. Menezes. On the number of trace-one elements in polynomial bases for F2<sup>n</sup> . Designs, Codes and Cryptography, 37, 493-507, 2005.
- 3. O. Ahmadi, and A. Menezes. Irreducible polynomials of maximum weight. Utilitas Mathematica, 72, 111–123, 2007.
- 4. D.W. Ash, I. F. Blake, and S. Vanstone. Low complexity normal bases. Discrete Applied Math. 25 191–210, 1989.
- 5. R.M. Avanzi. Delaying and Merging Operations in Scalar Multiplication: Applications to Curve-Based Cryptosystems. To appear in proceedings of SAC 2006.
- 6. R.M. Avanzi, and E. Cesena. Trace Zero Varieties over Fields of Characteristic 2: Cryptographic Applications. SAGA 2007, The first Symposium on Algebraic Geometry and its Applications. Tahiti, May 7–11, 2007.
- 7. R.M. Avanzi, M. Ciet, and F. Sica. Faster Scalar Multiplication on Koblitz Curves combining Point Halving with the Frobenius Endomorphism. Proceedings of PKC 2004, LNCS 2947, 28–40. Springer–Verlag, 2004.
- 8. R. M. Avanzi, and N. Th´eriault, Effects of Optimizations for Software Implementations of Small Binary Field Arithmetic. To appear in Proceedings of WAIFI 2007, International Workshop on the Arithmetic of Finite Fields, Madrid, Spain. June 21-22, 2007. 18 Pages.

- 9. R. Avanzi, H. Cohen, C. Doche, G. Frey, T. Lange, K. Nguyen, and F. Vercauteren. The Handbook of Elliptic and Hyperelliptic Curve Cryptography. CRC Press, 2005.
- 10. R.M. Avanzi, C. Heuberger, and H. Prodinger. Scalar Multiplication on Koblitz Curves Using the Frobenius Endomorphism and its Combination with Point Halving: Extensions and Mathematical Analysis. Algorithmica 46 (2006), 249–270
- 11. R.M. Avanzi, C. Heuberger, and H. Prodinger. On Redundant τ -adic Expansions and Non-Adjacent Digit Sets. To appear in proceedings of SAC 2006.
- 12. R.M. Avanzi, N. Th´eriault, and Z. Wang. Rethinking Low Genus Hyperelliptic Jacobian Arithmetic over Binary Fields: Interplay of Field Arithmetic and Explicit Formulæ. CACR Technical Report 2006-07.
- 13. P. Birkner. Efficient Divisor Class Halving on Genus Two Curves. To appear in: Proceedings of Selected Areas in Cryptography – SAC 2006. Springer Verlag LNCS.
- 14. P. Birkner, and N. Th´eriault. Efficient Divisor Class Doubling and Halving on Genus Three Curves. In preparation.
- 15. A.W. Bluher. A Swan-like Theorem. Finite Fields and Their Applications 12, 128– 138, 2006.
- 16. W. Bosma, J. Cannon, and C. Playoust, The Magma Algebra System I: The User Language, J. Symbolic Comput. 24 (1997), 235–265.
- 17. E. Cesena. Variet´a a Traccia Zero su Campi Binari: Applicazioni Crittografiche. (Trace Zero Varieties over Binary Fields: Cryptographic Applications.) Master's Thesis. Universit´a degli Studi di Milano. 2005. In Italian.
- 18. J.-S. Coron, D. M'Ra¨ıhi, and C. Tymen. Fast generation of pairs (k, [k]P) for Koblitz elliptic curves. In: Proceedings of SAC 2001, LNCS 2259, 151–164. Springer, 2001.
- 19. K. Fong, D. Hankerson, J. L´opez, and A. Menezes:. Field Inversion and Point Halving Revisited. IEEE Trans. Computers 53(8), 1047–1059, 2004.
- 20. D. Hankerson, A. J. Menezes, and S. A. Vanstone. Guide to elliptic curve cryptography. Springer–Verlag, 2003.
- 21. B.S. Kaliski, Jr., and T.L. Yin. Storage-efficient finite field basis conversion. In: Proceedings of SAC98. LNCS 1556, Springer, 1998.
- 22. E.W. Knudsen. Elliptic Scalar Multiplication Using Point Halving. Proocedings of ASIACRYPT 1999, LNCS 1716, 135–149. Springer, 1999.
- 23. N. Koblitz. CM-curves with good cryptographic properties. In: Proceedings of CRYPTO 1991, LNCS 576, 279–287. Springer, 1991.
- 24. T. Lange, and M. Stevens. Efficient doubling for genus two curves over binary fields. In: Selected Areas in Cryptography – SAC 2004. LNCS 3357, 170–181, Springer-Verlag, 2005.
- 25. R. Lidl, and H. Niederreiter. Finite Fields. Cambridge University Press, 1984.
- 26. National Institute of Standards and Technology. Recommended Elliptic Curves for Federal Government Use. NIST Special Publication, July 1999. Available from: http://csrc.nist.gov/csrc/fedstandards.html
- 27. R. Schroeppel. Elliptic curve point ambiguity resolution apparatus and method. International Application Number PCT/US00/31014, filed 9 November 2000.
- 28. R.G. Swan. Factorization of Polynomials over Finite Fields. In Pac. J. Math. 19, 1099–1106, 1962.

# A Some values of ζ

In this appendix we provide two comparisons of the values of ζ when type I SSRF polynomials are used and when they are not.

#### A.1 Degree 83

For the field  $\mathbb{F}_{2^{83}}$  we choose  $P(X) = X^{83} + X^{29} + X^{25} + X^3 + 1$ . The corresponding expression for  $\zeta$  is  $x^{42} + x^{15} + x^{13} + x^2$ .

Computer algebra systems, like MAGMA [16] , usually suggest to use the polynomial  $P(X) = X^{83} + X^7 + X^4 + X^2 + 1$  instead. But, in this case  $\zeta = x^{82} + x^{80} + x^{79} + x^{77} + x^{76} + x^{74} + x^{73} + x^{71} + x^{70} + x^{68} + x^{67} + x^{65} + x^{64} + x^{62} + x^{61} + x^{59} + x^{58} + x^{56} + x^{55} + x^{53} + x^{52} + x^{50} + x^{49} + x^{47} + x^{46} + x^{44} + x^{43} + x^{41} + x^{39} + x^{38} + x^{36} + x^{35} + x^{33} + x^{32} + x^{30} + x^{29} + x^{27} + x^{26} + x^{24} + x^{23} + x^{21} + x^{20} + x^{18} + x^{17} + x^{15} + x^{14} + x^{12} + x^{11} + x^{9} + x^{8} + x^{5} + x^{4} + x^{3} + 1.$  The internal representation of  $\zeta$ , given in hexadecimal notation where the most significant bits are to the left, is 5b6db 6db6dadb 6db6db39, that has weight 54. It shows some intriguing patterns.

#### A.2 Degree 163

To define  $\mathbb{F}_{2^{163}}$  we choose  $X^{163} + X^{57} + X^{49} + X^{29} + 1$ , and we have  $\zeta = x^{82} + x^{29} + x^{25} + x^{15}$  of weight four.

On the other hand, if the standard polynomial  $P(X) = X^{163} + X^7 + X^6 + X^3 + 1$  is used, then  $\zeta = x^{162} + x^{159} + x^{156} + x^{153} + x^{150} + x^{147} + x^{144} + x^{141} + x^{138} + x^{135} + x^{132} + x^{129} + x^{126} + x^{123} + x^{120} + x^{117} + x^{114} + x^{111} + x^{108} + x^{105} + x^{102} + x^{99} + x^{96} + x^{93} + x^{90} + x^{87} + x^{84} + x^{81} + x^{79} + x^{78} + x^{76} + x^{75} + x^{73} + x^{72} + x^{70} + x^{69} + x^{67} + x^{66} + x^{64} + x^{63} + x^{61} + x^{60} + x^{58} + x^{57} + x^{55} + x^{54} + x^{52} + x^{51} + x^{49} + x^{48} + x^{46} + x^{45} + x^{43} + x^{42} + x^{40} + x^{39} + x^{37} + x^{36} + x^{34} + x^{33} + x^{31} + x^{30} + x^{28} + x^{27} + x^{25} + x^{24} + x^{22} + x^{21} + x^{19} + x^{18} + x^{16} + x^{15} + x^{13} + x^{12} + x^{10} + x^9 + x^7 + x^5 + x^4,$  of weight 79. The internal representation of  $\zeta$  is 4 92492492 49249249 2492db6d b6db6db6db6db6db6db6

### B Comparing some modular reduction routines

The use of a square root friendly polynomial can slow down modular reduction, but we already observed that this performance loss is minimal. This is explained by the fact that even though reduction does become more expensive, the amount of additional operations is rather small.

As an example, we report here the reduction code for the two degree 163 polynomials which we used. The input is given as eleven 32-bit words rA,r9,r8,...,r1,r0 and the reduced output is computed in place in the six least significant words r5,r4,r3,r2,r1,r0.

To reduce modulo  $X^{163} + X^7 + X^6 + X^3 + 1$ , the number of necessary logical operations between CPU registers is 74. Reduction modulo  $X^{163} + X^{57} + X^{49} + X^{29} + 1$  takes 89 logical operations.

```
#define bf_mod_163_7_6_3_0(rA,r9,r8,r7,r6,r5,r4,r3,r2,r1,r0) do { \
  /* reduce rA */ \
  r5 ^= (rA) ^ ((rA) << 3) ^ ((rA) << 4) ^ ((rA) >> 3); \
  r4 ^= ((rA) << 29); \
  /* reduce r9 */ \
  r5 ^= ((r9) >> 29) ^ ((r9) >> 28); \
  r4 ^= (r9) ^ ((r9) << 3) ^ ((r9) << 4) ^ ((r9) >> 3); \
  r3 ^= ((r9) << 29); \
  /* reduce r8 */ \
  r4 ^= ((r8) >> 29) ^ ((r8) >> 28); \
  r3 ^= (r8) ^ ((r8) << 3) ^ ((r8) << 4) ^ ((r8) >> 3); \
  r2 ^= ((r8) << 29); \
  /* reduce r7 */ \
  r3 ^= ((r7) >> 29) ^ ((r7) >> 28); \
  r2 ^= (r7) ^ ((r7) << 3) ^ ((r7) << 4) ^ ((r7) >> 3); \
  r1 ^= ((r7) << 29); \
  /* reduce r6 */ \
  r2 ^= ((r6) >> 29) ^ ((r6) >> 28); \
  r1 ^= (r6) ^ ((r6) << 3) ^ ((r6) << 4) ^ ((r6) >> 3); \
  r0 ^= ((r6) << 29); \
  /* reduce the 29 most significant bits of r5 */ \
  r6 = (r5) >> 3; r5 &= 0x00000007; \
  r0 ^= (r6) ^ ((r6) << 3) ^ ((r6) << 6) ^ ((r6) << 7); \
  r1 ^= ((r6) >> 26) ^ ((r6) >> 25); \
} while (0)
#define bf_mod_163_57_49_29_0(rA,r9,r8,r7,r6,r5,r4,r3,r2,r1,r0) do { \
  /* reduce rA */ \
  r6 ^= ((rA) << 22) ^ ((rA) << 14); \
  r5 ^= ((rA) << 26) ^ ((rA) >> 3); \
  r4 ^= ((rA) << 29); \
  /* reduce r9 */ \
  r6 ^= ((r9) >> 10) ^ ((r9) >> 18); \
  r5 ^= ((r9) << 22) ^ ((r9) << 14) ^ ((r9) >> 6); \
  r4 ^= ((r9) << 26) ^ ((r9) >> 3); \
  r3 ^= ((r9) << 29); \
  /* reduce r8 */ \
  r5 ^= ((r8) >> 10) ^ ((r8) >> 18); \
  r4 ^= ((r8) << 22) ^ ((r8) << 14) ^ ((r8) >> 6); \
  r3 ^= ((r8) << 26) ^ ((r8) >> 3); \
  r2 ^= ((r8) << 29); \
  /* reduce r7 */ \
  r4 ^= ((r7) >> 10) ^ ((r7) >> 18); \
  r3 ^= ((r7) << 22) ^ ((r7) << 14) ^ ((r7) >> 6); \
  r2 ^= ((r7) << 26) ^ ((r7) >> 3); \
  r1 ^= ((r7) << 29); \
  /* reduce r6 */ \
  r3 ^= ((r6) >> 10) ^ ((r6) >> 18); \
  r2 ^= ((r6) << 22) ^ ((r6) << 14) ^ ((r6) >> 6); \
  r1 ^= ((r6) << 26) ^ ((r6) >> 3); \
  r0 ^= ((r6) << 29); \
  /* reduce the 29 most significant bits of r5 */ \
  r6 = (r5) >> 3; r5 &= 0x00000007; \
  r2 ^= ((r6) >> 7) ^ ((r6) >> 15); \
  r1 ^= ((r6) << 25) ^ ((r6) << 17) ^ ((r6) >> 3); \
  r0 ^= ((r6) << 29) ^ (r6); \
} while(0)
```