---
import BaseLayout from '../../layouts/BaseLayout.astro';
import PaperDisclaimer from '../../components/PaperDisclaimer.astro';
import PaperHistory from '../../components/PaperHistory.astro';

const EPRINT_URL = 'https://eprint.iacr.org/2020/179';
const CRAWLER = 'marker';
const CONVERTED_DATE = '2026-02-16';
const TITLE_HTML = 'Mind the Middle Layer: The HADES Design Strategy Revisited';
const AUTHORS_HTML = 'Nathan Keller, Asaf Rosemarin';

const CONTENT = `    <section id="abstract" class="mb-10">
      <h2 class="text-2xl font-bold">Abstract</h2>
      <p class="text-gray-300">The HADES design strategy combines the classical SPN construction with the Partial SPN (PSPN) construction, in which at every encryption round, the non-linear layer is applied to only a part of the state. In a HADES design, a middle layer that consists of PSPN rounds is surrounded by outer layers of SPN rounds. The security arguments of HADES with respect to statistical attacks use only the SPN rounds, disregarding the PSPN rounds. This allows the designers to not pose any restriction on the MDS matrix used as the linear mixing operation.

In this paper we show that the choice of the MDS matrix significantly affects the security level provided by HADES designs. If the MDS is chosen properly, then the security level of the scheme against differential and linear attacks is significantly higher than claimed by the designers. On the other hand, weaker choices of the MDS allow for extremely large invariant subspaces that pass the entire middle layer without activating any non-linear operation (a.k.a. S-box).

We showcase our results on the Starkad and Poseidon instantiations of HADES. For Poseidon, we significantly improve the lower bounds on the number of active S-boxes with respect to both differential and linear cryptanalysis provided by the designers -- for example, from 28 to 60 active S-boxes for the t=6 variant. For Starkad, we show that the t=24 variant proposed by the designers admits an invariant subspace of a huge size of $2^{1134}$ that passes any number of PSPN rounds without activating any S-box. Furthermore, we show that the problem can be fixed easily by replacing  t  with any value that is not divisible by four.</p>
      <p class="text-gray-300"><strong>Keywords:</strong> Partial SPN &middot; HADES design &middot; MDS matrix &middot; STARKs &middot; Finite fields.</p>
    </section>

    <section id="sec-1" class="mb-10">
      <h2 class="text-2xl font-bold">1 Introduction</h2>

      <h3 id="sec-1.1" class="text-xl font-semibold mt-8">1.1 Background</h3>

    <p class="text-gray-300">Substitution-permutation network (SPN) is a classical design strategy of cryptographic permutations, used in the AES <a href="#page-27-0">[14]</a> and in numerous other modern cryptosystems. An SPN iterates many times a sequence of operations called 'round', which consists of a layer of local non-linear operations (S-boxes) and a global linear mixing layer. The wide trail strategy, employed in the AES, allows designing SPNs with an easily provable lower bound on the number of active S-boxes in any differential or linear characteristic, thus providing a security guarantee with respect to the most common statistical cryptanalytic attacks.</p>

    <p class="text-gray-300">In 2013, Gerard et al. <a href="#page-26-0">[9]</a> proposed the Partial SPN (PSPN) construction, in which the S-box layer is applied to only a part of the state in each round (in exchange for somewhat increasing the number of rounds). This approach, that has obvious performance advantages in various scenarios, was used in the block ciphers Zorro <a href="#page-26-0">[9]</a> and LowMC <a href="#page-25-0">[1]</a>. A drawback of this approach is that 'clean' security arguments (like the wide trail strategy) are not applicable for PSPNs, and thus, the security of these designs was argued by more ad-hoc approaches. These turned out to be insufficient, as Zorro was practically broken in <a href="#page-26-1">[2]</a> and the security of the initial versions of LowMC was shown in <a href="#page-26-2">[7,</a><a href="#page-26-3">8]</a> to be significantly lower than claimed by the designers.</p>

    <p class="text-gray-300">At Eurocrypt 2020, Grassi et al. <a href="#page-26-4">[12]</a> proposed the HADES design strategy that combines the classical SPN construction with the PSPN construction. In a HADES design, a middle layer of PSPN rounds is surrounded by two layers of SPN rounds. The scheme allows enjoying 'the best of the two worlds' &ndash; the efficiency provided by the PSPN construction, along with the clean security arguments applicable for the SPN construction. Specifically, the security arguments of the cryptosystem with respect to statistical (e.g., differential and linear) attacks are provided only by the SPN (a.k.a. 'full') rounds, using the wide trail strategy. The security arguments with respect to algebraic attacks use also the PSPN rounds, and take advantage of the fact that a partial non-linear layer increases the algebraic degree in essentially the same way as a 'full' non-linear layer. The linear layer in the HADES design is implemented by an MDS matrix (see <a href="#page-27-0">[14]</a>), which guarantees that if the number of S-boxes in any full round is t, then any differential or linear characteristic over two full rounds activates at least t + 1 S-boxes. Since the PSPN rounds are not used in the security arguments with respect to statistical attacks, the HADES designers do not impose any restriction on the MDS used in the scheme. As a specific example, they propose using Cauchy matrices over finite fields (to be defined in Sec. <a href="#page-5-0">2)</a>.</p>

    <p class="text-gray-300">The designers of HADES presented applications of their strategy for securing data transfers with distributed databases using secure multiparty computation (MPC). Subsequently, Grassi et al. proposed Starkad <a href="#page-26-5">[10,</a> initial version] and Poseidon <a href="#page-26-6">[11]</a> &ndash; hash functions whose underlying permutations are instantiations of the HADES methodology, aimed at applications for practical proof systems, such as SNARKs, STARKs, or Bulletproofs. The HADES family of algorithms (including various Starkad and Poseidon variants) was a candidate in the STARK-Friendly Hash Challenge <a href="#page-27-1">[17]</a>.</p>

      <h3 id="sec-1.2" class="text-xl font-semibold mt-8">1.2 Our results</h3>

    <p class="text-gray-300">In this paper we study the effect of the MDS matrix on the security level of HADES designs. We show that when the MDS is chosen properly, the PSPN rounds can be taken into consideration in the security arguments against differential and linear attacks, leading to a very significant improvement in the lower bound on the number of active S-boxes in differential and linear characteristics. On the other hand, we show that a weaker choice of the MDS matrix may lead to existence of huge invariant subspaces for the entire middle layer that do not activate any S-box (for any number of PSPN rounds). Furthermore, for certain instances (albeit, not for the specific instances chosen in <a href="#page-26-5">[10,</a> initial version] and <a href="#page-27-1">[17]</a>), these invariant subspaces allow breaking the hash function with a Gr&uml;obner-basis <a href="#page-26-7">[3]</a> preimage attack.</p>

    <p class="text-gray-300">To be specific, we focus on the variants of Starkad and Poseidon suggested in <a href="#page-26-5">[10,</a> initial version]. Interestingly, our results point out a sharp difference between the cases of a prime field (Poseidon) and a binary field (Starkad).</p>

    <p class="text-gray-300">Analysis of Poseidon. In the case of Poseidon (which operates over a prime field GF(p)), for all variants proposed in <a href="#page-26-5">[10,</a><a href="#page-26-6">11]</a>, we significantly improve the lower bound on the number of active S-boxes in differential and linear characteristics. The improvement is especially large for variants with a small number of S-boxes in each round (denoted in <a href="#page-26-4">[12]</a> by t). For example, for t = 6 (which is the main reference variant provided in the supplementary material of <a href="#page-26-5">[10]</a>), the designers claim a lower bound of 4 &middot; (6 + 1) = 28 active S-boxes, based on application of the wide trail strategy to the 'full' rounds. We prove that the PSPN rounds must activate at least 32 S-boxes, thus more than doubling the lower bound on the number of active S-boxes to 60. For the t = 2 variant, the improvement is most striking: there are at least 41 active S-boxes in the PSPN rounds, while the designers' bound for the SPN rounds is 12 S-boxes. We obtain the new lower bounds using an automated characteristic search tool for PSPNs proposed in <a href="#page-26-1">[2]</a>. A comparison of our new lower bounds and the lower bounds of the designers is presented in Table <a href="#page-3-0">1.</a></p>

    <p class="text-gray-300">Analysis of Starkad. In the case of Starkad (which operates over a binary field GF(2<sup>n</sup>)), perhaps surprisingly, there is a significant difference between different values of t. For t = 24 (which is the main reference variant provided in the supplementary material of <a href="#page-26-5">[10,</a> initial version]), we show that there exists an invariant subspace U of size 2<sup>18</sup>&middot;<sup>63</sup> = 2<sup>1134</sup> that does not activate the S-box in the PSPN rounds. This means that U passes any number of PSPN rounds,</p>

    <div class="overflow-x-auto my-4">
      <table class="min-w-full text-sm text-gray-300">
        <thead>
            <th class="px-3 py-2 border-b border-gray-600 font-semibold text-left">Security</th>
            <th class="px-3 py-2 border-b border-gray-600 font-semibold text-left">t</th>
            <th class="px-3 py-2 border-b border-gray-600 font-semibold text-left"><span class="math">R_F = \\text{Full}</span></th>
            <th class="px-3 py-2 border-b border-gray-600 font-semibold text-left"><span class="math">R_P = Partial</span></th>
            <th class="px-3 py-2 border-b border-gray-600 font-semibold text-left">S-boxes</th>
            <th class="px-3 py-2 border-b border-gray-600 font-semibold text-left">S-boxes</th>
            <th class="px-3 py-2 border-b border-gray-600 font-semibold text-left">S-boxes</th>
        </thead>
        <tbody>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">Level</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left"></td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">Rounds</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">Rounds</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">in <span class="math">R_F</span></td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">in <span class="math">R_P</span></td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">in total</td>
          </tr>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">128</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">2</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">8</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">82</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">12</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">41</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">53</td>
          </tr>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">128</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">4</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">8</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">83</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">20</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">36</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">56</td>
          </tr>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">128</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">6</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">8</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">84</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">28</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">32</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">60</td>
          </tr>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">256</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">8</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">8</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">127</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">36</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">42</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">78</td>
          </tr>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">128</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">16</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">8</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">64</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">68</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">12</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">80</td>
          </tr>
        </tbody>
      </table>
    </div>

    <p class="text-gray-300"><strong>Table 1.</strong> The lower bound on the number of active S-boxes in a differential/linear characteristic, for the full rounds (shown by the designers) and for the PSPN rounds (our results), for various versions of Poseidon</p>

    <p class="text-gray-300">without activating any S-box! On the other hand, for t = 47 and t = 51 (the other variants of Starkad considered in [10, initial version]), there are no t-round differential or linear characteristics that do not activate any S-box.<sup>3</sup> We show that these results are not a coincidence, but rather follow from properties of Cauchy matrices over binary fields. Specifically, we prove the following:</p>

    <p class="text-gray-300"><strong>Theorem 1.</strong> Let  <span class="math">\\mathbb{F} = GF(2^n)</span>  be a binary field. Let  <span class="math">t = 2^k \\cdot s</span>  where  <span class="math">s \\in \\mathbb{N}</span> . Let M be a t-by-t Cauchy matrix over  <span class="math">\\mathbb{F}</span>  constructed according to the Starkad specification. Then there exists a linear subspace  <span class="math">U \\subset \\mathbb{F}^t</span>  of dimension at least  <span class="math">(1 - \\frac{k+1}{2^k})t</span>  such that for any  <span class="math">\\ell \\in \\mathbb{N}</span>  and for any  <span class="math">x \\in U</span> , the top n bits of  <span class="math">M^\\ell x</span>  are equal to zero. Consequently, application of any number of PSPN rounds to any  <span class="math">x \\in U</span>  does not activate any S-box.</p>

    <p class="text-gray-300">Theorem 1 implies that for any t that is divisible by 4, there is a huge subspace U of size at least  <span class="math">2^{nt/4}</span>  that passes any number of PSPN rounds without activating any S-box. (This follows from applying the theorem with k=2 and s=t/4.) In fact, we conjecture that the lower bound on the dimension of the subspace in Theorem 1 can be improved to  <span class="math">(1-\\frac{2}{2^k})t</span>  (which would fully explain the size of the invariant subspace for the t=24 variant of Starkad). We verified this conjecture experimentally for many values of n and t, including all variants of Starkad proposed in [10, initial version]. The sizes of the invariant subspace for n=63 and several representative values of t are given in Table 2.</p>

    <p class="text-gray-300">An especially notable case is Starkad variants with  <span class="math">t = 2^k</span> . For such variants, we show that the MDS is essentially an <em>involution</em>.</p>

    <p class="text-gray-300"><strong>Theorem 2.</strong> Let  <span class="math">\\mathbb{F} = GF(2^n)</span>  be a binary field, and let  <span class="math">t = 2^k</span>  for  <span class="math">k \\in \\mathbb{N}</span> . Let M be a t-by-t Cauchy matrix over  <span class="math">\\mathbb{F}</span>  constructed according to the Starkad specification. Then  <span class="math">M^2 = \\alpha I</span> , where  <span class="math">\\alpha = (\\sum_{j=2^k}^{2^{k+1}-1} j^{-1})^2</span> . Consequently, there</p>

    <p class="text-gray-300"><sup>&amp;</sup>lt;sup&gt;3</sup> We note that for the specific variants with t = 47,51 proposed in [10], there does exist a large subspace that does not activate any S-box in the PSPN rounds, since the number of these rounds (25 for t = 47 and 24 for t = 51) is smaller than t. While this might be undesirable, this is an inevitable result of the choice of the number of PSPN rounds, that does not depend on the MDS matrix.</p>

    <div class="overflow-x-auto my-4">
      <table class="min-w-full text-sm text-gray-300">
        <thead>
            <th class="px-3 py-2 border-b border-gray-600 font-semibold text-left">t</th>
            <th class="px-3 py-2 border-b border-gray-600 font-semibold text-left">Dimension of</th>
            <th class="px-3 py-2 border-b border-gray-600 font-semibold text-left">t</th>
            <th class="px-3 py-2 border-b border-gray-600 font-semibold text-left">Dimension of</th>
            <th class="px-3 py-2 border-b border-gray-600 font-semibold text-left">t</th>
            <th class="px-3 py-2 border-b border-gray-600 font-semibold text-left">Dimension of</th>
        </thead>
        <tbody>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left"></td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">invariant subspace</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left"></td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">invariant subspace</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left"></td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">invariant subspace</td>
          </tr>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">4</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">2</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">6</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">0</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">8</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">6</td>
          </tr>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">10</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">0</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">13</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">0</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">16</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">14</td>
          </tr>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">18</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">0</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">21</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">0</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">24</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">18</td>
          </tr>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">28</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">14</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">32</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">30</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">42</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">0</td>
          </tr>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">46</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">0</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">47</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">0</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">48</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">42</td>
          </tr>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">50</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">0</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">51</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">0</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">52</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">26</td>
          </tr>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">56</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">42</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">64</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">62</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">70</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">0</td>
          </tr>
        </tbody>
      </table>
    </div>

    <p class="text-gray-300"><strong>Table 2.</strong> The dimension of the invariant subspace whose elements do not activate S-boxes for any number of PSPN rounds, as a function of t (the number of S-boxes in each round), for a Starkad cipher over the field  <span class="math">GF(2^{63})</span></p>

    <p class="text-gray-300">exists a linear subspace  <span class="math">U \\subset \\mathbb{F}^t</span>  of dimension at least t-2 such that for any  <span class="math">\\ell \\in \\mathbb{N}</span>  and for any  <span class="math">x \\in U</span> , the top n bits of  <span class="math">M^{\\ell}x</span>  are equal to zero.</p>

    <p class="text-gray-300">As can be seen in Table 2, Theorem 2 is tight for all checked variants (i.e., n=63 and t=4,8,16,32,64).</p>

    <p class="text-gray-300">We obtain Theorems 1 and 2 via an extensive study of properties of Cauchy matrices over binary fields.<sup>4</sup> As Cauchy matrices are widely used (e.g., for error correcting codes, see [15]), these linear-algebraic results are of independent interest.</p>

    <p class="text-gray-300">Of course, a crucial question is whether these invariant subspaces can be used to actually attack Starkad. We show that they indeed can be used to mount a Gr&ouml;bner-basis preimage attack proposed by Beyne et al. [6, Sec. 6.2], and that for certain choices of the parameters (e.g., a variant over the field  <span class="math">GF(2^{127})</span>  aimed at a 256-bit security level, like the variant proposed in the STARK-Friendly Hash Challenge [17], with 16 S-boxes in each round instead of 14), the resulting attack breaks the security claims of the hash function.</p>

    <p class="text-gray-300">On the other hand, our results show that this deficiency can be fixed easily: it is sufficient to choose a value of t that is not divisible by 4 (see Table 2). Furthermore, we show that various other mild changes (such as slightly altering the way in which the sequences  <span class="math">\\{x_i\\}, \\{y_j\\}</span>  used in the construction of the Cauchy matrix are selected) are also sufficient for avoiding the existence of an invariant subspace.</p>

    <p class="text-gray-300">Hence, our results (both on Poseidon and on Starkad) suggest that properly designing the MDS matrix and taking it into consideration in the analysis allows significantly improving the security guarantee of HADES constructions with respect to statistical attacks.</p>

    <p class="text-gray-300"><sup>&amp;</sup>lt;sup&gt;4</sup> We note that a variant of the easier Theorem 2 was independently and concurrently obtained in [6, Appendix C].</p>

      <h3 id="sec-1.3" class="text-xl font-semibold mt-8">1.3 Practical impact of our results and subsequent work</h3>

    <p class="text-gray-300">In the short time since the initial version of this paper appeared on eprint, its results had a practical impact:</p>

    <p class="text-gray-300">Our results for strong MDS matrices. The designers of Starkad and Poseidon accepted our results and included them in the amended security analysis presented in <a href="#page-26-5">[10,</a> updated version, Sec. 5.4.1] and <a href="#page-26-6">[11]</a>. In particular, the authors of <a href="#page-26-5">[10,</a><a href="#page-26-6">11]</a> agreed with our claim that as far as statistical attacks are concerned, several full rounds could be replaced by partial rounds without reducing the security claims. Nevertheless, they decided to not reduce the number of full rounds in the amended version, since the full rounds are advantageous over partial rounds also with respect to certain algebraic attacks, such as Gr&uml;obner basis attacks (see <a href="#page-26-5">[10,</a> updated version, Sec. 5.4.1]).</p>

    <p class="text-gray-300">Our results for weak MDS matrices. Following our results, the designers of Starkad and Poseidon amended the design in such a way that invariant subspaces that pass an infinite number of PSPN rounds would not be possible (see <a href="#page-26-5">[10]</a>). To this end, they adopted the amednments we proposed (and in particular, required t to be odd), along with other amendments.</p>

    <p class="text-gray-300">In addition, the STARK-Friendly Hash Challenge <a href="#page-27-1">[17]</a> cryptanalytic committee used our results, alongside other results, to motivate their recommendation to remove Starkad from consideration in the challenge (see <a href="#page-26-9">[4,</a> Sec. 4]).</p>

    <p class="text-gray-300">Subsequent work. Motivated by our results, Grassi et al. <a href="#page-27-3">[13]</a> presented a systematic study of linear layers for which the cipher admits an invariant subspace that passes all PSPN rounds for free. The results of the analysis were used to determine the requirements on the MDS matrix used in the amended variant of Starkad and Poseidon <a href="#page-26-5">[10,</a> updated version].</p>

      <h3 id="sec-1.4" class="text-xl font-semibold mt-8">1.4 Organization of the paper</h3>

    <p class="text-gray-300">This paper is organized as follows. We briefly describe the HADES construction and its instantiations, Starkad and Poseidon, in Section <a href="#page-5-0">2.</a> In Section <a href="#page-7-0">3</a> we present our results on variants of Poseidon. In Section <a href="#page-8-0">4</a> we explore a special class of matrices over binary fields (which includes Cauchy matrices of the type used in Starkad) and obtain the linear-algebraic results required for proving Theorems <a href="#page-3-2">1</a> and <a href="#page-3-3">2.</a> In Section <a href="#page-17-0">5</a> we present our results on variants of Starkad, and in particular, prove Theorems <a href="#page-3-2">1</a> and <a href="#page-3-3">2.</a> We conclude the paper with a discussion and open problems in Section <a href="#page-23-0">6.</a></p>

    </section>

    <section id="sec-2" class="mb-10">
      <h2 class="text-2xl font-bold">2 The HADES construction</h2>

    <p class="text-gray-300">In this section we briefly describe the structure of a HADES permutation <a href="#page-26-4">[12]</a>. A block cipher / permutation designed according to the HADES strategy employs four types of operations:</p>

    <p class="text-gray-300">    <img src="_page_6_Figure_0.jpeg" alt="" class="my-4 max-w-full" />
</p>

    <p class="text-gray-300">Fig. 1. The HADES construction</p>

    <ul class="list-disc list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li><ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li>AddRoundKey, denoted by  <span class="math">ARK(\\cdot)</span>  a bitwise XOR of a round subkey (or a round constant for unkeyed designs) with the state;</li>
    </ol></li>
      <li><ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li>Full S-box Layer, denoted by  <span class="math">S(\\cdot)</span>  parallel application of t copies of an identical S-box to the entire state;</li>
    </ol></li>
      <li><ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li>Partial S-box Layer, denoted by  <span class="math">S^*(\\cdot)</span>  application of a single S-box to a part of the state, while the rest of the state remains unchanged;</li>
    </ol></li>
      <li><ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li>Mixing Layer, denoted by  <span class="math">M(\\cdot)</span>  multiplication of the entire state by an MDS matrix.</li>
    </ol></li>
    </ul>

    <p class="text-gray-300">A full round is defined as  <span class="math">M \\circ S \\circ ARK(\\cdot)</span> , and a partial round is defined as  <span class="math">M \\circ S^* \\circ ARK(\\cdot)</span> . The cipher consists of  <span class="math">R_f</span>  full rounds, followed by  <span class="math">R_P</span>  full rounds, followed by  <span class="math">R_f</span>  full rounds, where the parameters  <span class="math">R_P, R_f</span>  are chosen by a complex rule intended mainly to thwart algebraic attacks. The structure of HADES is demonstrated in Figure 1.</p>

    <p class="text-gray-300">In this paper, we study the Poseidon and Starkad permutations [10], built according to the HADES design strategy. Poseidon works over a finite field GF(p), while Starkad works over a binary field  <span class="math">GF(2^n)</span> . Starkad uses only the S-box  <span class="math">S(x) = x^3</span> , while Poseidon uses also  <span class="math">x^{-1}</span>  and  <span class="math">x^5</span> . For our purposes, the choice of the S-box is not relevant.</p>

    <p class="text-gray-300">The block ciphers are parameterized by  <span class="math">R_P, R_f</span>  (as in HADES), n &ndash; the logarithm of the field size, and t &ndash; the number of S-boxes applied in each full round.</p>

    <p class="text-gray-300">The MDS matrix. The design component on which we focus in this work is the MDS matrix used in the linear layer. In the case of a binary field GF(2n), the matrix is a so-called Cauchy matrix, constructed as follows.</p>

    <p class="text-gray-300">First, a constant r is chosen. Then, one sets up two sequences {xi}, {yj} of length t, by choosing a staring point x<sup>0</sup> and setting</p>

    <p class="text-gray-300"><span class="math">$\\forall i \\in [t] : x_i \\triangleq x_0 + i - 1, y_i \\triangleq x_i + r,</span>$</p>

    <p class="text-gray-300">where + denotes integer addition. The t-by-t MDS matrix M is set as</p>

    <p class="text-gray-300"><span class="math">$M_{i,j} = (x_i \\oplus y_j)^{-1},</span>$</p>

    <p class="text-gray-300">where the inversion is taken in the field GF(2n). In all Starkad variants presented in <a href="#page-26-5">[10]</a>, the parameters x0, r are set to 0, t, respectively. The construction for a prime F<sup>p</sup> (on which we do not focus) is similar to the binary case.</p>

    <p class="text-gray-300">In this section we show that the lower bounds on the number of active S-boxes in a differential or a linear characteristic obtained by the designers of Poseidon, can be improved significantly by taking into consideration active S-boxes in PSPN rounds and lower bounding their number.</p>

    <p class="text-gray-300">In order to lower-bound the number of active S-boxes, we use a generic characteristic search algorithm for PSPNs, presented by Bar-On et al. <a href="#page-26-1">[2]</a> at Eurocrypt 2015. For a parameter a, the algorithm allows computing the (provably) minimal number r of rounds such that any r-round differential/linear characteristic must activate at least a + 1 S-boxes.</p>

    <p class="text-gray-300">The idea behind the algorithm is to enumerate patterns of active/non-active S-boxes and to check the validity of each pattern by posing a homogeneous linear equation on each non-active S-box, and linearizing the output of active S-boxes by introducing new variables. As for checking an r-round variant, the algorithm has to sieve rt<sup>0</sup> &le;a possible patterns of active S-boxes, where t 0 is the number of S-boxes in each PSPN round, the running time of the algorithm is determined by the parameters a, r, t<sup>0</sup> . In addition, the complexity depends on t &ndash; the number of S-boxes in each full round, which affects the complexity of multipication by the MDS matrix (an operation used extensively in the algorithm). As a result, for smaller values of t, we were able to run the algorithm up to larger values of a.</p>

    <p class="text-gray-300">For t = 2, the algorithm is not needed. Indeed, the MDS property of the matrix guarantees that both S-boxes are active every second round, and hence, the lower bound on the number of active S-boxes in an r-round characteristic is at least r/2. The t = 2 variant of Poseidon has 82 PSPN rounds, and thus, any characteristic over the PSPN rounds has at least 41 active S-boxes. Interestingly, the lower bound obtained by the designers using the wide trail strategy is much lower &ndash; only 12 active S-boxes.</p>

    <p class="text-gray-300">For t = 6, which is the main variant proposed by the designers, we were able to run the algorithm up to a = 8, showing that there is no characteristic with at most 8 active S-boxes for 22 rounds. As this variant of Poseidon contains 84 possible rounds, our result implies that any characteristic for the PSPN rounds of Poseidon activates at least 32 S-boxes. This number is higher than the lower bound proved by the designers &ndash; 28 active S-boxes in the SPN rounds. Combining the bounds, we obtain a provable lower bound of 60 active S-boxes for the entire cipher, more than doubling the bound proved by the designers.</p>

    <p class="text-gray-300">For large values of t (e.g., t = 16), the lower bound that follows from the wide trail strategy becomes much more effective, and on the other hand, the number of PSPN rounds is reduced. As a result, our lower bound for the PSPN rounds is less effective for these variants.</p>

    <p class="text-gray-300">It should be emphasized that for all variants and for all values of a we were able to check, the minimal number of rounds for which any characteristic must activate at least a + 1 S-boxes is t + 2a &ndash; matching exactly the generic estimate of <a href="#page-26-1">[2]</a>. This suggests that in this respect, the MDS matrices of all Poseidon variants achieve the effect of 'random' matrices.</p>

    <p class="text-gray-300">The lower bounds we obtained on the number of active S-boxes for different variants of Poseidon, along with the maximal values of a we were able to check, are presented in Table <a href="#page-7-0">3.</a> The code we used is publicly available.<a href="#page-8-1">5</a> The exact description of the algorithm is given in Appendix <a href="#page-27-4">A.</a></p>

    <div class="overflow-x-auto my-4">
      <table class="min-w-full text-sm text-gray-300">
        <thead>
            <th class="px-3 py-2 border-b border-gray-600 font-semibold text-left">Security t RF</th>
            <th class="px-3 py-2 border-b border-gray-600 font-semibold text-left"></th>
            <th class="px-3 py-2 border-b border-gray-600 font-semibold text-left"></th>
            <th class="px-3 py-2 border-b border-gray-600 font-semibold text-left">RP</th>
            <th class="px-3 py-2 border-b border-gray-600 font-semibold text-left">Field</th>
            <th class="px-3 py-2 border-b border-gray-600 font-semibold text-left"></th>
            <th class="px-3 py-2 border-b border-gray-600 font-semibold text-left">a S-boxes S-boxes S-boxes</th>
            <th class="px-3 py-2 border-b border-gray-600 font-semibold text-left"></th>
        </thead>
        <tbody>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">level</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left"></td>
            <td class="px-3 py-2 border-b border-gray-700 text-left"></td>
            <td class="px-3 py-2 border-b border-gray-700 text-left"></td>
            <td class="px-3 py-2 border-b border-gray-700 text-left"></td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">in Rf</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">in RP</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">in total</td>
          </tr>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">128</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">2</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">8</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left"></td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">82 GF(p) -</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">12</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">41</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">53</td>
          </tr>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">128</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">4</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">8</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left"></td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">83 GF(p) 12</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">20</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">36</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">56</td>
          </tr>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">128</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">6</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">8</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left"></td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">84 GF(p) 8</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">28</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">32</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">60</td>
          </tr>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">256</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">8</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">8</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left"></td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">127 GF(p) 7</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">36</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">42</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">78</td>
          </tr>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">128</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">16</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">8</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left"></td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">64 GF(p) 5</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">68</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">12</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">80</td>
          </tr>
        </tbody>
      </table>
    </div>

    <p class="text-gray-300">Table 3. Lower bounds on the number of active S-boxes in a differential or a linear characteristic over the PSPN rounds, for variants of Poseidon. The column 'a' denotes the number of active S-boxes checked by our algorithm.</p>

    <p class="text-gray-300">In this section we study the properties of a certain class of matrices over commutative rings with characteristic 2 (e.g., binary fields GF(2<sup>n</sup>)). As we will show</p>

    <p class="text-gray-300"><sup>5</sup> The link to the code is: https://anonymous.4open.science/r/bc580cca-659f-4e8fb8c1-9dfcd5fb75a2/.</p>

    <p class="text-gray-300">in Section 5, the MDS matrix used in Starkad belongs to this class (for all variants of Starkad), and thus, the results of this section will allow us to study the security of the middle layer of Starkad constructions.</p>

      <h3 id="sec-4.1" class="text-xl font-semibold mt-8">4.1 Special matrices and their basic properties</h3>

    <p class="text-gray-300">Special matrices 6 are matrices of order  <span class="math">2^k</span>  (for  <span class="math">k \\in \\mathbb{N} \\cup \\{0\\}</span> ) over a ring R, defined in the following inductive way.</p>

    <p class="text-gray-300"><strong>Definition 1.</strong> For k=0, any  <span class="math">1\\times 1</span>  matrix over R is a special matrix. For  <span class="math">k\\geq 1</span> , a matrix  <span class="math">M\\in R^{2^k\\times 2^k}</span>  is a special matrix if  <span class="math">M=\\begin{bmatrix}A&amp;B\\\\B&amp;A\\end{bmatrix}</span> , where A and B are special matrices.</p>

    <p class="text-gray-300">The following proposition summarizes some basic properties of special matrices. Most importantly, it shows that special matrices commute.</p>

    <p class="text-gray-300"><strong>Proposition 1.</strong> Let R be a ring, let  <span class="math">k \\ge 0</span> , and let  <span class="math">S_k</span>  be the set of all  <span class="math">2^k \\times 2^k</span>  special matrices over R. Then  <span class="math">S_k</span>  is a commutative subring of  <span class="math">R^{2^k \\times 2^k}</span> .</p>

    <p class="text-gray-300"><em>Proof.</em> We have to show that for any  <span class="math">k \\geq 0</span> , if  <span class="math">M_1, M_2 \\in \\mathbb{R}^{2^k \\times 2^k}</span>  are special matrices, then:</p>

    <ul class="list-disc list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li><ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li><span class="math">-M_1, M_1 + M_2</span> , and  <span class="math">M_1 \\cdot M_2</span>  are special matrices;</li>
    </ol></li>
      <li><ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li><span class="math">M_1</span>  and  <span class="math">M_2</span>  commute.</li>
    </ol></li>
    </ul>

    <p class="text-gray-300">The proof is a simple induction on k; we provide it for the sake of completeness. For k = 0 the claim is obvious. For k &gt; 0, assume the claim holds for k - 1, and let</p>

    <p class="text-gray-300">
<span class="math">$M_1 = \\begin{bmatrix} A &amp; B \\\\ B &amp; A \\end{bmatrix}, M_2 = \\begin{bmatrix} C &amp; D \\\\ D &amp; C \\end{bmatrix}</span>$</p>

    <p class="text-gray-300">be  <span class="math">2^k \\times 2^k</span>  special matrices. We have  <span class="math">M_1 + M_2 = \\begin{bmatrix} A+C &amp; B+D \\\\ B+D &amp; A+C \\end{bmatrix}</span> . As by the induction hypothesis, A+C and B+D are special matrices,  <span class="math">M_1+M_2</span>  is a special matrix as well.</p>

    <p class="text-gray-300">Similarly, for any  <span class="math">c \\in R</span>  (and in particular, for c = -1),</p>

    <p class="text-gray-300"><span class="math">$c \\cdot M_1 = \\begin{bmatrix} c \\cdot A &amp; c \\cdot B \\\\ c \\cdot B &amp; c \\cdot A \\end{bmatrix},</span>$</p>

    <p class="text-gray-300">and thus by the induction hypothesis,  <span class="math">c \\cdot M_1</span>  is a special matrix.</p>

    <p class="text-gray-300">Furthermore, we have</p>

    <p class="text-gray-300"><span class="math">$M_1 \\cdot M_2 = \\begin{bmatrix} A \\cdot C + B \\cdot D \\ A \\cdot D + B \\cdot C \\\\ B \\cdot C + A \\cdot D \\ B \\cdot D + A \\cdot C \\end{bmatrix} = \\begin{bmatrix} X \\ Y \\\\ Y \\ X \\end{bmatrix},</span>$</p>

    <p class="text-gray-300"><sup>&amp;</sup>lt;sup&gt;6</sup> We refrain from giving a meaningful name to this class of matrices, since most probably it was already considered in previous works (which we were not able to find so far).</p>

    <p class="text-gray-300">where X = A &middot; C + B &middot; D and Y = A &middot; D + B &middot; C. By the induction hypothesis X and Y are special matrices, and thus, M<sup>1</sup> &middot; M<sup>2</sup> is a special matrix as well.</p>

    <p class="text-gray-300">To show that special matrices commute, we first observe that they are symmetric. Indeed, we have</p>

    <p class="text-gray-300"><span class="math">$M_1^T = \\begin{bmatrix} A^T &amp; B^T \\\\ B^T &amp; A^T \\end{bmatrix} = \\begin{bmatrix} A &amp; B \\\\ B &amp; A \\end{bmatrix} = M_1,</span>$</p>

    <p class="text-gray-300">where the middle equality follows by induction on k. Now, let M1, M<sup>2</sup> be special matrices. We have</p>

    <p class="text-gray-300"><span class="math">$M_1 \\cdot M_2 = (M_1 \\cdot M_2)^T = M_2^T \\cdot M_1^T = M_2 \\cdot M_1,</span>$</p>

    <p class="text-gray-300">where the first equality uses the fact that M<sup>1</sup> &middot;M<sup>2</sup> is a special matrix, and hence, is symmetric. This completes the proof.</p>

      <h3 id="sec-4.2" class="text-xl font-semibold mt-8">4.2 Special matrices over commutative rings of characteristic 2</h3>

    <p class="text-gray-300">When R is a commutative ring of characteristic 2 (i.e., a commutative ring such that for any x &isin; R, we have x + x = 0), special matrices over R have more interesting structural properties, as is shown in the following two propositions.</p>

    <p class="text-gray-300">In particular, a special matrix has a single eigenvalue and is 'almost' an involution, and we have det(M<sup>1</sup> + M2) = det M<sup>1</sup> + det M<sup>2</sup> for any pair M1, M<sup>2</sup> of special matrices over R.</p>

    <p class="text-gray-300">Proposition 2. Let R be a commutative ring of characteristic 2, let k &isin; N&cup;{0}, and let M &isin; R<sup>2</sup> <sup>k</sup>&times;2 k be a special matrix. Then:</p>

    <ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li>M has exactly one eigenvalue, which is the sum of elements in each of its rows. Consequently, the characteristic polynomial of M is</li>
    </ol>

    <p class="text-gray-300"><span class="math">$f_M(x) = (x - \\lambda(M))^{2^k},</span>$</p>

    <p class="text-gray-300">where &lambda;(M) is the unique eigenvalue of M, and det(M) = &lambda;(M) 2 k . 2. We have M<sup>2</sup> = &lambda;(M) 2 &middot; I.</p>

    <p class="text-gray-300">Proof. By induction on k. For k = 0 the claim is obvious. For k &gt; 0, assume the claim holds for k &minus; 1, and let M = A B B A be a 2<sup>k</sup> &times; 2 k special matrix. The characteristic polynomial of M, which we denote by fM(&lambda;), satisfies</p>

    <p class="text-gray-300"><span class="math">$f_M(\\lambda) = \\det(\\lambda \\cdot I - M) = \\det\\begin{pmatrix} \\lambda \\cdot I - A &amp; -B \\\\ -B &amp; \\lambda \\cdot I - A \\end{pmatrix}</span>$
<span class="math">$= \\det(\\lambda \\cdot I - A + B) \\cdot \\det(\\lambda \\cdot I - A - B),</span>$</p>

    <p class="text-gray-300">where the last equality uses the well-known formula</p>

    <p class="text-gray-300"><span class="math">$\\det(\\begin{bmatrix} X &amp; Y \\\\ Y &amp; X \\end{bmatrix}) = \\det(X + Y) \\cdot \\det(X - Y),</span>$</p>

    <p class="text-gray-300">which is a special case of Theorem <a href="#page-15-0">3</a> below. As char(R) = 2, we have</p>

    <p class="text-gray-300"><span class="math">$f_M(\\lambda) = \\det(\\lambda \\cdot I - A + B) \\cdot \\det(\\lambda \\cdot I - A - B) = \\det(\\lambda \\cdot I - (A + B))^2.</span>$</p>

    <p class="text-gray-300">Since A + B is a special matrix by Proposition <a href="#page-9-1">1,</a> we can use the induction hypothesis to deduce</p>

    <p class="text-gray-300"><span class="math">$f_M(x) = f_{A+B}(x)^2 = (x - \\lambda(A+B))^{2^k}.</span>$</p>

    <p class="text-gray-300">Thus, &lambda;(A+B) is the only eigenvalue of M, and so we have fM(x) = (x&minus;&lambda;(M))<sup>2</sup> k and det(M) = &lambda;(M) 2 k , as asserted.</p>

    <p class="text-gray-300">Since char(R) = 2, and as special matrices commute by Proposition <a href="#page-9-1">1,</a> we have</p>

    <p class="text-gray-300"><span class="math">$M^2 = \\begin{bmatrix} A^2 + B^2 &amp; AB + BA \\\\ BA + AB &amp; A^2 + B^2 \\end{bmatrix} = \\begin{bmatrix} (A+B)^2 &amp; 0 \\\\ 0 &amp; (A+B)^2 \\end{bmatrix}.</span>$</p>

    <p class="text-gray-300">Since A + B is a special matrix, we can use again the induction hypothesis to deduce</p>

    <p class="text-gray-300"><span class="math">$M^{2} = \\begin{bmatrix} (A+B)^{2} &amp; 0\\\\ 0 &amp; (A+B)^{2} \\end{bmatrix} = \\begin{bmatrix} \\lambda(A+B)^{2} \\cdot I &amp; 0\\\\ 0 &amp; \\lambda(A+B)^{2} \\cdot I \\end{bmatrix} = \\lambda(M)^{2} \\cdot I.</span>$</p>

    <p class="text-gray-300">Finally, note that in any special matrix, the sums of elements in all rows are equal. Hence, the sum of elements in each row is an eigenvalue, that corresponds to the eigenvector (1, 1, . . . , 1). This completes the proof.</p>

    <p class="text-gray-300">Proposition 3. Let R be a commutative ring of characteristic 2, let k &isin; N&cup;{0}, and let M1, M<sup>2</sup> &isin; R<sup>2</sup> <sup>k</sup>&times;2 k be special matrices. Then</p>

    <ul class="list-disc list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li><ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li>det(M<sup>1</sup> + M2) = det(M1) + det(M2);</li>
    </ol></li>
      <li><ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li>&lambda;(M<sup>1</sup> + M2) = &lambda;(M1) + &lambda;(M2);</li>
    </ol></li>
      <li><ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li>&lambda;(M<sup>1</sup> &middot; M2) = &lambda;(M1) &middot; &lambda;(M2),</li>
    </ol></li>
    </ul>

    <p class="text-gray-300">where &lambda;(M) denotes the unique eigenvalue of the special matrix M.</p>

    <p class="text-gray-300">Proof. Let</p>

    <p class="text-gray-300"><span class="math">$M_1 = \\begin{bmatrix} A &amp; B \\\\ B &amp; A \\end{bmatrix}, M_2 = \\begin{bmatrix} C &amp; D \\\\ D &amp; C \\end{bmatrix} \\in R^{2^k \\times 2^k}.</span>$</p>

    <p class="text-gray-300">We have</p>

    <p class="text-gray-300"><span class="math">$\\lambda(M_1 + M_2) = \\lambda(A + B + C + D) = \\lambda(A + B) + \\lambda(C + D) = \\lambda(M_1) + \\lambda(M_2),</span>$</p>

    <p class="text-gray-300">where the first and last transitions follow from the fact that &lambda;(M) = &lambda;(A + B) as was shown in the proof of Proposition <a href="#page-10-0">2,</a> and the middle transition uses the induction hypothesis.</p>

    <p class="text-gray-300">Since char(R) = 2 and R is commutative, we have</p>

    <p class="text-gray-300"><span class="math">$\\det(M_1 + M_2) = \\lambda (M_1 + M_2)^{2^k} = (\\lambda (M_1) + \\lambda (M_2))^{2^k}</span>$
<span class="math">$= \\lambda (M_1)^{2^k} + \\lambda (M_2)^{2^k} = \\det(M_1) + \\det(M_2).</span>$</p>

    <p class="text-gray-300">Finally, as  <span class="math">(1,1,\\ldots,1)</span>  is an eigenvector of both  <span class="math">M_1</span>  and  <span class="math">M_2</span> , corresponding to the eigenvalues  <span class="math">\\lambda(M_1)</span>  and  <span class="math">\\lambda(M_2)</span> , respectively, it follows that  <span class="math">\\lambda(M_1) \\cdot \\lambda(M_2)</span>  is an eigenvalue of  <span class="math">M_1 \\cdot M_2</span> , corresponding to the same eigenvector. As  <span class="math">M_1 \\cdot M_2</span> is a special matrix, Proposition 2 implies  <span class="math">\\lambda(M_1 \\cdot M_2) = \\lambda(M_1) \\cdot \\lambda(M_2)</span> . This completes the proof.</p>

      <h3 id="sec-4.3" class="text-xl font-semibold mt-8">4.3 Nilpotent special matrices over commutative rings with characteristic 2</h3>

    <p class="text-gray-300">In this subsection we consider the subring  <span class="math">N_k</span>  of  <span class="math">S_k</span>  which consists of the special matrices M that are nilpotent (i.e.,  <span class="math">N_k = \\{M \\in S_k : \\exists t, M^t = 0\\}</span> ). By Proposition 2,  <span class="math">N_k</span>  has a simple characterization:  <span class="math">N_k = \\{M \\in S_k : \\lambda(M) = 0\\}</span> . We aim at showing that the product of any k+1 matrices in  <span class="math">N_k</span>  equals zero. To this end, we need a somewhat complex inductive argument, which uses the following auxiliary operator.</p>

    <p class="text-gray-300"><strong>Definition 2.</strong> For any  <span class="math">k \\geq 1</span> , the operator  <span class="math">*: S^k \\to S^{k-1}</span>  is defined as follows. For any special matrix  <span class="math">M = \\begin{bmatrix} A &amp; B \\\\ B &amp; A \\end{bmatrix} \\in S_k</span> , we define  <span class="math">M^* = A + B</span> . (Note that  <span class="math">M^* \\in S_{k-1}</span>  since the sum of special matrices is a special matrix.)</p>

    <p class="text-gray-300">Basic properties of the operator * are described in the following proposition. The easy proof is provided for the sake of completeness.</p>

    <p class="text-gray-300"><strong>Proposition 4.</strong> Let  <span class="math">M_1, M_2 \\in S_k</span>  for some  <span class="math">k \\geq 1</span> . We have:</p>

    <ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li><p class="text-gray-300"><span class="math">$(M_1 + M_2)^* = M_1^* + M_2^*;</span>$</p></li>
      <li><p class="text-gray-300"><span class="math">(M_1 \\cdot M_2)^* = M_1^* \\cdot M_2^*;</span></p></li>
      <li><p class="text-gray-300"><span class="math">$(M_1 \\cdot M_2)^* = M_1^* \\cdot M_2^*</span>$
;</p></li>
      <li><p class="text-gray-300"><span class="math">$\\lambda(M_1^*) = \\lambda(M_1)</span>$</p></li>
      <li></li>
    </ol>

    <p class="text-gray-300"><em>Proof.</em> Let
<span class="math">$M_1 = \\begin{bmatrix} A &amp; B \\\\ B &amp; A \\end{bmatrix}</span>$
and  <span class="math">M_2 = \\begin{bmatrix} C &amp; D \\\\ D &amp; C \\end{bmatrix}</span>  be special matrices. Then</p>

    <p class="text-gray-300">
<span class="math">$(M_1 + M_2)^* = A + B + C + D = M_1^* + M_2^*.</span>$</p>

    <p class="text-gray-300">Furthermore,
<span class="math">$M_1 \\cdot M_2 = \\begin{bmatrix} AC + BD &amp; AD + BC \\\\ AD + BC &amp; AC + BD \\end{bmatrix}</span>$
, and hence,</p>

    <p class="text-gray-300"><span class="math">$(M_1 \\cdot M_2)^* = AC + BD + AD + BC = (A+B) \\cdot (C+D) = M_1^* \\cdot M_2^*.</span>$</p>

    <p class="text-gray-300">Part (3) was shown in the proof of Proposition 2.</p>

    <p class="text-gray-300">We now define, by induction on  <span class="math">k + \\ell</span> , the notion of a special matrix  <span class="math">M \\in S_k</span> which is a depth- <span class="math">\\ell</span>  zero.</p>

    <p class="text-gray-300"><strong>Definition 3.</strong> For  <span class="math">\\ell = 0</span>  and for any  <span class="math">k \\in \\mathbb{N}</span> , a matrix  <span class="math">M \\in S_k</span>  is a depth-0 zero if and only if  <span class="math">\\lambda(M) = 0</span> .</p>

    <p class="text-gray-300">For any  <span class="math">\\ell, k</span>  such that  <span class="math">\\ell \\geq k</span> , a matrix  <span class="math">M \\in S_k</span>  is a depth- <span class="math">\\ell</span>  zero if and only if it is the zero matrix.</p>

    <p class="text-gray-300">For all
<span class="math">$k &gt; \\ell \\geq 1</span>$
, a matrix  <span class="math">M = \\begin{bmatrix} A &amp; B \\\\ B &amp; A \\end{bmatrix} \\in S_k</span>  is a depth- <span class="math">\\ell</span>  zero if:</p>

    <ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li>A and B are depth- <span class="math">(\\ell-1)</span>  zeros, and 2.  <span class="math">M^* = A + B</span>  is a depth- <span class="math">\\ell</span>  zero.</li>
    </ol>

    <p class="text-gray-300">The zero depth of a matrix  <span class="math">M \\in S_k</span>  is the maximal  <span class="math">\\ell</span> , such that M is a depth- <span class="math">\\ell</span>  zero.</p>

    <p class="text-gray-300">Intuitively, the higher is the zero depth of  <span class="math">M \\in S_k</span>  related to k, the 'closer' is M to the zero matrix. In particular, if the zero depth of M is 0, we only know that  <span class="math">\\lambda(M) = 0</span> . If the zero depth of M is k-1, then M is 'almost zero', in the sense that  <span class="math">M = \\begin{bmatrix} X &amp; X \\\\ X &amp; X \\end{bmatrix}</span> , where  <span class="math">X \\in S_{k-1}</span>  has zero depth k-2. If the zero depth of M is k, then k is the zero matrix.</p>

    <p class="text-gray-300">The two following propositions relate the zero depth of the sum and the product of special matrices to their zero depths.</p>

    <p class="text-gray-300"><strong>Proposition 5.</strong> Let  <span class="math">M_1, M_2 \\in S_k</span>  be special matrices over a commutative ring R with characteristic 2 that are depth- <span class="math">\\ell</span>  zeros, and let  <span class="math">c \\in R</span> . Then  <span class="math">c \\cdot M_1</span>  and  <span class="math">M_1 + M_2</span>  are depth- <span class="math">\\ell</span>  zeros as well.</p>

    <p class="text-gray-300"><em>Proof.</em> For  <span class="math">\\ell=0</span> , the assertion follows immediately from Proposition 3 (i.e., additivity of the eigenvalue for special matrices).</p>

    <p class="text-gray-300">For  <span class="math">\\ell \\geq 1</span> , the proof is an easy induction on k. For k=0 the claim is obvious. Assume the claim holds for k-1 and let</p>

    <p class="text-gray-300"><span class="math">$M_1 = \\begin{bmatrix} A &amp; B \\\\ B &amp; A \\end{bmatrix}, M_2 = \\begin{bmatrix} C &amp; D \\\\ D &amp; C \\end{bmatrix} \\in S_k</span>$</p>

    <p class="text-gray-300">be depth- <span class="math">\\ell</span>  zeros. By definition, A,B,C,D are depth- <span class="math">(\\ell-1)</span>  zeros, and thus, by the induction hypothesis (or by Proposition 3, in the case  <span class="math">\\ell=1</span> ), A+C,B+D (which are the blocks of  <span class="math">M_1+M_2</span> ) are depth- <span class="math">(\\ell-1)</span>  zeros as well. Furthermore,  <span class="math">M_1^*=A+B</span>  and  <span class="math">M_2^*=C+D</span>  are depth- <span class="math">\\ell</span>  zeros, and thus, by the induction hypothesis,  <span class="math">(M_1+M_2)^*=A+B+C+D</span>  is a depth- <span class="math">\\ell</span>  zero as well. Hence,  <span class="math">M_1+M_2</span>  is a depth- <span class="math">\\ell</span>  zero. The proof for  <span class="math">c\\cdot M_1</span>  is similar.</p>

    <p class="text-gray-300"><strong>Proposition 6.</strong> Let  <span class="math">M, L \\in S_k</span>  be special matrices over a commutative ring R with characteristic 2, and assume that:</p>

    <ul class="list-disc list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li><ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li>M is a depth- <span class="math">\\ell</span>  zero for some  <span class="math">\\ell &lt; k</span> ;</li>
    </ol></li>
      <li><ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li>L is a depth-0 zero.</li>
    </ol></li>
    </ul>

    <p class="text-gray-300">Then  <span class="math">M \\cdot L</span>  is a depth- <span class="math">(\\ell + 1)</span>  zero.</p>

    <p class="text-gray-300"><em>Proof.</em> We prove the claim by induction on  <span class="math">k + \\ell</span> . For the base case, we consider  <span class="math">k = 1, \\ell = 0</span> . In this case, since k = 1 and  <span class="math">\\lambda(M) = \\lambda(L) = 0</span> , M and L must be of the form</p>

    <p class="text-gray-300"><span class="math">$M = \\begin{bmatrix} a &amp; a \\\\ a &amp; a \\end{bmatrix}, L = \\begin{bmatrix} b &amp; b \\\\ b &amp; b \\end{bmatrix},</span>$</p>

    <p class="text-gray-300">for some a, b. In such a case,  <span class="math">M \\cdot L = 0</span> , which is a depth-1 zero, as asserted.</p>

    <p class="text-gray-300">Assume the assertion holds for all  <span class="math">k&#x27;, \\ell&#x27;</span>  with  <span class="math">k&#x27; + \\ell&#x27; &lt; k + \\ell</span> , and let</p>

    <p class="text-gray-300"><span class="math">$M = \\begin{bmatrix} A &amp; B \\\\ B &amp; A \\end{bmatrix}, L = \\begin{bmatrix} C &amp; D \\\\ D &amp; C \\end{bmatrix} \\in S_k</span>$</p>

    <p class="text-gray-300">be such that M is a depth- <span class="math">\\ell</span>  zero and  <span class="math">\\lambda(L) = 0</span> . We have</p>

    <p class="text-gray-300"><span class="math">$M \\cdot L = \\begin{bmatrix} AC + BD \\ AD + BC \\\\ AD + BC \\ AC + BD \\end{bmatrix} = \\begin{bmatrix} X \\ Y \\\\ Y \\ X \\end{bmatrix}.</span>$</p>

    <p class="text-gray-300">We consider several cases:</p>

    <p class="text-gray-300">Case 1:  <span class="math">0 &lt; \\ell &lt; k-1</span> . First, we show that  <span class="math">X+Y=(M\\cdot L)^*</span>  is a depth- <span class="math">(\\ell+1)</span>  zero. By Proposition 4, we have  <span class="math">(M\\cdot L)^*=M^*\\cdot L^*</span> .  <span class="math">M^*</span>  is a depth- <span class="math">\\ell</span>  zero by definition and  <span class="math">\\lambda(L^*)=\\lambda(L)=0</span> . Thus, by the induction hypothesis (which can be applied since  <span class="math">\\ell &lt; k-1</span> ),  <span class="math">M^*\\cdot L^*</span>  is a depth- <span class="math">(\\ell+1)</span>  zero.</p>

    <p class="text-gray-300">Now we show that X and Y are depth- <span class="math">\\ell</span>  zeros. As  <span class="math">\\lambda(M)=0</span> , we have  <span class="math">\\lambda(C)=\\lambda(D)</span> . Denote  <span class="math">\\lambda(C)=\\lambda(D)=\\gamma</span> , and let  <span class="math">C&#x27;=C+\\gamma\\cdot I, D&#x27;=D+\\gamma\\cdot I</span> . We have</p>

    <p class="text-gray-300"><span class="math">$X = A \\cdot (C&#x27; + \\gamma \\cdot I) + B \\cdot (D&#x27; + \\gamma \\cdot I) = A \\cdot C&#x27; + B \\cdot D&#x27; + \\gamma \\cdot M^*.</span>$</p>

    <p class="text-gray-300">By Proposition 5,  <span class="math">\\gamma \\cdot M^*</span>  is a depth- <span class="math">\\ell</span>  zero and by the induction hypothesis (which can be applied since  <span class="math">\\ell &gt; 0</span> ),  <span class="math">A \\cdot C&#x27;</span>  and  <span class="math">B \\cdot D&#x27;</span>  are depth- <span class="math">\\ell</span>  zeros as well. Hence, by Proposition 5, X is a depth- <span class="math">\\ell</span>  zero. The proof for Y is similar.</p>

    <p class="text-gray-300">Case 2:  <span class="math">\\ell=0</span> . In this case, the proof that X+Y is a depth-1 zero works like in Case 1.</p>

    <p class="text-gray-300">We now prove that X is a depth-0 zero; the proof for Y is similar. Since M and L are depth-0 zeros, we have  <span class="math">\\lambda(A) = \\lambda(B)</span>  and  <span class="math">\\lambda(C) = \\lambda(D)</span> . Hence, Proposition 3 implies</p>

    <p class="text-gray-300"><span class="math">$\\lambda(X) = \\lambda(AC + BD) = \\lambda(A)\\lambda(C) + \\lambda(B)\\lambda(D) = 0,</span>$</p>

    <p class="text-gray-300">and thus, X is a depth-0 zero, as asserted.</p>

    <p class="text-gray-300">Case 3:  <span class="math">\\ell = k - 1</span> . In this case, the proof that X and Y are depth- <span class="math">\\ell</span>  zeros works like in Case 1. As  <span class="math">X, Y \\in S_{k-1}</span> , this means that X = Y = 0, and thus,  <span class="math">M \\cdot L</span>  is the zero matrix, which is of course a depth- <span class="math">(\\ell + 1)</span> -zero. This completes the proof.</p>

    <p class="text-gray-300">Now we are ready to prove that the product of any k+1 elements of  <span class="math">N_k</span>  is the zero matrix.</p>

    <p class="text-gray-300"><strong>Proposition 7.</strong> Let  <span class="math">M_1, ..., M_{k+1}</span>  be  <span class="math">2^k</span> -by- <span class="math">2^k</span>  nilpotent special matrices over a commutative ring R with characteristic 2. Then</p>

    <p class="text-gray-300"><span class="math">$\\prod_{i=1}^{k+1} M_i = 0.</span>$</p>

    <p class="text-gray-300"><em>Proof.</em> By applying Proposition 6 on the sequence of products  <span class="math">P_j = \\prod_{i=1}^j M_i</span> , we deduce that for all  <span class="math">j \\geq 1</span> ,  <span class="math">P_j</span>  is a depth-(j-1) zero. In particular,  <span class="math">P_{k+1} = \\prod_{i=1}^{k+1} M_i</span>  is a depth-k zero, which means that it is the zero matrix by the definition of zero depth.</p>

      <h3 id="sec-4.4" class="text-xl font-semibold mt-8">4.4 Block matrices with special blocks</h3>

    <p class="text-gray-300">In this subsection we consider s-by-s block matrices over a commutative ring R with characteristic 2, in which each block is a special  <span class="math">2^k</span> -by- <span class="math">2^k</span>  matrix. We aim at showing that the <em>minimal polynomial</em> of any such matrix is of degree at most s(k+1). As an intermediate result, we show that the characteristic polynomial of any such matrix has a very specific structure.</p>

    <p class="text-gray-300">We use the following classical result (see, e.g., [16, Theorem 1]) on determinants of block matrices with commuting blocks.</p>

    <p class="text-gray-300"><strong>Theorem 3.</strong> Let  <span class="math">\\ell, m \\in \\mathbb{N}</span> . Let R be a commutative ring and let S be a commutative subring of  <span class="math">R^{\\ell \\times \\ell}</span> . Let  <span class="math">X \\in S^{m \\times m}</span>  be an m-by-m block matrix over R with  <span class="math">\\ell</span> -by- <span class="math">\\ell</span>  blocks in S. Then  <span class="math">\\det_R(X) = \\det_R(\\det_S(X))</span> .</p>

    <p class="text-gray-300">The theorem asserts that if the blocks of the matrix commute, then in order to compute its determinant, we can first compute the determinant of the 'matrix of blocks' (an m-by-m matrix over the ring S), which in itself is an  <span class="math">\\ell</span> -by- <span class="math">\\ell</span>  matrix over R, and then compute the determinant (over R) of this determinant.</p>

    <p class="text-gray-300">In the case of block matrices over a commutative ring with characteristic 2 whose blocks are special matrices, the computation of the determinant can be further simplified.</p>

    <p class="text-gray-300"><strong>Proposition 8.</strong> Let  <span class="math">k, s \\in \\mathbb{N}</span> . Let R be a commutative ring with characteristic 2, and let M be an s-by-s block matrix over R, each of whose blocks is a  <span class="math">2^k</span> -by- <span class="math">2^k</span>  special matrix. Denote the blocks of M by  <span class="math">\\{M_{i,j}\\}_{i,j=1}^s</span> . Let  <span class="math">M&#x27; \\subset R^{s \\times s}</span>  be defined by  <span class="math">M&#x27;_{i,j} = \\det(M_{i,j})</span> . Then  <span class="math">\\det(M) = \\det(M&#x27;)</span> .</p>

    <p class="text-gray-300">The proposition asserts that for block matrices with special blocks, in order to compute the determinant, we can replace each block with its determinant and compute the determinant of the resulting s-by-s matrix.</p>

    <p class="text-gray-300"><em>Proof.</em> By Theorem 3, we have  <span class="math">\\det(M) = \\det_R(\\det_S(M))</span> . The expression  <span class="math">\\det_S(M)</span>  is a sum-of-products of special matrices. As in the subring  <span class="math">S_k</span>  of special matrices, the determinant is multiplicative and additive by Proposition 3, the expression  <span class="math">\\det_R(\\det_S(M))</span>  does not change if we replace each matrix in  <span class="math">\\det_S(M)</span>  with its determinant. The result is exactly  <span class="math">\\det(M&#x27;)</span> . Thus,  <span class="math">\\det(M) = \\det(M&#x27;)</span> , as asserted.</p>

    <p class="text-gray-300">We are now ready for computing the characteristic polynomial of a block matrix whose blocks are special matrices.</p>

    <p class="text-gray-300"><strong>Proposition 9.</strong> Let  <span class="math">k, s \\in \\mathbb{N}</span> . Let R be a commutative ring with characteristic 2, and let M be an s-by-s block matrix over R, each of whose blocks is a  <span class="math">2^k</span> -by- <span class="math">2^k</span>  special matrix. Denote the blocks of M by  <span class="math">\\{M_{i,j}\\}_{i,j=1}^s</span> . Let  <span class="math">M&#x27;&#x27; \\subset R^{s \\times s}</span>  be defined by  <span class="math">M&#x27;&#x27;_{i,j} = \\lambda(M_{i,j})</span> , where  <span class="math">\\lambda(M_{i,j})</span>  is the unique eigenvalue of the special matrix  <span class="math">M_{i,j}</span> . Denote by  <span class="math">p(x) = f_M(x)</span>  and  <span class="math">q(x) = f_{M&#x27;&#x27;}(x)</span>  the characteristic polynomials of M and M'', respectively. Then  <span class="math">p(x) = q(x)^{2^k}</span> .</p>

    <p class="text-gray-300">Proof. Since  <span class="math">\\operatorname{char}(R) = 2</span> , we have  <span class="math">p(\\lambda) = f_M(\\lambda) = \\det(\\lambda \\cdot I + M)</span> . As the blocks of  <span class="math">\\lambda \\cdot I + M</span>  are special matrices (over the commutative ring  <span class="math">R[\\lambda]</span>  that has characteristic 2), by Proposition 8 the expression  <span class="math">\\det(\\lambda \\cdot I + M)</span>  does not change if we replace each block with its determinant. For non-diagonal blocks  <span class="math">M_{i,j}</span> , the replacement yields  <span class="math">M&#x27;_{i,j}</span> , where M' is as defined in the proof of Proposition 8. For diagonal blocks  <span class="math">M_{i,i}</span> , by Proposition 3 we have</p>

    <p class="text-gray-300"><span class="math">$\\det(\\lambda \\cdot I + M_{i,i}) = \\det(\\lambda \\cdot I) + \\det(M_{i,i}) = \\lambda^{2^k} + M&#x27;_{i,i}.</span>$</p>

    <p class="text-gray-300">Therefore, we have</p>

    <p class="text-gray-300"><span class="math">$p(\\lambda) = \\det(\\lambda \\cdot I + M) = \\det(\\lambda^{2^k} \\cdot I + M&#x27;) = f_{M&#x27;}(\\lambda^{2^k}).</span>$</p>

    <p class="text-gray-300">Denote  <span class="math">f_{M&#x27;}(x) = \\sum_{l=0}^{s} f_l(\\{M&#x27;_{ij}\\}) \\cdot x^l</span> , where each  <span class="math">f_l(\\{M&#x27;_{ij}\\})</span>  is a sum of products of  <span class="math">M&#x27;_{ij}</span> 's. Recall that for any i, j,</p>

    <p class="text-gray-300"><span class="math">$M&#x27;_{i,j} = \\det(M_{i,j}) = (\\lambda(M_{i,j}))^{2^k} = (M&#x27;&#x27;_{i,j})^{2^k}.</span>$</p>

    <p class="text-gray-300">As char(R) = 2 (and so, the function  <span class="math">x \\mapsto x^{2^k}</span>  is linear over R), it follows that for each l,  <span class="math">f_l(\\{M&#x27;_{i,j}\\}) = f_l(\\{M&#x27;&#x27;_{i,j}\\})^{2^k}</span> . Hence,</p>

    <p class="text-gray-300"><span class="math">$f_{M&#x27;}(\\lambda^{2^k}) = \\sum_{l=0}^s f_l(\\{M&#x27;&#x27;_{i,j}\\})^{2^k} (\\lambda^{2^k})^l = (\\sum_{l=0}^s f_l(\\{M&#x27;&#x27;_{i,j}\\})\\lambda^l)^{2^k}.</span>$</p>

    <p class="text-gray-300">Finally, as  <span class="math">\\sum_{l=0}^{s} f_l(\\{M_{i,j}^{&quot;}\\})\\lambda^l = f_{M&#x27;&#x27;}(\\lambda)</span> , we obtain</p>

    <p class="text-gray-300">
<span class="math">$p(\\lambda) = f_{M&#x27;}(\\lambda^{2^k}) = (f_{M&#x27;&#x27;}(\\lambda))^{2^k} = q(\\lambda)^{2^k}.</span>$</p>

    <p class="text-gray-300">This completes the proof.</p>

    <p class="text-gray-300">We are now ready to show that the degree of the minimal polynomial of a block matrix whose blocks are special matrices is much lower than the degree of its characteristic polynomial. Specifically, we prove that its degree is at most s(k+1), while the degree of the characteristic polynomial is  <span class="math">s \\cdot 2^k</span> .</p>

    <p class="text-gray-300"><strong>Proposition 10.</strong> Let  <span class="math">k, s \\in \\mathbb{N}</span> . Let R be a commutative ring with characteristic 2, and let M be an s-by-s block matrix over R, each of whose blocks is a  <span class="math">2^k</span> -by- <span class="math">2^k</span>  special matrix. Denote the blocks of M by  <span class="math">\\{M_{i,j}\\}_{i,j=1}^s</span> . Let  <span class="math">M&#x27;&#x27; \\subset R^{s \\times s}</span>  be defined by  <span class="math">M&#x27;&#x27;_{i,j} = \\lambda(M_{i,j})</span> , where  <span class="math">\\lambda(M_{i,j})</span>  is the unique eigenvalue of the special matrix  <span class="math">M_{i,j}</span> . Denote by  <span class="math">q(x) = f_{M&#x27;&#x27;}(x)</span>  the characteristic polynomial of M''. Then  <span class="math">q(M)^{k+1} = 0</span> .</p>

    <p class="text-gray-300"><em>Proof.</em> First, we claim that q(M) is a block matrix whose blocks are <em>nilpotent</em> special matrices (equivalently, special matrices whose unique eigenvalue is 0). Indeed, the blocks of q(M) are special matrices, since they are sums-of-products of special matrices. Hence, we can represent each such block  <span class="math">(q(M))_{i,j}</span>  in the form  <span class="math">\\sum \\prod A_i</span> , where all  <span class="math">A_i</span>  are special matrices. By Proposition 3, we have</p>

    <p class="text-gray-300"><span class="math">$\\lambda(q(M)_{i,j}) = \\lambda(\\sum \\prod A_i) = \\sum \\prod \\lambda(A_i) = (q(M&#x27;&#x27;))_{i,j} = 0,</span>$</p>

    <p class="text-gray-300">where the last equality holds since q(M'')=0 by the Cayley-Hamilton theorem. Now, we can apply Proposition 7. Consider the matrix  <span class="math">q(M)^{k+1}</span> . Each block of this matrix is a sum of products of k+1 nilpotent  <span class="math">2^k</span> -by- <span class="math">2^k</span>  special matrices. By Proposition 7, each such product is the zero matrix. Hence, each block of  <span class="math">q(M)^{k+1}</span>  is the zero matrix, and thus,  <span class="math">q(M)^{k+1}=0</span> , as asserted.</p>

      <h3 id="sec-4.5" class="text-xl font-semibold mt-8">4.5 A stronger conjectured bound</h3>

    <p class="text-gray-300">We conjecture that Proposition 10 can be further improved, and that in fact, the following holds:</p>

    <p class="text-gray-300">Conjecture 1. Let  <span class="math">k, s \\in \\mathbb{N}</span> . Let R be a commutative ring with characteristic 2, and let M be an s-by-s block matrix over R, each of whose blocks is a  <span class="math">2^k</span> -by- <span class="math">2^k</span>  special matrix. Denote the blocks of M by  <span class="math">\\{M_{i,j}\\}_{i,j=1}^s</span> . Let  <span class="math">M&#x27;&#x27; \\subset R^{s \\times s}</span>  be defined by  <span class="math">M&#x27;&#x27;_{i,j} = \\lambda(M_{i,j})</span> , where  <span class="math">\\lambda(M_{i,j})</span>  is the unique eigenvalue of the special matrix  <span class="math">M_{i,j}</span> . Denote by  <span class="math">q(x) = f_{M&#x27;&#x27;}(x)</span>  the characteristic polynomial of M''. Then  <span class="math">q(M)^2 = 0</span> .</p>

    <p class="text-gray-300">We proved this conjecture for s=2 by a direct computation (which we omit here, being not sufficiently illuminating), and verified it experimentally for many values of t, over various binary fields (including the field  <span class="math">GF(2^{33})</span>  used in Starkad with t=47). In particular, it matches all sizes of invariant subspaces presented in Table 2. However, we were not able to prove the conjecture in general at this stage.</p>

    </section>

    <section id="sec-5" class="mb-10">
      <h2 class="text-2xl font-bold">5 A Large Invariant Subspace in the Middle Layer of Starkad Permutations</h2>

    <p class="text-gray-300">In this section we apply the results on special matrices obtained in Section 4 to show that for many choices of t (i.e., the number of S-boxes in each round), the Starkad permutation admits a huge invariant subspace that allows bypassing any number of PSPN rounds without activating any S-box. We then explain how the invariant subspace can be used to mount a Gr&ouml;bner basis preimage attack on Starkad, using an attack strategy proposed by Beyne et al. [6]. Subsequently, we show that these invariant subspaces can be easily avoided, by a careful choice of parameters, or by very mild changes in the design.</p>

      <h3 id="sec-5.1" class="text-xl font-semibold mt-8">5.1 The Starkad MDS and special matrices</h3>

    <p class="text-gray-300">In this subsection we show that for any choice of the parameters, the Starkad MDS is a block matrix over a binary field  <span class="math">GF(2^n)</span>  (which is, in particular, a commutative ring with characteristic 2), whose blocks are special matrices. This will allow us to deduce Theorems 1 and 2 from the results on special matrices obtained in Section 4.</p>

    <p class="text-gray-300">We start with the case  <span class="math">t = 2^k</span> .</p>

    <p class="text-gray-300"><strong>Proposition 11.</strong> Let  <span class="math">M \\in GF(2^n)^{2^k \\times 2^k}</span>  be a Cauchy matrix generated from the sequences  <span class="math">\\{x_i\\}, \\{y_j\\}</span> , where for each  <span class="math">1 \\le i \\le 2^k</span> , we have  <span class="math">x_i = i - 1</span>  and  <span class="math">y_i = x_i + r</span>  (integer summation), for some r such that  <span class="math">2^k | r</span> . Then M is a special matrix.</p>

    <p class="text-gray-300"><em>Proof.</em> In the following, we use the symbols  <span class="math">\\boxplus</span>  and  <span class="math">\\boxminus</span>  to denote integer addition and subtraction and  <span class="math">\\oplus</span>  to denote bit-wise XOR, which is addition in the field.</p>

    <p class="text-gray-300">We prove the claim by induction on k. For k=0 the claim is obvious, assume the claim holds for k-1. Let  <span class="math">M=\\begin{bmatrix}A&amp;B\\\\C&amp;D\\end{bmatrix}\\in\\mathbb{F}^{2^k\\times 2^k}</span>  be a Cauchy matrix generated as described above. A is obviously a  <span class="math">2^{k-1}\\times 2^{k-1}</span>  Cauchy matrix with</p>

    <p class="text-gray-300"><span class="math">$x_i = i \\boxminus 1, y_i = x_i \\boxminus r,</span>$</p>

    <p class="text-gray-300">and thus, by the induction hypothesis, is a special matrix.</p>

    <p class="text-gray-300">D is a  <span class="math">2^{k-1} \\times 2^{k-1}</span>  Cauchy matrix with</p>

    <p class="text-gray-300"><span class="math">$x_i = 2^{k-1} \\boxplus i \\boxminus 1, y_i = x_i \\boxplus r,</span>$</p>

    <p class="text-gray-300">for all  <span class="math">1 \\leq i \\leq 2^{k-1}</span> . Using the range of the  <span class="math">i \\boxminus 1</span> 's, we conclude that  <span class="math">x_i = 2^{k-1} \\boxplus (i \\boxminus 1) = 2^{k-1} \\oplus x_i&#x27;</span>  for  <span class="math">x_i&#x27; = i \\boxminus 1</span> . Similarly, as  <span class="math">2^k | r, y_i = x_i \\boxplus r = x_i \\oplus r</span> . Thus,</p>

    <p class="text-gray-300"><span class="math">$D_{ij} = (x_i \\oplus y_j)^{-1} = (x_i&#x27; \\oplus 2^{k-1} \\oplus x_j \\oplus r)^{-1} = (x_i&#x27; \\oplus 2^{k-1} \\oplus x_j&#x27; \\oplus 2^{k-1} \\oplus r)^{-1}</span>$
<span class="math">$= (x_i&#x27; \\oplus x_j&#x27; \\oplus r)^{-1} = (x_i&#x27; \\oplus (x_j&#x27; \\oplus r))^{-1} = A_{ij}.</span>$</p>

    <p class="text-gray-300">Hence, D = A.</p>

    <p class="text-gray-300">Define  <span class="math">r&#x27; \\triangleq 2^{k-1} \\oplus r</span> . Notice that B is a Cauchy matrix with  <span class="math">x_i = i \\boxminus 1, y_i = x_i \\boxminus r \\boxminus 2^{k-1}</span> . As  <span class="math">0 \\le x_i &lt; 2^{k-1}</span>  and  <span class="math">2^k | r</span> , we have</p>

    <p class="text-gray-300"><span class="math">$y_i = x_i \\oplus 2^{k-1} \\oplus r = x_i \\oplus r&#x27; = x_i \\boxplus r&#x27;.</span>$</p>

    <p class="text-gray-300">As r' is divisible by  <span class="math">2^{k-1}</span> , we can use the induction hypothesis to conclude that B is also a special matrix.</p>

    <p class="text-gray-300">C is a Cauchy matrix with  <span class="math">x_i = 2^{k \\boxminus 1} \\boxminus (i \\boxminus 1) = 2^{k-1} \\oplus (i-1), y_i = r \\boxminus (i \\boxminus 1) = r \\oplus (i \\boxminus 1)</span> . Thus  <span class="math">C_{ij} = (x_i \\oplus y_j)^{-1} = ((i-1) \\oplus (j-1) \\oplus r&#x27;)^{-1} = B_{ij}</span> . Hence, C = B. We proved that A, B are special and that C = B, D = A. Thus, M is a special matrix, as asserted.</p>

    <p class="text-gray-300"><strong>Corollary 1.</strong> For any  <span class="math">t = 2^k</span> , the MDS in Starkad with t S-boxes in each SPN round is a special matrix.</p>

    <p class="text-gray-300">Corollary 1 follows immediately from Proposition 11, since the sequences  <span class="math">\\{x_i\\}</span>  and  <span class="math">\\{y_j\\}</span>  used in Starkad to generate the Cauchy matrix are exactly those considered in the proposition, and since the parameter r is chosen in Starkad to be equal to t.</p>

    <p class="text-gray-300">Now we consider variants of Starkad with any number t of S-boxes in each round.</p>

    <p class="text-gray-300"><strong>Proposition 12.</strong> Let  <span class="math">t = 2^k \\cdot s</span> , for  <span class="math">k \\ge 0</span>  and  <span class="math">s \\ge 1</span> . Let  <span class="math">M \\in GF(2^n)^{t \\times t}</span>  be a Cauchy matrix generated from the sequences  <span class="math">\\{x_i\\}, \\{y_j\\}</span> , where for each  <span class="math">1 \\le i \\le 2^k</span> , we have  <span class="math">x_i = i - 1</span>  and  <span class="math">y_i = x_i + r</span>  (integer summation), for some r such that  <span class="math">2^k | r</span> . Then M is an  <span class="math">s \\times s</span>  block matrix of  <span class="math">2^k \\times 2^k</span>  special matrices.</p>

    <p class="text-gray-300"><em>Proof.</em> Divide the matrix M into  <span class="math">s \\times s</span>  blocks of  <span class="math">2^k \\times 2^k</span>  matrices. Denote the blocks by  <span class="math">M_{p,q}, 1 \\leq p, q \\leq s</span> . Let  <span class="math">M_{p,q}</span>  be one of the blocks and we will prove that it is a special matrix.  <span class="math">M_{p,q}</span>  is a Cauchy matrix with</p>

    <p class="text-gray-300"><span class="math">$x_i = (i \\boxminus 1) \\boxplus p2^k = (i \\boxminus 1) \\oplus p2^k, y_i = (i \\boxminus 1) \\boxplus q2^k \\boxplus t = (i \\boxminus 1) \\oplus (q2^k \\boxplus t).</span>$</p>

    <p class="text-gray-300">Define  <span class="math">t&#x27; \\triangleq p2^k \\oplus (q2^k \\boxplus t)</span> . We have</p>

    <p class="text-gray-300"><span class="math">$(M_{p,q})_{ij} = ((i \\boxminus 1) \\oplus (j \\boxminus 1) \\oplus (p2^k \\oplus (q2^k \\boxminus t)))^{-1} = ((i \\boxminus 1) \\oplus (j \\boxminus 1) \\oplus t&#x27;)^{-1} = ((i \\boxminus 1) \\oplus ((j \\boxminus 1) \\boxplus t&#x27;))^{-1}.</span>$</p>

    <p class="text-gray-300">Notice that  <span class="math">2^k|t&#x27;</span> , and thus,  <span class="math">M_{p,q}</span>  satisfies the assumption of Proposition 11, and thus, is a special matrix. This completes the proof.</p>

    <p class="text-gray-300"><strong>Corollary 2.</strong> For any  <span class="math">t = 2^k \\cdot s</span> , the MDS in Starkad with t S-boxes in each SPN round is an s-by-s block matrix, each of whose blocks is a special matrix.</p>

    <p class="text-gray-300">Corollary 1 follows immediately from Proposition 11, since  <span class="math">\\{x_i\\}, \\{y_j\\}</span> , and r used in Starkad satisfy the assumption of the proposition.</p>

    <p class="text-gray-300">In this subsection we prove Theorems 1 and 2. The former shows that for any  <span class="math">t=4\\ell</span> , Starkad with t S-boxes in each SPN round admits a large invariant subspace. The latter asserts that if t is a power of 2, then the MDS of Starkad with t S-boxes in each SPN round is essentially an involution.</p>

    <p class="text-gray-300">First, we prove Theorem 1. Let us recall its statement.</p>

    <p class="text-gray-300"><strong>Theorem 1.</strong> Let  <span class="math">\\mathbb{F}=GF(2^n)</span>  be a binary field. Let  <span class="math">t=2^k\\cdot s</span>  where  <span class="math">s\\in\\mathbb{N}</span> . Let M be a t-by-t Cauchy matrix over  <span class="math">\\mathbb{F}</span>  constructed according to the Starkad specification. Then there exists a linear subspace  <span class="math">U\\subset\\mathbb{F}^t</span>  of dimension at least  <span class="math">(1-\\frac{k+1}{2^k})t</span>  such that for any  <span class="math">\\ell\\in\\mathbb{N}</span>  and for any  <span class="math">x\\in U</span> , the top n bits of  <span class="math">M^\\ell x</span>  are equal to zero. Consequently, application of any number of PSPN rounds to any  <span class="math">x\\in U</span>  does not activate any S-box.</p>

    <p class="text-gray-300"><em>Proof.</em> Let M be a matrix that satisfies the assumptions of the theorem. By Corollary 2, it is an s-by-s block matrix, where each block is a  <span class="math">2^k</span> -by- <span class="math">2^k</span>  special matrix. Hence, by Proposition 10, there exists a polynomial q' of degree s(k+1) such that q'(M) = 0.</p>

    <p class="text-gray-300">Let</p>

    <p class="text-gray-300"><span class="math">$U = \\{x \\in GF(2^n)^t : \\forall 0 \\le i \\le s(k+1) - 1, (M^i x)_1 = 0\\},\\</span>$</p>

    <p class="text-gray-300">where  <span class="math">(X)_1</span>  stands for the top n bits of X that enter the unique S-box in the PSPN rounds. Clearly, U is a linear subspace of dimension at least  <span class="math">s(2^k - (k + 1)) = (1 - \\frac{k+1}{2^k})t</span> . We claim that for any  <span class="math">\\ell \\in \\mathbb{N}</span>  and for any  <span class="math">x \\in U</span> , the top n bits of  <span class="math">M^{\\ell}x</span>  are equal to zero. Indeed, using division of polynomials we can write  <span class="math">M^{\\ell} = q&#x27;(M) \\cdot q_0(M) + q_1(M)</span> , where  <span class="math">\\deg(q_1(M)) &lt; \\deg(q&#x27;(M)) = s(k+1)</span> . We have</p>

    <p class="text-gray-300"><span class="math">$(M^{\\ell}x)_1 = (q&#x27;(M) \\cdot q_0(M)x + q_1(M)x)_1 = (q_1(M)x)_1 = 0,</span>$</p>

    <p class="text-gray-300">where the second equality holds since q'(M) = 0 and the last inequality holds since  <span class="math">\\deg(q_1(M)) &lt; s(k+1)</span>  and  <span class="math">x \\in U</span> . This completes the proof.</p>

    <p class="text-gray-300">As for any  <span class="math">k \\ge 2</span>  we have  <span class="math">(k+1)/2^k \\le 3/4</span> , Theorem 1 implies that whenever the number t of S-boxes in each full round of Starkad is divisible by 4, there exists a linear subspace of dimension at least t/4 that does not activate any S-box for any number of PSPN rounds. If t is divisible by 8, the lower bound on the dimension of the subspace increases to t/2, if 16|t, it increases to 11t/16, etc.</p>

    <p class="text-gray-300">In the cases where t is a power of 2, the structure of the Starkad MDS is surprisingly simple, as is shown in Theorem 2. Let us recall its statement.</p>

    <p class="text-gray-300"><strong>Theorem 2.</strong> Let  <span class="math">\\mathbb{F} = GF(2^n)</span>  be a binary field, and let  <span class="math">t = 2^k</span>  for  <span class="math">k \\in \\mathbb{N}</span> . Let M be a t-by-t Cauchy matrix over  <span class="math">\\mathbb{F}</span>  constructed according to the Starkad specification. Then  <span class="math">M^2 = \\alpha I</span> , where  <span class="math">\\alpha = (\\sum_{j=2^k}^{2^{k+1}-1} j^{-1})^2</span> . Consequently, there exists a linear subspace  <span class="math">U \\subset \\mathbb{F}^t</span>  of dimension at least t-2 such that for any  <span class="math">\\ell \\in \\mathbb{N}</span>  and for any  <span class="math">x \\in U</span> , the top n bits of  <span class="math">M^{\\ell}x</span>  are equal to zero.</p>

    <p class="text-gray-300"><em>Proof.</em> Let M be a matrix that satisfies the assumption of the theorem. By Corollary 1, M is a special matrix. By Proposition 2, we have  <span class="math">M^2 = \\alpha \\cdot I</span> , where  <span class="math">\\alpha = \\lambda(M)^2</span> , and  <span class="math">\\lambda(M)</span>  (i.e., the unique eigenvalue of M) is the sum of elements in each row of M. By the construction of the Starkad MDS, these elements are the inverses of  <span class="math">\\{2^k + i\\}_{i=0}^{2^k - 1}</span> . Hence,</p>

    <p class="text-gray-300"><span class="math">$\\alpha = (\\sum_{j=2^k}^{2^{k+1}-1} j^{-1})^2,</span>$</p>

    <p class="text-gray-300">as asserted. Finally, the dimension of the subspace U is at least t-2, since it is sufficient to require  <span class="math">x_1 = 0</span>  and  <span class="math">(Mx)_1 = 0</span> , by the argument used in the proof of Theorem 1. This completes the proof.</p>

      <h3 id="sec-5.3" class="text-xl font-semibold mt-8">5.3 Using the invariant subspaces for a preimage attack</h3>

    <p class="text-gray-300">In [6, Sec. 6.2], Beyne et al. showed that if the linear layer of Starkad or Poseidon was an involution, this could be used to mount a Gr&ouml;bner basis preimage attack on the scheme.</p>

    <p class="text-gray-300">Brief description of the attack of <a href="#page-26-8">[6]</a>. The basic idea behind the attack is simple. Assuming that the linear layer is involutionary, it is easy to show that there exists an invariant subspace of dimension t&minus;2 over the field (where t is the number of Sboxes in each round) that passes all PSPN rounds without activating any S-box. Hence, if we restrict ourselves to plaintexts whose intermediate values lie in the invariant subspace, a Gr&uml;obner basis attack on the scheme can bypass all PSPN rounds for free. The condition that the intermediate value resides in the invariant subspace can be added as a set of linear constraints to the system of equations in the Gr&uml;obner basis attack, without increasing its complexity significantly. The preimage is then found by representing the full rounds as a system of equations, adding the linear constraints, and solving the resulting system of equations using Gr&uml;obner basis methods.</p>

    <p class="text-gray-300">The authors of <a href="#page-26-8">[6]</a> conclude that a preimage can be found in time</p>

    <p class="text-gray-300">
<span class="math">$2\\gamma(2\\pi)^{-\\omega/2}(c+2)^{2-\\omega/2}e^{\\omega(c+2)}3^{(\\omega(c+2)+1)(R_F-1)},\\tag{1}</span>$</p>

    <p class="text-gray-300">where the parameters &gamma; and &omega; are such that the computational cost of computing the row-reduced echelon form of an m-by-n matrix is &gamma;mn<sup>&omega;</sup> (see <a href="#page-26-8">[6,</a> Appendix D]).<a href="#page-21-0">7</a></p>

    <p class="text-gray-300">Application of the attack in our scenario. The preimage attack of <a href="#page-26-8">[6]</a> is presented in terms of the multiplicative order of the linear layer (which is actually very high in Starkad, unless t is a power of 2). However, it is easy to see by going over the proof of <a href="#page-26-8">[6,</a> Lemma 2], that the multiplicative order of the matrix can be replaced by the co-dimension of the invariant subspace that passes the PSPN rounds without activating any S-box. (In other words, there is no difference between the case where M<sup>k</sup> = &alpha;I for some constant &alpha; and the more general case where the minimal polynomial of M is of degree at most k).</p>

    <p class="text-gray-300">Therefore, the attack described above can be applied to Starkad, where in the formula of the time complexity (i.e., Equation <a href="#page-21-1">(1)</a> above) c + 2 is replaced with c+d 0 , where d 0 is the degree of the minimal polynomial of M. In particular, if we take a variant of Starkad with the binary field GF(2127) as was proposed in the Starkware Challenge <a href="#page-27-1">[17]</a> for 256-bit security, and take t to be any power of 2, then the scheme admits a preimage attack of complexity about 2220, which breaks the 256-bit security bound.</p>

    <p class="text-gray-300">We note however that for all actually proposed sets of parameters, the complexity of the preimage attack we described does not break the security bound.</p>

    <p class="text-gray-300"><sup>7</sup> Note that these results are weaker than the results claimed in <a href="#page-26-8">[6,</a> Sec. 6.2]; specifically, we replace c by c+ 2, which affects the results significantly. In particular, this means that among the results presented in <a href="#page-26-8">[6,</a> Table 5], the complexity of the attack on the variant 128-e is increased from 2<sup>44</sup>.<sup>2</sup> to about 2<sup>115</sup>, the complexity of the attack on 256-b is increased from 2<sup>150</sup>.<sup>9</sup> to about 2<sup>220</sup>, and the attack on 128-c becomes infeasible. In addition, the attack on the variant 256-a fails as well, since for that variant we have c = t/2, while the attack applies only for c &lt; t/2, as is explained in <a href="#page-26-8">[6,</a> Sec. 6]. The authors of <a href="#page-26-8">[6]</a> admitted (in private communication <a href="#page-26-10">[5]</a>) that the formula they wrote was incorrect, and agreed with our correction.</p>

      <h3 id="sec-5.4" class="text-xl font-semibold mt-8">5.4 The invariant subspaces can be avoided easily</h3>

    <p class="text-gray-300">While it is not clear whether the invariant subspaces presented above can be exploited to attack the Starkad hash function, it seems clear that their existence is an undesirable feature. The 'good news' are that these subspaces can be easily avoided, by a careful choice of parameters. We present below three possible ways to make sure that the middle layer of Starkad cannot be bypassed without activating any S-box.</p>

    <p class="text-gray-300">Choosing the value of t carefully. One possible way is to choose t that is not divisible by 4. As was exemplified in Table <a href="#page-4-0">2</a> for several values of t, in most cases<a href="#page-22-0">8</a> where t is not divisible by 4, there is no invariant subspace of the form described above. Furthermore, given a value of t, we can use the tool described in Section <a href="#page-7-0">3</a> to guarantee that any t-round characteristic indeed activates at least one S-box.</p>

    <p class="text-gray-300">Changing the parameter r. Another possible way is to change the parameter r used in the generation of the MDS matrix. Recall that the MDS matrix is a Cauchy matrix, generated by the sequences {xi}, {yj}, where x<sup>i</sup> = i &minus; 1 and y<sup>i</sup> = x<sup>i</sup> + r (integer addition). The designers fixed r = t.</p>

    <p class="text-gray-300">The relation of the Starkad matrix to special matrices, proved in Proposition <a href="#page-18-1">12,</a> assumes that r is divisible by 2<sup>k</sup> (which is obviously satisfied by r = t). This suggests that choosing a different value of r might avoid the invariant subspace. Our experiments, performed with n = 2<sup>63</sup> and t = 24, indicate that indeed, whenever r is not divisible by 4, there is no invariant subspace of the form described above (see Table <a href="#page-22-1">4)</a>. As before, given such a value of r, we can use the strategy described in Section <a href="#page-7-0">3</a> to guarantee that any t-round characteristic indeed activates at least one S-box.</p>

    <div class="overflow-x-auto my-4">
      <table class="min-w-full text-sm text-gray-300">
        <thead>
            <th class="px-3 py-2 border-b border-gray-600 font-semibold text-left">r</th>
            <th class="px-3 py-2 border-b border-gray-600 font-semibold text-left">Dimension of</th>
            <th class="px-3 py-2 border-b border-gray-600 font-semibold text-left">r</th>
            <th class="px-3 py-2 border-b border-gray-600 font-semibold text-left">Dimension of</th>
            <th class="px-3 py-2 border-b border-gray-600 font-semibold text-left">r</th>
            <th class="px-3 py-2 border-b border-gray-600 font-semibold text-left">Dimension of</th>
        </thead>
        <tbody>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left"></td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">invariant subspace</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left"></td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">invariant subspace</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left"></td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">invariant subspace</td>
          </tr>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">24</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">18</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">25</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">0</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">26</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">0</td>
          </tr>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">27</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">0</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">28</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">12</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">29</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">0</td>
          </tr>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">30</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">0</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">31</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">0</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">32</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">20</td>
          </tr>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">40</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">18</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">47</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">0</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">52</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">12</td>
          </tr>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">64</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">20</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">101</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">0</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">128</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">20</td>
          </tr>
        </tbody>
      </table>
    </div>

    <p class="text-gray-300">Table 4. The dimension of the invariant subspace whose elements do not activate Sboxes for any number of PSPN rounds, as a function of r, for a Starkad permutation over the field GF(2<sup>63</sup>) with t = 24</p>

    <p class="text-gray-300"><sup>8</sup> We checked this experimentally, with numerous values of t and n. The only 'counterexamples' we are aware of occur for small values of n, that is, over small-sized binary fields.</p>

    <p class="text-gray-300">Shifting the sequence {xi}. A third possible mild change is shifting the sequence {xi}, namely, taking x<sup>i</sup> = x0+i&minus;1 for some x<sup>0</sup> 6= 0. In this case, our experiments (performed with n = 2<sup>63</sup> and t = 24, see Table <a href="#page-23-1">5)</a> indicate that non-divisibility of x<sup>0</sup> by 4 is not a sufficient condition. However, there exist many values of x<sup>0</sup> for which there is no invariant subspace of the form described above, and as before, for such values of x<sup>0</sup> we can guarantee that any t-round characteristic indeed activates at least one S-box using the technique of Section <a href="#page-7-0">3.</a></p>

    <div class="overflow-x-auto my-4">
      <table class="min-w-full text-sm text-gray-300">
        <thead>
            <th class="px-3 py-2 border-b border-gray-600 font-semibold text-left">x0</th>
            <th class="px-3 py-2 border-b border-gray-600 font-semibold text-left">Dimension of</th>
            <th class="px-3 py-2 border-b border-gray-600 font-semibold text-left"></th>
            <th class="px-3 py-2 border-b border-gray-600 font-semibold text-left">Dimension of</th>
            <th class="px-3 py-2 border-b border-gray-600 font-semibold text-left"></th>
            <th class="px-3 py-2 border-b border-gray-600 font-semibold text-left">Dimension of</th>
        </thead>
        <tbody>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left"></td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">invariant subspace</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left"></td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">invariant subspace</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left"></td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">invariant subspace</td>
          </tr>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">0</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">18</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">1</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">6</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">2</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">0</td>
          </tr>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">3</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">0</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">4</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">12</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">5</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">0</td>
          </tr>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">6</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">0</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">7</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">12</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">8</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">18</td>
          </tr>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">9</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">6</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">10</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">0</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">11</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">0</td>
          </tr>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">12</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">12</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">13</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">0</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">14</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">0</td>
          </tr>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">15</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">12</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">16</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">18</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">17</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">6</td>
          </tr>
        </tbody>
      </table>
    </div>

    <p class="text-gray-300">Table 5. The dimension of the invariant subspace whose elements do not activate Sboxes for any number of PSPN rounds, as a function of x<sup>0</sup> (the initial element of the sequence {xi} used in the construction of the Cauchy matrix), for a Starkad cipher over the field GF(2<sup>63</sup>) with t = 24</p>

    </section>

    <section id="sec-6" class="mb-10">
      <h2 class="text-2xl font-bold">6 Discussion and Open Problems</h2>

    <p class="text-gray-300">We conclude this paper with a discussion on the implication of our results on the HADES design strategy, and with a few open problems.</p>

      <h3 id="sec-6.1" class="text-xl font-semibold mt-8">6.1 Discussion: PSPN rounds vs. SPN rounds</h3>

    <p class="text-gray-300">In this paper we showed that the MDS matrix used in HADES constructions significantly affects the security level provided by the cryptosystem. This emphasizes the need of choosing the MDS matrix in the construction carefully, but also gives rise to a more general question regarding the design strategy.</p>

    <p class="text-gray-300">Specifically, we showed in Section <a href="#page-7-0">3</a> that when the MDS matrix is chosen properly (which is the case for all suggested variants of Poseidon, an instantiation of HADES for prime fields), the lower bound on the number of active S-boxes in differential and linear characteristics can be significantly improved by taking into consideration the PSPN rounds. In some of the cases, the lower bound we obtain on the number of active S-boxes in the PSPN rounds is much larger than the lower bound obtained by the designers using the wide-trail strategy.</p>

    <p class="text-gray-300">This gives rise to the question, whether full SPN rounds are 'cost effective' compared to PSPN rounds, in scenarios where the complexity is dominated by the number of S-boxes in the construction (which are the target scenarios of the HADES design strategy).</p>

    <p class="text-gray-300">As was emphasized by the HADES designers, PSPN rounds are more cost-effective with respect to algebraic attacks, since when the linear layer is an MDS, the increase of the algebraic degree obtained by a PSPN round is the same as the increase obtained by an SPN round which uses t times more S-boxes. It should be noted (and was also emphasized by the HADES designers) that security with respect to algebraic attacks is determined not only by the algebraic degree, and thus, a single PSPN round provides less security with respect to algebraic attacks than an SPN round. However, it seems clear that t PSPN rounds provide a much larger security increase than a single SPN round, while employing the same number of S-boxes.</p>

    <p class="text-gray-300">The HADES designers motivate the use of the SPN rounds by protection against statistical &ndash; mainly differential and linear &ndash; attacks, and in particular, by the ability to use the wide trail strategy for proving lower bounds on the number of active S-boxes in differential and linear characteristics. It turns out however that when the MDS matrix is chosen properly, the number of active S-boxes in a characteristic over PSPN rounds is not much smaller than the respective number for SPN rounds that employ the same number of S-boxes. Indeed, the wide trail strategy provides a tight lower bound of t+1 active S-boxes over two rounds which employ 2t S-boxes in total. For PSPN rounds with a single S-box in each round, the analysis of [2] suggests that for a 'good' MDS, the minimal number of active S-boxes over m rounds (which employ m S-boxes) is  <span class="math">\\frac{m-t}{2}+1</span> . While the ratio  <span class="math">\\frac{t+1}{2t}</span>  obtained by SPN rounds is somewhat larger than the ratio  <span class="math">\\frac{m-t+2}{2m}</span>  obtained for PSPN rounds, the asymptotic difference between the ratios is small.</p>

    <p class="text-gray-300">The wide trail strategy has the advantages of being generic, and of applicability to any number of active S-boxes (compared to the algorithm of [2] we use in this paper, which depends on the specific structure of the cipher and on the available computational resources). However, if indeed the advantage of SPN rounds with respect to statistical attacks is small, while the advantage of PSPN rounds with respect to algebraic attacks is very large, then it might make sense to change the balance between the numbers of rounds in favor of PSPN rounds.</p>

      <h3 id="sec-6.2" class="text-xl font-semibold mt-8">6.2 Open problems</h3>

    <p class="text-gray-300">Finding better ways to exploit the invariant subspace in Starkad. The first open problem arising from this paper is, whether there are more efficient ways to exploit the large invariant subspaces found for variants of Starkad to mount attacks on the schemes.</p>

    <p class="text-gray-300"> <span class="math">&lt;sup&gt;^9&lt;/sup&gt;</span>  It should be noted that in our analysis, we considered only differential and linear attacks, and not other types of statistical attacks. However, for all other classes of attacks, the security arguments provided for SPN constructions are heuristic, and hence, there is no clear way to decide whether r full SPN rounds provide a better security guarantee against those attacks, compared to tr PSPN rounds. Therefore, we focus on differential and linear attacks, for which the results are 'measurable'.</p>

    <p class="text-gray-300">Optimal bound on the size of the invariant subspace. Another open problem is to prove Conjecture <a href="#page-17-2">1</a> &ndash; namely, to show that the dimension of the invariant subspace for t = 2<sup>k</sup> &middot; s is at least t &minus; 2s. Numerous experiments suggest that the conjecture (which would be tight if proved) indeed holds, and it seems that a proof is not out of reach.</p>

    <p class="text-gray-300">Improved cryptanalysis techniques for PSPN rounds. As was pointed out by the HADES designers, the cryptanalysis tools available for PSPN designs are very scarce. Developing new tools (and improving existing ones, like that of <a href="#page-26-1">[2]</a> we used) may enable a wider use of PSPN rounds, and further development of designs based on them. In particular, it seems unclear whether a design that contains only PSPN rounds with a few S-boxes in each round is necessarily problematic, despite the mixed success of previous designs of this class (Zorro and LowMC).</p>

    <p class="text-gray-300">The recent paper <a href="#page-27-3">[13]</a> is a first step in this direction, but the main problems in the understanding of PSPN designs are still open.</p>

    <p class="text-gray-300">Balancing the number of SPN vs. PSPN rounds in HADES designs. As was mentioned in the above discussion, our results may suggest that one can design more efficient instantiations of HADES by choosing the MDS properly, taking into consideration the middle layer, and changing the balance between SPN and PSPN rounds. It will be interesting to find out whether this is indeed possible. To be concrete, we suggest studying the following variant.</p>

    <p class="text-gray-300">Question 1. Consider a variant of Poseidon in which the 2R<sup>f</sup> SPN rounds are replaced by tR<sup>f</sup> PSPN rounds (and so, the cipher has only PSPN rounds, and the total number of S-boxed is reduced by tR<sup>f</sup> ). What is the security level of the new variant, compared to the initial variant?</p>

    <p class="text-gray-300">If the security level of the new variant is not lower, this allows to speed up variants of Poseidon without reducing their security level, and suggests that using only PSPN rounds is advantageous over combining SPN and PSPN rounds, provided that the linear transformation is chosen properly.</p>

    </section>

    <section id="acknowledgements" class="mb-10">
      <h2 class="text-2xl font-bold">Acknowledgements</h2>

    <p class="text-gray-300">The authors are grateful to Tim Beyne, Itai Dinur, Lorenzo Grassi and Christian Rechberger, for helpful discussions and suggestions.</p>

    </section>

    <section id="references" class="mb-10">
      <h2 class="text-2xl font-bold">References</h2>

    <p class="text-gray-300">1. Albrecht, M.R., Rechberger, C., Schneider, T., Tiessen, T., Zohner, M.: Ciphers for MPC and FHE. In: Oswald, E., Fischlin, M. (eds.) Advances in Cryptology - EUROCRYPT 2015 - 34th Annual International Conference on the Theory and Applications of Cryptographic Techniques, Sofia, Bulgaria, April 26-30, 2015, Proceedings, Part I. Lecture Notes in Computer Science, vol. 9056, pp. 430&ndash;454. Springer (2015). <a href="https://doi.org/10.1007/978-3-662-46800-5_17" target="_blank" rel="noopener noreferrer">https://doi.org/10.1007/978-3-662-46800-5</a> 17, <a href="https://doi.org/10.1007/978-3-662-46800-5_17" target="_blank" rel="noopener noreferrer">https:</a> <a href="https://doi.org/10.1007/978-3-662-46800-5_17" target="_blank" rel="noopener noreferrer">//doi.org/10.1007/978-3-662-46800-5</a> 17</p>

    <ul class="space-y-2 text-gray-400 text-sm list-none">
      <li><p class="text-gray-300">2. Bar-On, A., Dinur, I., Dunkelman, O., Lallemand, V., Keller, N., Tsaban, B.: Cryptanalysis of SP networks with partial non-linear layers. In: Oswald, E., Fischlin, M. (eds.) Advances in Cryptology - EUROCRYPT 2015 - 34th Annual International Conference on the Theory and Applications of Cryptographic Techniques, Sofia, Bulgaria, April 26-30, 2015, Proceedings, Part I. Lecture Notes in Computer Science, vol. 9056, pp. 315&ndash;342. Springer (2015). <a href="https://doi.org/10.1007/978-3-662-46800-5_13" target="_blank" rel="noopener noreferrer">https://doi.org/10.1007/978-3-</a> <a href="https://doi.org/10.1007/978-3-662-46800-5_13" target="_blank" rel="noopener noreferrer">662-46800-5</a> 13, <a href="https://doi.org/10.1007/978-3-662-46800-5_13" target="_blank" rel="noopener noreferrer">https://doi.org/10.1007/978-3-662-46800-5</a> 13</p></li>
      <li><p class="text-gray-300">3. Becker, T., Weispfenning, V.: Gr&uml;obner bases &ndash; a computational approach to commutative algebra (1991)</p></li>
      <li><p class="text-gray-300">4. Ben-Sasson, E., Goldberg, L., Levit, D.: STARK friendly hash - survey and recommendation. IACR Cryptol. ePrint Arch. 2020, 948 (2020), <a href="https://eprint.iacr.org/2020/948" target="_blank" rel="noopener noreferrer">https://eprint.iacr.</a> <a href="https://eprint.iacr.org/2020/948" target="_blank" rel="noopener noreferrer">org/2020/948</a></p></li>
      <li><p class="text-gray-300">5. Beyne, T.: Personal communication (2020)</p></li>
      <li><p class="text-gray-300">6. Beyne, T., Canteaut, A., Dinur, I., Eichlseder, M., Leander, G., Leurent, G., Naya-Plasencia, M., Perrin, L., Sasaki, Y., Todo, Y., Wiemer, F.: Out of oddity - new cryptanalytic techniques against symmetric primitives optimized for integrity proof systems. In: Micciancio, D., Ristenpart, T. (eds.) Advances in Cryptology - CRYPTO 2020 - 40th Annual International Cryptology Conference, CRYPTO 2020, Santa Barbara, CA, USA, August 17-21, 2020, Proceedings, Part III. Lecture Notes in Computer Science, vol. 12172, pp. 299&ndash;328. Springer (2020). <a href="https://doi.org/10.1007/978-3-030-56877-1_11" target="_blank" rel="noopener noreferrer">https://doi.org/10.1007/978-3-030-56877-1</a> 11, <a href="https://doi.org/10.1007/978-3-030-56877-1_11" target="_blank" rel="noopener noreferrer">https://doi.org/</a> <a href="https://doi.org/10.1007/978-3-030-56877-1_11" target="_blank" rel="noopener noreferrer">10.1007/978-3-030-56877-1</a> 11</p></li>
      <li><p class="text-gray-300">7. Dinur, I., Liu, Y., Meier, W., Wang, Q.: Optimized interpolation attacks on LowMC. In: Iwata, T., Cheon, J.H. (eds.) Advances in Cryptology - ASIACRYPT 2015 - 21st International Conference on the Theory and Application of Cryptology and Information Security, Auckland, New Zealand, November 29 - December 3, 2015, Proceedings, Part II. Lecture Notes in Computer Science, vol. 9453, pp. 535&ndash;560. Springer (2015). <a href="https://doi.org/10.1007/978-3-662-48800-3_22" target="_blank" rel="noopener noreferrer">https://doi.org/10.1007/978-3-662-48800-3</a> 22, <a href="https://doi.org/10.1007/978-3-662-48800-3_22" target="_blank" rel="noopener noreferrer">https:</a> <a href="https://doi.org/10.1007/978-3-662-48800-3_22" target="_blank" rel="noopener noreferrer">//doi.org/10.1007/978-3-662-48800-3</a> 22</p></li>
      <li><p class="text-gray-300">8. Dobraunig, C., Eichlseder, M., Mendel, F.: Higher-order cryptanalysis of LowMC. In: Kwon, S., Yun, A. (eds.) Information Security and Cryptology - ICISC 2015 - 18th International Conference, Seoul, South Korea, November 25-27, 2015, Revised Selected Papers. Lecture Notes in Computer Science, vol. 9558, pp. 87&ndash;101. Springer (2015). <a href="https://doi.org/10.1007/978-3-319-30840-1_6" target="_blank" rel="noopener noreferrer">https://doi.org/10.1007/978-3-319-30840-1</a> 6, <a href="https://doi.org/10.1007/978-3-319-30840-1_6" target="_blank" rel="noopener noreferrer">https://doi.org/10.</a> <a href="https://doi.org/10.1007/978-3-319-30840-1_6" target="_blank" rel="noopener noreferrer">1007/978-3-319-30840-1</a> 6</p></li>
      <li><p class="text-gray-300">9. G&acute;erard, B., Grosso, V., Naya-Plasencia, M., Standaert, F.: Block ciphers that are easier to mask: How far can we go? In: Bertoni, G., Coron, J. (eds.) Cryptographic Hardware and Embedded Systems - CHES 2013 - 15th International Workshop, Santa Barbara, CA, USA, August 20-23, 2013. Proceedings. Lecture Notes in Computer Science, vol. 8086, pp. 383&ndash;399. Springer (2013). <a href="https://doi.org/10.1007/978-3-642-40349-1_22" target="_blank" rel="noopener noreferrer">https://doi.org/10.1007/978-3-642-40349-1</a> 22, <a href="https://doi.org/10.1007/978-3-642-40349-1_22" target="_blank" rel="noopener noreferrer">https://doi.org/10.1007/</a> <a href="https://doi.org/10.1007/978-3-642-40349-1_22" target="_blank" rel="noopener noreferrer">978-3-642-40349-1</a> 22</p></li>
      <li><p class="text-gray-300">10. Grassi, L., Kales, D., Khovratovich, D., Roy, A., Rechberger, C., Schofnegger, M.: Starkad and Poseidon: New hash functions for zero knowledge proof systems. IACR Cryptology ePrint Archive 2019, 458 (2019), <a href="https://eprint.iacr.org/2019/458" target="_blank" rel="noopener noreferrer">https://eprint.iacr.org/2019/458</a></p></li>
      <li><p class="text-gray-300">11. Grassi, L., Khovratovich, D., Rechberger, C., Roy, A., Schofnegger, M.: Poseidon: A New Hash Function for Zero-Knowledge Proof Systems. In: USENIX Security Symposium. USENIX Association (2021)</p></li>
      <li><p class="text-gray-300">12. Grassi, L., L&uml;uftenegger, R., Rechberger, C., Rotaru, D., Schofnegger, M.: On a Generalization of Substitution-Permutation Networks: The HADES Design Strat-</p></li>
      <li><p class="text-gray-300">egy. In: EUROCRYPT (2). Lecture Notes in Computer Science, vol. 12106, pp. 674&ndash;704. Springer (2020)</p></li>
      <li><p class="text-gray-300">13. Grassi, L., Rechberger, C., Schofnegger, M.: Weak linear layers in word-oriented partial SPN and hades-like ciphers. IACR Cryptol. ePrint Arch. 2020, 500 (2020), <a href="https://eprint.iacr.org/2020/500" target="_blank" rel="noopener noreferrer">https://eprint.iacr.org/2020/500</a></p></li>
      <li><p class="text-gray-300">14. NIST: Advanced Encryption Standard, Federal Information Processing Standards publications no. 197 (2001)</p></li>
      <li><p class="text-gray-300">15. Roth, R.M., Lempel, A.: On MDS codes via Cauchy matrices. IEEE Trans. Information Theory 35(6), 1314&ndash;1319 (1989). <a href="https://doi.org/10.1109/18.45291" target="_blank" rel="noopener noreferrer">https://doi.org/10.1109/18.45291,</a> <a href="https://doi.org/10.1109/18.45291" target="_blank" rel="noopener noreferrer">https://doi.org/10.1109/18.45291</a></p></li>
      <li><p class="text-gray-300">16. Silvester, J.R.: Determinants of block matrices. The Mathematical Gazette 84(501), 460&ndash;467 (2000)</p></li>
      <li><p class="text-gray-300">17. StarkWare: Stark-friendly hash challenge (2019&ndash;2020), <a href="https://starkware.co/hash-challenge" target="_blank" rel="noopener noreferrer">https://starkware.co/</a> <a href="https://starkware.co/hash-challenge" target="_blank" rel="noopener noreferrer">hash-challenge</a></p></li>
    </ul>

    <p class="text-gray-300">In this appendix we describe in detail the pattern search algorithm we applied to variants of the Poseidon permutation. The code of the algorithm is publicly available at: https://anonymous.4open.science/r/bc580cca-659f-4e8f-b8c1- 9dfcd5fb75a2/.</p>

      <h3 id="app-a.1" class="text-xl font-semibold mt-8">A.1 Checking a single pattern</h3>

    <p class="text-gray-300">In order to check whether there exists a differential characteristic following a specific pattern, one can use the following algorithm:</p>

    <pre><code class="language-text">algorithm Check-Pattern(pattern), pattern &isin;

                                                  [n]
                                                  a

1. ST := (It; 0a+t)
2. E := &empty;
3. s := t + 1
4. for every i = 1 : n
   (a) if i &isin; pattern: ST1 &larr; es, s &larr; s + 1
   (b) if i /&isin; pattern: E &larr; E &cup; ST1
   (c) ST &larr; M &middot; ST
5. Solve the equation system E, return TRUE if and only if there exists a
   nontrivial solution
</code></pre>

    <p class="text-gray-300">Explanation of the algorithm. Each row of the state corresponds to the coefficients in the linear combination of the t + a variables. Thus, the beginnings of the rows consist of the unit vectors e1, . . . , et.</p>

    <p class="text-gray-300">On a non-active S-box, we get a linear restriction by the coefficients in the first row. On an active S-box, we replace the first row by a new variable, which is represented by es.</p>

    <p class="text-gray-300">The state is updated after the S-box layer, using the MDS matrix. When we finish posing the linear equations, we can solve the system E using Gaussian elimination and check whether there exists a solution. We note that for linear characteristics, the same algorithm can be used, with the matrix (M<sup>T</sup> ) &minus;1 instead of M.</p>

      <h3 id="app-a.2" class="text-xl font-semibold mt-8">A.2 Checking all r-round patterns with a active S-boxes</h3>

    <p class="text-gray-300">We can also iterate over all the patterns of length r with a active S-boxes, using the following simple recursive algorithm:</p>

    <pre><code class="language-text">function Search-Pattern(pref, s, a, i, n):
 1. if i &ge; n &minus; 1 &and; Check-Pattern(pref) : output pref
 2. if i &lt; t + 2s: Search-Pattern(pref,s, a, i + 1, n)
 3. if s &lt; a &and; 2s &lt; i: Search-Pattern(pref &cup;{i}, s + 1, a, i + 1, n)
</code></pre>

    <p class="text-gray-300">Explanation of the algorithm. The word &quot;pref&quot; denotes a prefix of the pattern, s is the number of active S-boxes in the prefix, i is the length of the prefix and n is the total number of S-boxes (i.e., the length of the final pattern). It should thus always hold that s &le; a, s &le; i.</p>

    <p class="text-gray-300">The function should be called with pattern = &empty;, s = 0, a, i = 2, n = t + 2a.</p>

    <p class="text-gray-300">Note that we assume that the function was already called for each a <sup>0</sup> &le; a and that no differential characteristic was found. We use this fact to reduce the number of checked patterns, since if a pattern contains a previously checked pattern as a substring, then we do not have to check it.</p>

    <p class="text-gray-300">The condition for a non active S-box is : i &lt; t + 2s. Indeed, if i &ge; t + 2s, then the prefix already cannot contain active S-boxes (this is the case of a lower a that was already checked), and thus we do not need to check this prefix at all.</p>

    <p class="text-gray-300">The condition for an active S-box is: s &lt; a &and; 2s &lt; i. Indeed, the condition s &lt; a is obvious. The condition 2s &lt; i appears, since if 2s &ge; i then the suffix (starting from i + 1) is a pattern that was already checked, as it corresponds to a <sup>0</sup> = a&minus;s, n<sup>0</sup> = n&minus;2s = t+ 2(a&minus;s) = t+ 2a 0 , and thus we do not need to check this prefix.</p>

    <p class="text-gray-300">The stopping condition is at n&minus;1, as the last two S-boxes must be non-active or otherwise the prefix will correspond to a <sup>0</sup> = a &minus; 1. By the same reasoning, we start from i = 2, meaning that the first two S-boxes are also inactive.</p>

    </section>
`;
---

<BaseLayout title="Mind the Middle Layer: The HADES Design Strategy Revisited (2020/179)">
  <article class="max-w-4xl mx-auto article-prose">
    <nav class="mb-8">
      <a href="/papers" class="text-blue-400 hover:text-blue-300">
        &larr; Back to Papers
      </a>
    </nav>

    <header class="mb-12">
      <h1 class="text-3xl font-bold mb-4"
        set:html={TITLE_HTML} />
      <p class="text-gray-400 mb-2"
        set:html={AUTHORS_HTML} />
      <p class="text-gray-500 text-sm mb-4">
        2020 &middot; eprint 2020/179
      </p>
      <div class="flex gap-4 text-sm">
        <a
          href={EPRINT_URL}
          target="_blank"
          rel="noopener noreferrer"
          class="text-blue-400 hover:text-blue-300"
        >
          Paper (eprint) &rarr;
        </a>
      </div>
      <PaperDisclaimer eprintUrl={EPRINT_URL} />
      <p class="mt-1 text-xs text-gray-600">
        Converted with: {CRAWLER} &middot; {CONVERTED_DATE}
      </p>
    </header>

    <nav id="toc" class="mb-10 p-6 rounded-lg" style="background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.06);">
      <h2 class="text-lg font-bold mb-4">Table of Contents</h2>
      <ol class="space-y-1 text-sm text-gray-300
        list-decimal list-inside">
        <li>
          <a href="#sec-1" class="hover:text-white">Introduction</a>
          <ol class="ml-6 mt-1 space-y-1 list-decimal
            list-inside text-gray-400">
            <li><a href="#sec-1.1" class="hover:text-white">Background</a></li>
            <li><a href="#sec-1.2" class="hover:text-white">Our results</a></li>
            <li><a href="#sec-1.3" class="hover:text-white">Practical impact of our results and subsequent work</a></li>
            <li><a href="#sec-1.4" class="hover:text-white">Organization of the paper</a></li>
          </ol>
        </li>
        <li><a href="#sec-2" class="hover:text-white">The HADES construction</a></li>
        <li><a href="#sec-3" class="hover:text-white">Improved Security Bounds for Poseidon Permutations</a></li>
        <li>
          <a href="#sec-4" class="hover:text-white">A Class of Matrices over a Binary Field and its Properties</a>
          <ol class="ml-6 mt-1 space-y-1 list-decimal
            list-inside text-gray-400">
            <li><a href="#sec-4.1" class="hover:text-white">Special matrices and their basic properties</a></li>
            <li><a href="#sec-4.2" class="hover:text-white">Special matrices over commutative rings of characteristic 2</a></li>
            <li><a href="#sec-4.3" class="hover:text-white">Nilpotent special matrices over commutative rings with characteristic 2</a></li>
            <li><a href="#sec-4.4" class="hover:text-white">Block matrices with special blocks</a></li>
            <li><a href="#sec-4.5" class="hover:text-white">A stronger conjectured bound</a></li>
          </ol>
        </li>
        <li>
          <a href="#sec-5" class="hover:text-white">A Large Invariant Subspace in the Middle Layer of Starkad Permutations</a>
          <ol class="ml-6 mt-1 space-y-1 list-decimal
            list-inside text-gray-400">
            <li><a href="#sec-5.1" class="hover:text-white">The Starkad MDS and special matrices</a></li>
            <li><a href="#sec-5.2" class="hover:text-white">A large invariant subspace in Starkad with 4\ell S-boxes in each full round</a></li>
            <li><a href="#sec-5.3" class="hover:text-white">Using the invariant subspaces for a preimage attack</a></li>
            <li><a href="#sec-5.4" class="hover:text-white">The invariant subspaces can be avoided easily</a></li>
          </ol>
        </li>
        <li>
          <a href="#sec-6" class="hover:text-white">Discussion and Open Problems</a>
          <ol class="ml-6 mt-1 space-y-1 list-decimal
            list-inside text-gray-400">
            <li><a href="#sec-6.1" class="hover:text-white">Discussion: PSPN rounds vs. SPN rounds</a></li>
            <li><a href="#sec-6.2" class="hover:text-white">Open problems</a></li>
          </ol>
        </li>
      </ol>
      <p class="text-xs text-gray-500 mt-4 mb-1 font-semibold">
        Appendices
      </p>
      <ol class="space-y-1 text-sm text-gray-400
        list-[upper-alpha] list-inside">
        <li>
          <a href="#app-a" class="hover:text-white">Detailed Description of the Pattern Search Algorithm</a>
          <ol class="ml-6 mt-1 space-y-1 list-decimal
            list-inside text-gray-400">
            <li><a href="#app-a.1" class="hover:text-white">Checking a single pattern</a></li>
            <li><a href="#app-a.2" class="hover:text-white">Checking all r-round patterns with a active S-boxes</a></li>
          </ol>
        </li>
      </ol>
      <p class="text-xs text-gray-500 mt-4 mb-1 font-semibold">
        Additional
      </p>
      <ul class="space-y-1 text-sm text-gray-400
        list-disc list-inside">
        <li><a href="#acknowledgements" class="hover:text-white">Acknowledgements</a></li>
        <li><a href="#references" class="hover:text-white">References</a></li>
      </ul>
    </nav>


    <Fragment set:html={CONTENT} />

    <PaperHistory slug="mind-the-middle-layer-the-hades-design-strategy-revisited-2020" />
  </article>
</BaseLayout>
