---
import BaseLayout from '../../layouts/BaseLayout.astro';

const EPRINT_URL = 'https://eprint.iacr.org/2014/228';
const CRAWLER = 'mistral';
const CONVERTED_DATE = '2026-02-16';
const TITLE_HTML = 'Cryptanalysis of SP Networks with Partial Non-Linear Layers';
const AUTHORS_HTML = 'Achiya Bar-On, Itai Dinur, Orr Dunkelman, Virginie Lallemand, Nathan Keller, Boaz Tsaban';

const CONTENT = `    <p class="text-gray-300">Achiya Bar-On<span class="math">^{1}</span>, Itai Dinur<span class="math">^{2}</span>, Orr Dunkelman<span class="math">^{3,5,*}</span>, Virginie Lallemand<span class="math">^{4,\\dagger}</span>, Nathan Keller<span class="math">^{1,5,\\ddagger}</span>, and Boaz Tsaban<span class="math">^{1}</span></p>

    <p class="text-gray-300"><span class="math">^{1}</span> Department of Mathematics, Bar-Ilan University, Israel <span class="math">^{2}</span> Département d'Informatique, École Normale Supérieure, Paris, France <span class="math">^{3}</span> Computer Science Department, University of Haifa, Israel <span class="math">^{4}</span> Inria, France <span class="math">^{5}</span> Computer Science department, The Weizmann Institute, Rehovot, Israel</p>

    <p class="text-gray-300">Abstract. Design of SP networks in which the non-linear layer is applied to only a part of the state in each round was suggested by Gérard et al. at CHES 2013. Besides performance advantage on certain platforms, such a design allows for more efficient masking techniques that can mitigate side-channel attacks with a small performance overhead.</p>

    <p class="text-gray-300">In this paper we present generic techniques for differential and linear cryptanalysis of SP networks with partial non-linear layers, including an automated characteristic search tool and dedicated key-recovery algorithms. Our techniques can be used both for cryptanalysis of such schemes and for proving their security with respect to basic differential and linear cryptanalysis, succeeding where previous automated analysis tools seem to fail.</p>

    <p class="text-gray-300">We first apply our techniques to the block cipher Zorro (designed by Gérard et al. following their methodology), obtaining practical attacks on the cipher which where fully simulated on a single desktop PC in a few days. Then, we propose a mild change to Zorro, and formally prove its security against basic differential and linear cryptanalysis. We conclude that there is no inherent flaw in the design strategy of Gérard et al., and it can be used in future designs, where our tools should prove useful.</p>

    <p class="text-gray-300">Keywords: Block cipher, Lightweight, Zorro, differential cryptanalysis, linear cryptanalysis.</p>

    <p class="text-gray-300">Most block ciphers are either SP networks that apply linear and non-linear layers to the entire state in every encryption round, or (generalized) Feistel structures that apply partial linear and non-linear layers in every round. In the CHES 2013</p>

    <p class="text-gray-300">*The third author was supported in part by the German-Israeli Foundation for Scientific Research and Development through grant No. 2282-2222.6/2011.</p>

    <p class="text-gray-300">†The fourth author was partially supported by the French Agence Nationale de la Recherche through the BLOC project under Contract ANR-11-INS-011.</p>

    <p class="text-gray-300">‡The fifth author was supported by the Alon Fellowship.</p>

    <p class="text-gray-300">paper <em>[9]</em>, Gérard et al. suggested a compromise between the two common block cipher designs – an SP network in which the non-linear layer is applied to only a part of the state in every round. Such partial non-linear SP networks (which we call PSP networks) contain a wide range of possible concrete schemes that were not considered so far, some of which have performance advantage on certain platforms. More importantly, PSP networks allow for more efficient masking techniques, capable of thwarting side-channel attacks with a small performance overhead.</p>

    <p class="text-gray-300">As a concrete instantiation of their methodology, Gérard et al. designed Zorro, a 128-bit lightweight block cipher. Zorro has an unconventional structure, as it applies a sequence of 24 AES-like rounds, with a partial S-box layer in each round, containing only 4 out of the possible 16 S-boxes. Since previous tools that were developed in order to formally prove the security of block ciphers against standard differential and linear cryptanalysis (such as the wide-trail strategy used for AES) do not apply to PSP networks such as Zorro, the authors replaced the formal proof for Zorro by a heuristic argument. Unfortunately, the heuristic argument turned out to be insufficient, as Wang et al. <em>[16]</em> found iterative differential and linear characteristics that were missed by the heuristic and used them to break full Zorro with complexity of <span class="math">2^{112}</span>.</p>

    <p class="text-gray-300">In this paper, we propose efficient algorithms for differential and linear cryptanalysis of PSP networks. These algorithms allow us to fully evaluate the security of such constructions against standard differential and linear cryptanalysis. In some cases, we can compute tight upper bounds on the probability of differential and linear characteristics, thus offering formal proofs which are expected from any proposal of a modern block cipher.</p>

    <p class="text-gray-300">Our most useful tool is a generic differential/linear characteristic search algorithm, allowing us to search for the best differential/linear characteristics for many rounds with a practical time complexity. A complementary tool is an efficient key recovery technique for differential and linear attacks, making use of the partial S-box layers to analyze more rounds at the end of the cipher with no increase in the attack’s complexity.</p>

    <h3 id="sec-3" class="text-xl font-semibold mt-8">1.1 Our New Automated Characteristic Search Tool</h3>

    <p class="text-gray-300">The starting point of our characteristic search algorithm is the algorithm of Biryukov and Nikolic <em>[2]</em> (along with several related algorithms, starting from Matsui’s classical algorithm <em>[12]</em> and more recent ones <em>[3, 13]</em>), which is based on a compact representation of differential characteristics, that we call a pattern. At its most basic form, a pattern describes for each byte (or nibble) of the cipher’s state, whether it is active (namely, it has a non-zero input difference) or inactive.</p>

    <p class="text-gray-300">Patterns allow the algorithm to group together and simultaneously analyze many characteristics for a given number of the cipher’s rounds. The algorithm</p>

    <p class="text-gray-300">outputs only patterns that contain the smallest number of active S-boxes, and thus correspond to high probability characteristics. However, depending on the analyzed cipher, not all possible patterns are valid, as there are patterns not followed by any actual characteristic. Thus, in order to provide meaningful results, a characteristic search algorithm has to ensure that it only outputs valid patterns.</p>

    <p class="text-gray-300">Previous search algorithms <em>[12, 13, 3, 2]</em> indeed made sure that their output patterns were valid. This was done using local consistency checks, separately ensuring that for each of the <span class="math">r</span> rounds of a pattern, there exist characteristics that satisfy the transitions of the round (i.e., conform to the 1-round pattern). For standard block ciphers, ensuring that an r-round pattern is <em>locally valid</em> (in the sense described above) also implies that it is <em>globally valid</em>, namely, there exists an actual r-round characteristic that simultaneously satisfies all the transitions of the <span class="math">r</span> rounds.</p>

    <p class="text-gray-300">Unlike standard block ciphers, for PSP networks there exist many locally valid patterns which are not globally valid over several rounds. In order to demonstrate this, consider a 4-round AES-like cipher with 4 S-boxes in each round (such as 4-round Zorro). The cipher contains a total of <span class="math">4\\cdot 4=16</span> S-boxes, and a larger number of <span class="math">12\\cdot 4=48</span> state bytes that do not go through an S-box in these rounds. It is easy to see that the cipher has a large number of locally valid patterns in which all the 16 S-boxes are inactive, as in each round, there are many valid active/inactive possibilities for the 12 bytes that do not go through an S-box. Consequently, when applying previous algorithms (such as <em>[2]</em>) to this cipher, we obtain many patterns in which all the 16 S-boxes are inactive, containing a huge number of possible 4-round characteristics with probability 1. However, as we show next, it is likely that none of these characteristics is globally valid, rendering previous algorithms ineffective for this (seemingly simple) PSP network.</p>

    <p class="text-gray-300">At a high level, the reason that it is likely that there exists no characteristic in which all the 16 S-boxes are inactive, is that each inactive S-box forces the input difference to 0, imposing a constraint on the characteristic. Thus, for the 4-round cipher, we have 16 such constraints, whereas the number of available degrees of freedom to choose the input difference at the first round is also 16. Consequently, we have the same number of constraints and degrees of freedom, and it is probable that the constraints cannot be simultaneously satisfied (which is indeed the case for 4-round Zorro, as shown in <em>[9]</em>).</p>

    <p class="text-gray-300">In order to take into account global constraints, we group characteristics according to patterns similarly to previous algorithms. However, unlike previous algorithms, our patterns do not contain information about the full state, but only about the activity/inactivity of the bytes that go through S-boxes. Then, we observe that all the constraints imposed on a characteristic that follows such</p>

    <p class="text-gray-300">a pattern can be described by a set of linear equations. This observation allows us to group together and efficiently analyze, many characteristics which reside in a subspace, defined according to subtle linear constraints imposed by the cipher’s linear layer.</p>

    <p class="text-gray-300">Previous related automated search tools of <em>[12, 13, 3, 2]</em> mostly employed method of dynamic programming and mixed integer-linear programming. On the other hand, our characteristic search algorithm, as well as our key recovery algorithms, is mostly based on linearization techniques, which combine in a novel way methods from simple linear algebra and combinatorics, and may be of independent interest. These techniques exploit the small number of S-boxes in the non-linear layers of the cipher in order to “linearize” sequences of rounds, thus making it possible to analyze many rounds efficiently. We stress that while we focus in this paper on PSP networks, our algorithms can potentially offer new insights on the security of other designs that apply a non-linear function to only a part of the state in each round, such as (generalized) Feistel constructions and stream ciphers.</p>

    <h3 id="sec-4" class="text-xl font-semibold mt-8">1.2 Main Application of the New Tool: Studying the Security of the PSP Network Design Methodology</h3>

    <p class="text-gray-300">As a first demonstration of our techniques, we apply them to the block cipher Zorro, improving the complexity of the previously best attack from <span class="math">2^{112}</span> to a practical <span class="math">2^{45}</span>. Our attack was fully simulated several times on a standard desktop PC over several days. This is a rare case in which an attack on a modern block cipher is fully simulated in practice.</p>

    <p class="text-gray-300">More significantly, we address the general question of whether the attacks on Zorro indicate a structural flaw in its design methodology, or are merely a result of an unlucky combination of components. Our conclusion is that indeed the methodology of building PSP networks based on AES in a straightforward way is flawed, and should not be reused. The structural weakness in this methodology is due to a subtle inter-relation between the ShiftRows and MixColumns operations of AES, that may need to be taken into consideration in future designs, especially in light of the common practice of using part of the AES components as building blocks.</p>

    <p class="text-gray-300">Finally, we address an even more general question of whether the basic PSP network design methodology is flawed, or it can potentially be reused in future designs. This question is investigated by analyzing a PSP network that slightly deviates from the AES design strategy, having a lightly modified ShiftRows mapping. We analyze this scheme using our characteristic search tool and formally prove its resistance to standard differential and linear cryptanalysis (as expected from modern block ciphers). Thus, as the most important application of our tools, we answer the main question posed by this paper, concluding that PSP networks are not inherently flawed, and can be reused (with caution) to build secure block ciphers.</p>

    <p class="text-gray-300">##</p>

    <p class="text-gray-300">1.3 Organization of the Paper</p>

    <p class="text-gray-300">We start by presenting our generic characteristic search algorithms for PSP networks in Section 2. Our generic key recovery algorithms for differential and linear attacks are given in Sections 3 and 4, respectively. In Section 5, we use our algorithms to attack Zorro. Finally, we study the problem of designing secure PSP networks in Section 6 and conclude in Section 7.</p>

    <h2 id="sec-5" class="text-2xl font-bold">2 Generic High-Probability Characteristic Search Algorithm for PSP Networks</h2>

    <p class="text-gray-300">In this section we present a novel and efficient high-probability characteristic search algorithm for SP networks with partial non-linear layers. The search algorithm is only presented for differential characteristics, but we note that the algorithm for linear characteristics is very similar. As the algorithm is somewhat involved, we first describe it at a high-level and then present it in detail. Finally, we describe an optimization which is very useful in practice.</p>

    <p class="text-gray-300">For ease of exposition, we describe the algorithm on the example of an AES-like cipher, in which a 128-bit state is represented as a 4-by-4 matrix of bytes, and the S-boxes (which are the only non-linear operation) act on some of the bytes in each round. The number of S-boxes in each round is denoted by <span class="math">t</span> (e.g., <span class="math">t=16</span> for AES and <span class="math">t=4</span> for Zorro). Hence, we shall concentrate on a PSP that contains the following parts:</p>

    <ul class="list-disc list-inside space-y-1 text-gray-300 my-2 ml-4">

      <li>S-box layer — The S-box layer is applied to <span class="math">t</span> out of the 16 state bytes. The S-boxes are all invertible.</li>

      <li>Linear layer — The linear layer <span class="math">L</span> is applied to the state. We do not assume anything in particular concerning the structure of <span class="math">L</span> (as long as it is invertible).</li>

      <li>Key addition layer — XORing the subkey into the state.</li>

    </ul>

    <p class="text-gray-300">As common in AES-like ciphers, we shall assume that there is one key addition layer before the first round (it does not affect our results whatsoever), and one can have in the last round a different linear layer (our described attacks and algorithms are trivially extended to cases where each round has its own linear layer).</p>

    <p class="text-gray-300">Inspired by <em>[2]</em>, we define the pattern of a differential (or a linear) characteristic to be a description of the activity for each of its spanned S-boxes (see Figure 1). Namely, a pattern is a function that specifies for each S-box spanned by the characteristic whether it is active (i.e., has a non-zero input difference) or not. We note that while <em>[2]</em> defines a pattern over the full bytes (S-boxes) of a state, we define it only over the bytes that are covered by S-boxes.</p>

    <h3 id="sec-6" class="text-xl font-semibold mt-8">2.1 An Overview of the Algorithm</h3>

    <p class="text-gray-300">Our algorithm is based on two observations:</p>

    <p class="text-gray-300">!<a href="img-0.jpeg">img-0.jpeg</a> Fig. 1. A 2-Round Pattern and a Differential Characteristic that Follows it</p>

    <ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">

      <li>The number of possible patterns is small. We observe that if there are only a few S-boxes in each round (i.e., if  <span class="math">t</span>  is small), then even for a relatively large number  <span class="math">r</span>  of rounds, the number of possible patterns of  <span class="math">r</span> -round characteristics with a small number of active S-boxes is rather small. Specifically, since  <span class="math">r</span>  rounds contain only  <span class="math">tr</span>  S-boxes, the number of  <span class="math">r</span> -round patterns with at most  <span class="math">a</span>  active S-boxes is at most  <span class="math">\\binom{tr}{\\leq a} \\triangleq \\sum_{i=0}^{a} \\binom{tr}{i}</span> . For reasonably small values of  <span class="math">t</span> ,  <span class="math">r</span>  and  <span class="math">a</span> , this number is quite small, and we can iterate all of them. For example, for  <span class="math">t = 4</span> ,  <span class="math">r = 9</span>  and  <span class="math">a = 4</span> , there are only  <span class="math">\\binom{36}{\\leq 4} \\approx 2^{17}</span>  distinct patterns.</li>

      <li>All characteristics following a fixed pattern can be enumerated efficiently. We observe that once we fix a pattern (i.e., fix the active and inactive S-boxes), we can typically calculate the actual characteristics that follow this pattern in an efficient way. This is the result of the fact that once the activity/inactivity of each S-box is determined, all the possible characteristics reside in a restricted linear subspace that can be easily calculated using linear algebra.</li>

    </ol>

    <p class="text-gray-300">Specifically, we denote the input difference of the characteristic by 128 variables, and "linearize" the chain of intermediate encryption differences by adding 8 new variables each time 8 state bits enter an active S-box. Since the active S-boxes are the only non-linear operations in the encryption process, all intermediate differences can be described as linear combinations of at most  <span class="math">128 + 8a</span>  variables. On the other hand, each inactive S-box in the pattern restricts the intermediate difference at the input of the S-box to zero, giving rise to 8 linear equations in the state variables. As there are at least  <span class="math">rt - a</span>  inactive S-boxes, we obtain a system containing at least  <span class="math">8(rt - a)</span>  lin</p>

    <p class="text-gray-300">ear equations in at most <span class="math">128 + 8a</span> variables, which can be efficiently solved.⁴ For a sufficiently small <span class="math">a</span> (compared to <span class="math">rt</span>, i.e., when most of the S-boxes are inactive), the expected dimension of the subspace in which the possible characteristics reside is small.</p>

    <p class="text-gray-300">After calculating the linear subspace of all possible characteristics, we apply a post-filtering phase that enumerates the elements of the subspace, and filters out characteristics in which the active S-box transitions are impossible (according to the difference distribution table of the S-box).⁵ Given that the dimension of the subspace is small enough, we can efficiently post-filter its elements, and thus output all the possible characteristics for the given pattern.</p>

    <p class="text-gray-300">Combining the two observations, when <span class="math">t,r</span> and <span class="math">a</span> are not too large, we can efficiently enumerate all the possible <span class="math">r</span>-round differential characteristics with at most <span class="math">a</span> active S-boxes. The analysis of the algorithm, presented in the next subsection, shows that the complexity of the algorithm is proportional to <span class="math">\\binom{tr}{\\leq a}</span>, given that the output size (i.e., the number of possible characteristics) is not too large.⁶ As a result, the algorithm is practical for a surprisingly wide choice of parameters (e.g., for <span class="math">t = 4</span> as in Zorro, <span class="math">r = 10</span> rounds and at most <span class="math">a = 10</span> active S-boxes, its complexity is still below 2³²).</p>

    <h2 id="sec-7" class="text-2xl font-bold">2.2 Detailed Description of the Algorithm</h2>

    <p class="text-gray-300">We fix the global parameters <span class="math">t, r, a</span>. The algorithm iterates over the <span class="math">\\binom{tr}{\\leq a}</span> distinct differential patterns, and for each of them, applies the two-step pattern analysis algorithm described below.</p>

    <p class="text-gray-300"><strong>Calculating the Linear Subspace of a Pattern</strong> We maintain a symbolic representation of the 128-bit state difference at round <span class="math">i</span>, <span class="math">ST_{i}</span>, using 128 linear combinations. Each linear combination is initialized with a 1-bit variable, representing the corresponding unknown state difference bit in the first round <span class="math">\\Delta(X_0)</span> (before the first S-box layer). Additionally, we allocate a linear equation system <span class="math">E_{i}</span> (which is empty at first), that describes linear constraints on the characteristic, which are imposed by the inactive S-boxes. At the end of the algorithm (after the final round, <span class="math">r</span>), the subspace of all the possible characteristics is described by the null-space of <span class="math">E_{r}</span>.</p>

    <p class="text-gray-300">The following round-linearization algorithm describes how we extend <span class="math">ST_{i}</span> and <span class="math">E_{i}</span> to <span class="math">ST_{i+1}</span> and <span class="math">E_{i+1}</span>, according to the activity pattern of the S-boxes in round <span class="math">i+1</span> (starting from round <span class="math">i=0</span>).</p>

    <p class="text-gray-300">⁴Note that some of the equations may be linearly dependent; this depends on the exact structure of the linear transformation.</p>

    <p class="text-gray-300">⁵Note that the solution of the linear equations yields all the intermediate differences, and in particular, the input and output differences of the active S-boxes.</p>

    <p class="text-gray-300">⁶As we are mainly interested in characteristics with the smallest number of active S-boxes, their number is typically not very large, and thus it is reasonable to assume that the output size is small.</p>

    <p class="text-gray-300">Extending Linearization by 1 Round:</p>

    <ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">

      <li>Allocate and initialize <span class="math">ST_{i+1}\\leftarrow ST_{i},E_{i+1}\\leftarrow E_{i}</span>.</li>

      <li>For each S-box <span class="math">S</span> of round <span class="math">i</span>:</li>

    </ol>

    <ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">

      <li>If <span class="math">S</span> is inactive according to the pattern of round <span class="math">i</span>, add 8 equations to the system <span class="math">E_{i+1}</span>, that equate the corresponding 8 bits in <span class="math">ST_{i+1}</span> to zero. If the dimension of the null-space of <span class="math">E_{i+1}</span> is 0 (i.e., there is no non-zero solution to the system, and thus no matching characteristic), return <span class="math">ST_{i+1}</span> and <span class="math">E_{i+1}</span> as <span class="math">NULL</span>, and exit.</li>

      <li>If <span class="math">S</span> is active according to the pattern of round <span class="math">i</span>, replace the corresponding 8 linear combinations in <span class="math">ST_{i+1}</span> with the newly allocated variables.</li>

      <li>Set <span class="math">ST_{i+1}\\leftarrow L(ST_{i+1})</span>, i.e., update the symbolic state <span class="math">ST_{i+1}</span> according to the linear function of the cipher, <span class="math">L</span>.</li>

    </ol>

    <p class="text-gray-300">Given a pattern, the linear subspace of all possible characteristics for <span class="math">r</span> rounds is calculated with the following algorithm:</p>

    <p class="text-gray-300">Calculate Linear Subspace:</p>

    <ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">

      <li>Initialize <span class="math">ST_{0}</span> with 128 new variables, and <span class="math">E_{0}</span> with an empty set of equations.</li>

      <li>For <span class="math">i=0</span> to <span class="math">i=r-1</span>, run the extension algorithm for round <span class="math">i+1</span>, calculating <span class="math">ST_{i+1}</span> and <span class="math">E_{i+1}</span>. If they are <span class="math">NULL</span>, return <span class="math">NULL</span> and exit.</li>

      <li>Output a basis <span class="math">B</span> for all the possible characteristics of the pattern using the null space of <span class="math">E_{r}</span>. This basis is represented as a set of <span class="math">b</span> free (unconstrained) linear variables, and linear combinations of these variables, as follows: the 128 linear combinations of the initial state <span class="math">ST_{0}</span>, and the <span class="math">16\\cdot a</span> linear combinations of all the inputs/outputs of the <span class="math">a</span> active S-box transitions (according to the pattern).</li>

    </ol>

    <h5 id="sec-8" class="text-base font-semibold mt-4">Post-Filtering the Linear Subspace of a Pattern</h5>

    <p class="text-gray-300">Once we obtain a basis <span class="math">B</span> for all the possible characteristics of the pattern, we apply a simple post-filtering algorithm.</p>

    <ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">

      <li>For each of the <span class="math">2^{b}</span> possible values of the free variables:</li>

    </ol>

    <ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">

      <li>For each active S-box transition:</li>

    </ol>

    <ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">

      <li>Calculate the actual input/output for the S-box transition by plugging in the values of the free variables.</li>

      <li>Check in the difference distribution table of the cipher whether the differential transition is possible, and if not, go back to Step 1.</li>

      <li>Output the full characteristic according to the current value of the free variables.</li>

    </ol>

    <p class="text-gray-300">We note that it is possible to optimize the post filtering in various situations by choosing the free variables to be input/output bits of a restricted set of S-boxes. This enables us to iterate in advance only over the input/output difference transitions that are possible according to the difference distribution table of these S-boxes. The optimization can be particularly useful when the filtered linear subspace is of a relatively large dimension (and thus, we have less restrictions on the choice of free variables).</p>

    <h4 id="sec-9" class="text-lg font-semibold mt-6">2.2.2 Complexity Analysis</h4>

    <p class="text-gray-300">Let <span class="math">T(node)</span> be the average complexity of evaluating a node in the recursive tree, without iterating and post-filtering the solutions. As the number of evaluated nodes is proportional to <span class="math">\\binom{tr}{\\leq a}</span>, the complexity of the algorithm can be estimated by the formula <span class="math">\\binom{tr}{\\leq a}\\cdot T(node)+SOL</span>, where <span class="math">SOL</span> is the total number of solutions that we need to post-filter. Since we cannot determine in advance the value of <span class="math">SOL</span>, we will estimate it according to the total number of characteristics which remain <em>after</em> post-filtering (i.e., the actual output size), which we denote by <span class="math">OUT</span>.</p>

    <p class="text-gray-300">In order to relate <span class="math">SOL</span> and <span class="math">OUT</span>, we note that an arbitrary input-output transition for an S-box is possible with probability of (at least) about <span class="math">2^{-1.5}</span> (this is true for the Zorro S-box, and for the AES S-box, the probability is even closer to <span class="math">2^{-1}</span>), and thus if we have at most <span class="math">a</span> active S-boxes, then we expect that <span class="math">OUT\\geq SOL\\cdot 2^{-1.5a}</span>, or <span class="math">SOL\\leq OUT\\cdot 2^{1.5a}</span>. Consequently, the time complexity of the algorithm can be upper bounded by <span class="math">\\binom{tr}{\\leq a}\\cdot T(Node)+OUT\\cdot 2^{1.5a}</span>. Assuming that the output size <span class="math">OUT</span> is not too big, the complexity of the algorithm is proportional to <span class="math">\\binom{tr}{\\leq a}</span>.</p>

    <h3 id="sec-10" class="text-xl font-semibold mt-8">2.3 Optimized Search Algorithm Using Pattern-Prefix Search</h3>

    <p class="text-gray-300">In this section we describe an optimization of the characteristic search algorithm, which is based on the observation that we can analyze together many common patterns with the same prefix. This allows us to dispose of all the patterns whose common prefix is not possible (instead of analyzing and disposing each one separately). In addition, this algorithm reduces the average amount of work (mostly linear algebra) performed for each pattern. We note that we cannot provide an improved theoretical analysis for this algorithm. However, this algorithm appears to give a significant advantage over the basic algorithm in practice.</p>

    <p class="text-gray-300">The algorithm <span class="math">PPS</span> (Pattern-Prefix Search) iterates over the tree of possible prefixes of patterns using the <span class="math">DFS</span> (Depth First Search) algorithm. The global parameters of <span class="math">PPS</span> are the number of rounds to analyze, <span class="math">r</span>, the number of S-boxes in each round, <span class="math">t</span>, and the maximal number of active S-boxes, <span class="math">a</span>. The parameters which are passed to each node of the tree are: the round number <span class="math">i</span>, the current S-box index in the round <span class="math">s\\in\\{0,1,\\ldots,t-1\\}</span>, the current number of active S-boxes in the prefix, <span class="math">ca</span>, and <span class="math">ST_{i}</span>, <span class="math">E_{i}</span> (as in the standard pattern-analysis algorithm). Thus, the <span class="math">PPS</span> algorithm is initially called with parameters</p>

    <p class="text-gray-300"><span class="math">PPS(i,s,ca,ST_{0},E_{0})</span>, where <span class="math">i=0</span>, <span class="math">s=0</span>, <span class="math">ca=0</span>, <span class="math">ST_{0}</span> is initialized with 128 new variables and <span class="math">E_{0}</span> is an empty set of equations.</p>

    <p class="text-gray-300"><span class="math">PPS(i,s,ca,ST_{i},E_{i})</span>:</p>

    <ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">

      <li>If <span class="math">i=r</span> (i.e., we finished iterating over all the S-boxes of the pattern), then the <span class="math">r</span>-round pattern is fully determined by the path to the root of the tree. Thus, calculate the basis <span class="math">B</span> for all the possible characteristics of the pattern (using <span class="math">E_{r}</span>). Finally, post-filter the characteristics (as in the pattern-analysis algorithm), and return them.</li>

      <li>Allocate a node <span class="math">n_{1}</span> for the case that S-box with index <span class="math">s</span> in round <span class="math">i</span> is inactive (duplicating the current <span class="math">ST_{i}</span>, <span class="math">E_{i}</span>): For this node, add 8 equations to the system <span class="math">E_{i}</span>, which equate the corresponding 8 bits in <span class="math">ST_{i}</span> to zero. Denote the (yet undetermined) output set of this node as <span class="math">OUT_{1}</span>.</li>

    </ol>

    <ul class="list-disc list-inside space-y-1 text-gray-300 my-2 ml-4">

      <li>If the dimension of the null-space of <span class="math">E_{i}</span> is 0 (i.e., there is no non-zero solution to the system, and thus no matching characteristic), delete this node and set <span class="math">OUT_{1}=\\emptyset</span>.</li>

      <li>Otherwise, the dimension of the null-space is greater than 0. If <span class="math">s=t-1</span> (i.e., we finished iterating over all the S-boxes of the current round <span class="math">i</span>), then set <span class="math">ST_{i+1}=L(ST_{i})</span> (i.e., update the symbolic state <span class="math">ST_{i+1}</span> according to the linear function of the cipher, <span class="math">L</span>), also set <span class="math">E_{i+1}=E_{i}</span>. Recursively call <span class="math">PPS(i+1,0,ca,ST_{i+1},E_{i+1})</span> and set <span class="math">OUT_{1}</span> according to the returned output.</li>

      <li>Otherwise, the dimension of the null-space is greater than 0, and <span class="math">s&lt;t-1</span>. Recursively call <span class="math">PPS(i,s+1,ca,ST_{i},E_{i})</span> and set <span class="math">OUT_{1}</span> according to the returned output.</li>

    </ul>

    <ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">

      <li>If <span class="math">ca=a</span> (i.e., we have reached the maximum number of active S-boxes), return <span class="math">OUT_{1}</span>.</li>

      <li>Otherwise (<span class="math">ca&lt;a</span>) allocate a node <span class="math">n_{2}</span> for the case that S-box with index <span class="math">s</span> in round <span class="math">i</span> is active (duplicating the current <span class="math">ST_{i}</span>, <span class="math">E_{i}</span>): For this node, replace the corresponding 8 linear combinations in <span class="math">ST_{i}</span> with newly allocated variables. Denote the (yet undetermined) output set for this node as <span class="math">OUT_{2}</span>.</li>

    </ol>

    <ul class="list-disc list-inside space-y-1 text-gray-300 my-2 ml-4">

      <li>If <span class="math">s=t-1</span> (i.e., we finished iterating over all the S-boxes of the current round <span class="math">i</span>), then set <span class="math">ST_{i+1}=L(ST_{i})</span> and <span class="math">E_{i+1}=E_{i}</span>. Recursively call <span class="math">PPS(i+1,0,ca+1,ST_{i+1},E_{i+1})</span> and set <span class="math">OUT_{2}</span> according to the returned output.</li>

      <li>Otherwise, <span class="math">s&lt;t-1</span>. Recursively call <span class="math">PPS(i,s+1,ca+1,ST_{i},E_{i})</span> and set <span class="math">OUT_{2}</span> according to the returned output.</li>

    </ul>

    <ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">

      <li>Return <span class="math">OUT_{1}\\bigcup OUT_{2}</span>.</li>

    </ol>

    <p class="text-gray-300">##</p>

    <p class="text-gray-300">3 Generic Key-Recovery Algorithm for Differential Attacks on PSP Networks</p>

    <p class="text-gray-300">In this section we present a key recovery algorithm for differential attacks exploiting the small number <span class="math">t</span> of S-boxes in each round of the cipher. As in Section 2, we describe the algorithm on the example of an AES-like cipher, in which a 128-bit state is represented as a 4-by-4 matrix of bytes, and the S-boxes (which are the only non-linear operation) act on <span class="math">t</span> bytes in each round. We show that given an <span class="math">r</span>-round differential characteristic with probability <span class="math">p</span>, one can attack <span class="math">r+\\lfloor 16/t\\rfloor</span> rounds (i.e., <span class="math">\\lfloor 16/t\\rfloor</span> rounds in addition to the characteristic) with data and time complexity of only about <span class="math">2\\cdot p^{-1}</span>, using negligible memory. First, we present an overview of the algorithm, and then we give a more detailed description.</p>

    <h3 id="sec-11" class="text-xl font-semibold mt-8">3.1 An Overview of the Algorithm</h3>

    <p class="text-gray-300">For sake of simplicity, we assume that <span class="math">t</span> divides 16, but the algorithm can be easily adapted to any value of <span class="math">t</span>. We denote the intermediate difference of the characteristic after <span class="math">i</span> rounds by <span class="math">\\Delta_{i}</span>, and thus the characteristic determines <span class="math">\\Delta_{i}</span> for <span class="math">i\\in\\{0,1,\\ldots,r\\}</span>. The algorithm requires the encryption of <span class="math">p^{-1}</span> plaintext pairs with input difference <span class="math">\\Delta_{0}</span>, and thus we expect that at least one of them is a right pair (i.e., follows the characteristic) with high probability. However, since we only have the output after <span class="math">r+16/t</span> rounds, there are no obvious filtering conditions on the ciphertext pair, and a trivial differential attack would fail to distinguish between right and wrong pairs.</p>

    <p class="text-gray-300">In order to work around this problem, we first note that given the actual values at the output of round <span class="math">r+16/t</span>, there is, on average, only one 128-bit key that leads to the fixed difference of <span class="math">\\Delta_{r}</span>. In this attack, we efficiently find the key suggestion (or suggestions in general) for each of the <span class="math">p^{-1}</span> ciphertext pairs, and then we perform a trial encryption in order to test whether it is the correct key. Hence, we show that instead of determining the right pair, it is sufficient to efficiently attach a candidate key to each pair.</p>

    <p class="text-gray-300">Our strategy resembles “Attack-C” of Albrecht and Cid <em>[1]</em>. In Attack-C, the adversary tests suggestions for the key, obtained by solving non-linear equations constructed using the fixed final difference of the characteristic and each of the ciphertexts pairs. In our case, we use a similar strategy, but without directly solving any non-linear equation. Instead, we use a linearization technique similar to the technique used in our search algorithm to determine the candidate key efficiently by solving two systems of linear equations.</p>

    <p class="text-gray-300">The algorithm first “linearizes” the last <span class="math">16/t</span> rounds by expressing the output difference <span class="math">\\Delta_{r+16/t}</span> as a linear combination of the fixed difference <span class="math">\\Delta_{r}</span> and some auxiliary variables. We start with the difference <span class="math">\\Delta_{r}</span> and examine its evolution through round <span class="math">r+1</span>. Since there are <span class="math">t</span> S-boxes in round <span class="math">r+1</span>, after the S-box</p>

    <p class="text-gray-300">layer there are (at most) <span class="math">8t</span> unknown bits. Hence, we add <span class="math">8t</span> variables to denote this difference so that <span class="math">\\Delta_{r+1}</span> can be expressed as a linear combination of <span class="math">\\Delta_r</span> and these <span class="math">8t</span> variables. We continue through rounds <span class="math">r+2,r+3,\\ldots,r+16/t</span>, and finally we obtain a representation of <span class="math">\\Delta_{r+16/t}</span> as a linear combination of <span class="math">\\Delta_r</span> and <span class="math">8t\\cdot(16/t)=128</span> variables. Note that this procedure does not depend on the actual ciphertexts, and can be performed during preprocessing. After obtaining the <span class="math">p^{-1}</span> ciphertext pairs, we plug the output difference <span class="math">\\Delta_{r+16/t}</span> into the system of equations, find all the 128 intermediate variables, and thus all intermediate differences <span class="math">\\Delta_{r+1},\\ldots,\\Delta_{r+16/t-1}</span>.</p>

    <p class="text-gray-300">After the differential sequence is determined, we can efficiently obtain the corresponding key suggestions to test. This is due to the fact that the determined differential transitions for the <span class="math">(16/t)\\cdot t=16</span> S-boxes give us the actual possible transition <em>values</em> (as each input/output difference suggests on average a single actual value). Assuming that the subkeys are interleaved with the state by a XOR operation (as in most SP networks), this gives 128 linear equations in the subkey bits, which are usually sufficient to recover the key easily.</p>

    <p class="text-gray-300">We note that the number of additional rounds can be further increased from <span class="math">16/t</span> if the differential characteristic is chosen such that its output difference <span class="math">\\Delta_r</span> forces some S-boxes in the next rounds to be inactive. In such a case, the number of auxiliary variables in the linearization stage is decreased, and thus, more rounds can be covered by 128 auxiliary variables. As will be shown in Section 5, this is the case in our attack on Zorro, where the <span class="math">r</span>-round characteristic is chosen such that out of the 8 S-boxes in rounds <span class="math">(r+1)</span> and <span class="math">(r+2)</span>, only four are active. As a result, rather than attacking <span class="math">r+16/4=r+4</span> rounds, we are able to break <span class="math">r+5</span> rounds with the same complexity.</p>

    <p class="text-gray-300">The full details of the algorithm are given below. Its data complexity is <span class="math">2\\cdot p^{-1}</span> chosen plaintexts and its time complexity is a bit more than <span class="math">2\\cdot p^{-1}</span> (and is estimated as <span class="math">4\\cdot p^{-1}</span>), since the analysis of each encrypted pair is very efficient (it essentially involves solving two small sets of linear equations). The algorithm requires negligible memory to store two small matrices.</p>

    <h3 id="sec-12" class="text-xl font-semibold mt-8">3.2 A Detailed Description of the Algorithm</h3>

    <p class="text-gray-300">In order to avoid abundance of variables, we assume that the number of S-boxes in each round is <span class="math">t=4</span> (as in Zorro), and thus the attack targets <span class="math">r+4</span> rounds. The algorithm can be easily adapted to any value of <span class="math">t</span>.</p>

    <h4 id="sec-13" class="text-lg font-semibold mt-6">The Main Key-Recovery Algorithm</h4>

    <p class="text-gray-300">The algorithm makes use of two auxiliary matrices, <span class="math">A_{1}</span> and <span class="math">A_{2}</span>, that are independent of the actual key and data, and are computed during preprocessing (to be described below).</p>

    <ul class="list-disc list-inside space-y-1 text-gray-300 my-2 ml-4">

      <li>Given the  <span class="math">96 \\times 128</span>  matrix  <span class="math">A_{1}</span> , and  <span class="math">\\Delta_{r+4}</span> , the 96-bit vector  <span class="math">A_{1} \\cdot \\Delta_{r+4}</span>  describes all the  <span class="math">12 \\cdot 8 = 96</span>  unknown output differences for the S-boxes of rounds  <span class="math">r+1</span> ,  <span class="math">r+2</span>  and  <span class="math">r+3</span> . Note that once the output differences of these 12 S-boxes are known, computing the full  <span class="math">\\Delta_{r+1}</span> ,  <span class="math">\\Delta_{r+2}</span>  and  <span class="math">\\Delta_{r+3}</span>  can be done by simple linear algebra.</li>

      <li>Given the  <span class="math">128 \\times (128 + 256)</span>  matrix  <span class="math">A_{2}</span> , and a  <span class="math">(128 + 256)</span> -bit vector  <span class="math">v</span>  (comprised of the 128-bit ciphertext, and  <span class="math">2 \\cdot (32 \\cdot 4) = 256</span> -bit input-output values of all the S-boxes of the last 4 rounds), the product  <span class="math">A_{2} \\cdot v</span>  gives a suggestion of the 128-bit key  <span class="math">K</span> .</li>

    </ul>

    <p class="text-gray-300">The full algorithm is as follows:</p>

    <ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">

      <li>Compute the matrices  <span class="math">A_{1}</span>  and  <span class="math">A_{2}</span>  (as described below).</li>

      <li>Ask for the encryptions of  <span class="math">p^{-1}</span>  plaintext pairs with input difference  <span class="math">\\Delta_0</span> . For each pair  <span class="math">(P, C)</span>  and  <span class="math">(P&#x27;, C&#x27;)</span> :</li>

    </ol>

    <p class="text-gray-300">(a) Compute  <span class="math">\\varDelta_{r+4}=C\\oplus C^{\\prime}</span> , and then calculate  <span class="math">A_{1}\\cdot \\varDelta_{r+4}</span> . This allows to compute the input-output differences of the 16 S-boxes in rounds  <span class="math">r+1, r+2, r+3, r+4</span> . (b) Check for each of the 16 S-boxes, whether the input-output difference transitions are possible according to the difference distribution table. If any of them is impossible, discard this pair and analyze the next pair by going back to Step 2. (c) Compute according to the difference distribution table, a list of vectors  <span class="math">List</span> , containing  <span class="math">2 \\cdot (32 \\cdot 4) = 256</span> -bit vectors, specifying all the possible input-output values of all the 16 S-boxes of the last 4 rounds. (d) For each 256-bit vector in  <span class="math">List</span> , denoted by  <span class="math">w</span> :</p>

    <p class="text-gray-300">i. Denote by  <span class="math">v</span>  the  <span class="math">(128 + 256)</span> -bit vector, comprised of the 128-bit ciphertext  <span class="math">C</span> , and the 256-bit vector  <span class="math">w</span>  (specifying the input-output values for all the S-boxes of the last 4 rounds). Obtain a suggestion for the key  <span class="math">K</span>  by computing product  <span class="math">A_2 \\cdot v</span> . ii. Test the key using a trial encryption, and if it succeeds, return it.</p>

    <p class="text-gray-300">Complexity Analysis The data complexity of the attack is  <span class="math">2 \\cdot p^{-1}</span>  chosen plaintexts. For each plaintext-ciphertext pair, we perform some simple linear algebra operations, whose complexity is generally proportional to a full cipher evaluation.[11] As noted in the beginning of this section, we expect to test only 1 key per plaintext pair, and thus we can estimate the time complexity of the attack to be slightly higher than  <span class="math">2 \\cdot p^{-1}</span>  cipher evaluations (given that the preprocessing complexity is negligible compared to  <span class="math">p^{-1}</span> ).</p>

    <p class="text-gray-300">The memory complexity of the attack is less than  <span class="math">2^{10}</span>  words of 128 bits, required in order to store  <span class="math">A_{1}</span>  and  <span class="math">A_{2}</span> . Note that the elements of List can be generated "on-the-fly", and we do not need to store them.</p>

    <p class="text-gray-300">Calculating the Differential Transitions From the Output Difference This preprocessing algorithm is given as input <span class="math">\\Delta_r</span> (which is known from the characteristic) and computes the <span class="math">96 \\times 128</span> matrix <span class="math">A_1</span> defined above. The algorithm symbolically maintains the state difference of round <span class="math">i</span> (<span class="math">\\Delta_i</span>), denoted by <span class="math">ST_i</span> (which is initialized for <span class="math">i = r</span> with the known <span class="math">\\Delta_r</span>).</p>

    <ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">

      <li>For each round <span class="math">i \\in \\{r, r + 1, r + 2, r + 3\\}</span>:</li>

    </ol>

    <p class="text-gray-300">(a) Given <span class="math">ST_i</span>, compute <span class="math">ST_{i+1}</span> by allocating <span class="math">4 \\cdot 8 = 32</span> new linear variables for the output of the 4 S-boxes of round <span class="math">i+1</span>, and then symbolically applying the linear layer <span class="math">L</span>, obtaining <span class="math">ST_{i+1} = L(ST_i)</span> (i.e., a symbolic representation of <span class="math">\\Delta_{i+1}</span>).</p>

    <ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">

      <li>Given the 128 computed symbolic expressions <span class="math">ST_{r+4}</span> (as functions of a total of <span class="math">4 \\cdot 32 = 128</span> linear variables), invert the <span class="math">128 \\times 128</span> matrix.</li>

    </ol>

    <p class="text-gray-300">This gives a matrix which calculates the S-box output differences of rounds <span class="math">r + 1</span>, <span class="math">r + 2</span> and <span class="math">r + 3</span> (and <span class="math">r + 4</span>) as functions of <span class="math">\\Delta_{r+4}</span> (note that we do not actually need to allocate the 32 variables for <span class="math">\\Delta_{r+4}</span> in order to compute this matrix). Denote by <span class="math">A_1</span> the first 96 rows of this matrix (calculating the S-box output differences of rounds <span class="math">r + 1</span>, <span class="math">r + 2</span> and <span class="math">r + 3</span>).</p>

    <p class="text-gray-300">Calculating the Key From the Ciphertext and S-box Transition Values This preprocessing algorithm computes the <span class="math">128 \\times (128 + 256)</span> matrix <span class="math">A_2</span> defined above. The algorithm first symbolically describes all the <span class="math">(32 \\cdot 4) = 128</span> S-box output values in the decryption process of a (symbolic) ciphertext <span class="math">C</span>, as linear combinations of the 128 variables of <span class="math">C</span>, the 128 variables of <span class="math">K</span>, and the <span class="math">(32 \\cdot 4) = 128</span> input values of all the intermediate S-boxes. This is done by iteratively computing the symbolic description of the values obtained in the decryption process of <span class="math">C</span> through rounds <span class="math">r + 4, r + 3, r + 2, r + 1</span> (from the decryption side), and expressing for each round, the outputs of the S-box transitions as linear combinations of the previous variables. Finally, the algorithm performs Gaussian elimination to express the 128 variables of the key as linear combinations in terms of the other <span class="math">128 + 256</span> variables, giving the matrix <span class="math">A_2</span>.</p>

    <p class="text-gray-300">As the idea of this algorithm is very similar to the one of the previous algorithm (which computes <span class="math">A_1</span>), we do not give its full description in this paper.</p>

    <h2 id="sec-14" class="text-2xl font-bold">4 Key-Recovery Algorithm for Linear Attacks on PSP Networks</h2>

    <p class="text-gray-300">In this section we present a key recovery algorithm for linear attacks exploiting the small number <span class="math">t</span> of S-boxes in each round. We show that given an <span class="math">r</span>-round linear characteristic with bias <span class="math">q</span>, one can attack <span class="math">r + \\ell</span> rounds (i.e., <span class="math">\\ell</span> rounds in addition to the characteristic) with data complexity<span class="math">^{12}</span> of <span class="math">c \\cdot q^{-2}</span>, time complexity of <span class="math">q^{-2} + t\\ell \\cdot 2^{8t\\ell + 8}</span>, and memory complexity of <span class="math">\\min(c \\cdot q^{-2}, 2^{8t\\ell})</span>. As in</p>

    <p class="text-gray-300"><span class="math">^{12}</span>The value of <span class="math">c</span> is determined by the amount of recovered subkey material and the desired success rate according to the formula suggested by Selçuk in [15] or its</p>

    <p class="text-gray-300">14</p>

    <p class="text-gray-300">the differential case, the algorithm is based on linearization of the rounds after the characteristic. An additional tool used here is a variant of the partial sums technique introduced by Ferguson et al. [8].</p>

    <p class="text-gray-300">A 1-round attack For sake of clarity, we first present the algorithm in the case of <span class="math">\\ell = 1</span>. Thus, we want to attack <span class="math">r + 1</span> rounds exploiting an <span class="math">r</span>-round linear characteristic. We denote the mask of the characteristic after <span class="math">i</span> rounds by <span class="math">\\Omega_{i}</span>, determining <span class="math">\\Omega_{i}</span> for <span class="math">i \\in \\{0,1,\\dots,r\\}</span>. The algorithm works by asking for the encryptions of <span class="math">c \\cdot q^{-2}</span> arbitrary plaintexts, and thus we expect to obtain a strong linear distinguisher after <span class="math">r</span> rounds.</p>

    <p class="text-gray-300">Obviously, the naive attack (guessing the last subkey and checking whether the linear relation holds) is worse than exhaustive key search for a 128-bit cipher, since the last round subkey consists of 128 bits. A better approach is to exchange the order of operations in the final round, such that the final key addition is performed right after the S-box layer, and the final linear layer becomes the last operation in the encryption process. This can be done by replacing the final round subkey with an equivalent key.^[13]^ As a result, in order to compute <span class="math">\\Omega_r \\cdot X_r</span>, where <span class="math">X_r</span> denotes the state after round <span class="math">r</span>, it is sufficient to guess only the 8t equivalent subkey bits that affect the S-boxes of the last round. Thus, the attack complexity is reduced to <span class="math">2^{8t} \\cdot q^{-2}</span>.</p>

    <p class="text-gray-300">The next optimization is useful when <span class="math">c \\cdot q^{-2} &amp;gt; 2^{8t}</span> (as in the case of Zorro). We write <span class="math">\\Omega_r = \\Omega_{8t} \\oplus \\Omega_{128 - 8t}</span>, namely, we divide the mask <span class="math">\\Omega_r</span> between two masks — one that affects only the 8t bits in the S-boxes, and all the rest (as a result <span class="math">\\Omega_{8t} \\cdot \\Omega_{128 - t} = 0</span>). If two "ciphertexts" (i.e., partially decrypted ciphertexts through the linear layer <span class="math">L</span>, which in the case of AES is composed of MC and SR) have the same value in the bits masked by <span class="math">\\Omega_{8t}</span>, then for any key guess, they yield the same value for <span class="math">\\Omega_{8t} \\cdot X_r</span>. Hence, we count for each of the 8t bits that enter the S-box, how many times they were suggested (if <span class="math">\\Omega_0 \\cdot P \\oplus \\Omega_{128 - 8t} \\cdot X_r = 0</span>, we increment the counter corresponding to the 8t bits, and if <span class="math">\\Omega_0 \\cdot P \\oplus \\Omega_{128 - 8t} \\cdot X_r = 1</span>, we decrement this counter). After counting how many times an 8t-bit value is suggested (again, compensating for the difference in the values of <span class="math">\\Omega_0 \\cdot P \\oplus \\Omega_{128 - 8t} \\cdot X_r</span>), we can analyze the 8t-bit value itself, and just increment/decrement the observed bias by the value of its corresponding counter. The resulting attack algorithm is as follows:</p>

    <ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">

      <li>Initialize <span class="math">2^{8t}</span> counters to zero.</li>

      <li>Collect <span class="math">c \\cdot q^{-2}</span> plaintext/ciphertext pairs <span class="math">(P_i, C_i)</span>.</li>

      <li>For each ciphertext <span class="math">C_i</span>, compute <span class="math">Z_i = L^{-1}(C_i)</span>.</li>

      <li>For each pair <span class="math">(P_i, Z_i)</span>:</li>

    </ol>

    <p class="text-gray-300">refinements from [4]. For example, for <span class="math">t = 4</span> (32-bit subkey) and success rate of <span class="math">84\\%</span>, we need to fix <span class="math">c = 3.7</span>. For the full 128-bit key and success rate of <span class="math">78.8\\%</span> we need to fix <span class="math">c = 7</span>.</p>

    <p class="text-gray-300">^[13] This procedure is common in attacks on AES, where the equivalent key is defined by <span class="math">\\tilde{K} = SR^{-1}(MC^{-1}(K))</span>, or in our notations <span class="math">\\tilde{K} = L^{-1}(K)</span>.</p>

    <ul class="list-disc list-inside space-y-1 text-gray-300 my-2 ml-4">

      <li>If <span class="math">\\Omega_{0}\\cdot P\\oplus\\Omega_{128-8t}\\cdot Z_{i}=0</span>, increment the counter corresponding to the value of the <span class="math">8t</span> bits of <span class="math">Z_{i}</span>.</li>

      <li>Else, decrement the counter corresponding to the value of the <span class="math">8t</span> bits of <span class="math">Z_{i}</span>.</li>

    </ul>

    <ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">

      <li>For all <span class="math">8t</span> key bits guess:</li>

    </ol>

    <ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">

      <li>Initialize a bias counter to 0.</li>

      <li>For any value of the <span class="math">8t</span> bits masked by <span class="math">\\Omega_{8t}</span>, use the guess of the key bits to evaluate <span class="math">\\Omega_{8t}\\cdot X_{r}</span>.</li>

      <li>If <span class="math">\\Omega_{8t}\\cdot X_{r}=0</span>, add to the bias counter, the counter associated with the <span class="math">8t</span> “ciphertext” bits, otherwise, decrement by the same value.</li>

      <li>Output the key with the maximal bias from 0.</li>

    </ol>

    <p class="text-gray-300">The advantage of this approach over the previous one is that the expensive partial decryption step is done only <span class="math">2^{8t}</span> times, rather than <span class="math">c\\cdot q^{-2}</span> times. The time complexity of the algorithm is <span class="math">c\\cdot q^{-2}+2^{2\\cdot 8t}</span>, and its memory complexity is <span class="math">\\min(c\\cdot q^{-2},2^{8t})</span>.</p>

    <p class="text-gray-300">The algorithm can be further refined by dividing the key guessing procedure into <span class="math">t</span> steps using the partial-sum technique. In the first step, we guess only the 8 subkey bits corresponding to a single S-box and partially decrypt only through this S-box, summing over the relevant counters. After this step, there are only <span class="math">2^{8(t-1)}</span> possible values (for the <span class="math">8(t-1)</span> bits, as the 8 bits corresponding to the “guessed” S-box are merged into a single entry). This process can be repeated for the next 8 subkey bits, until all <span class="math">8t</span> equivalent subkey bits are guessed. As the complexity of each of these stages is <span class="math">2^{8t+8}</span> operations, the overall time complexity of the attack becomes <span class="math">c\\cdot q^{-2}+t2^{8t+8}</span> operations. The memory complexity remains <span class="math">\\min(c\\cdot q^{-2},2^{8t})</span>.</p>

    <p class="text-gray-300">Finally, we note that when the key addition layer is composed of XOR, we can optimize the parity evaluations by applying the algorithm of <em>[5]</em>. This algorithm, based on Fast Fourier Transform, allows computing the biases of all combinations of values and keys for a single S-box in time <span class="math">3\\cdot 8\\cdot 2^{8}=2^{12.6}</span> rather than <span class="math">2^{16}</span> as in a straightforward implementation. Hence, the time complexity of our attack becomes <span class="math">c\\cdot q^{-2}+t2^{8t+4.6}</span>.</p>

    <h5 id="sec-15" class="text-base font-semibold mt-4">An <span class="math">\\ell</span>-round attack</h5>

    <p class="text-gray-300">In order to extend the attack to <span class="math">r+\\ell</span> rounds, we linearize the last <span class="math">\\ell</span> encryption rounds. Namely, we represent the bits of the state <span class="math">X_{r}</span> as a linear function of the ciphertext bits and <span class="math">8t\\ell</span> auxiliary variables (similarly to the differential attack, we add 8 variables each time an active S-box is encountered). As in the case <span class="math">\\ell=1</span>, we observe that if two partially decrypted ciphertexts agree on <span class="math">8t\\ell</span> bits, then they agree also on <span class="math">\\Omega_{r}\\cdot X_{r}</span>. Hence, we can group the ciphertexts into <span class="math">2^{8t\\ell}</span> sets according to the values of these bits, and execute the same algorithm as in the case of <span class="math">\\ell=1</span>.</p>

    <p class="text-gray-300">The complexity of the attack is <span class="math">D=c\\cdot q^{-2}</span> known plaintexts, <span class="math">M=\\min(c\\cdot q^{-2},2^{8t\\ell})</span> 128-bit memory blocks, and <span class="math">T=c\\cdot q^{-2}+t\\ell\\cdot 2^{8t\\ell+4.6}</span> operations, where each operation is less than a single round decryption.</p>

    <p class="text-gray-300">We note that the complexity of the attack can be further reduced if the linear characteristic is chosen in such a way that only <span class="math">t^{\\prime}</span> of the active S-boxes in</p>

    <p class="text-gray-300">round  <span class="math">r + 1</span>  affect the output mask  <span class="math">\\varOmega_r\\cdot X_r</span> . In such a case, the number of sets to which we group the ciphertexts is reduced to  <span class="math">2^{8((\\ell -1)t + t&#x27;)}</span> , and the attack's complexity is reduced accordingly. As described in Appendix A, this is the case in our linear attack on Zorro, where only 2 of the 4 active S-boxes in the last round affect the output mask. This also changes the memory complexity to  <span class="math">M = \\min (c\\cdot q^{-2},2^{8t(\\ell -1) + 8t&#x27;})</span> .</p>

    <p class="text-gray-300">In this section we apply our generic algorithms to the lightweight block cipher Zorro.</p>

    <p class="text-gray-300">Zorro is an AES-based 128-bit lightweight block cipher proposed by Gérard et al. at CHES 2013 [9]. The cipher executes 24 AES-like rounds, where the key schedule simply adds the 128-bit master key every four rounds, as shown at the top of Figure 2.</p>

    <p class="text-gray-300">Each Zorro round is made of four AES-like operations, namely  <span class="math">SB^{<em>}</span> ,  <span class="math">AC</span> ,  <span class="math">SR</span>  and  <span class="math">MC</span>  (see the bottom of Figure 2).  <span class="math">SR</span>  and  <span class="math">MC</span>  are exactly the same as the ones used in AES, whereas  <span class="math">AC</span>  for round  <span class="math">i</span>  adds the four constants  <span class="math">(i,i,i,i \\ll 3)</span>  to the 4 bytes of the first row. The main difference of Zorro from the AES is its non-linear operation  <span class="math">SB^{</em>}</span> , which contains only 4 S-boxes (instead of 16), located in the first row of the state matrix. Moreover, the actual  <span class="math">8 \\times 8</span>  S-box is different than the one used in AES. However, as the S-box implantation has only a limited effect on our results, we refer the interested reader to the design document [9] for its specification.</p>

    <p class="text-gray-300">!<a href="img-1.jpeg">img-1.jpeg</a></p>

    <p class="text-gray-300">!<a href="img-2.jpeg">img-2.jpeg</a> Fig. 2. The Key Schedule and Round Function of Zorro</p>

    <p class="text-gray-300">Summary of Attacks on Zorro Table 1 summarizes the previously published and our new attacks on full Zorro. <span class="math">^{14}</span>  We note that although the (independent and concurrent) work of Rasoolzadeh et al. [14] exploited the same characteristics as we do (that were found by them manually), their attack complexities are higher by a factor of  <span class="math">2^{12}</span> , due to the use of inferior attack techniques.</p>

    <div class="overflow-x-auto my-4">

      <table class="min-w-full text-sm text-gray-300">

        <thead>

          <tr>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">Source</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">Time</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">Data</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">Memory</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">Technique</th>

          </tr>

        </thead>

        <tbody>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">[16]</td>

            <td class="px-3 py-2 border-b border-gray-700">2112††</td>

            <td class="px-3 py-2 border-b border-gray-700">2112 CP</td>

            <td class="px-3 py-2 border-b border-gray-700">negligible</td>

            <td class="px-3 py-2 border-b border-gray-700">Differential</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">[14]†</td>

            <td class="px-3 py-2 border-b border-gray-700">≈ 255††</td>

            <td class="px-3 py-2 border-b border-gray-700">255.12 CP</td>

            <td class="px-3 py-2 border-b border-gray-700">217</td>

            <td class="px-3 py-2 border-b border-gray-700">Differential</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">[14]†</td>

            <td class="px-3 py-2 border-b border-gray-700">257.85</td>

            <td class="px-3 py-2 border-b border-gray-700">245.44 KP</td>

            <td class="px-3 py-2 border-b border-gray-700">217</td>

            <td class="px-3 py-2 border-b border-gray-700">Linear</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">Sec. 5.2</td>

            <td class="px-3 py-2 border-b border-gray-700">245</td>

            <td class="px-3 py-2 border-b border-gray-700">241.5 CP</td>

            <td class="px-3 py-2 border-b border-gray-700">210</td>

            <td class="px-3 py-2 border-b border-gray-700">Differential</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">App. A</td>

            <td class="px-3 py-2 border-b border-gray-700">245</td>

            <td class="px-3 py-2 border-b border-gray-700">245 KP</td>

            <td class="px-3 py-2 border-b border-gray-700">217</td>

            <td class="px-3 py-2 border-b border-gray-700">Linear</td>

          </tr>

        </tbody>

      </table>

    </div>

    <p class="text-gray-300">KP - Known plaintext, CP - Chosen plaintext</p>

    <p class="text-gray-300">† The results were obtained concurrently and independently of ours. The reported time complexities of [14, 16] are lower. However, in order to calculate the time complexity, we take into account the time required for generating the data.</p>

    <p class="text-gray-300">Table 1. Previous, Independent and New Key-Recovery Attacks on Full Zorro</p>

    <p class="text-gray-300">In order to mount a differential attack on Zorro, we first apply the differential characteristic search algorithm of Section 2.2, and then use the key recovery technique of Section 3.</p>

    <p class="text-gray-300">Differential Characteristic Search We applied the differential search algorithm of Section 2.2 to the full Zorro. The highest probability characteristic for Zorro (for more than 7 rounds) is obtained by concatenating several instances of the 4-round iterative characteristic described <span class="math">^{15}</span>  in Figure 5 (given in the appendix). In fact, there are 5 additional linearly-dependent variants (over  <span class="math">GF(2^8)</span> ) of the presented characteristic with the same probability.</p>

    <p class="text-gray-300">Key Recovery for the Differential Attack In order to exploit the characteristic in an attack, we extend it up to round 19 (see Figure 5). The resulting 19-round characteristic has 8 active S-boxes in total, and has probability of</p>

    <p class="text-gray-300"><span class="math">(6 / 256)^{8} \\approx 2^{-43}</span> . We used the optimized version of our characteristic search tool (pattern-prefix search) to prove that it is the highest probability characteristic for the full 19 rounds.</p>

    <p class="text-gray-300">A straightforward application of the algorithm presented in Section 3 can be used to attack  <span class="math">19 + 16 / 4 = 23</span>  rounds. However, as mentioned in Section 3, more rounds can be attacked if the characteristic is chosen such that several S-boxes after the characteristic are inactive, and this is the case here. First, we observe that the state difference after 19 rounds (i.e., the output difference of the characteristic) contains 2 inactive S-boxes (see Figure 5). Furthermore, we can exploit the specific super S-box structure of Zorro (and of AES-based designs in general), and extend the characteristic with 2 additional inactive S-boxes in round 20 (see Figure 5). Thus, we have a total of 16 active S-boxes in the last 5 rounds (similarly to 4 fully active Zorro rounds), allowing to attack 5 rounds in addition to the 19 rounds of the characteristic.</p>

    <p class="text-gray-300">According to Section 3, as the 19-round characteristic has a probability of about  <span class="math">p = 2^{-43}</span> , the data complexity of the attack is about  <span class="math">2 \\cdot p^{-1} = 2^{44}</span>  chosen plaintexts, its time complexity is about  <span class="math">2^{45}</span> , and its memory complexity is less than  <span class="math">2^{10}</span> .</p>

    <p class="text-gray-300">We can reduce the data complexity of the attack by a factor of 6 by using structures that exploit all the 6 characteristics of probability  <span class="math">p = 2^{-43}</span> . This is a common technique in differential cryptanalysis, and was used (for example) in [16]. Each structure we use is an affine subspace of dimension 6, which is constructed from an arbitrary plaintext, by XORing to it all the  <span class="math">2^{6}</span>  linear combinations (over  <span class="math">GF(2)</span> ) of the 6 initial differences of the characteristics of probability  <span class="math">p = 2^{-43}</span> . Thus, the data complexity is reduced by a factor of 6 to about  <span class="math">2^{41.5}</span> . The time complexity remains the same, and the memory complexity remains very small (as each structure contains only  <span class="math">2^{6}</span>  elements).</p>

    <p class="text-gray-300">Attack Simulation The differential attack presented in this section was implemented and fully simulated 11 times on a single desktop PC, each simulation running for (up to) several days (the fastest took less than 8 hours, whereas the longest took about 235.5 hours). Table 2 describes the average results of the simulations, which are very close to the theoretical prediction. More detailed results are given in Table 6 (in the appendix).</p>

    <div class="overflow-x-auto my-4">

      <table class="min-w-full text-sm text-gray-300">

        <thead>

          <tr>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">Result</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">Plaintexts Encrypted</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">Structures Analyzed</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">Pairs Analyzed</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">Keys Suggested</th>

          </tr>

        </thead>

        <tbody>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">Theory</td>

            <td class="px-3 py-2 border-b border-gray-700">241.5</td>

            <td class="px-3 py-2 border-b border-gray-700">235.5</td>

            <td class="px-3 py-2 border-b border-gray-700">243</td>

            <td class="px-3 py-2 border-b border-gray-700">243</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">Simulations (Average)</td>

            <td class="px-3 py-2 border-b border-gray-700">241.49</td>

            <td class="px-3 py-2 border-b border-gray-700">235.49</td>

            <td class="px-3 py-2 border-b border-gray-700">243.07</td>

            <td class="px-3 py-2 border-b border-gray-700">243.07</td>

          </tr>

        </tbody>

      </table>

    </div>

    <p class="text-gray-300">Table 2. Average Simulation Results of Differential Attack on Full Zorro (Versus Theoretical Estimate)</p>

    <p class="text-gray-300">6 Design of Secure PSP Networks</p>

    <p class="text-gray-300">In this section, we show that the weakness of Zorro is not inherently present in all PSP networks. We demonstrate this by designing a mild modification of Zorro that is <em>provably secure</em> against basic differential and linear attacks (such as those that broke the original Zorro). Finally, we discuss how to choose the parameter <span class="math">t</span> (i.e., the number of S-boxes in each round) in PSP networks.</p>

    <p class="text-gray-300">In order to quantify what we consider to be a “good” PSP network with respect to resistance against basic differential and linear attacks, we estimate the minimal number <span class="math">a</span> of active S-boxes in an <span class="math">r</span>-round characteristic for a very strong PSP network. Our model constructs an idealized PSP network by choosing the layer of each round uniformly at random from the space of invertible linear mappings, and it is therefore expected to provide very fast diffusion.</p>

    <p class="text-gray-300">As described in Section 2, an <span class="math">r</span>-round characteristic with <span class="math">a</span> active S-boxes gives rise to a system of <span class="math">8(tr-a)</span> linear equations in <span class="math">8(16+a)</span> variables (using the notations of Section 2). Based on our randomness assumption, we expect a solution when <span class="math">8(16+a)\\geq 8(tr-a)</span>, or equivalently, <span class="math">a\\geq(t\\cdot r-16)/2</span>. Namely, an <span class="math">r</span>-round characteristic for an idealized PSP network is expected to have at least <span class="math">(t\\cdot r-16)/2</span> active S-boxes. We note that this inequality is somewhat oversimplified, as it does not take into account the fact that we have many possible patterns, whereas we are looking for only one valid characteristic. On the other hand, depending on the actual S-box, not all solutions are valid for a given cipher. As these two considerations have opposite effects on <span class="math">a</span>, and their total effect seems relatively small for large values of <span class="math">r</span>, we consider the formula <span class="math">a\\geq(t\\cdot r-16)/2</span> to be a reasonable measure for a “good” PSP Network. As an extreme case, consider AES for which <span class="math">t=16</span>. Plugging <span class="math">r=4</span> into the formula, we estimate that 4-round AES can be designed to have at least <span class="math">a\\geq(16\\cdot 4-16)/2=24</span> active S-boxes in any characteristic. Indeed, it is known that the minimal number of active S-boxes in a 4-round characteristic of AES is 25 (see <em>[6]</em>), and thus our estimate is very close in this case.</p>

    <h3 id="sec-19" class="text-xl font-semibold mt-8">6.1 Analysis of a Concrete PSP Network</h3>

    <p class="text-gray-300">We now construct a PSP Network which (roughly) satisfies the formula <span class="math">a\\geq(t\\cdot r-16)/2</span> for large values of <span class="math">r</span>, thus providing significantly better resistance against basic differential and linear attacks compared to Zorro. According to Appendix B, in order to avoid the weakness of Zorro, our scheme has to deviate from the AES-based design strategy. More specifically, this appendix shows that any AES-based PSP network (with small <span class="math">t</span>) is likely to have 4-round iterative characteristics with a high probably. The reason for the inherent weakness of AES-based PSP networks is subtle and is detailed in Appendix B. Very roughly, this weakness stems from the combination of the two properties below:</p>

    <ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">

      <li>Any MDS circulant MixColumn matrix, MC, raised to the power of 4 (i.e.,  <span class="math">(MC)^{4}</span> ) has a large space of eigenvectors ("almost fixed-points") that satisfy  <span class="math">MC^4(x) = \\alpha x</span>  for an appropriately chosen eigenvalue scalar  <span class="math">\\alpha</span> .</li>

      <li>The order of ShiftRows is 4 (i.e.,  <span class="math">(SR)^{4}</span>  is the identity).</li>

    </ol>

    <p class="text-gray-300">Therefore, in order to avoid the high probability 4-round iterative characteristics of the type shown in Figure 5, our scheme has to deviate from the AES design strategy by changing at least one of the two properties above. In our tweaked scheme, we slightly change the ShiftRows operation such that its order is greater than 4, as described below. Furthermore, in order to avoid additional types of iterative characteristics (namely, characteristics presented in [16], which are independent of ShiftRows), we also change the locations of the S-boxes, and place them on the diagonal instead of the first row.</p>

    <p class="text-gray-300">The modified variant of ShiftRows (denoted as  <span class="math">SR^{<em>}</span> ) is described in Figure 3 and works as follows: The action of  <span class="math">SR^{</em>}</span>  on rows 1,3 and 4 is the same as in the original ShiftRows. On the other hand, only the first 3 bytes of row 2 are cyclically rotated by 1 (whereas the 4'th byte remains unchanged at its position), and it is easy to see that the order of  <span class="math">SR^{*}</span>  is  <span class="math">3 \\cdot 4 = 12</span> . We note that this modified variant provides slightly weaker local diffusion compared to AES-based designs. However, we now show that globally, this modification significantly strengthens the resistance of the scheme against standard differential and linear attacks.</p>

    <p class="text-gray-300">!<a href="img-3.jpeg">img-3.jpeg</a> Fig.3.Modified ShiftRows</p>

    <p class="text-gray-300">We first consider 11 rounds of the tweaked scheme and estimate its strength in our ideal model by plugging  <span class="math">t = 4</span>  and  <span class="math">r = 11</span>  into the formula  <span class="math">a \\geq (t \\cdot r - 16)/2</span> , obtaining  <span class="math">a \\geq (4 \\cdot 11 - 16)/2 = 14</span> . However, a more careful analysis reveals that there are many possible 11-round patterns with 13 active S-boxes  <span class="math">\\left( \\binom{11 \\cdot 4}{13} &amp;gt; 2^{35} \\right)</span> , each giving rise to a system with  <span class="math">8 \\cdot (16 + 13) = 8 \\cdot 29</span>  variables and  <span class="math">8 \\cdot (44 - 13) = 8 \\cdot 31</span>  equations, which has a solution with non-negligible probability of  <span class="math">2^{8 \\cdot (29 - 31)} = 2^{-16}</span> . Therefore, 13-round characteristics can also be expected, slightly deviating from the generic formula when we do not consider post-filtering according to the cipher's S-box.</p>

    <p class="text-gray-300">Using the characteristic search tool presented in Section 2, we were able to prove that there exists no characteristic (or linear mask) with at most 12 active S-boxes (regardless of the cipher's specific S-box). Considering 13 active</p>

    <p class="text-gray-300">S-boxes, there exist only a few dozens of possible characteristics for the cipher. Consequently, the behavior of the 11-round scheme closely matches our ideal one, and we conclude that it has no particular weakness against standard differential and linear cryptanalysis.</p>

    <p class="text-gray-300">A more comprehensive differential analysis<span class="math">^{17}</span> of the 11-round cipher reveals that none of the characteristics with 13 active S-boxes satisfies the restrictions imposed by the 13 transitions through the Zorro S-box. This is expected, as the number of possible characteristics is small, and implies that our generic formula <span class="math">a \\geq (t \\cdot r - 16)/2</span> predicted the exact value of <span class="math">a = 14</span> in this case. Indeed, we were able to find about <span class="math">2^{32}</span> 11-round characteristics with 14 active S-boxes using our tool. When considering the specific Zorro S-box for postfiltering these solutions, about <span class="math">2^{22}</span> valid 14-round differential characteristics remain. The highest-probability differential characteristic with 14 active S-boxes is described in Figure 6 (in the appendix), having probability of about <span class="math">2^{-86.8}</span>. Since the highest differential transition probability for the Zorro S-box is about <span class="math">2^{-4.7}</span>, this proves that the best 11-round characteristic has probability of at most <span class="math">\\min(2^{-86.8}, 2^{15 \\cdot (-4.7)}) = 2^{-70.5}</span>. Consequently, the best characteristic for 22 rounds of the cipher has probability of at most <span class="math">2^{-70.5 \\cdot 2} = 2^{-141}</span> (note that for the stronger AES S-box, the bound is even lower).</p>

    <p class="text-gray-300">For 12 rounds of the cipher, we were able to prove that there exists no characteristic (or mask) with at most 14 active S-boxes. However, we did not run the tool for more than 14 active S-boxes, as this is too time-consuming for a standard desktop PC. Of course, it would be interesting to further optimize the search tool and efficiently analyze more rounds.<span class="math">^{18}</span> Nevertheless, even in their current state, our results are sufficient for demonstrating that the security of our modified Zorro variant with respect to standard differential and linear attacks is close to that of an idealized PSP network with the same parameters. Indeed, according to the formula <span class="math">a \\geq (t \\cdot r - 16)/2</span>, the bound of at least <span class="math">a = 30</span> active S-boxes (or a differential characteristic probability bound of <span class="math">2^{-141}</span>) should be obtained for <span class="math">r = 19</span> rounds. Thus, the gap between the expected behavior of the scheme and what we can prove, is only 3 rounds for a probability bound as low as <span class="math">2^{-141}</span>, and if we consider the stronger AES S-box (for which the probability bound of <span class="math">2^{-141}</span> can be obtained with only 24 active S-boxes), this gap is even smaller.</p>

    <h2 id="sec-20" class="text-2xl font-bold">6.2 How to Choose the Number of S-boxes in Each Round in PSP Networks?</h2>

    <p class="text-gray-300">We now use the insight gained in this paper to revisit one of the main questions posed in [9], namely: for a PSP network, what is the value of <span class="math">t</span> that offers security</p>

    <p class="text-gray-300"><span class="math">^{17}</span>The linear analysis is very similar, and we omit it from this paper.</p>

    <p class="text-gray-300"><span class="math">^{18}</span>One could try to incorporate dynamic programming techniques into our tool, similarly to the algorithms of [2, 3]. However, this seems far from straightforward, as concatenating two patterns requires the relatively complex operation of intersecting their corresponding linear subspaces.</p>

    <p class="text-gray-300">with the minimal number of S-boxes? In <em>[9]</em>, it was concluded that for 128-bit ciphers with 8-bit S-boxes, the optimal value is <span class="math">t=4</span>, when considering security against standard differential and linear cryptanalysis. However, our formula <span class="math">a\\geq(t\\cdot r-16)/2</span> shows that the total number of S-boxes in the scheme, <span class="math">t\\cdot r</span>, required to guarantee that <span class="math">a</span> of them are active (and thus to obtain a bound on the characteristic probability) is fixed to <span class="math">(2\\cdot a)+16</span>, regardless of the value of <span class="math">t</span>. Furthermore, according to Sections 3 and 4, the number of S-boxes that need to be added at the end of the cipher is fixed as well (e.g., to about 16 for differential attacks), and is independent of <span class="math">t</span>.</p>

    <p class="text-gray-300">Since it is possible to use <span class="math">t=16</span> as in AES, this seems to question the effectiveness of PSP networks in thwarting side-channel attacks via masking techniques. Indeed, when considering resistance against standard differential and linear cryptanalysis, it seems that there is no gain in using partial non-linear layers. However, we still claim that the combination of partial non-linear layers with strong linear layers has an advantage, when taking into consideration other types of attacks.</p>

    <p class="text-gray-300">In order to demonstrate this potential advantage, we consider AES-128, where 4 rounds are sufficient for assuring that any characteristic has probability lower than <span class="math">2^{-128}</span>. Despite its strength against differential and linear cryptanalysis, 4-round AES-128 is an extremely weak cipher due to strong structural properties, and can be broken in <span class="math">2^{10}</span> chosen plaintexts and time (see <em>[8]</em>). In fact, as the best attacks on AES-128 can break 7 rounds (e.g., see <em>[7]</em>), one has to (at least) double the number of rounds to 8 (and double the number of S-boxes to <span class="math">16\\cdot 8=128</span>) in order to obtain a secure cipher.</p>

    <p class="text-gray-300">PSP networks, on the other hand, employ many strong linear layers through more rounds, and thus seem to better mitigate structural attacks. Consequently, one could build a secure PSP network where the number of S-boxes is closer (compared to AES) to the bound <span class="math">(2\\cdot a)+16</span>.</p>

    <p class="text-gray-300">Finally, we note that (generalized) Feistel structures employ only partial linear layers, and therefore may require many more than <span class="math">(2\\cdot a)+16</span> S-boxes to resist standard differential and linear cryptanalysis. Furthermore, due to the partial linear layers, some Feistel structures are particularly vulnerable to structural attacks such as impossible differential cryptanalysis.</p>

    <p class="text-gray-300">We conclude that PSP networks may allow for more efficient masking techniques to mitigate side-channel attacks. However, the optimal choice of the number of S-boxes in each round has to be made for each specific design separately, after evaluating its security against a broad class of attacks, which are out of the context of this paper.</p>

    <h2 id="sec-21" class="text-2xl font-bold">7 Conclusions</h2>

    <p class="text-gray-300">In this paper, we introduced new algorithms for differential and linear cryptanalysis of PSP networks. Using these algorithms, we were able to devise and fully simulate a practical attack against the block cipher Zorro. We then closely examined PSP networks, and concluded that they should not be based directly</p>

    <p class="text-gray-300">on the AES design strategy. Finally, we designed and analyzed a tweak of Zorro and used it to show that PSP networks do not have an inherent flaw. We do not formally propose to use this tweak, as this would require defining its concrete number of rounds and performing full analysis against many types of known attacks. Nevertheless, we believe that our tweak may provide a good starting point for building future designs. Alternatively, one can think of building PSP networks based on bit-oriented design strategies, such as the one used for the block cipher Serpent. Regardless of concrete design strategies, we believe that the tools developed in this paper will be useful in future PSP network design and analysis.</p>

    <h2 id="sec-22" class="text-2xl font-bold">References</h2>

    <ul class="list-disc list-inside space-y-1 text-gray-300 my-2 ml-4">

      <li>[1] Albrecht, M.R., Cid, C.: Algebraic Techniques in Differential Cryptanalysis. In: Dunkelman, O. (ed.) FSE. Lecture Notes in Computer Science, vol. 5665, pp. 193–208. Springer (2009)</li>

      <li>[2] Biryukov, A., Nikolic, I.: Automatic Search for Related-Key Differential Characteristics in Byte-Oriented Block Ciphers: Application to AES, Camellia, Khazad and Others. In: Gilbert, H. (ed.) EUROCRYPT. Lecture Notes in Computer Science, vol. 6110, pp. 322–344. Springer (2010)</li>

      <li>[3] Biryukov, A., Nikolic, I.: Search for Related-Key Differential Characteristics in DES-Like Ciphers. In: Joux, A. (ed.) Fast Software Encryption - 18th International Workshop, FSE 2011, Lyngby, Denmark, February 13-16, 2011, Revised Selected Papers. Lecture Notes in Computer Science, vol. 6733, pp. 18–34. Springer (2011), http://dx.doi.org/10.1007/978-3-642-21702-9_2</li>

      <li>[4] Bogdanov, A., Tischhauser, E.: On the Wrong Key Randomisation and Key Equivalence Hypotheses in Matsui’s Algorithm 2. In: FSE (2013), to appear in Lecture Notes in Computer Science</li>

      <li>[5] Collard, B., Standaert, F.X., Quisquater, J.J.: Improving the Time Complexity of Matsui’s Linear Cryptanalysis. In: Nam, K.H., Rhee, G. (eds.) ICISC. Lecture Notes in Computer Science, vol. 4817, pp. 77–88. Springer (2007)</li>

      <li>[6] Daemen, J., Rijmen, V.: The Design of Rijndael: AES - The Advanced Encryption Standard. Information Security and Cryptography, Springer (2002), http://dx.doi.org/10.1007/978-3-662-04722-4</li>

      <li>[7] Derbez, P., Fouque, P., Jean, J.: Improved Key Recovery Attacks on Reduced-Round AES in the Single-Key Setting. In: Johansson, T., Nguyen, P.Q. (eds.) Advances in Cryptology - EUROCRYPT 2013, 32nd Annual International Conference on the Theory and Applications of Cryptographic Techniques, Athens, Greece, May 26-30, 2013. Proceedings. Lecture Notes in Computer Science, vol. 7881, pp. 371–387. Springer (2013), http://dx.doi.org/10.1007/978-3-642-38348-9_23</li>

      <li>[8] Ferguson, N., Kelsey, J., Lucks, S., Schneier, B., Stay, M., Wagner, D., Whiting, D.: Improved Cryptanalysis of Rijndael. In: Schneier, B. (ed.) FSE. Lecture Notes in Computer Science, vol. 1978, pp. 213–230. Springer (2000)</li>

      <li>[9] Gérard, B., Grosso, V., Naya-Plasencia, M., Standaert, F.X.: Block Ciphers That Are Easier to Mask: How Far Can We Go? In: Bertoni, G., Coron, J.S. (eds.) CHES. Lecture Notes in Computer Science, vol. 8086, pp. 383–399. Springer (2013)</li>

      <li>[10] Guo, J., Nikolic, I., Peyrin, T., Wang, L.: Cryptanalysis of Zorro. Cryptology ePrint Archive, Report 2013/713 (2013), http://eprint.iacr.org/</li>

    </ul>

    <ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">

      <li>Le, T.V., Sparr, R., Wernsdorf, R., Desmedt, Y.: Complementation-Like and Cyclic Properties of AES Round Functions. In: Dobbertin, H., Rijmen, V., Sowa, A. (eds.) AES Conference. Lecture Notes in Computer Science, vol. 3373, pp. 128–141. Springer (2004)</li>

      <li>Matsui, M.: On Correlation Between the Order of S-boxes and the Strength of DES. In: Santis, A.D. (ed.) Advances in Cryptology - EUROCRYPT '94, Workshop on the Theory and Application of Cryptographic Techniques, Perugia, Italy, May 9-12, 1994, Proceedings. Lecture Notes in Computer Science, vol. 950, pp. 366-375. Springer (1994), http://dx.doi.org/10.1007/BFb0053451</li>

      <li>Mouha, N., Wang, Q., Gu, D., Preneel, B.: Differential and Linear Cryptanalysis Using Mixed-Integer Linear Programming. In: Wu, C., Yung, M., Lin, D. (eds.) Information Security and Cryptology - 7th International Conference, Inscript 2011, Beijing, China, November 30 - December 3, 2011. Revised Selected Papers. Lecture Notes in Computer Science, vol. 7537, pp. 57-76. Springer (2011), http://dx.doi.org/10.1007/978-3-642-34704-7_5</li>

      <li>Rasoolzadeh, S., Ahmadian, Z., Salmasizadeh, M., Aref, M.R.: Total Break of Zorro using Linear and Differential Attacks. ISeCure, The ISC International Journal of Information Security 6(1), 23-34 (2014)</li>

      <li>Selçuk, A.A.: On Probability of Success in Linear and Differential Cryptanalysis. J. Cryptology 21(1), 131-147 (2008)</li>

      <li>Wang, Y., Wu, W., Guo, Z., Yu, X.: Differential Cryptanalysis and Linear Distinguisher of Full-Round Zorro. In: Boureanu, I., Owesarski, P., Vaudenay, S. (eds.) Applied Cryptography and Network Security - 12th International Conference, ACNS 2014, Lausanne, Switzerland, June 10-13, 2014. Proceedings. Lecture Notes in Computer Science, vol. 8479, pp. 308-323. Springer (2014), http://dx.doi.org/10.1007/978-3-319-07536-5_19</li>

    </ol>

    <h2 id="sec-23" class="text-2xl font-bold">A Details of the Linear Cryptanalysis of Full Zorro</h2>

    <p class="text-gray-300">In this section, we describe our linear attack on full Zorro.</p>

    <h3 id="sec-24" class="text-xl font-semibold mt-8">Linear Characteristic Search</h3>

    <p class="text-gray-300">We applied the linear characteristic search algorithm of Section 2 to 23-round Zorro. Similarly to the differential case, the best characteristics are concatenations of 4-round iterative linear characteristics. These characteristics can be viewed as counterparts of the differential ones, and follow a similar representation as in Figure 5. The resulting 23-round linear characteristic has 10 active S-boxes, and thus has a bias of <span class="math">q = (56 / 256)^{10} \\approx 2^{-22}</span>. As in the differential case, we used our characteristic search tool to prove that it is the best linear characteristic for 23 rounds.</p>

    <h3 id="sec-25" class="text-xl font-semibold mt-8">Key Recovery for the Linear Attack</h3>

    <p class="text-gray-300">Using the algorithm of Section 4, we can attack <span class="math">23 + 1 = 24</span> rounds with data complexity of <span class="math">2^{44}</span> known plaintexts, time complexity of <span class="math">2^{44} + 2^{2 \\cdot 8 + 9} \\approx 2^{44}</span> encryptions, and memory complexity of <span class="math">\\min(2^{44}, 2^{2 \\cdot 8 + 1}) = 2^{17}</span> 32-bit words. The attack recovers 2 bytes of equivalent</p>

    <p class="text-gray-300"><span class="math">\\tilde{K}=SR^{-1}(MC^{-1}(K))</span> (i.e., the two bytes used in the “active” S-boxes in round 24), which is the result of exchanging the order of the final key addition and linear operations <span class="math">SR</span> and <span class="math">MC</span>.</p>

    <p class="text-gray-300">In order to recover additional 2 bytes of <span class="math">\\tilde{K}</span>, we can simultaneously and independently (using the same data) exploit the variant of the same linear characteristic, in which the 2 columns are swapped. Furthermore, we can simultaneously exploit another variant of the iterative characteristic which spans rounds 2–24 (with the active S-boxes in round 2), and apply the key recovery on the encryption side. This allows us to recover 2 bytes of <span class="math">K</span>, and additional 2 bytes can be simultaneously recovered by swapping the columns in the last characteristic. As the time complexity bottleneck in all of these 4 simultaneous attacks is the actual collection of data, the total time complexity of recovering the 8 bytes of key material remains about <span class="math">2^{44}</span>, and the memory complexity is less than <span class="math">4\\cdot 2^{(2\\cdot 8)+1}=2^{19}</span> words of 32 bits, or <span class="math">2^{17}</span> words of 128 bits.</p>

    <p class="text-gray-300">After determining the 8 bytes of key material used in rounds 1 and 24 which contribute to all non-linear operations, we can “peel off” this non-linearity and apply the same ideas to the inner rounds 2 and 23 in order to recover the 8 additional (linear combinations of) key bytes, which contribute to the non-linearity in these rounds. This is done by exploiting the iterative characteristics in which the active S-boxes are in round 2, and in round 23. However, due to the dependency of the inner-round attacks on the previously recovered 8 bytes, it is not obvious how to perform these attacks simultaneously, and thus (in order to avoid the large memory overhead of storing the original data) we can request additional <span class="math">2^{44}</span> known plaintexts in order to recover the rest of the key. This leads to an attack that uses <span class="math">2^{45}</span> known plaintexts, runs in <span class="math">2^{45}</span> time, and requires memory of about <span class="math">2^{17}</span> words of 128 bits.</p>

    <h2 id="sec-26" class="text-2xl font-bold">Appendix B Analysis of PSP Networks Based on AES</h2>

    <p class="text-gray-300">In this section, we show that the high probability iterative differential and linear characteristics for Zorro are likely to appear in any AES-based PSP Network (although perhaps with lower probabilities).</p>

    <p class="text-gray-300">In the specific case of Zorro, there are extremely high-probability characteristics with only 2 active S-boxes every 4 rounds (for comparison, the heuristic presented in <em>[9]</em> suggested that any 14-round characteristic has at least 24 S-boxes). We analyze these characteristics and show that they exist due to a subtle inter-relation between the MixColumns and ShiftRows operations of AES, used as components of Zorro. Following this analysis, we propose two changes to the design of Zorro that can potentially mitigate the high-probability (or high-bias) characteristics while maintaining the AES-like design. The first modification is replacing the MixColumns operation with multiplication with another circulant matrix (we do not consider non-circulant matrices, as these increase the footprint of the implementation). The second modification is changing the positions of the S-boxes, while maintaining 4 S-boxes in each round. Finally, we analyze several of the modified variants using our generic tool. For some of these variants, the</p>

    <p class="text-gray-300">probability of the iterative characteristics is reduced, but their probability is still higher than expected from a reasonable design, indicating an inherent weakness of AES-based PSP Networks.</p>

    <h2 id="sec-27" class="text-2xl font-bold">B.1 Analysis of the High-Probability and High-Bias Characteristics of Zorro</h2>

    <p class="text-gray-300">For ease of explanation, we concentrate on the high-probability differential characteristics. The analysis of the high-bias linear characteristics is similar. The highest-probability characteristics of 4-round Zorro (such as the one of Figure 5) share several properties:</p>

    <ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">

      <li>They are iterative (in cycles of 4 rounds).</li>

      <li>They have a two-column symmetry, i.e., the difference in the first two columns are equal to the differences in the last two columns.</li>

      <li>All S-box transitions in the characteristics are of the form <span class="math">x \\to x</span>.²⁰</li>

    </ol>

    <p class="text-gray-300">Property (3) simplifies the analysis of the characteristics, as it implies that the S-boxes can be neglected (all having “fixed-point” transitions). Thus, for the sake of this analysis we can consider a modified variant of Zorro, in which the only operations in each round are SR and MC (note that AK and AC have no effect on the difference propagation).</p>

    <p class="text-gray-300">Property (1) implies that for the input difference of the characteristic <span class="math">\\Delta_0</span>, we have <span class="math">(\\mathrm{MC} \\circ \\mathrm{SR})^4 (\\Delta_0) = \\Delta_0</span>. Since both MC and SR are linear operations on the 4-by-4 state matrix, they can be represented as 16-by-16 matrices over the finite field <span class="math">GF(2^8)</span> (whose elements represent the bytes of the state). Hence, in order to find all characteristics satisfying properties (1) and (3), we can simply compute the eigenvectors of the matrix representing the operation <span class="math">(\\mathrm{MC} \\circ \\mathrm{SR})^4</span> that correspond to the eigenvalue 1. We performed this computation, and found that there are surprisingly many such vectors with a well-defined structure.</p>

    <p class="text-gray-300"><strong>Proposition 1.</strong> The state matrices <span class="math">\\Delta_0</span> satisfying the equation <span class="math">(\\mathrm{MC} \\circ \\mathrm{SR})^4 (\\Delta_0) = \\Delta_0</span> are exactly all state matrices in which the last two columns are equal to the first two columns.</p>

    <p class="text-gray-300">The proposition shows that among 4-round characteristics satisfying property (3), properties (1) and (2) are equivalent.</p>

    <p class="text-gray-300">The abundance of characteristics satisfying all the three properties appears to explain the unexpectedly high probability of the best characteristic. The explanation is based on a few simple observations:</p>

    <p class="text-gray-300">²⁰ We note that the idea of considering iterative 4-round characteristics in which all S-box transitions are of the form <span class="math">x \\to x</span> was used in the first attack on full Zorro presented by Wang et al. [16]. To avoid the effects of SR, Wang et al. considered fully symmetric states in which all four columns are equal. This appears to give less flexibility than two-column symmetric states, which allows us to obtain characteristics with a higher probability.</p>

    <p class="text-gray-300">27</p>

    <ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">

      <li>Both MC and SR preserve the two-column symmetry property (this observation was first made in <em>[11]</em> and was already used in several attacks on AES-based primitives), Thus, for any characteristic satisfying (1),(2) and (3), all the intermediate state differences satisfy the symmetry property.</li>

      <li>As a result from the previous observation, and since the locations of the S-boxes are also two-column symmetric, if the 4-round characteristic has a zero input difference in <span class="math">k</span> of the 8 S-boxes in the left two columns over 4 rounds, it must have a zero input difference also in the <span class="math">k</span> corresponding S-boxes in the right two columns.</li>

      <li>The number of characteristics satisfying (1),(2), and (3) is <span class="math">2^{64}</span> (this is the number of two-column symmetric states).</li>

      <li>If the S-boxes are neglected, then each condition of the form “The input difference to a specific S-box in some round is zero” can be translated to 8 linear equations in the bits of the input difference.</li>

    </ol>

    <p class="text-gray-300">Using these observations, we can easily construct iterative 4-round characteristics with only two active S-boxes. We take the input difference to be one of the <span class="math">2^{64}</span> two-column symmetric differences. We then require that the input difference to 7 of the 8 active S-boxes in the left two columns is zero. This requirement is translated to 56 linear equations in the input bits of the characteristic, and we can easily solve them and find the linear subspace of size <span class="math">2^{8}</span> of characteristics satisfying them. These characteristics have only a single active S-box in the left two columns, and thus only a single active S-box in the right two columns, a total of two active S-boxes for four rounds.</p>

    <p class="text-gray-300">Summarizing the above discussion, the unexpectedly high probability of the best differential results from a combination of three factors:</p>

    <ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">

      <li>The huge number (<span class="math">2^{64}</span>) of fixed-points in the function (MC<span class="math">\\,\\circ\\,</span>SR).</li>

      <li>The fact that these fixed-points are all of a two-columns symmetric structure that is preserved by both MC and SR.</li>

      <li>The two-columns symmetric location of the S-boxes.</li>

    </ol>

    <p class="text-gray-300">Based on this understanding, we consider modifications of Zorro, that mitigate one or more of these three factors.</p>

    <h3 id="sec-28" class="text-xl font-semibold mt-8">B.2 Analysis of Modifications of Zorro</h3>

    <p class="text-gray-300">In this section, we study slightly modified variants of Zorro, aiming to increase its resistance to differential and linear cryptanalysis. As in this section we adhere to the Zorro and AES design criterions, we do not consider changing the S-box (as it was designed in a special way to allow efficient masking), nor replacing MC with a non-circulant matrix (as this increases the footprint of the implementation). Instead, we consider two modifications:</p>

    <ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">

      <li>Replacing the circulant matrix used in MC.</li>

      <li>Changing the locations of the S-boxes (while maintaining four active S-boxes in each round).</li>

    </ol>

    <p class="text-gray-300">The motivation behind these two modifications is that changing the circulant matrix can mitigate factors (1) and (2) above, while changing the location of the S-boxes mitigates factor (3) above.</p>

    <h4 id="sec-29" class="text-lg font-semibold mt-6">Replacing the Circulant Matrix of MixColumns</h4>

    <p class="text-gray-300">We first performed a mathematical analysis of the properties of the transformation <span class="math">(\\text{MC}^{\\prime}\\circ\\text{SR})^{4}</span> where <span class="math">\\text{MC}^{\\prime}</span> denotes the application of an arbitrary circulant matrix <span class="math">M^{\\prime}</span> to each column in parallel. The analysis, presented in subsection B.3, shows that all two-column symmetric state matrices are eigenvectors of this transformation for any circulant matrix <span class="math">M^{\\prime}</span>. Unlike the case of Zorro, for a general circulant matrix the eigenvalue is <span class="math">\\alpha=(a_{0}^{4}+a_{1}^{4}+a_{2}^{4}+a_{3}^{4})</span>, where <span class="math">(a_{0},a_{1},a_{2},a_{3})</span> is the first row of the matrix <span class="math">M^{\\prime}</span>. Hence, if the matrix is chosen such that <span class="math">\\alpha\\neq 1</span>, we can assure that the two-column symmetric state matrices are not fixed-points of <span class="math">(\\text{MC}^{\\prime}\\circ\\text{SR})^{4}</span>, but are rather multiplied by a constant. In such a case, one may still construct an almost-iterative 4-round characteristic with only two active S-boxes, starting with a two-columns symmetric state and using <span class="math">x\\to x</span> transitions in all S-boxes. However, since the values of <span class="math">x</span> used in the differential transitions are changed in every “iteration”, the overall probability of the characteristic is reduced, since not all of them can be optimized simultaneously. This particularly affects the linear characteristics, where there exists only a single value of <span class="math">x</span> for which the transition <span class="math">x\\to x</span> has a large bias of 56/256. For the original Zorro, the linear characteristic can be chosen such that in all active S-boxes, the transition has the maximal bias of 56/256. If the circular matrix is changed, then the bias can be taken to be maximal only in one iteration, while in other transitions the bias is significantly smaller.</p>

    <p class="text-gray-300">We summarize in Tables 3 and 4 the maximal, median, and minimal values of the probability of the best differential for 19 rounds, and the bias of the best linear characteristic for 23 rounds, respectively, as a function of <span class="math">\\alpha</span>, along with the complexities of attacks on modified Zorro based on these characteristics. We note that there are two values of <span class="math">\\alpha</span> for which no differential characteristic exists, due to properties of the S-box. Linear characteristic exists for all values of <span class="math">\\alpha</span>.</p>

    <p class="text-gray-300">We conclude that while replacing MixColumns with another circulant matrix can increase the security of Zorro without any performance overhead, the resulting security, especially against differential attacks, is still very weak.</p>

    <h4 id="sec-30" class="text-lg font-semibold mt-6">Changing the Location of the S-boxes</h4>

    <p class="text-gray-300">From the analysis presented above, it is clear that changing the location of the S-boxes to a location that is not two-column symmetric may increase the number of active S-boxes in 4-round iterative characteristics. Indeed, as fixing the input difference of S-boxes in the left two columns to zero does not assure zero difference in the S-boxes in the right two columns (since the S-boxes are no longer in symmetric positions), the</p>

    <div class="overflow-x-auto my-4">

      <table class="min-w-full text-sm text-gray-300">

        <thead>

          <tr>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600"></th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">α</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">x</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">pD(α)</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">Complexity</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600"></th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600"></th>

          </tr>

        </thead>

        <tbody>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700">Data</td>

            <td class="px-3 py-2 border-b border-gray-700">Time</td>

            <td class="px-3 py-2 border-b border-gray-700">Memory</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">Maximal</td>

            <td class="px-3 py-2 border-b border-gray-700">0x01</td>

            <td class="px-3 py-2 border-b border-gray-700">0x7B</td>

            <td class="px-3 py-2 border-b border-gray-700">2-43</td>

            <td class="px-3 py-2 border-b border-gray-700">244</td>

            <td class="px-3 py-2 border-b border-gray-700">245</td>

            <td class="px-3 py-2 border-b border-gray-700">negligible</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">Median</td>

            <td class="px-3 py-2 border-b border-gray-700">0x96</td>

            <td class="px-3 py-2 border-b border-gray-700">0x71</td>

            <td class="px-3 py-2 border-b border-gray-700">2-53</td>

            <td class="px-3 py-2 border-b border-gray-700">254</td>

            <td class="px-3 py-2 border-b border-gray-700">255</td>

            <td class="px-3 py-2 border-b border-gray-700">negligible</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">Minimal</td>

            <td class="px-3 py-2 border-b border-gray-700">0x16</td>

            <td class="px-3 py-2 border-b border-gray-700">0x09</td>

            <td class="px-3 py-2 border-b border-gray-700">2-56</td>

            <td class="px-3 py-2 border-b border-gray-700">257</td>

            <td class="px-3 py-2 border-b border-gray-700">258</td>

            <td class="px-3 py-2 border-b border-gray-700">negligible</td>

          </tr>

        </tbody>

      </table>

    </div>

    <p class="text-gray-300"><span class="math">x</span>  denotes the non-zero transition in the first step of the characteristics.</p>

    <p class="text-gray-300">The minimal does not list the two  <span class="math">\\alpha</span> 's for which  <span class="math">p_D(\\alpha) = 0</span> .</p>

    <p class="text-gray-300">Table 3. Differential Attacks on Modified Zorro (Different Matrix)</p>

    <div class="overflow-x-auto my-4">

      <table class="min-w-full text-sm text-gray-300">

        <thead>

          <tr>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600"></th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">α</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">x</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">pL(α)</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">Complexity</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600"></th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600"></th>

          </tr>

        </thead>

        <tbody>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700">Data</td>

            <td class="px-3 py-2 border-b border-gray-700">Time</td>

            <td class="px-3 py-2 border-b border-gray-700">Memory</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">Maximal</td>

            <td class="px-3 py-2 border-b border-gray-700">0x01</td>

            <td class="px-3 py-2 border-b border-gray-700">0x88</td>

            <td class="px-3 py-2 border-b border-gray-700">2-23</td>

            <td class="px-3 py-2 border-b border-gray-700">246</td>

            <td class="px-3 py-2 border-b border-gray-700">246</td>

            <td class="px-3 py-2 border-b border-gray-700">217 bits</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">Median</td>

            <td class="px-3 py-2 border-b border-gray-700">0x38</td>

            <td class="px-3 py-2 border-b border-gray-700">0xDD</td>

            <td class="px-3 py-2 border-b border-gray-700">2-36</td>

            <td class="px-3 py-2 border-b border-gray-700">272</td>

            <td class="px-3 py-2 border-b border-gray-700">272</td>

            <td class="px-3 py-2 border-b border-gray-700">217</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">Minimal</td>

            <td class="px-3 py-2 border-b border-gray-700">0xF7</td>

            <td class="px-3 py-2 border-b border-gray-700">0xBE</td>

            <td class="px-3 py-2 border-b border-gray-700">2-39.5</td>

            <td class="px-3 py-2 border-b border-gray-700">279</td>

            <td class="px-3 py-2 border-b border-gray-700">279</td>

            <td class="px-3 py-2 border-b border-gray-700">217</td>

          </tr>

        </tbody>

      </table>

    </div>

    <p class="text-gray-300"><span class="math">x</span>  denotes the non-zero transition in the first step of the characteristics.</p>

    <p class="text-gray-300">Table 4. Linear Attacks on Modified Zorro (Different Matrix)</p>

    <p class="text-gray-300">characteristic is expected to contain more active S-boxes. Based on this motivation, we investigated three modified variants of Zorro with asymmetric positions of S-boxes, and applied to them our generic characteristic search algorithm. The variants are presented in Figure 4. We list in Table 5 the probabilities of the best 4-round iterative characteristics we could find in each of these three variants.</p>

    <p class="text-gray-300">!<a href="img-4.jpeg">img-4.jpeg</a> (a) Diagonal</p>

    <p class="text-gray-300">!<a href="img-5.jpeg">img-5.jpeg</a> (b) First Column</p>

    <p class="text-gray-300">!<a href="img-6.jpeg">img-6.jpeg</a> (c) Secondary Diagonal Fig. 4. Non-Symmetric S-boxes Positions Studied</p>

    <p class="text-gray-300">For all these three variants, the probabilities of the iterative characteristics are significantly reduced compared to Zorro. However, they still possess the inherent weakness of AES-based PSP Networks. For example, for each of the variants, there are 11-round characteristics with only 11 active S-boxes (obtained by</p>

    <div class="overflow-x-auto my-4">

      <table class="min-w-full text-sm text-gray-300">

        <thead>

          <tr>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600"></th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">Differential</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">Linear</th>

          </tr>

        </thead>

        <tbody>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">Main diagonal</td>

            <td class="px-3 py-2 border-b border-gray-700">2-32</td>

            <td class="px-3 py-2 border-b border-gray-700">2-11.96</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">First column</td>

            <td class="px-3 py-2 border-b border-gray-700">2-33</td>

            <td class="px-3 py-2 border-b border-gray-700">2-11.96</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">Secondary diagonal</td>

            <td class="px-3 py-2 border-b border-gray-700">2-32</td>

            <td class="px-3 py-2 border-b border-gray-700">2-14.16</td>

          </tr>

        </tbody>

      </table>

    </div>

    <p class="text-gray-300">Table 5. Maximal Probabilities of 1-Step Iterative Characteristics (Non-symmetric Positions)</p>

    <p class="text-gray-300">concatenations of the 4-round characteristics). On the other hand, by slightly deviating for the AES design strategy, we can easily construct designs in which the number of active S-boxes for 11 rounds is at least 14 (as shown in Section 6).</p>

    <p class="text-gray-300">In this section we present the proofs of the properties of circulant matrices we use in Section B.2.</p>

    <p class="text-gray-300">We start with a property of circulant matrices over any field  <span class="math">\\mathbb{F}</span>  with  <span class="math">\\mathrm{char}(\\mathbb{F}) = 2</span> .</p>

    <p class="text-gray-300">Lemma 1. Let  <span class="math">\\mathbb{F}</span>  be a field with  <span class="math">\\mathrm{char}(\\mathbb{F}) = 2</span> . Let</p>

    <div class="my-4 text-center"><span class="math-block">M = \\left( \\begin{array}{c} a _ {0}   a _ {3}   a _ {2}   a _ {1} \\\\ a _ {1}   a _ {0}   a _ {3}   a _ {2} \\\\ a _ {2}   a _ {1}   a _ {0}   a _ {3} \\\\ a _ {3}   a _ {2}   a _ {1}   a _ {0} \\end{array} \\right) \\in \\mathbb {F} ^ {4 \\times 4},</span></div>

    <p class="text-gray-300">be a circulant matrix. Then, the matrix  <span class="math">M^4</span>  is the scalar matrix  <span class="math">\\alpha I</span>  for  <span class="math">\\alpha = (a_0^4 + a_1^4 + a_2^4 + a_3^4)</span> .</p>

    <p class="text-gray-300">Proof. Let  <span class="math">T \\colon \\mathbb{F}_3[x] \\to \\mathbb{F}_3[x]</span>  be the linear map defined as  <span class="math">T(g(x)) = f(x) \\cdot g(x)</span>  (mod  <span class="math">x^4 + 1</span> ), where  <span class="math">f(x) = a_0 + a_1x + a_2x^2 + a_3x^3</span>  is fixed. It is easy to check that  <span class="math">M</span>  is the transformation matrix of  <span class="math">T</span>  in the standard base  <span class="math">B = \\{1, x, x^2, x^3\\}</span>  (i.e.,  <span class="math">M = [T]_B = [T]</span> ). Therefore,  <span class="math">M^4 = [T]^4 = [T^4]</span> , and as  <span class="math">\\mathrm{char}(\\mathbb{F}) = 2</span> , it is easy to see that  <span class="math">f^4(x) = (a_0 + a_1x + a_2x^2 + a_3x^3)^4 = a_0^4 + a_1^4 + a_2^4 + a_3^4</span>  (mod  <span class="math">x^4 + 1</span> ). Denoting  <span class="math">\\alpha = a_0^4 + a_1^4 + a_2^4 + a_3^4</span> ,  <span class="math">T^4(g(x)) = \\alpha g(x)</span>  (mod  <span class="math">x^4 + 1</span> ) and  <span class="math">M^4 = [T^4] = \\alpha I</span> .</p>

    <p class="text-gray-300">Definition 1. Let  <span class="math">M \\in \\mathbb{F}^{4 \\times 4}</span>  be a circulant matrix. The scalar of  <span class="math">M</span>  is the scalar  <span class="math">\\alpha</span>  such that  <span class="math">M^4 = \\alpha I</span> .</p>

    <p class="text-gray-300">The following observation (originally suggested in [11]) relates to SR, and was actually used in the characteristic suggested in Figure 5:</p>

    <p class="text-gray-300">Observation 1 ([11]) In a 4-by-4 state matrix where the first two columns equal to the last two columns, the SR operation does not alter this property. Namely,</p>

    <p class="text-gray-300">!<a href="img-7.jpeg">img-7.jpeg</a></p>

    <p class="text-gray-300">As can be seen, in this structure SR can be treated as an operation on two columns. We denote this operation as SR2, which operates as follows:</p>

    <p class="text-gray-300">!<a href="img-8.jpeg">img-8.jpeg</a></p>

    <p class="text-gray-300">Lemma 2. Let  <span class="math">\\mathbb{F}</span>  be a field with  <span class="math">\\mathrm{char}(\\mathbb{F}) = 2</span> , and let  <span class="math">M \\in \\mathbb{F}^{4 \\times 4}</span>  be a circulant matrix (as defined in Lemma 1). Define MC, SR2:  <span class="math">\\mathbb{F}^{4 \\times 2} \\to \\mathbb{F}^{4 \\times 2}</span>  by  <span class="math">\\mathrm{MC}(A) = M \\cdot A</span> , and SR2 as above. Then  <span class="math">(\\mathrm{MC} \\circ \\mathrm{SR2})^4 = \\alpha I</span>  where  <span class="math">\\alpha</span>  is the scalar of  <span class="math">M</span> .</p>

    <p class="text-gray-300">Proof. We consider a matrix in  <span class="math">\\mathbb{F}^{4\\times 2}</span>  as a vector in  <span class="math">\\mathbb{F}^8</span>  by placing the second column below the first one. In this representation, the transformation matrices of MC and SR2 (in the standard base of  <span class="math">\\mathbb{F}^8</span> ) are</p>

    <div class="my-4 text-center"><span class="math-block">\\tilde {M} = M \\oplus M = \\left( \\begin{array}{c c} M &amp;amp; 0 \\\\ 0 &amp;amp; M \\end{array} \\right)</span></div>

    <p class="text-gray-300">and</p>

    <div class="my-4 text-center"><span class="math-block">S = \\left( \\begin{array}{c c c c c c c} 1 &amp;amp; 0 &amp;amp; 0 &amp;amp; 0 &amp;amp; 0 &amp;amp; 0 &amp;amp; 0 \\\\ 0 &amp;amp; 0 &amp;amp; 0 &amp;amp; 0 &amp;amp; 0 &amp;amp; 1 &amp;amp; 0 \\\\ 0 &amp;amp; 0 &amp;amp; 1 &amp;amp; 0 &amp;amp; 0 &amp;amp; 0 &amp;amp; 0 \\\\ 0 &amp;amp; 0 &amp;amp; 0 &amp;amp; 0 &amp;amp; 0 &amp;amp; 0 &amp;amp; 1 \\\\ 0 &amp;amp; 0 &amp;amp; 0 &amp;amp; 0 &amp;amp; 1 &amp;amp; 0 &amp;amp; 0 \\\\ 0 &amp;amp; 1 &amp;amp; 0 &amp;amp; 0 &amp;amp; 0 &amp;amp; 0 &amp;amp; 0 \\\\ 0 &amp;amp; 0 &amp;amp; 0 &amp;amp; 0 &amp;amp; 0 &amp;amp; 1 &amp;amp; 0 \\\\ 0 &amp;amp; 0 &amp;amp; 0 &amp;amp; 1 &amp;amp; 0 &amp;amp; 0 &amp;amp; 0 \\end{array} \\right),</span></div>

    <p class="text-gray-300">respectively. By a computer symbolic calculation,  <span class="math">(\\tilde{M}\\cdot S)^4 = (a_0^4 +a_1^4 +a_2^4 +a_3^4)I.</span>  By Lemma 1,  <span class="math">M^4 = (a_0^4 +a_1^4 +a_2^4 +a_3^4)I.\\square</span></p>

    <div class="overflow-x-auto my-4">

      <table class="min-w-full text-sm text-gray-300">

        <thead>

          <tr>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">Simulation</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">Plaintexts Encrypted</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">Structures Analyzed</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">Pairs Analyzed</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">Keys Suggested</th>

          </tr>

        </thead>

        <tbody>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">Theory</td>

            <td class="px-3 py-2 border-b border-gray-700">241.5</td>

            <td class="px-3 py-2 border-b border-gray-700">235.5</td>

            <td class="px-3 py-2 border-b border-gray-700">243</td>

            <td class="px-3 py-2 border-b border-gray-700">243</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">Simulation Average</td>

            <td class="px-3 py-2 border-b border-gray-700">241.49</td>

            <td class="px-3 py-2 border-b border-gray-700">235.49</td>

            <td class="px-3 py-2 border-b border-gray-700">243.07</td>

            <td class="px-3 py-2 border-b border-gray-700">243.07</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">1</td>

            <td class="px-3 py-2 border-b border-gray-700">238.30</td>

            <td class="px-3 py-2 border-b border-gray-700">232.30</td>

            <td class="px-3 py-2 border-b border-gray-700">239.89</td>

            <td class="px-3 py-2 border-b border-gray-700">239.84</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">2</td>

            <td class="px-3 py-2 border-b border-gray-700">238.50</td>

            <td class="px-3 py-2 border-b border-gray-700">232.50</td>

            <td class="px-3 py-2 border-b border-gray-700">240.08</td>

            <td class="px-3 py-2 border-b border-gray-700">240.06</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">3</td>

            <td class="px-3 py-2 border-b border-gray-700">238.56</td>

            <td class="px-3 py-2 border-b border-gray-700">232.56</td>

            <td class="px-3 py-2 border-b border-gray-700">240.14</td>

            <td class="px-3 py-2 border-b border-gray-700">240.10</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">4</td>

            <td class="px-3 py-2 border-b border-gray-700">238.77</td>

            <td class="px-3 py-2 border-b border-gray-700">232.77</td>

            <td class="px-3 py-2 border-b border-gray-700">240.35</td>

            <td class="px-3 py-2 border-b border-gray-700">240.34</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">5</td>

            <td class="px-3 py-2 border-b border-gray-700">238.86</td>

            <td class="px-3 py-2 border-b border-gray-700">232.86</td>

            <td class="px-3 py-2 border-b border-gray-700">240.44</td>

            <td class="px-3 py-2 border-b border-gray-700">240.44</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">6</td>

            <td class="px-3 py-2 border-b border-gray-700">239.12</td>

            <td class="px-3 py-2 border-b border-gray-700">233.12</td>

            <td class="px-3 py-2 border-b border-gray-700">240.70</td>

            <td class="px-3 py-2 border-b border-gray-700">240.69</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">7</td>

            <td class="px-3 py-2 border-b border-gray-700">240.59</td>

            <td class="px-3 py-2 border-b border-gray-700">234.59</td>

            <td class="px-3 py-2 border-b border-gray-700">242.17</td>

            <td class="px-3 py-2 border-b border-gray-700">242.22</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">8</td>

            <td class="px-3 py-2 border-b border-gray-700">240.83</td>

            <td class="px-3 py-2 border-b border-gray-700">234.83</td>

            <td class="px-3 py-2 border-b border-gray-700">242.41</td>

            <td class="px-3 py-2 border-b border-gray-700">242.43</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">9</td>

            <td class="px-3 py-2 border-b border-gray-700">242.90</td>

            <td class="px-3 py-2 border-b border-gray-700">236.90</td>

            <td class="px-3 py-2 border-b border-gray-700">244.49</td>

            <td class="px-3 py-2 border-b border-gray-700">244.47</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">10</td>

            <td class="px-3 py-2 border-b border-gray-700">243.07</td>

            <td class="px-3 py-2 border-b border-gray-700">237.07</td>

            <td class="px-3 py-2 border-b border-gray-700">244.66</td>

            <td class="px-3 py-2 border-b border-gray-700">244.67</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">11</td>

            <td class="px-3 py-2 border-b border-gray-700">243.21</td>

            <td class="px-3 py-2 border-b border-gray-700">237.21</td>

            <td class="px-3 py-2 border-b border-gray-700">244.79</td>

            <td class="px-3 py-2 border-b border-gray-700">244.79</td>

          </tr>

        </tbody>

      </table>

    </div>

    <p class="text-gray-300">Table 6. Simulation Results of Differential Attack on Full Zorro (Versus Theoretical Estimate)</p>

    <p class="text-gray-300">!<a href="img-9.jpeg">img-9.jpeg</a> The output differences of the 16 S-boxes marked with  <span class="math">L</span>  are initially unknown. They are linearized and recovered according to Section 3, leading to an efficient key recovery. Fig. 5. Differential Attack on Full Zorro</p>

    <p class="text-gray-300">!<a href="img-10.jpeg">img-10.jpeg</a> Fig. 6. Best 11-round Characteristic with 14 Active S-boxes for the Tweaked PSP Network</p>`;
---

<BaseLayout title="Cryptanalysis of SP Networks with Partial Non-Linear Layers (2014/228)">
  <article class="max-w-4xl mx-auto article-prose">
    <nav class="mb-8">
      <a href="/papers" class="text-blue-400 hover:text-blue-300">
        &larr; Back to Papers
      </a>
    </nav>

    <header class="mb-12">
      <h1 class="text-3xl font-bold mb-4"
        set:html={TITLE_HTML} />
      <p class="text-gray-400 mb-2"
        set:html={AUTHORS_HTML} />
      <p class="text-gray-500 text-sm mb-4">
        2014 &middot; eprint 2014/228
      </p>
      <div class="flex gap-4 text-sm">
        <a
          href={EPRINT_URL}
          target="_blank"
          rel="noopener noreferrer"
          class="text-blue-400 hover:text-blue-300"
        >
          Paper (eprint) &rarr;
        </a>
      </div>
      <p class="mt-4 text-xs text-gray-500">
        All content below belongs to the original authors. This page
        reproduces the paper for educational purposes. Always
        <a
          href={EPRINT_URL}
          target="_blank"
          rel="noopener noreferrer"
          class="text-blue-400 hover:text-blue-300"
        >cite the original</a>.
      </p>
      <p class="mt-1 text-xs text-gray-600">
        Converted with: {CRAWLER} &middot; {CONVERTED_DATE}
      </p>
    </header>

    <Fragment set:html={CONTENT} />

  </article>
</BaseLayout>
