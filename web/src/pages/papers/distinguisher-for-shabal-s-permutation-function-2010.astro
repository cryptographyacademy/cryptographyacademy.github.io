---
import BaseLayout from '../../layouts/BaseLayout.astro';
import PaperDisclaimer from '../../components/PaperDisclaimer.astro';
import PaperHistory from '../../components/PaperHistory.astro';

const EPRINT_URL = 'https://eprint.iacr.org/2010/398';
const CRAWLER = 'modal-marker';
const CONVERTED_DATE = '2026-02-18';
const TITLE_HTML = 'Distinguisher for Shabal&#x27;s Permutation Function';
const AUTHORS_HTML = 'Peter Novotney';

const CONTENT = `    <section id="abstract" class="mb-10">
      <h2 class="text-2xl font-bold">Abstract</h2>
      <p class="text-gray-300">In this note we consider the Shabal permutation function $\\mathcal{P}$ as a block cipher with input $A_p$,$B_p$ and key $C$,$M$ and describe a distinguisher with a data complexity of $2^{23}$ random inputs with a given difference.  If the attacker can control one chosen bit of $B_p$, only $2^{21}$ inputs with a given difference are required on average.  This distinguisher does not appear to lead directly to an attack on the full Shabal construction.</p>
      <p class="text-gray-300"><strong>Keywords:</strong> hash functions</p>
    </section>

    <section id="sec-1" class="mb-10">
      <h2 class="text-2xl font-bold">1 Introduction</h2>

    <p class="text-gray-300">The Shabal hash function [4] is a second round candidate in NIST's SHA-3 hash function competition. Shabal uses a iterated hash mode built around a keyed permutation function P, which takes as input Ap,B<sup>p</sup> and takes as a key C,M. In this note we will demonstrate that given an unknown key C,M, we can distinguish the permutation function P with known input differences with respect to XOR on A<sup>p</sup> and Bp. Others have noted various distinguishers in the Shabal permutation function as well: In [2] the non-ideal behavior of Shabal's permutation function using a cube tester is described. Fixed points and key collisions of the permutation are described in [6]. A related key distinguisher is given in [3], and [1] presents a distinguisher based on rotational differences. In [5] the authors of Shabal respond to some of these papers. The distinguisher in this note seems to add its own unique features to those referenced above.</p>

    </section>

    <section id="sec-2" class="mb-10">
      <h2 class="text-2xl font-bold">2 The Shabal Permutation Function</h2>

    <p class="text-gray-300">We use a slightly different description of the Shabal permutation function than given in [4]. The description below retains intermediate values, allowing them to be uniquely referenced in the differential description in section 3. Our description assumes the default tunable parameters (p, r) = (3, 12) as defined in [4].</p>

    <p class="text-gray-300">The Shabal permutation function takes 4 inputs Ap, Bp, C, and M, and gives as output A<sup>c</sup> and Bc. We will consider A<sup>p</sup> and B<sup>p</sup> as the plaintext and M and C as the key. A<sup>p</sup> contains 12 words and Bp, C and M each contain 16 words, where words are 32 bits. All additions and multiplications are mod 2<sup>32</sup> . P is given as:</p>

    <p class="text-gray-300">First we initialize the intermediate arrays with the input values:</p>

    <p class="text-gray-300"><span class="math">$i \\rightarrow 0 \\dots 11</span>$</p>

    <p class="text-gray-300"><span class="math">$A[i] := A_p[i]</span>$</p>

    <p class="text-gray-300"><span class="math">$i \\rightarrow 0 \\dots 15</span>$</p>

    <p class="text-gray-300"><span class="math">$B[i] := B_p[i] \\lll 17</span>$</p>

    <p class="text-gray-300">Main computation of the permutation:</p>

    <p class="text-gray-300"><span class="math">$\\begin{aligned} i \\to 0 \\dots 47 \\\\ a_i &amp;:= 5(A[11+i] \\lll 15) \\oplus A[i] \\\\ k_i &amp;:= 3(a_i \\oplus C[8-i \\bmod 16]) \\oplus M[i \\bmod 16] \\\\ b_i &amp;:= B[13+i] \\oplus (B[9+i] \\wedge \\overline{B[6+i]}) \\\\ f_i &amp;:= k_i \\oplus b_i \\\\ A[12+i] &amp;:= f_i \\\\ B[16+i] &amp;:= \\overline{f_i} \\oplus (B[i] \\lll 1) \\end{aligned}</span>$</p>

    <p class="text-gray-300">Perform the output whitening on A and copy result to output buffers:</p>

    <p class="text-gray-300"><span class="math">$i \\to 0 \\dots 11</span>$</p>

    <p class="text-gray-300"><span class="math">$A_c[i] := A[i+48] + C[i+3] + C[i+15] + C[i+27]</span>$
<span class="math">i \\to 0 \\dots 15</span></p>

    <p class="text-gray-300"><span class="math">$B_c[i] := B[i+48]</span>$</p>

    </section>

    <section id="sec-3" class="mb-10">
      <h2 class="text-2xl font-bold">3 The Differential</h2>

    <p class="text-gray-300">The differential we analyze has a one bit difference in both A<sup>p</sup> and B<sup>p</sup> with respect to XOR and is given below:</p>

    <p class="text-gray-300"><span class="math">$\\Delta A_p[10] = 0</span>$
x80000000h
<span class="math">\\Delta B_p[7] = 0</span> x00002000h</p>

    <p class="text-gray-300">These differences are chosen such that they cancel each other out multiple times with high probability and remain unaffected as possible by the multiplication mod2<sup>32</sup>, making it to round 26 of the permutation with a 1-bit difference with probability 1/8.</p>

      <h3 id="sec-3.1" class="text-xl font-semibold mt-8">3.1 Following the Differential to Round 26</h3>

    <p class="text-gray-300">After the initial 17 bit rotations of the B values our differential is of the form</p>

    <p class="text-gray-300"><span class="math">$\\Delta A[10] = 0</span>$
x80000000h  <span class="math">\\Delta B[7] = 0</span> x40000000h</p>

    <p class="text-gray-300">From here we enter the main section of the permutation function. There are 48 total rounds counting from 0, so i = 0...47. The following rounds are those that involve the words with differences in A or B:</p>

    <ul class="list-disc list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li>Round 1:  <span class="math">b_1 = B[14] \\oplus (B[10] \\wedge \\overline{B[7]})</span> , so  <span class="math">\\Delta b_1 = 0</span>  when  <span class="math">B[10] \\wedge \\Delta B[7] = 0</span>  which occurs with probability 1/2. Note that we can set one bit in  <span class="math">B_p[10]</span>  appropriately so this condition is always met.</li>
      <li>Round 7:  <span class="math">B[23] := \\overline{f_7} \\oplus (B[7] \\lll 1)</span>  so  <span class="math">\\Delta B[23] = \\texttt{0x800000000h}</span></li>
      <li>Round 10: we have  <span class="math">a_{10} := 5(A[9] \\ll 15) \\oplus A[10]</span> , so  <span class="math">\\Delta a_{10} = 0</span> x80000000h. In the  <span class="math">k_{10}</span>  step we multiple by three, but since the difference is in the highest order bit we have  <span class="math">\\Delta k_{10} = 0</span> x80000000h.  <span class="math">b_{10} := B[23] \\oplus (B[19] \\wedge \\overline{B[16]})</span>  so  <span class="math">\\Delta b_{10} = 0</span> x80000000h and therefore the difference cancels at  <span class="math">f_{10} := k_{10} \\oplus b_{10}</span> .</li>
      <li>Round 14:  <span class="math">b_{14} := B[27] \\oplus (B[23] \\wedge \\overline{B[20]})</span>  where  <span class="math">\\Delta B[23] = 0</span> x80000000h, so if  <span class="math">\\Delta B[23] \\wedge \\overline{B[20]} = 0</span>  the difference cancels and we are left with  <span class="math">\\Delta b_{14} = 0</span> . This occurs with probability 1/2.</li>
      <li>Round 17:  <span class="math">b_{17} := B[30] \\oplus (B[26] \\wedge \\overline{B[23]})</span>  and again  <span class="math">\\Delta B[23] = 0</span> x80000000h so if  <span class="math">B[26] \\wedge \\Delta B[20] = 0</span>  the difference cancels out and we have  <span class="math">\\Delta b_{17} = 0</span> . This occurs with probability 1/2.</li>
      <li>Round 23:  <span class="math">B[39] := \\overline{f_{23}} \\oplus (B[23] \\ll 1) = 0 \\times 00000001 \\text{h}.</span></li>
      <li>Round 26:  <span class="math">b_{26} := B[39] \\oplus (B[35] \\wedge \\overline{B[32]})</span>  and we end up with  <span class="math">\\Delta A[38] = 0</span> x00000001h and  <span class="math">\\Delta B[42] = 0</span> x00000001h.</li>
    </ul>

    <p class="text-gray-300">From round 0 to round 26 the overall probability of hitting this one bit difference in A[38] and B[42] is 1/8 (1/4 if we are free to modify one bit of  <span class="math">B_p[10]</span> ).</p>

      <h3 id="sec-3.2" class="text-xl font-semibold mt-8">3.2 From Round 26</h3>

    <p class="text-gray-300">After round 26 the 1-bit differential begins to diffuse. However, due to there being only 6 rounds until the creation of the first output word  <span class="math">B_c[0] := B[48]</span> , the diffusion does not appear to be sufficient to remove biases in  <span class="math">\\Delta B[48]</span> . Table 1 shows an example differential in  <span class="math">\\Delta B[i+16]</span>  progressing from round i=26 to i=32. The bolded value shows the position of the original 1 bit differential considering the 15 bit rotation operation that occurs every round. In experimental data described below, this is the bit with the largest bias at the end of each round.</p>

    <div class="overflow-x-auto my-4">
      <table class="min-w-full text-sm text-gray-300">
        <thead>
            <th class="px-3 py-2 border-b border-gray-600 font-semibold text-left">Example Differential</th>
            <th class="px-3 py-2 border-b border-gray-600 font-semibold text-left"></th>
            <th class="px-3 py-2 border-b border-gray-600 font-semibold text-left"></th>
        </thead>
        <tbody>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">Round</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left"><span class="math">\\Delta B[i+16]</span></td>
            <td class="px-3 py-2 border-b border-gray-700 text-left"></td>
          </tr>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">i=26</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">000000000000000000000000000000000000000</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left"></td>
          </tr>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">i=27</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">000000000001111000000000000000000000000</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left"></td>
          </tr>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">i=28</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">11000000000000000000000000111001</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left"></td>
          </tr>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">i=29</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">0000001011110000011000000000001</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left"></td>
          </tr>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">i=30</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">001 <b>1</b> 0000001110110000111100001000</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left"></td>
          </tr>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">i = 31</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">10000011110001110110 <b>1</b> 001011111010</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left"></td>
          </tr>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">i = 32</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">01011100000010110100010110000000</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left"></td>
          </tr>
        </tbody>
      </table>
    </div>

    <p class="text-gray-300">Table 1: Example differential in  <span class="math">\\Delta B[i+16]</span>  for rounds i=26...32</p>

    <p class="text-gray-300">We measure the biases in Bc[0] experimentally by the following procedure:</p>

    <ul class="list-disc list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li><ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li>For k = 1 . . . 2 32:</li>
    </ol>

    <ul class="list-disc list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li>(a) Generate Random Ap, Bp, M, and C.</li>
      <li>(b) Set A 0 p := A<sup>p</sup> &oplus; 0x80000000h Set B p := B<sup>p</sup> &oplus; 0x00002000h</li>
      <li>(c) Ac, B<sup>c</sup> := Shabal-P(Ap, Bp, M, C)</li>
      <li>(d) A 0 c , B<sup>0</sup> c := Shabal-P(A 0 p , B<sup>0</sup> p , M, C)</li>
      <li>(e) Count value of each bit in &#8710;Bc[0] := Bc[0] &oplus; B 0 c [0]</li>
    </ul></li>
      <li><ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li>Calculate bias of each bit in the 2<sup>32</sup> samples of &#8710;Bc[0]</li>
    </ol></li>
    </ul>

    <p class="text-gray-300">With 2<sup>32</sup> samples we can see that some bits are significantly biased. The results for some of the bits with the greatest bias are listed in Table 2.</p>

    <div class="overflow-x-auto my-4">
      <table class="min-w-full text-sm text-gray-300">
        <thead>
            <th class="px-3 py-2 border-b border-gray-600 font-semibold text-left">Bit</th>
            <th class="px-3 py-2 border-b border-gray-600 font-semibold text-left">Bias with Random Input</th>
            <th class="px-3 py-2 border-b border-gray-600 font-semibold text-left">Bias after fixing Bp[10]</th>
        </thead>
        <tbody>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">21</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">&minus;13.9<br>&asymp; 2</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">&minus;12.9<br>&asymp; 2</td>
          </tr>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">22</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">&minus;13.8<br>&asymp; 2</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">&minus;12.9<br>&asymp; 2</td>
          </tr>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">23</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">&minus;14.7<br>&asymp; 2</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">&minus;13.5<br>&asymp; 2</td>
          </tr>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">24</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">&minus;14.0<br>&asymp; 2</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">&minus;13.5<br>&asymp; 2</td>
          </tr>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">25</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">&minus;12.9<br>&asymp; 2</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">&minus;11.9<br>&asymp; 2</td>
          </tr>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">26</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">&minus;11.2<br>&asymp; 2</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">&minus;10.1<br>&asymp; 2</td>
          </tr>
        </tbody>
      </table>
    </div>

    <p class="text-gray-300">Table 2: Selection of Measured Bit Biases in &#8710;Bc[0]</p>

    <p class="text-gray-300">Given 2<sup>23</sup> inputs with the given difference, we expect to be able to statistically distinguish the bias of bit 26. If we can fix the Bp[10] value on the inputs we can distinguish with 2<sup>21</sup> inputs.</p>

    <p class="text-gray-300">Thank you to Anne Canteaut and the Shabal Team for taking the time to confirm the existence of this distinguisher on the inner permutation of Shabal. And thank you to Niels Ferguson, for the initial conversations that lead to this paper.</p>

    </section>

    <section id="sec-5" class="mb-10">
      <h2 class="text-2xl font-bold">5 Conclusion</h2>

    <p class="text-gray-300">This distinguisher shows that one can skip large amounts of the mixing in P with a high probability given specific differences in the input. However, it does not seem possible to apply these biases to the full Shabal hash function since the IV is fixed, and multiple final iterations follow the last message block. While the difference given in this note was chosen to minimize the effects of the multiplication (mod 2<sup>32</sup>) in the first 26 rounds, it seems possible that one could find other differences in Ap,B<sup>p</sup> giving greater biases than seen here.</p>

    </section>

    <section id="references" class="mb-10">
      <h2 class="text-2xl font-bold">References</h2>

    <ul class="space-y-2 text-gray-400 text-sm list-none">
      <li>[1] Gilles Van Assche. A rotational distinguisher on shabal's keyed permutation and its impact on the security proofs. Available online, 2010.</li>
      <li>[2] Jean-Philippe Aumasson. On the pseudorandomness of shabal's keyed permutation. Available online, 2009.</li>
      <li>[3] Jean-Philippe Aumasson, Atefeh Mashatan, and Willi Meier. More on shabal's permutation. OFFICIAL COMMENT, 2009.</li>
      <li>[4] Emmanuel Bresson, Anne Canteaut, Benot Chevallier-Mames, Christophe Clavier, Thomas Fuhr, Aline Gouget, Thomas Icart, Jean-Franois Misarsky, Mara Naya-Plasencia, Pascal Paillier, Thomas Pornin, Jean-Ren Reinhard, Cline Thuillet, and Marion Videau. Shabal, a submission to nists cryptographic hash algorithm competition. Submission to NIST, 2008.</li>
      <li>[5] Emmanuel Bresson, Anne Canteaut, Benot Chevallier-Mames, Christophe Clavier, Thomas Fuhr, Aline Gouget, Thomas Icart, Jean-Franois Misarsky, Mara Naya-Plasencia, Pascal Paillier, Thomas Pornin, Jean-Ren Reinhard, Cline Thuillet, and Marion Videau. Indifferentiability with distinguishers: Why shabal does not require ideal ciphers. Cryptology ePrint Archive, Report 2009/199, 2009.</li>
      <li>[6] Lars R. Knudsen, Krystian Matusiewicz, and Sren S. Thomsen. Observations on the shabal keyed permutation. OFFICIAL COMMENT, 2009.</li>
    </ul>

    </section>
`;
---

<BaseLayout title="Distinguisher for Shabal&#x27;s Permutation Function (2010/398)">
  <article class="max-w-4xl mx-auto article-prose">
    <nav class="mb-8">
      <a href="/papers" class="text-blue-400 hover:text-blue-300">
        &larr; Back to Papers
      </a>
    </nav>

    <header class="mb-12">
      <h1 class="text-3xl font-bold mb-4"
        set:html={TITLE_HTML} />
      <p class="text-gray-400 mb-2"
        set:html={AUTHORS_HTML} />
      <p class="text-gray-500 text-sm mb-4">
        2010 &middot; eprint 2010/398
      </p>
      <div class="flex gap-4 text-sm">
        <a
          href={EPRINT_URL}
          target="_blank"
          rel="noopener noreferrer"
          class="text-blue-400 hover:text-blue-300"
        >
          Paper (eprint) &rarr;
        </a>
      </div>
      <PaperDisclaimer eprintUrl={EPRINT_URL} />
      <p class="mt-1 text-xs text-gray-600">
        Converted with: {CRAWLER} &middot; {CONVERTED_DATE}
      </p>
    </header>

    <Fragment set:html={CONTENT} />

    <PaperHistory slug="distinguisher-for-shabal-s-permutation-function-2010" />
  </article>
</BaseLayout>
