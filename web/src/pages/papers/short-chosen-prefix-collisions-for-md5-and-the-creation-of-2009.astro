---
import BaseLayout from '../../layouts/BaseLayout.astro';

const EPRINT_URL = 'https://eprint.iacr.org/2009/111';
const CRAWLER = 'mistral';
const CONVERTED_DATE = '2026-02-16';
const TITLE_HTML = 'Short Chosen-Prefix Collisions for MD5 and the Creation of a Rogue CA Certificate';
const AUTHORS_HTML = 'Marc Stevens, Alexander Sotirov, Jacob Appelbaum, Arjen Lenstra, David Molnar, Dag Arne Osvik, Benne de Weger';

const CONTENT = `    <p class="text-gray-300">Marc Stevens¹, Alexander Sotirov², Jacob Appelbaum³, Arjen Lenstra⁴,⁵, David Molnar⁶, Dag Arne Osvik⁴ and Benne de Weger⁷</p>

    <p class="text-gray-300">¹ CWI, Amsterdam, The Netherlands ² http://www.phreedom.org ³ http://www.appelbaum.net ⁴ EPFL IC LACAL, Station 14, CH-1015 Lausanne, Switzerland ⁵ Alcatel-Lucent Bell Laboratories ⁶ University of California at Berkeley ⁷ EiPSI, TU Eindhoven, The Netherlands ¹⁻⁷ md5-collisions@phreedom.org</p>

    <p class="text-gray-300">Abstract. We present a refined chosen-prefix collision construction for MD5 that allowed creation of a rogue Certification Authority (CA) certificate, based on a collision with a regular end-user website certificate provided by a commercial CA. Compared to the previous construction from Eurocrypt 2007, this paper describes a more flexible family of differential paths and a new variable birthdaying search space. Combined with a time-memory trade-off, these improvements lead to just three pairs of near-collision blocks to generate the collision, enabling construction of RSA moduli that are sufficiently short to be accepted by current CAs. The entire construction is fast enough to allow for adequate prediction of certificate serial number and validity period: it can be made to require about <span class="math">2^{49}</span> MD5 compression function calls. Finally, we improve the complexity of identical-prefix collisions for MD5 to about <span class="math">2^{16}</span> MD5 compression function calls and use it to derive a practical single-block chosen-prefix collision construction of which an example is given.</p>

    <p class="text-gray-300">Keywords: MD5, collision attack, certificate, PlayStation 3</p>

    <p class="text-gray-300">1 Introduction</p>

    <p class="text-gray-300">At Eurocrypt 2007, it was shown how chosen-prefix collisions for MD5 can be constructed and an undesirable consequence for any public key infrastructure (PKI) was pointed out in the form of different certificates with the same valid signature (cf. [13]). Actual realization of the threat in question was considered to be hard due to a combination of difficulties, some related to the construction, others to the way certificates are</p>

    <p class="text-gray-300">produced by CAs. Thus, some CAs kept using MD5, either consciously based on the perception that the obstacles were too high, or because they were unaware of lurking dangers.</p>

    <p class="text-gray-300">It was found, however, that for at least one commercial CA the relevant obstacles could be overcome with non-negligible probability. Understandably, this triggered new research in the earlier chosen-prefix collision construction. A couple of non-trivial refinements removed all remaining obstacles, thereby in principle allowing us to create real havoc.</p>

    <p class="text-gray-300">Obviously, creating havoc was not our goal. It was our intention and priority that all relevant responsible parties would develop a thorough understanding of the implications of chosen-prefix collisions for MD5. Furthermore, before publishing the details of our results, we wanted to make sure that all parties would have had both a strong impetus and ample time to adequately change their procedures. Therefore, we decided to actually implement our construction and to try and exploit it in practice by attempting to create a harmless rogue CA certificate that would be accepted by all regular web browsers: harmless, because they would only do so after setting their date back to August 2004, because we would keep the private key of the rogue CA in question under tight control, and because we would not right away reveal the details of our method. After a moderate number of attempts we succeeded to create such a certificate.</p>

    <p class="text-gray-300">The announcement of our successful creation of a rogue CA certificate had the desired effect. CAs and other vendors responded swiftly and adequately. We believe that as a result of our exercise, the bar to undermine the security of PKI was raised, somewhat. Given that the current situation with respect to usage of MD5 looks much better than when we made our announcement, we feel that the details behind our method can now be revealed. We also feel that this should indeed be done to give others the opportunity to further build on them and to develop a better understanding of the lack of strength of currently popular cryptographic hash functions. Fully appreciating the details presented here requires a full understanding of the approach from <em>[13]</em>.</p>

    <div class="overflow-x-auto my-4">

      <table class="min-w-full text-sm text-gray-300">

        <thead>

          <tr>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">We describe, roughly, what was achieved in the Eurocrypt 2007 paper <em>[13]</em> and why those methods were believed to have limited impact. Given any two chosen message prefixes <span class="math">P</span> and <span class="math">P^{\\prime}</span>, it was shown how suffixes <span class="math">S</span> and <span class="math">S^{\\prime}</span> can be constructed such that the concatenations $P\\</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">S<span class="math"> and </span>P^{\\prime}\\</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">S^{\\prime}<span class="math"> collide under MD5. In the X.509 certificate context, the prefixes include the Distinguished Name fields, and the suffixes are the initial parts of the RSA moduli. A simple, previously published method was then used to construct a further extension </span>T<span class="math"> such that each of </span>P\\</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">S\\</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">T<span class="math"> and </span>P^{\\prime}\\</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">S^{\\prime}\\</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">T$</th>

          </tr>

        </thead>

        <tbody>

        </tbody>

      </table>

    </div>

    <div class="overflow-x-auto my-4">

      <table class="min-w-full text-sm text-gray-300">

        <thead>

          <tr>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">is a complete to-be-signed part, with two different hard to factor RSA moduli contained in $S\\</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">T<span class="math"> and </span>S^{\\prime}\\</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">T<span class="math">, respectively. Because the two to-be-signed parts still collide under MD5, this allowed construction of two X.509 certificates with identical MD5-based signatures but different Distinguished Names and different public keys. Put differently, assuming full control over the prefix part </span>P<span class="math"> and RSA public key data of a legitimate user, a certificate of that user’s data can be used to fraudulently obtain a rogue certificate for any party identified by a prefix part </span>P^{\\prime}<span class="math"> selected by the attacker. Using moderate resources, the calculation of suffixes </span>S<span class="math">, </span>S^{\\prime}<span class="math"> and </span>T<span class="math">, given any chosen prefixes </span>P<span class="math"> and </span>P^{\\prime}$, can be completed in a day using e.g. a quad-core PC.</th>

          </tr>

        </thead>

        <tbody>

        </tbody>

      </table>

    </div>

    <p class="text-gray-300">One obstacle against actual abuse of this construction is apparent from the above description. Only the signing CA has full control over the final contents of the <span class="math">P</span>-part: an attacker will have to wait and see what serial number and validity period will be inserted. Obviously, an unpredictable <span class="math">P</span> will make it impossible to concoct the collision required for a rogue certificate. On the other hand, if the full contents of <span class="math">P</span> can reasonably be predicted one day in advance, nothing seems to be in the way of the construction of a rogue certificate. That, however, is not the case: the <span class="math">S</span> and <span class="math">S^{\\prime}</span> as found during the collision construction of <em>[13]</em> lead to RSA moduli that are too large. More precisely, <span class="math">S</span> and <span class="math">S^{\\prime}</span> both typically consist of 11 <em>near-collision blocks</em> (i.e., <span class="math">11\\cdot 512</span> bits) and require 5 additional blocks to generate secure 8192-bit RSA moduli. On the other hand, CAs do not necessarily accept RSA moduli of more than 2048 bits. Despite this mismatch, there was no real incentive to reduce the lengths of the RSA moduli, because the assumption that <span class="math">P</span> could be predicted a day in advance sounded preposterous to begin with.</p>

    <p class="text-gray-300">The practical validity of the above assumption came as somewhat of a surprise: practical in the sense that the prefix <span class="math">P</span> cannot be predicted with 100% certainty, but with high enough probability to make further research efforts worthwhile to try and reduce the number of near-collision blocks to, say, 3. In principle the latter can be achieved by throwing more resources at the construction of the collision. It quickly turned out, as further explained below, that either the running time or the space requirements of this approach are prohibitive. To get the rogue certificate construction to work for an actual CA, a better approach to chosen-prefix collisions for MD5 was imperative.</p>

    <p class="text-gray-300">Our improved chosen-prefix collision construction for MD5 is based on two main ingredients. In the first place, we managed to generalize the known differential path constructions (as described in <em>[13]</em> and extended</p>

    <p class="text-gray-300">in <em>[12]</em>) to an entire family of differential paths. As a result, more bits can be eliminated per pair of near-collision blocks, at a somewhat higher complexity of the actual construction of those blocks than before. This is described in Section 3, after notation and MD5 have been introduced in Section 2. The reader is forewarned that full appreciation of the improved differential paths requires familiarity with <em>[13, Section 5]</em>. Secondly, we introduced a variable birthday search that permits a flexible choice of search space between the two extremes of 96 bits (as in <em>[13]</em>) and 64 bits (as introduced in <em>[12]</em> and actually used for <em>[14]</em>): in this way more time can be invested in the birthday search to achieve a lower average number of required near-collision blocks. The details along with the more contrived parameter selection that this all leads to can be found in Section 4. The construction of the rogue CA certificate is described in Section 5. Section 6 describes an improvement creating a chosen-prefix collision using only a single near-collision block.</p>

    <h2 id="sec-2" class="text-2xl font-bold">2 Preliminaries</h2>

    <h3 id="sec-3" class="text-xl font-semibold mt-8">2.1 Notation</h3>

    <p class="text-gray-300">MD5 operates on 32-bit words (<span class="math">v_{31}v_{30}\\ldots v_{0}</span>) with <span class="math">v_{i}\\in\\{0,1\\}</span>, that are identified with elements <span class="math">v=\\sum_{i=0}^{31}v_{i}2^{i}</span> of <span class="math">\\mathbb{Z}/2^{32}\\mathbb{Z}</span> and referred to as 32-bit integers. In this paper we switch freely between these representations.</p>

    <p class="text-gray-300">Integers are denoted in hexadecimal as, for instance, <span class="math">\\mathtt{1E}_{16}</span> and in binary as <span class="math">\\mathtt{00011110}_{2}</span>. For 32-bit words <span class="math">X</span> and <span class="math">Y</span> we denote their bitwise AND, OR and XOR as <span class="math">X\\wedge Y</span>, <span class="math">X\\vee Y</span> and <span class="math">X\\oplus Y</span>, respectively, <span class="math">\\overline{X}</span> is the bitwise complement of <span class="math">X</span>, the <span class="math">i</span>-th bit <span class="math">v_{i}</span> of <span class="math">X=(v_{31}v_{30}\\ldots v_{0})</span> is denoted <span class="math">X[i]</span>, and <span class="math">RL(X,n)</span> (resp. <span class="math">RR(X,n)</span>) is the cyclic left (resp. right) rotation of <span class="math">X</span> by <span class="math">n</span> bit positions.</p>

    <div class="overflow-x-auto my-4">

      <table class="min-w-full text-sm text-gray-300">

        <thead>

          <tr>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">For chosen message prefixes <span class="math">P</span> and <span class="math">P^{\\prime}</span> we seek suffixes <span class="math">S</span> and <span class="math">S^{\\prime}</span> such that the messages $P\\</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">S<span class="math"> and </span>P^{\\prime}\\</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">S^{\\prime}<span class="math"> collide under MD5. In this paper any variable </span>X<span class="math"> related to the message </span>P\\</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">S<span class="math"> or its MD5 calculation, may have a corresponding variable </span>X^{\\prime}<span class="math"> related to the message </span>P^{\\prime}\\</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">S^{\\prime}<span class="math"> or its MD5 calculation. Furthermore, </span>\\delta X=X^{\\prime}-X<span class="math"> for such a ‘matched’ </span>X\\in\\mathbb{Z}/2^{32}\\mathbb{Z}<span class="math">. For a ‘matched’ variable </span>Z<span class="math"> that consist of tuples of 32-bit integers, say </span>Z=(z_{1},z_{2},\\ldots)<span class="math">, we define </span>\\delta Z<span class="math"> as </span>(\\delta z_{1},\\delta z_{2},\\ldots)$.</th>

          </tr>

        </thead>

        <tbody>

        </tbody>

      </table>

    </div>

    <h3 id="sec-4" class="text-xl font-semibold mt-8">2.2 MD5 overview</h3>

    <p class="text-gray-300">MD5 works as follows:</p>

    <ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">

      <li>Padding. Pad the message with: first a ‘1’-bit, next the least number of ‘0’ bits to make the length equal to <span class="math">448\\bmod 512</span>, and finally the bitlength of the original unpadded message as a 64-bit little-endian integer. As a result the total bitlength of the padded message is <span class="math">512N</span> for a positive integer <span class="math">N</span>.</li>

      <li>Partitioning. Partition the padded message into <span class="math">N</span> consecutive 512-bit blocks <span class="math">M_{1}</span>, <span class="math">M_{2}</span>, <span class="math">\\ldots,M_{N}</span>.</li>

      <li>Processing. MD5 goes through <span class="math">N+1</span> states <span class="math">\\mathrm{IHV}_{i}</span>, for <span class="math">0\\leq i\\leq N</span>, called the intermediate hash values and denoted this way to achieve consistency with <em>[13]</em>. Each intermediate hash value <span class="math">\\mathrm{IHV}_{i}</span> consists of four 32-bit words <span class="math">a_{i},b_{i},c_{i},d_{i}</span>. For <span class="math">i=0</span> these are fixed public values <span class="math">(a_{0},b_{0},c_{0},d_{0})=(\\texttt{67452301}_{16},\\texttt{EFCDAB89}_{16},\\texttt{98BADCFE}_{16},\\texttt{10325476}_{16})</span>. For <span class="math">i=1,2,\\ldots,N</span> intermediate hash value <span class="math">\\mathrm{IHV}_{i}</span> is computed as MD5Compress(<span class="math">\\mathrm{IHV}_{i-1},M_{i}</span>) using the MD5 compression function described in detail below.</li>

      <li>Output. The resulting hash value is the last intermediate hash value <span class="math">\\mathrm{IHV}_{N}</span>, expressed as the concatenation of the hexadecimal byte strings of the four words <span class="math">a_{N},b_{N},c_{N},d_{N}</span>, converted back from their little-endian representation.</li>

    </ol>

    <h3 id="sec-5" class="text-xl font-semibold mt-8">2.3 MD5 compression function</h3>

    <div class="overflow-x-auto my-4">

      <table class="min-w-full text-sm text-gray-300">

        <thead>

          <tr>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">The input for the compression function MD5Compress(<span class="math">\\mathrm{IHV},B</span>) is an intermediate hash value <span class="math">\\mathrm{IHV}=(a,b,c,d)</span> and a 512-bit message block <span class="math">B</span>. The compression function consists of 64 steps (numbered 0 to 63), split into four consecutive rounds of 16 steps each. Each step <span class="math">t</span> uses modular additions, a left rotation, and a non-linear function <span class="math">f_{t}</span>. These functions involve Addition Constants $AC_{t}=\\left\\lfloor 2^{32}\\left</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">\\sin(t+1)\\right</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">\\right\\rfloor<span class="math"> for </span>0\\leq t<64<span class="math">, and Rotation Constants </span>RC_{t}$ defined as</th>

          </tr>

        </thead>

        <tbody>

        </tbody>

      </table>

    </div>

    <p class="text-gray-300">\\[ (RC_{t},RC_{t+1},RC_{t+2},RC_{t+3})=\\begin{cases}(7,12,17,22)&\\text{for }t=0,4,8,12,\\\\ (5,9,14,20)&\\text{for }t=16,20,24,28,\\\\ (4,11,16,23)&\\text{for }t=32,36,40,44,\\\\ (6,10,15,21)&\\text{for }t=48,52,56,60.\\end{cases} \\]</p>

    <p class="text-gray-300">The non-linear function <span class="math">f_{t}</span> depends on the round:</p>

    <p class="text-gray-300">\\[ f_{t}(X,Y,Z)=\\begin{cases}F(X,Y,Z)=(X\\wedge Y)\\oplus(\\overline{X}\\wedge Z)&\\text{for }0\\leq t<16,\\\\ G(X,Y,Z)=(Z\\wedge X)\\oplus(\\overline{Z}\\wedge Y)&\\text{for }16\\leq t<32,\\\\ H(X,Y,Z)=X\\oplus Y\\oplus Z&\\text{for }32\\leq t<48,\\\\ I(X,Y,Z)=Y\\oplus(X\\vee\\overline{Z})&\\text{for }48\\leq t<64.\\end{cases} \\]</p>

    <p class="text-gray-300">The message block <span class="math">B</span> is partitioned into sixteen consecutive 32-bit words <span class="math">m_0, m_1, \\ldots, m_{15}</span> (with little-endian byte ordering), and expanded to 64 words <span class="math">W_t</span>, for <span class="math">0 \\leq t &amp;lt; 64</span>, of 32 bits each:</p>

    <div class="my-4 text-center"><span class="math-block">W_t = \\begin{cases} m_t &amp;amp; \\text{for } 0 \\leq t &amp;lt; 16, \\\\ m_{(1+5t) \\bmod 16} &amp;amp; \\text{for } 16 \\leq t &amp;lt; 32, \\\\ m_{(5+3t) \\bmod 16} &amp;amp; \\text{for } 32 \\leq t &amp;lt; 48, \\\\ m_{(7t) \\bmod 16} &amp;amp; \\text{for } 48 \\leq t &amp;lt; 64. \\end{cases}</span></div>

    <p class="text-gray-300">To facilitate the analysis we follow an 'unrolled' description instead of a cyclic state. For each step <span class="math">t</span> the compression function algorithm maintains a working register with 4 state words <span class="math">Q_t</span>, <span class="math">Q_{t-1}</span>, <span class="math">Q_{t-2}</span> and <span class="math">Q_{t-3}</span> and calculates a new state word <span class="math">Q_{t+1}</span>. With <span class="math">(Q_0, Q_{-1}, Q_{-2}, Q_{-3}) = (b, c, d, a)</span>, for <span class="math">t = 0, 1, \\ldots, 63</span> in succession <span class="math">Q_{t+1}</span> is calculated as follows:</p>

    <div class="my-4 text-center"><span class="math-block">\\begin{cases} F_t = f_t(Q_t, Q_{t-1}, Q_{t-2}), \\\\ T_t = F_t + Q_{t-3} + AC_t + W_t, \\\\ R_t = RL(T_t, RC_t), \\\\ Q_{t+1} = Q_t + R_t. \\end{cases}</span></div>

    <p class="text-gray-300">After all steps are computed, the resulting state words are added to the intermediate hash value and returned as output:</p>

    <div class="my-4 text-center"><span class="math-block">\\mathrm{MD5Compress}(\\mathrm{IHV}, B) = (a + Q_{61}, b + Q_{64}, c + Q_{63}, d + Q_{62}). \\tag{1}</span></div>

    <p class="text-gray-300">The suffixes <span class="math">S</span> and <span class="math">S&#x27;</span> in a chosen-prefix collision consist of three consecutive parts: padding bitstrings, birthday bitstrings and near-collision bitstrings. The padding bitstrings are arbitrarily chosen such that the birthday bitstrings end on the same 512-bit block border. The birthday bitstrings result in a <span class="math">\\delta\\mathrm{IHV}</span> that will be eliminated by a sequence of near-collision blocks which make up the near-collision bitstrings as described in [13, Section 5.3]. Fewer near-collision blocks are required if the family of differential paths is more effective, whereas finding a <span class="math">\\delta\\mathrm{IHV}</span> that requires fewer near-collision blocks increases the birthday search complexity. Thus, if both search time and number of near-collision blocks are limited, a more effective family of differential paths is required.</p>

    <p class="text-gray-300">In our target application, generating a rogue CA certificate, we have to deal with two hard limits. Because the CA that is supposed to sign</p>

    <p class="text-gray-300">our (legitimate) certificate does not accept certification requests for RSA moduli larger than 2048 bits, each of our suffixes  <span class="math">S</span>  and  <span class="math">S&#x27;</span>  and their common appendage  <span class="math">T</span>  must fit in 2048 bits. This implies that we can use at most 3 near-collision blocks. Furthermore, to reliably predict the serial number, the entire construction must be performed within a few days.</p>

    <p class="text-gray-300">Table 1. Family of partial differential paths using  <span class="math">\\delta {m}_{11} =  \\pm  {2}^{q - {10}\\bmod {32}}</span>  .</p>

    <div class="overflow-x-auto my-4">

      <table class="min-w-full text-sm text-gray-300">

        <thead>

          <tr>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">t</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">δQt</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">δFt</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">δWt</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">δTt</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">δRt</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">RCt</th>

          </tr>

        </thead>

        <tbody>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">35-60</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">·</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">61</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">±2q-10 mod 32</td>

            <td class="px-3 py-2 border-b border-gray-700">±2q-10 mod 32</td>

            <td class="px-3 py-2 border-b border-gray-700">±2q</td>

            <td class="px-3 py-2 border-b border-gray-700">10</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">62</td>

            <td class="px-3 py-2 border-b border-gray-700">±2q</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">15</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">63</td>

            <td class="px-3 py-2 border-b border-gray-700">±2q</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">21</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">64</td>

            <td class="px-3 py-2 border-b border-gray-700">±2q + ∑λ=0w'sλ2q+21+λ mod 32</td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

          </tr>

        </tbody>

      </table>

    </div>

    <p class="text-gray-300">Here  <span class="math">w&#x27; = \\min(w, 31 - q)</span>  and  <span class="math">s_0, \\ldots, s_{w&#x27;} \\in \\{-1, 0, +1\\}</span>  for a fixed parameter  <span class="math">w \\geq 0</span> . Interesting values for  <span class="math">w</span>  are between 2 and 5.</p>

    <p class="text-gray-300">Thus, as shown in Table 1, we have extended the family of differential paths used to construct chosen-prefix collisions. The larger choice is parameterized by the non-negative integer  <span class="math">w</span> : a larger value allows elimination of more differences in  <span class="math">\\delta \\mathrm{IHV}</span>  per near-collision block, but increases the cost of constructing each near-collision block by a factor of roughly  <span class="math">2^{2w}</span> . The value for  <span class="math">w</span>  in Table 1 can be chosen freely, however due to the blow-up factor of  <span class="math">2^{2w}</span>  only the values 2, 3, 4, and 5 are of interest.</p>

    <p class="text-gray-300">Compared to the earlier differential paths in [13, Table 2] and [12, Table 7-2], the new ones vary the carry propagations in the last 3 steps and the boolean function difference in the last step. This change affects the working state only in difference  <span class="math">\\delta Q_{64}</span> . Each possible value  <span class="math">\\delta Q_{64}</span>  may be caused by many different carry propagations and boolean function differences. When performing the collision finding for an actual near-collision block using a particular differential path, we do not consider just one such possible variation but for the last 3 steps check only if the  <span class="math">\\delta Q_t</span> 's are as specified.</p>

    <div class="overflow-x-auto my-4">

      <table class="min-w-full text-sm text-gray-300">

        <thead>

          <tr>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">A birthday search on a search space  <span class="math">V</span>  is generally performed by iterating a properly chosen deterministic function  <span class="math">f: V \\to V</span>  and by assuming that the points of  <span class="math">V</span>  thus visited form a 'random walk' [9]. After approximately  $\\sqrt{\\pi</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">V</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">/2}$  iterations one may expect to have encountered a</th>

          </tr>

        </thead>

        <tbody>

        </tbody>

      </table>

    </div>

    <div class="overflow-x-auto my-4">

      <table class="min-w-full text-sm text-gray-300">

        <thead>

          <tr>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">collision, i.e., different points <span class="math">x</span> and <span class="math">y</span> such that <span class="math">f(x)=f(y)</span>. Because the entire trail can in practice not be stored and to take advantage of parallelism, different pseudo-random walks are generated, of which only the startpoints, lengths, and endpoints are kept. The walks are generated to end on ‘distinguished points’, points with an easily recognizable bitpattern depending on $</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">V</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600"><span class="math">, available storage and other characteristics. The average length of a walk is inversely proportional to the fraction of distinguished points in </span>V$. Because intersecting walks share their endpoints, they can easily be detected. The collision point can then be recomputed given the startpoints and lengths of the two colliding walks.</th>

          </tr>

        </thead>

        <tbody>

        </tbody>

      </table>

    </div>

    <div class="overflow-x-auto my-4">

      <table class="min-w-full text-sm text-gray-300">

        <thead>

          <tr>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">Let <span class="math">p</span> be the probability that a birthday collision satisfies additional conditions that cannot be captured by <span class="math">V</span> or <span class="math">f</span>. On average <span class="math">1/p</span> birthday collisions have to be found at a cost of $C_{\\mathrm{tr}}=\\sqrt{\\pi</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">V</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">/(2p)}<span class="math"> iterations, plus recomputation of </span>1/p<span class="math"> intersecting walks at </span>C_{\\mathrm{coll}}<span class="math"> iterations. To achieve </span>C_{\\mathrm{coll}}\\approx\\epsilon\\cdot C_{\\mathrm{tr}}<span class="math"> for any given </span>\\epsilon\\leq 1<span class="math"> and optimizing for the expected walk lengths, one needs to store approximately </span>1/(p\\cdot\\epsilon)<span class="math"> walks. The value for </span>p<span class="math"> depends in an intricate way on </span>k<span class="math"> (cf. below), </span>w<span class="math">, and the targeted number of near-collision blocks and is extensively tabulated in the final version <em>[15]</em> of <em>[13]</em>. The value for </span>\\epsilon<span class="math"> depends on the amount of available space to store walks. For very small </span>\\epsilon<span class="math"> the overall birthdaying complexity is about </span>C_{\\mathrm{tr}}$.</th>

          </tr>

        </thead>

        <tbody>

        </tbody>

      </table>

    </div>

    <div class="overflow-x-auto my-4">

      <table class="min-w-full text-sm text-gray-300">

        <thead>

          <tr>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">The first chosen-prefix collision example from <em>[13]</em> used a 96-bit birthday search space <span class="math">V</span> with $</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">V</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">=2^{96}<span class="math"> to find a </span>\\delta\\mathrm{IHV}=(\\delta a,\\delta b,\\delta c,\\delta d)<span class="math"> with </span>\\delta a=0<span class="math">, </span>\\delta b=\\delta c=\\delta d<span class="math">. This search can be continued until a birthday collision is found that requires a sufficiently small number of near-collision blocks, which leads to a trade-off between the birthday search and the number of blocks. If one would aim for just 3 near-collision blocks, one expects </span>2^{57.33}$ MD5 compressions for the 96-bit birthday search, which would take about 50 days on 215 PlayStation 3 game consoles.</th>

          </tr>

        </thead>

        <tbody>

        </tbody>

      </table>

    </div>

    <p class="text-gray-300">By leaving <span class="math">\\delta b</span> free, we get an improved 64-bit search space (cf. <em>[12]</em>, <em>[14]</em>). In the resulting birthday collisions, the differences in <span class="math">\\delta b</span> compared to <span class="math">\\delta c</span> were handled by the differential path from <em>[12, section 7.4]</em> which corresponds to <span class="math">\\delta Q_{64}=\\pm 2^{q}\\mp 2^{q+21\\bmod 32}</span> in Table 1 (cf. equation 2.3(1)). This significantly decreasing the birthday search complexity, but also increases the average number of near-collision blocks. When aiming for 3 blocks, birthdaying requires about <span class="math">2^{55.73}</span> MD5 compressions. But the probability that a birthday collision is useful becomes so small that the space requirements are prohibitive: about <span class="math">2^{50.15}</span> bytes, i.e., more than a petabyte.</p>

    <p class="text-gray-300">A more flexible approach is obtained by interpolating between the above 64-bit and 96-bit birthday searches, while exploiting the family of differential paths from Section 3. For any <span class="math">k\\in\\{0,1,\\ldots,32\\}</span>, we can do</p>

    <p class="text-gray-300">a  <span class="math">(64 + k)</span> -bit search similar to the one above, but with  <span class="math">\\delta b = \\delta c \\mod 2^k</span> . Since  <span class="math">\\delta b</span>  does not introduce new differences compared to  <span class="math">\\delta c</span>  in the lower  <span class="math">k</span>  bits, the average number of near-collision blocks may be reduced - in particular when taking advantage of our new family of differential paths - while incurring a higher birthdaying cost. For any targeted number of near-collision blocks, this leads to a trade-off between the birthdaying cost and space requirements (unless the number of blocks is at least 6, since then 241MB suffices for the plausible choice  <span class="math">w = 2</span> ). Table 2 gives birthday complexities for  <span class="math">k = 0</span> , a range of  <span class="math">w</span> -values to control the number of differences that can be eliminated per near-collision block, and number  <span class="math">r</span>  of near-collision blocks. The smallest amount of memory required for  <span class="math">C_{\\mathrm{coll}}</span>  to be smaller than  <span class="math">C_{\\mathrm{tr}}</span>  is denoted by  <span class="math">M</span> .</p>

    <p class="text-gray-300">Table 2. Birthday complexities and memory requirements for  <span class="math">k = 0</span>  .</p>

    <div class="overflow-x-auto my-4">

      <table class="min-w-full text-sm text-gray-300">

        <thead>

          <tr>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600"></th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">w=0</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600"></th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">w=1</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600"></th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">w=2</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600"></th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">w=3</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600"></th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">w=4</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600"></th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">w=5</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600"></th>

          </tr>

        </thead>

        <tbody>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">r</td>

            <td class="px-3 py-2 border-b border-gray-700">Ctr</td>

            <td class="px-3 py-2 border-b border-gray-700">M</td>

            <td class="px-3 py-2 border-b border-gray-700">Ctr</td>

            <td class="px-3 py-2 border-b border-gray-700">M</td>

            <td class="px-3 py-2 border-b border-gray-700">Ctr</td>

            <td class="px-3 py-2 border-b border-gray-700">M</td>

            <td class="px-3 py-2 border-b border-gray-700">Ctr</td>

            <td class="px-3 py-2 border-b border-gray-700">M</td>

            <td class="px-3 py-2 border-b border-gray-700">Ctr</td>

            <td class="px-3 py-2 border-b border-gray-700">M</td>

            <td class="px-3 py-2 border-b border-gray-700">Ctr</td>

            <td class="px-3 py-2 border-b border-gray-700">M</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">14</td>

            <td class="px-3 py-2 border-b border-gray-700">236.68</td>

            <td class="px-3 py-2 border-b border-gray-700">1MB</td>

            <td class="px-3 py-2 border-b border-gray-700">234.01</td>

            <td class="px-3 py-2 border-b border-gray-700">1MB</td>

            <td class="px-3 py-2 border-b border-gray-700">232.96</td>

            <td class="px-3 py-2 border-b border-gray-700">1MB</td>

            <td class="px-3 py-2 border-b border-gray-700">232.84</td>

            <td class="px-3 py-2 border-b border-gray-700">1MB</td>

            <td class="px-3 py-2 border-b border-gray-700">232.83</td>

            <td class="px-3 py-2 border-b border-gray-700">1MB</td>

            <td class="px-3 py-2 border-b border-gray-700">232.83</td>

            <td class="px-3 py-2 border-b border-gray-700">1MB</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">13</td>

            <td class="px-3 py-2 border-b border-gray-700">237.55</td>

            <td class="px-3 py-2 border-b border-gray-700">1MB</td>

            <td class="px-3 py-2 border-b border-gray-700">234.69</td>

            <td class="px-3 py-2 border-b border-gray-700">1MB</td>

            <td class="px-3 py-2 border-b border-gray-700">233.22</td>

            <td class="px-3 py-2 border-b border-gray-700">1MB</td>

            <td class="px-3 py-2 border-b border-gray-700">232.93</td>

            <td class="px-3 py-2 border-b border-gray-700">1MB</td>

            <td class="px-3 py-2 border-b border-gray-700">232.88</td>

            <td class="px-3 py-2 border-b border-gray-700">1MB</td>

            <td class="px-3 py-2 border-b border-gray-700">232.87</td>

            <td class="px-3 py-2 border-b border-gray-700">1MB</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">12</td>

            <td class="px-3 py-2 border-b border-gray-700">238.55</td>

            <td class="px-3 py-2 border-b border-gray-700">1MB</td>

            <td class="px-3 py-2 border-b border-gray-700">235.59</td>

            <td class="px-3 py-2 border-b border-gray-700">1MB</td>

            <td class="px-3 py-2 border-b border-gray-700">233.71</td>

            <td class="px-3 py-2 border-b border-gray-700">1MB</td>

            <td class="px-3 py-2 border-b border-gray-700">233.16</td>

            <td class="px-3 py-2 border-b border-gray-700">1MB</td>

            <td class="px-3 py-2 border-b border-gray-700">233.02</td>

            <td class="px-3 py-2 border-b border-gray-700">1MB</td>

            <td class="px-3 py-2 border-b border-gray-700">232.98</td>

            <td class="px-3 py-2 border-b border-gray-700">1MB</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">11</td>

            <td class="px-3 py-2 border-b border-gray-700">239.68</td>

            <td class="px-3 py-2 border-b border-gray-700">2MB</td>

            <td class="px-3 py-2 border-b border-gray-700">236.71</td>

            <td class="px-3 py-2 border-b border-gray-700">1MB</td>

            <td class="px-3 py-2 border-b border-gray-700">234.50</td>

            <td class="px-3 py-2 border-b border-gray-700">1MB</td>

            <td class="px-3 py-2 border-b border-gray-700">233.63</td>

            <td class="px-3 py-2 border-b border-gray-700">1MB</td>

            <td class="px-3 py-2 border-b border-gray-700">233.34</td>

            <td class="px-3 py-2 border-b border-gray-700">1MB</td>

            <td class="px-3 py-2 border-b border-gray-700">233.24</td>

            <td class="px-3 py-2 border-b border-gray-700">1MB</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">10</td>

            <td class="px-3 py-2 border-b border-gray-700">240.97</td>

            <td class="px-3 py-2 border-b border-gray-700">11MB</td>

            <td class="px-3 py-2 border-b border-gray-700">238.06</td>

            <td class="px-3 py-2 border-b border-gray-700">1MB</td>

            <td class="px-3 py-2 border-b border-gray-700">235.60</td>

            <td class="px-3 py-2 border-b border-gray-700">1MB</td>

            <td class="px-3 py-2 border-b border-gray-700">234.42</td>

            <td class="px-3 py-2 border-b border-gray-700">1MB</td>

            <td class="px-3 py-2 border-b border-gray-700">233.91</td>

            <td class="px-3 py-2 border-b border-gray-700">1MB</td>

            <td class="px-3 py-2 border-b border-gray-700">233.71</td>

            <td class="px-3 py-2 border-b border-gray-700">1MB</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">9</td>

            <td class="px-3 py-2 border-b border-gray-700">242.40</td>

            <td class="px-3 py-2 border-b border-gray-700">79MB</td>

            <td class="px-3 py-2 border-b border-gray-700">239.63</td>

            <td class="px-3 py-2 border-b border-gray-700">2MB</td>

            <td class="px-3 py-2 border-b border-gray-700">237.02</td>

            <td class="px-3 py-2 border-b border-gray-700">1MB</td>

            <td class="px-3 py-2 border-b border-gray-700">235.56</td>

            <td class="px-3 py-2 border-b border-gray-700">1MB</td>

            <td class="px-3 py-2 border-b border-gray-700">234.80</td>

            <td class="px-3 py-2 border-b border-gray-700">1MB</td>

            <td class="px-3 py-2 border-b border-gray-700">234.45</td>

            <td class="px-3 py-2 border-b border-gray-700">1MB</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">8</td>

            <td class="px-3 py-2 border-b border-gray-700">244.02</td>

            <td class="px-3 py-2 border-b border-gray-700">732MB</td>

            <td class="px-3 py-2 border-b border-gray-700">241.43</td>

            <td class="px-3 py-2 border-b border-gray-700">21MB</td>

            <td class="px-3 py-2 border-b border-gray-700">238.76</td>

            <td class="px-3 py-2 border-b border-gray-700">1MB</td>

            <td class="px-3 py-2 border-b border-gray-700">237.09</td>

            <td class="px-3 py-2 border-b border-gray-700">1MB</td>

            <td class="px-3 py-2 border-b border-gray-700">236.05</td>

            <td class="px-3 py-2 border-b border-gray-700">1MB</td>

            <td class="px-3 py-2 border-b border-gray-700">235.51</td>

            <td class="px-3 py-2 border-b border-gray-700">1MB</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">7</td>

            <td class="px-3 py-2 border-b border-gray-700">245.73</td>

            <td class="px-3 py-2 border-b border-gray-700">8GB</td>

            <td class="px-3 py-2 border-b border-gray-700">243.43</td>

            <td class="px-3 py-2 border-b border-gray-700">323MB</td>

            <td class="px-3 py-2 border-b border-gray-700">240.83</td>

            <td class="px-3 py-2 border-b border-gray-700">9MB</td>

            <td class="px-3 py-2 border-b border-gray-700">239.02</td>

            <td class="px-3 py-2 border-b border-gray-700">1MB</td>

            <td class="px-3 py-2 border-b border-gray-700">237.73</td>

            <td class="px-3 py-2 border-b border-gray-700">1MB</td>

            <td class="px-3 py-2 border-b border-gray-700">236.95</td>

            <td class="px-3 py-2 border-b border-gray-700">1MB</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">6</td>

            <td class="px-3 py-2 border-b border-gray-700">247.92</td>

            <td class="px-3 py-2 border-b border-gray-700">164GB</td>

            <td class="px-3 py-2 border-b border-gray-700">245.69</td>

            <td class="px-3 py-2 border-b border-gray-700">7GB</td>

            <td class="px-3 py-2 border-b border-gray-700">243.22</td>

            <td class="px-3 py-2 border-b border-gray-700">241MB</td>

            <td class="px-3 py-2 border-b border-gray-700">241.40</td>

            <td class="px-3 py-2 border-b border-gray-700">20MB</td>

            <td class="px-3 py-2 border-b border-gray-700">239.89</td>

            <td class="px-3 py-2 border-b border-gray-700">3MB</td>

            <td class="px-3 py-2 border-b border-gray-700">238.85</td>

            <td class="px-3 py-2 border-b border-gray-700">1MB</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">5</td>

            <td class="px-3 py-2 border-b border-gray-700">249.82</td>

            <td class="px-3 py-2 border-b border-gray-700">3TB</td>

            <td class="px-3 py-2 border-b border-gray-700">247.92</td>

            <td class="px-3 py-2 border-b border-gray-700">164GB</td>

            <td class="px-3 py-2 border-b border-gray-700">245.89</td>

            <td class="px-3 py-2 border-b border-gray-700">10GB</td>

            <td class="px-3 py-2 border-b border-gray-700">244.20</td>

            <td class="px-3 py-2 border-b border-gray-700">938MB</td>

            <td class="px-3 py-2 border-b border-gray-700">242.59</td>

            <td class="px-3 py-2 border-b border-gray-700">102MB</td>

            <td class="px-3 py-2 border-b border-gray-700">241.34</td>

            <td class="px-3 py-2 border-b border-gray-700">18MB</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">4</td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700">249.33</td>

            <td class="px-3 py-2 border-b border-gray-700">2TB</td>

            <td class="px-3 py-2 border-b border-gray-700">247.42</td>

            <td class="px-3 py-2 border-b border-gray-700">82GB</td>

            <td class="px-3 py-2 border-b border-gray-700">245.81</td>

            <td class="px-3 py-2 border-b border-gray-700">9GB</td>

            <td class="px-3 py-2 border-b border-gray-700">244.55</td>

            <td class="px-3 py-2 border-b border-gray-700">2GB</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">3</td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700">248.17</td>

            <td class="px-3 py-2 border-b border-gray-700">231GB</td>

          </tr>

        </tbody>

      </table>

    </div>

    <p class="text-gray-300">Having a cluster of 215 PlayStation 3 (PS3) game consoles at our disposal obviously influenced our parameter choices. When running Linux on a PS3, our application has access to 6 Synergistic Processing Units (SPUs), a general purpose CPU, and about 150MB of RAM per PS3. For our birthday search, the  <span class="math">6 \\times 215</span>  SPUs are computationally equivalent to approximately 8600 regular 32-bit cores, due to each SPU's  <span class="math">4 \\times 32</span> -bit wide SIMD architecture. The other parts of the chosen-prefix collision construction are not suitable for the SPUs, but we were able to use the 215 PS3 CPUs for the construction of the actual near-collision blocks. With these resources, the choice  <span class="math">w = 5</span>  still turned out to be acceptable despite the 1000-fold increase in the cost of the actual near-collision block construction. This is the case even for the hard cases with many</p>

    <p class="text-gray-300">differences between IHV and  <span class="math">\\mathrm{IHV^{\\prime}}</span> : as a consequence the differential paths contain many bitconditions which leaves little space for so-called 'tunnels' (cf. [6]), thereby complicating the near-collision block construction.</p>

    <p class="text-gray-300">For  <span class="math">w = 5</span>  and the targeted 3 near-collision blocks, Table 3 shows the time-memory tradeoff when the birthday search space is varied with  <span class="math">k</span> . With 150MB at our disposal per PS3, for a total of about 30GB, we decided to use  <span class="math">k = 8</span>  as this optimizes the overall birthday complexity for the plausible case that the birthday search takes  <span class="math">\\sqrt{2}</span>  times longer than expected. The overall chosen-prefix collision construction takes on average less than a day on the cluster of PS3s. In theory we could have used 1TB (or more) of hard drive space, in which case it would have been optimal to use  <span class="math">k = 0</span>  for a birthday search of about 20 PS3 days.</p>

    <p class="text-gray-300">Table 3. Birthday complexities and memory requirements for  <span class="math">r = 3</span>  .</p>

    <div class="overflow-x-auto my-4">

      <table class="min-w-full text-sm text-gray-300">

        <thead>

          <tr>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600"></th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">w=3</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600"></th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">w=4</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600"></th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">w=5</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600"></th>

          </tr>

        </thead>

        <tbody>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">k</td>

            <td class="px-3 py-2 border-b border-gray-700">Ctr</td>

            <td class="px-3 py-2 border-b border-gray-700">M</td>

            <td class="px-3 py-2 border-b border-gray-700">Ctr</td>

            <td class="px-3 py-2 border-b border-gray-700">M</td>

            <td class="px-3 py-2 border-b border-gray-700">Ctr</td>

            <td class="px-3 py-2 border-b border-gray-700">M</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700">248.17</td>

            <td class="px-3 py-2 border-b border-gray-700">231GB</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">2</td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700">249.10</td>

            <td class="px-3 py-2 border-b border-gray-700">210GB</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">4</td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700">250.43</td>

            <td class="px-3 py-2 border-b border-gray-700">330GB</td>

            <td class="px-3 py-2 border-b border-gray-700">249.29</td>

            <td class="px-3 py-2 border-b border-gray-700">68GB</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">6</td>

            <td class="px-3 py-2 border-b border-gray-700">251.33</td>

            <td class="px-3 py-2 border-b border-gray-700">287GB</td>

            <td class="px-3 py-2 border-b border-gray-700">250.54</td>

            <td class="px-3 py-2 border-b border-gray-700">96GB</td>

            <td class="px-3 py-2 border-b border-gray-700">249.69</td>

            <td class="px-3 py-2 border-b border-gray-700">30GB</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">8</td>

            <td class="px-3 py-2 border-b border-gray-700">251.98</td>

            <td class="px-3 py-2 border-b border-gray-700">177GB</td>

            <td class="px-3 py-2 border-b border-gray-700">250.74</td>

            <td class="px-3 py-2 border-b border-gray-700">32GB</td>

            <td class="px-3 py-2 border-b border-gray-700">249.99</td>

            <td class="px-3 py-2 border-b border-gray-700">11GB</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">10</td>

            <td class="px-3 py-2 border-b border-gray-700">252.43</td>

            <td class="px-3 py-2 border-b border-gray-700">82GB</td>

            <td class="px-3 py-2 border-b border-gray-700">251.24</td>

            <td class="px-3 py-2 border-b border-gray-700">16GB</td>

            <td class="px-3 py-2 border-b border-gray-700">250.44</td>

            <td class="px-3 py-2 border-b border-gray-700">5GB</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">12</td>

            <td class="px-3 py-2 border-b border-gray-700">252.44</td>

            <td class="px-3 py-2 border-b border-gray-700">22GB</td>

            <td class="px-3 py-2 border-b border-gray-700">251.64</td>

            <td class="px-3 py-2 border-b border-gray-700">7GB</td>

            <td class="px-3 py-2 border-b border-gray-700">250.90</td>

            <td class="px-3 py-2 border-b border-gray-700">3GB</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">14</td>

            <td class="px-3 py-2 border-b border-gray-700">252.76</td>

            <td class="px-3 py-2 border-b border-gray-700">9GB</td>

            <td class="px-3 py-2 border-b border-gray-700">252.01</td>

            <td class="px-3 py-2 border-b border-gray-700">3GB</td>

            <td class="px-3 py-2 border-b border-gray-700">251.38</td>

            <td class="px-3 py-2 border-b border-gray-700">2GB</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">16</td>

            <td class="px-3 py-2 border-b border-gray-700">253.13</td>

            <td class="px-3 py-2 border-b border-gray-700">4GB</td>

            <td class="px-3 py-2 border-b border-gray-700">252.48</td>

            <td class="px-3 py-2 border-b border-gray-700">2GB</td>

            <td class="px-3 py-2 border-b border-gray-700">251.96</td>

            <td class="px-3 py-2 border-b border-gray-700">675MB</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">18</td>

            <td class="px-3 py-2 border-b border-gray-700">253.59</td>

            <td class="px-3 py-2 border-b border-gray-700">2GB</td>

            <td class="px-3 py-2 border-b border-gray-700">253.02</td>

            <td class="px-3 py-2 border-b border-gray-700">733MB</td>

            <td class="px-3 py-2 border-b border-gray-700">252.61</td>

            <td class="px-3 py-2 border-b border-gray-700">418MB</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">20</td>

            <td class="px-3 py-2 border-b border-gray-700">253.96</td>

            <td class="px-3 py-2 border-b border-gray-700">673MB</td>

            <td class="px-3 py-2 border-b border-gray-700">253.46</td>

            <td class="px-3 py-2 border-b border-gray-700">340MB</td>

            <td class="px-3 py-2 border-b border-gray-700">253.13</td>

            <td class="px-3 py-2 border-b border-gray-700">215MB</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">22</td>

            <td class="px-3 py-2 border-b border-gray-700">254.43</td>

            <td class="px-3 py-2 border-b border-gray-700">324MB</td>

            <td class="px-3 py-2 border-b border-gray-700">254.01</td>

            <td class="px-3 py-2 border-b border-gray-700">182MB</td>

            <td class="px-3 py-2 border-b border-gray-700">253.73</td>

            <td class="px-3 py-2 border-b border-gray-700">123MB</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">24</td>

            <td class="px-3 py-2 border-b border-gray-700">254.92</td>

            <td class="px-3 py-2 border-b border-gray-700">160MB</td>

            <td class="px-3 py-2 border-b border-gray-700">254.59</td>

            <td class="px-3 py-2 border-b border-gray-700">102MB</td>

            <td class="px-3 py-2 border-b border-gray-700">254.33</td>

            <td class="px-3 py-2 border-b border-gray-700">71MB</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">26</td>

            <td class="px-3 py-2 border-b border-gray-700">255.52</td>

            <td class="px-3 py-2 border-b border-gray-700">92MB</td>

            <td class="px-3 py-2 border-b border-gray-700">255.25</td>

            <td class="px-3 py-2 border-b border-gray-700">64MB</td>

            <td class="px-3 py-2 border-b border-gray-700">255.04</td>

            <td class="px-3 py-2 border-b border-gray-700">47MB</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">28</td>

            <td class="px-3 py-2 border-b border-gray-700">256.11</td>

            <td class="px-3 py-2 border-b border-gray-700">52MB</td>

            <td class="px-3 py-2 border-b border-gray-700">255.95</td>

            <td class="px-3 py-2 border-b border-gray-700">42MB</td>

            <td class="px-3 py-2 border-b border-gray-700">255.83</td>

            <td class="px-3 py-2 border-b border-gray-700">36MB</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">30</td>

            <td class="px-3 py-2 border-b border-gray-700">256.74</td>

            <td class="px-3 py-2 border-b border-gray-700">32MB</td>

            <td class="px-3 py-2 border-b border-gray-700">256.68</td>

            <td class="px-3 py-2 border-b border-gray-700">29MB</td>

            <td class="px-3 py-2 border-b border-gray-700">256.61</td>

            <td class="px-3 py-2 border-b border-gray-700">26MB</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">32</td>

            <td class="px-3 py-2 border-b border-gray-700">257.27</td>

            <td class="px-3 py-2 border-b border-gray-700">17MB</td>

            <td class="px-3 py-2 border-b border-gray-700">257.27</td>

            <td class="px-3 py-2 border-b border-gray-700">17MB</td>

            <td class="px-3 py-2 border-b border-gray-700">257.27</td>

            <td class="px-3 py-2 border-b border-gray-700">17MB</td>

          </tr>

        </tbody>

      </table>

    </div>

    <p class="text-gray-300">In this section we present some of the details of the construction of the to-be-signed parts of our colliding certificates, as outlined in Figure 1.</p>

    <p class="text-gray-300">The chosen prefix of the website certificate contains a subject Distinguished Name (a domain name), as well as the first 208 bits of the RSA modulus, chosen at random, as padding to reach proper alignment</p>

    <p class="text-gray-300">!<a href="img-0.jpeg">img-0.jpeg</a> Fig. 1. The to-be-signed parts of the colliding certificates.</p>

    <p class="text-gray-300">with the rogue CA certificate. Furthermore, an educated guess has to be included for the serial number and validity period fields that the signing CA will insert when it processes the legitimate website's certification request. For the targeted commercial CA it turned out, based on repeated observations, that the validity period can be predicted very reliably as the period of precisely one year plus one day, starting exactly six seconds after a certification request is submitted. Furthermore, it was found that the targeted CA uses sequential serial numbers. Being able to predict the next serial number, however, is not enough, because the construction of the collision can be expected to take at least a day, implying a substantial and uncertain increment in the serial number by the time the collision construction is finished. The increment in serial number over a weekend, however, does not vary a lot and Monday morning's serial numbers can be predicted, roughly, on the Friday afternoon before.</p>

    <p class="text-gray-300">The chosen prefix of the rogue CA certificate contains a short rogue CA name, a 1024-bit RSA public key, and the first part of the X.509v3 extension fields. One of these extension fields is the 'basic constraints' field, containing a bit that identifies the certificate as a CA certificate (in Figure 1 denoted by "CA=TRUE"). The final part of the rogue chosen prefix contains an indication that all remaining bits of this to-be-signed part should be interpreted as an extension field of the type "Netscape Comment", a field that is ignored by most application software. In Figure 1 this field is denoted as 'tumor'.</p>

    <p class="text-gray-300">Given these two chosen prefixes, the collision bits consisting of birthday bits and near-collision blocks are computed as described above. We describe how those bits are interpreted on either side. The birthday bits</p>

    <p class="text-gray-300">occupy 96 bits. Immediately after them there is a border between MD5 input blocks. In the website certificate the birthday bits are part of the RSA modulus, in the rogue CA certificate they belong to the tumor.</p>

    <p class="text-gray-300">After the birthday bits, there are 3 near-collision blocks of 512 bits each. In the website certificate these are part of the RSA modulus, thereby fixing <span class="math">208+96+3\\times 512=1840</span> bits of the website’s RSA modulus. In the rogue CA certificate these 3 blocks are the second part of the tumor.</p>

    <p class="text-gray-300">After the collision bits, another <span class="math">2048-1840=208</span> bits are needed to complete the website’s 2048-bit RSA modulus. These 208 bits have to be determined in such a way that the complete factorization of the RSA modulus is known, in order to be able to submit a valid certificate signing request for the website. The RSA modulus does not have to be secure as it will not be used after obtaining the website’s certificate. Its least significant 208 bits are determined as follows. Let <span class="math">B</span> denote the fixed 1840-bit part of the RSA modulus followed by 208 one bits. Now select a random 224-bit integer <span class="math">q</span> until <span class="math">B</span> mod <span class="math">q</span> is less than <span class="math">2^{208}</span>, and keep doing so until both <span class="math">q</span> and <span class="math">\\lfloor B/q\\rfloor</span> are prime. As a result <span class="math">n=\\lfloor B/q\\rfloor q</span> has the desired 1840 leading bits and, for purely esthetic reasons, <span class="math">n</span>’s smallest prime factor <span class="math">q</span> is larger than the 67-digit largest factor found (so far) using the Elliptic Curve integer factorization method.</p>

    <p class="text-gray-300">Finally the website’s RSA public exponent is set, followed by the X.509v3 extensions of the website certificate. All bits after the collision bits in the website certificate’s to-be-signed part are copied to the tumor in the rogue CA certificate.</p>

    <p class="text-gray-300">A legitimate PKCS#10 Certificate Signing Request can now be submitted to the signing CA. This CA requires proof of possession of the private key corresponding to the public key inside the request. This is done by signing the request using this private key and this is the sole reason that we needed the factorization of the website’s RSA modulus. Upon correct submission, the signing CA returns a website certificate. If the serial number and validity period as inserted by the CA indeed match our guess, then the website certificate’s to-be-signed part will collide under MD5 with the rogue CA certificate’s to-be-signed part, and the signing CA’s MD5-based digital signature will be equally valid for the rogue data.</p>

    <p class="text-gray-300">Getting the right serial number at the right time requires some care. About half an hour before the targeted submission moment, the same request is submitted, and the serial number in the resulting certificate is inspected. If it is already too high, the entire attempt has to be abandoned. Otherwise, the request is repeatedly submitted, with a frequency depending on the gap that may still exist between the serial number re</p>

    <p class="text-gray-300">ceived and the targeted one, and taking into account possible certification requests by others. In this way the serial number is slowly nudged toward the right value at the right time.</p>

    <p class="text-gray-300">A proof of concept rogue CA certificate constructed in this manner, where it required some experimentation and a moderate number of attempts to get the correct serial number and validity period, was obtained using a commercial CA. Full details, including the rogue CA certificate, are available from www.win.tue.nl/hashclash/rogue-ca/.</p>

    <h2 id="sec-9" class="text-2xl font-bold">6 Independent additional improvement</h2>

    <p class="text-gray-300">We show how to construct a chosen-prefix collision for MD5 that consists of 84 birthday bits followed by one pair of near-collision blocks, for a chosen-prefix collision-causing appendage of <span class="math">84+512=596</span> bits. The construction is based on an even richer family of differential paths that allows elimination using a single pair of near-collision blocks of a set of <span class="math">\\delta</span>IHVs that is bounded enough so that finding the near-collision blocks is still feasible, but large enough that such a <span class="math">\\delta</span>IHV can be found efficiently by a birthday search. Instead of using the family of differential paths based on <span class="math">\\delta m_{11}=\\pm 2^{i}</span>, we use the fastest known collision attack for MD5 and vary the last few steps to find a large family of differential paths.</p>

    <p class="text-gray-300">We first present a new collision attack for MD5 with complexity of approximately <span class="math">2^{16}</span> MD5 compressions improving upon the <span class="math">2^{20.96}</span> MD5 compressions required in <em>[20]</em>. Our starting point is the partial differential path for MD5 given in Table 4. It is based on message differences <span class="math">\\delta m_{2}=2^{8}</span>, <span class="math">\\delta m_{4}=\\delta m_{14}=2^{31}</span> and <span class="math">\\delta m_{11}=2^{15}</span> which is very similar to those used by Wang et al. in <em>[17]</em> for the first collision attack against MD5. This partial differential path can be used for a near-collision attack with complexity of approximately <span class="math">2^{14.8}</span> MD5 compressions. This leads in the usual fashion to an identical-prefix collision attack for MD5 that requires approximately <span class="math">2^{16}</span> MD5 compressions, since one has to do it twice: first to add differences to <span class="math">\\delta</span>IHV and then to eliminate them again. It should be noted that usually bitconditions are required on the IHV and IHV^{′} between the two collision blocks which imply an extra factor in complexity. In the present case, however, we can construct a large set of differential paths for the second near-collision block that will cover all bitconditions that are likely to occur, thereby avoiding the extra complexity.</p>

    <p class="text-gray-300">By properly tuning the birthday search, the same partial differential path leads to the construction of a single near-collision block chosen-prefix collision for MD5. By varying the last steps of the differential path and</p>

    <p class="text-gray-300">Table 4. Partial differential path for fast near-collision attack.</p>

    <div class="overflow-x-auto my-4">

      <table class="min-w-full text-sm text-gray-300">

        <thead>

          <tr>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">t</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">δQt</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">δFt</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">δWt</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">δTt</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">δRt</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">RCt</th>

          </tr>

        </thead>

        <tbody>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">30 - 33</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">-</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">34</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">215</td>

            <td class="px-3 py-2 border-b border-gray-700">215</td>

            <td class="px-3 py-2 border-b border-gray-700">231</td>

            <td class="px-3 py-2 border-b border-gray-700">16</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">35</td>

            <td class="px-3 py-2 border-b border-gray-700">231</td>

            <td class="px-3 py-2 border-b border-gray-700">231</td>

            <td class="px-3 py-2 border-b border-gray-700">231</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">23</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">36</td>

            <td class="px-3 py-2 border-b border-gray-700">231</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">4</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">37</td>

            <td class="px-3 py-2 border-b border-gray-700">231</td>

            <td class="px-3 py-2 border-b border-gray-700">231</td>

            <td class="px-3 py-2 border-b border-gray-700">231</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">11</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">38 - 46</td>

            <td class="px-3 py-2 border-b border-gray-700">231</td>

            <td class="px-3 py-2 border-b border-gray-700">231</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">-</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">47</td>

            <td class="px-3 py-2 border-b border-gray-700">231</td>

            <td class="px-3 py-2 border-b border-gray-700">231</td>

            <td class="px-3 py-2 border-b border-gray-700">28</td>

            <td class="px-3 py-2 border-b border-gray-700">28</td>

            <td class="px-3 py-2 border-b border-gray-700">231</td>

            <td class="px-3 py-2 border-b border-gray-700">23</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">48</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">6</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">49</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">10</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">50</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">231</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">15</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">51 - 59</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">-</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">60</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">231</td>

            <td class="px-3 py-2 border-b border-gray-700">231</td>

            <td class="px-3 py-2 border-b border-gray-700">-25</td>

            <td class="px-3 py-2 border-b border-gray-700">6</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">61</td>

            <td class="px-3 py-2 border-b border-gray-700">-25</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">215</td>

            <td class="px-3 py-2 border-b border-gray-700">215</td>

            <td class="px-3 py-2 border-b border-gray-700">225</td>

            <td class="px-3 py-2 border-b border-gray-700">10</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">62</td>

            <td class="px-3 py-2 border-b border-gray-700">-25 + 225</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">28</td>

            <td class="px-3 py-2 border-b border-gray-700">28</td>

            <td class="px-3 py-2 border-b border-gray-700">223</td>

            <td class="px-3 py-2 border-b border-gray-700">15</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">63</td>

            <td class="px-3 py-2 border-b border-gray-700">-25 + 225 + 223</td>

            <td class="px-3 py-2 border-b border-gray-700">25 - 223</td>

            <td class="px-3 py-2 border-b border-gray-700">0</td>

            <td class="px-3 py-2 border-b border-gray-700">25 - 223</td>

            <td class="px-3 py-2 border-b border-gray-700">226 - 214</td>

            <td class="px-3 py-2 border-b border-gray-700">21</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">64</td>

            <td class="px-3 py-2 border-b border-gray-700">-25 + 225 + 223 + 226 - 214</td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

          </tr>

        </tbody>

      </table>

    </div>

    <p class="text-gray-300">Partial differential path for  <span class="math">t = 29, \\ldots, 63</span>  using message differences  <span class="math">\\delta m_2 = 2^8</span> ,  <span class="math">\\delta m_4 = \\delta m_{14} = 2^{31}</span> ,  <span class="math">\\delta m_{11} = 2^{15}</span> . The probability that it is satisfied is approximately  <span class="math">2^{-14.5}</span> .</p>

    <p class="text-gray-300">by allowing the collision finding complexity to grow by a factor of about  <span class="math">2^{26}</span> , we have found a set  <span class="math">\\mathcal{S}</span>  of about  <span class="math">2^{23.3}</span>  different  <span class="math">\\delta \\mathrm{IHV} = (\\delta a, \\delta b, \\delta c, \\delta d)</span>  of the form  <span class="math">\\delta a = -2^5</span> ,  <span class="math">\\delta d = -2^5 + 2^{25}</span> ,  <span class="math">\\delta c = -2^5 \\mod 2^{20}</span>  that can be eliminated. Such  <span class="math">\\delta \\mathrm{IHVs}</span>  can be found using an 84-bit birthday search with step function  <span class="math">f: \\{0,1\\}^{84} \\to \\{0,1\\}^{84}</span>  of the form</p>

    <div class="my-4 text-center"><span class="math-block"></span></div>

    <div class="overflow-x-auto my-4">

      <table class="min-w-full text-sm text-gray-300">

        <thead>

          <tr>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">f (x) = \\left\\{ \\begin{array}{l l} \\phi (\\mathrm {M D 5 c o m p r e s s} (\\mathrm {I H V}, B \\</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">x) + \\delta \\widehat {\\mathrm {I H V}}) &amp; \\mathrm {f o r} \\sigma (x) = 0 \\\\ \\phi (\\mathrm {M D 5 c o m p r e s s} (\\mathrm {I H V} ^ {\\prime}, B ^ {\\prime} \\</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">x)) &amp; \\mathrm {f o r} \\sigma (x) = 1, \\end{array} \\right.</th>

          </tr>

        </thead>

        <tbody>

        </tbody>

      </table>

    </div>

    <div class="my-4 text-center"><span class="math-block"></span></div>

    <div class="overflow-x-auto my-4">

      <table class="min-w-full text-sm text-gray-300">

        <thead>

          <tr>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">where  <span class="math">\\delta \\widehat{\\mathrm{IHV}}</span>  is of the required form,  <span class="math">\\sigma : x \\mapsto \\{0,1\\}</span>  is a balanced selector function and  $\\phi(a,b,c,d) \\mapsto a\\</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">d\\</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">(c \\bmod 2^{20})<span class="math"> . There are  </span>2^{128-84} = 2^{44}<span class="math">  possible  </span>\\delta \\mathrm{IHVs}<span class="math">  of this form, of which only about  </span>2^{23.3}<span class="math">  are in the allowed set  </span>\\mathcal{S}<span class="math"> . It follows that a birthday collision has probability  </span>p = 2^{23.3} / (2^{44} \\cdot 2) = 2^{-21.7}$  to be useful, where the additional factor 2 stems from the fact that different prefixes are required.</th>

          </tr>

        </thead>

        <tbody>

        </tbody>

      </table>

    </div>

    <p class="text-gray-300">A useful birthday collision can be expected after  <span class="math">\\sqrt{\\pi 2^{84} / (2p)} \\approx 2^{53.2}</span>  MD5 compressions, requires 400MB of storage and takes about 3 days on 215 PS3s. The expected complexity of finding the actual near-collision blocks is bounded by about  <span class="math">2^{14.8 + 26} = 2^{40.8}</span>  MD5 compressions. In Table 5 two 128-byte messages are given both consisting of a 52-byte chosen prefix</p>

    <p class="text-gray-300">and a 76-byte single-block chosen-prefix collision suffix and with colliding MD5 hash value D320B6433D8EBC1AC65711705721C2E1.</p>

    <p class="text-gray-300">Table 5: Example single-block chosen-prefix collision.</p>

    <p class="text-gray-300">Message 1 4F64656420476F6C6472656963680A4F64656420476F6C6472656963680A4F64656420476FD8050D0019BB9318924CAA96DCE35CB835B349E144E98C50C22CF461244A4064BF1AFAECC5820D428AD38D6BEC89A5AD51E29063DD79B16CF67C12978647F5AF123DE3ACF844085CD025B956</p>

    <p class="text-gray-300">Message 2 4E65616C204B6F626C69747A0A4E65616C204B6F626C69747A0A4E65616C204B6F626C69747A0A75B80E0035F3D2C909AF1BADDCE35CB835B349E144E88C50C22CF461244A40E4BF1AFAECC5820D428AD38D6BEC89A5AD51E29063DD79B16CF6FC11978647F5AF123DE3ACF84408DCD025B956</p>

    <h2 id="sec-10" class="text-2xl font-bold">7 Conclusion</h2>

    <p class="text-gray-300">We have shown that the length of formerly rather long chosen-prefix collisions for MD5 can be reduced to a minimum at a still acceptable cost, and that short enough chosen-prefix collision-causing appendages can be found fast enough to cause trouble, if so desired.</p>

    <p class="text-gray-300">As secure cryptographic hash function for digital signature applications, MD5 has been declared dead over and over again. The improvements in the collision construction for MD5 presented here firmly hammer another nail into its coffin. We have been told that simply removing all existing MD5 applications would break too much. Nevertheless, we hope that our work has contributed to a sooner ending of MD5’s funeral.</p>

    <p class="text-gray-300">In Table 6 we present a historical overview of the decline in complexity of MD5 and SHA-1 collision finding. It clearly illustrates that attacks only get better, not worse. Not reflected in the table is the fact that already in 1993 it was known that there was serious trouble with MD5, based on collisions in its compression function (cf. <em>[1]</em>, <em>[3]</em>). We leave any speculation about the future of SHA-1 cryptanalysis to the knowledgeable reader.</p>

    <p class="text-gray-300">A possible mitigation of the risk posed by chosen-prefix collisions when signing documents is to let the signer add a sufficient amount of fresh randomness at the appropriate spot in the to-be-signed data, i.e., not as a suffix but preferably somewhere early on. For certificates the serial number, or even a somewhat variable validity period, would be an appropriate</p>

    <p class="text-gray-300">Table 6. Collision complexities - Historical overview.</p>

    <div class="overflow-x-auto my-4">

      <table class="min-w-full text-sm text-gray-300">

        <thead>

          <tr>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">year</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">MD5</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600"></th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">SHA-1</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600"></th>

          </tr>

        </thead>

        <tbody>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700">identical-prefix</td>

            <td class="px-3 py-2 border-b border-gray-700">chosen-prefix</td>

            <td class="px-3 py-2 border-b border-gray-700">identical-prefix</td>

            <td class="px-3 py-2 border-b border-gray-700">chosen-prefix</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">pre-2004</td>

            <td class="px-3 py-2 border-b border-gray-700">264 (trivial)</td>

            <td class="px-3 py-2 border-b border-gray-700">264 (trivial)</td>

            <td class="px-3 py-2 border-b border-gray-700">280 (trivial)</td>

            <td class="px-3 py-2 border-b border-gray-700">280 (trivial)</td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">2004</td>

            <td class="px-3 py-2 border-b border-gray-700">240 [16], [17]</td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">2005</td>

            <td class="px-3 py-2 border-b border-gray-700">237 [5]</td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700">269 [18]</td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

          </tr>

        </tbody>

      </table>

    </div>

    <p class="text-gray-300">|   |  |  | 263 [19] |   |</p>

    <div class="overflow-x-auto my-4">

      <table class="min-w-full text-sm text-gray-300">

        <thead>

          <tr>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">2006</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">232 [6], [11]</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">249 [13]</th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600"></th>

            <th class="px-3 py-2 text-left font-semibold border-b border-gray-600">280-ε [10]</th>

          </tr>

        </thead>

        <tbody>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">2008</td>

            <td class="px-3 py-2 border-b border-gray-700">221 [20]</td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

          </tr>

          <tr>

            <td class="px-3 py-2 border-b border-gray-700">2009</td>

            <td class="px-3 py-2 border-b border-gray-700">216 (this paper)</td>

            <td class="px-3 py-2 border-b border-gray-700">239 (this paper)</td>

            <td class="px-3 py-2 border-b border-gray-700">252 [7]</td>

            <td class="px-3 py-2 border-b border-gray-700"></td>

          </tr>

        </tbody>

      </table>

    </div>

    <p class="text-gray-300">Complexity is given as the number of calls to the relevant compression function. The figures are optimized for speed, i.e., for collisions using any number of near-collision blocks. For other collision lengths the complexities may differ.</p>

    <p class="text-gray-300">spot. Although this would work, it can be argued that such a countermeasure relies on unintentional choices of the X.509 certificate standard. Indeed, we would be in favor of a more fundamental way to add randomness to to-be-hashed data, such as using randomized hashing as a mode of operation for hash functions as proposed in [4]. The collision was, at least partially, achievable because of 'flabby structure' of the certificate (cf. [2]), so that may have to be addressed as well. On the other hand, a more 'rigid' structure would not be an excuse to use a poor hash function: irrespective of the elegance or lack thereof of the certificate structure, we need a solid hash function.</p>

    <p class="text-gray-300">As far as we know, no harm was done using our rogue CA certificate. The positive effects we intended to achieve by its construction have been realized. From this point of view, and because it required new cryptanalytic insights in MD5, the project described in this paper was very gratifying. Nevertheless, there was another, secondary aspect that is worth mentioning here. Although, as stated earlier, creating havoc was not our goal, we must admit that some havoc was created by our announcement. Despite our best efforts to inform the party that was arguably most directly affected by our work (as documented on one of the related websites), we also felt we should not reveal our identities to avoid any attempt to file an injunction barring our announcement. Overall, this did not stimulate a healthy exchange of information of which all parties involved could have profited. We do not know how the present legal climate could best be changed to address this problem, but hope that the difficulties as clearly observed in our case help to expedite a solution.</p>

    <p class="text-gray-300">Acknowledgements</p>

    <p class="text-gray-300">We are grateful for comments by the Crypto 2009 reviewers, and support by the European Commission through the EU ICT program ECRYPT II, by the Swiss National Science Foundation, and by EPFL DIT.</p>

    <h2 id="sec-11" class="text-2xl font-bold">References</h2>

    <ul class="list-disc list-inside space-y-1 text-gray-300 my-2 ml-4">

      <li>[1] B. den Boer and A. Bosselaers, <em>Collisions for the compression function of MD5</em>, Eurocrypt ’93, LNCS 765, pp. 293–304, 1994.</li>

      <li>[2] W. Diffie, personal communication, January 2009.</li>

      <li>[3] H. Dobbertin, <em>Cryptanalysis of MD5 Compress</em>, May 1996, http:www-cse.ucsd.edu/~bsy/dobbertin.ps.</li>

      <li>[4] S. Halevi and H. Krawczyk, <em>Strengthening Digital Signatures via Randomized Hashing</em>, Internet Draft, http://tools.ietf.org/html/draft-irtf-cfrg-rhash-01. Crypto 2006, LNCS 4117, pp. 41–59, 2006.</li>

      <li>[5] Vlastimil Klima, <em>Finding MD5 Collisions on a Notebook PC Using Multi-message Modifications</em>, Cryptology ePrint Archive, Report 2005/102.</li>

      <li>[6] Vlastimil Klima, <em>Tunnels in Hash Functions: MD5 Collisions Within a Minute</em>, Cryptology ePrint Archive, Report 2006/105.</li>

      <li>[7] Cameron McDonald, Philip Hawkes and Josef Pieprzyk, <em>SHA-1 collisions now <span class="math">2^{52}</span></em>, Eurocrypt 2009 Rump session.</li>

      <li>[8] Florian Mendel, Christian Rechberger and Vincent Rijmen, <em>Update on SHA-1</em>, Crypto 2007 Rump session.</li>

      <li>[9] Paul C. van Oorschot and Michael J. Wiener, <em>Parallel collision search with cryptanalytic applications</em>, Journal of Cryptology 12(1), 1–28, 1999.</li>

      <li>[10] Christian Rechberger, unpublished result, 2006.</li>

      <li>[11] Marc Stevens, <em>Fast Collision Attack on MD5</em>, Cryptology ePrint Archive, Report 2006/104.</li>

      <li>[12] Marc Stevens, <em>On collisions for MD5</em>, Master’s thesis, TU Eindhoven, June 2007, available from http://www.win.tue.nl/hashclash/.</li>

      <li>[13] Marc Stevens, Arjen Lenstra and Benne de Weger, <em>Chosen-Prefix Collisions for MD5 and Colliding X.509 Certificates for Different Identities</em>, in M. Naor (Ed.), Eurocrypt 2007, LNCS 4515, pp. 1–22, 2007.</li>

      <li>[14] Marc Stevens, Arjen Lenstra and Benne de Weger, <em>Predicting the winner of the 2008 US presidential elections using a Sony PlayStation 3</em>, http://www.win.tue.nl/hashclash/Nostradamus/, 2007.</li>

      <li>[15] Marc Stevens, Arjen Lenstra and Benne de Weger, <em>Chosen-Prefix Collisions for MD5 and Applications</em>, in preparation.</li>

      <li>[16] Xiaoyun Wang, Xuejia Lai, Dengguo Feng and Hongbo Yu, <em>Collisions for hash functions MD4, MD5, HAVAL-128 and RIPEMD</em>, Crypto 2004 Rump Session.</li>

      <li>[17] Xiaoyun Wang and Hongbo Yu, <em>How to Break MD5 and Other Hash Functions</em>, Eurocrypt 2005, LNCS 3494, pp. 19-35.</li>

      <li>[18] Xiaoyun Wang, Yiqun Lisa Yin and Hongbo Yu, <em>Finding Collisions in the Full SHA-1</em>, Crypto 2005, LNCS 3621, pp. 17-36.</li>

      <li>[19] Xiaoyun Wang, Andrew Yao and Frances Yao, <em>New Collision Search for SHA-1</em>, Crypto 2005 Rump session.</li>

      <li>[20] Tao Xie, FanBao Liu and DengGuo Feng, <em>Could The 1-MSB Input Difference Be The Fastest Collision Attack For MD5?</em>, Cryptology ePrint Archive, Report 2008/391.</li>

    </ul>`;
---

<BaseLayout title="Short Chosen-Prefix Collisions for MD5 and the Creation of a... (2009/111)">
  <article class="max-w-4xl mx-auto article-prose">
    <nav class="mb-8">
      <a href="/papers" class="text-blue-400 hover:text-blue-300">
        &larr; Back to Papers
      </a>
    </nav>

    <header class="mb-12">
      <h1 class="text-3xl font-bold mb-4"
        set:html={TITLE_HTML} />
      <p class="text-gray-400 mb-2"
        set:html={AUTHORS_HTML} />
      <p class="text-gray-500 text-sm mb-4">
        2009 &middot; eprint 2009/111
      </p>
      <div class="flex gap-4 text-sm">
        <a
          href={EPRINT_URL}
          target="_blank"
          rel="noopener noreferrer"
          class="text-blue-400 hover:text-blue-300"
        >
          Paper (eprint) &rarr;
        </a>
      </div>
      <p class="mt-4 text-xs text-gray-500">
        All content below belongs to the original authors. This page
        reproduces the paper for educational purposes. Always
        <a
          href={EPRINT_URL}
          target="_blank"
          rel="noopener noreferrer"
          class="text-blue-400 hover:text-blue-300"
        >cite the original</a>.
      </p>
      <p class="mt-1 text-xs text-gray-600">
        Converted with: {CRAWLER} &middot; {CONVERTED_DATE}
      </p>
    </header>

    <Fragment set:html={CONTENT} />

  </article>
</BaseLayout>
