---
import BaseLayout from '../../layouts/BaseLayout.astro';

const EPRINT_URL = 'https://eprint.iacr.org/2020/179';
---

<BaseLayout title="Mind the Middle Layer: HADES Revisited (2020/179)">
  <article class="max-w-4xl mx-auto article-prose">
    <nav class="mb-8">
      <a href="/papers" class="text-blue-400 hover:text-blue-300">
        &larr; Back to Papers
      </a>
    </nav>

    <header class="mb-12">
      <h1 class="text-3xl font-bold mb-4">
        Mind the Middle Layer: The HADES Design Strategy
        Revisited
      </h1>
      <p class="text-gray-400 mb-2">
        Nathan Keller, Asaf Rosemarin
      </p>
      <p class="text-gray-500 text-sm mb-4">
        2020 &middot; Full Version &middot; eprint 2020/179
      </p>
      <div class="flex gap-4 text-sm">
        <a href={EPRINT_URL} target="_blank"
          rel="noopener noreferrer"
          class="text-blue-400 hover:text-blue-300">
          Paper (eprint) &rarr;
        </a>
      </div>
      <p class="mt-4 text-xs text-gray-500">
        All content below belongs to the original authors.
        This page reproduces the paper for educational
        purposes. Always
        <a href={EPRINT_URL} target="_blank"
          rel="noopener noreferrer"
          class="text-blue-400 hover:text-blue-300">
          cite the original</a>.
      </p>
    </header>

    <!-- ====================================================== -->
    <!-- TABLE OF CONTENTS                                      -->
    <!-- ====================================================== -->

    <nav id="toc" class="mb-10 p-6 rounded-lg"
      style="background: rgba(255,255,255,0.03);
             border: 1px solid rgba(255,255,255,0.06);">
      <h2 class="text-lg font-bold mb-4">
        Table of Contents
      </h2>
      <ol class="space-y-1 text-sm text-gray-300
        list-decimal list-inside">
        <li>
          <a href="#abstract" class="hover:text-white">
            Abstract</a>
        </li>
        <li>
          <a href="#sec-1" class="hover:text-white">
            Introduction</a>
          <ol class="ml-6 mt-1 space-y-1 list-decimal
            list-inside text-gray-400">
            <li><a href="#sec-1.1"
              class="hover:text-white">Background</a></li>
            <li><a href="#sec-1.2"
              class="hover:text-white">
              Our Results</a></li>
            <li><a href="#sec-1.3"
              class="hover:text-white">
              Practical Impact and Subsequent Work</a></li>
            <li><a href="#sec-1.4"
              class="hover:text-white">
              Organization of the Paper</a></li>
          </ol>
        </li>
        <li>
          <a href="#sec-2" class="hover:text-white">
            The HADES Construction</a>
        </li>
        <li>
          <a href="#sec-3" class="hover:text-white">
            Improved Security Bounds for Poseidon
            Permutations</a>
        </li>
        <li>
          <a href="#sec-4" class="hover:text-white">
            A Class of Matrices over a Binary Field</a>
          <ol class="ml-6 mt-1 space-y-1 list-decimal
            list-inside text-gray-400">
            <li><a href="#sec-4.1"
              class="hover:text-white">
              Special Matrices and Their Basic
              Properties</a></li>
            <li><a href="#sec-4.2"
              class="hover:text-white">
              Special Matrices over Commutative Rings of
              Characteristic 2</a></li>
            <li><a href="#sec-4.3"
              class="hover:text-white">
              Nilpotent Special Matrices</a></li>
            <li><a href="#sec-4.4"
              class="hover:text-white">
              Block Matrices with Special Blocks</a></li>
            <li><a href="#sec-4.5"
              class="hover:text-white">
              A Stronger Conjectured Bound</a></li>
          </ol>
        </li>
        <li>
          <a href="#sec-5" class="hover:text-white">
            A Large Invariant Subspace in Starkad</a>
          <ol class="ml-6 mt-1 space-y-1 list-decimal
            list-inside text-gray-400">
            <li><a href="#sec-5.1"
              class="hover:text-white">
              The Starkad MDS and Special Matrices</a></li>
            <li><a href="#sec-5.2"
              class="hover:text-white">
              A Large Invariant Subspace</a></li>
            <li><a href="#sec-5.3"
              class="hover:text-white">
              Using the Invariant Subspaces for a Preimage
              Attack</a></li>
            <li><a href="#sec-5.4"
              class="hover:text-white">
              The Invariant Subspaces Can Be Avoided
              Easily</a></li>
          </ol>
        </li>
        <li>
          <a href="#sec-6" class="hover:text-white">
            Discussion and Open Problems</a>
          <ol class="ml-6 mt-1 space-y-1 list-decimal
            list-inside text-gray-400">
            <li><a href="#sec-6.1"
              class="hover:text-white">
              Discussion: PSPN vs. SPN Rounds</a></li>
            <li><a href="#sec-6.2"
              class="hover:text-white">
              Open Problems</a></li>
          </ol>
        </li>
        <li>
          <a href="#acknowledgements"
            class="hover:text-white">Acknowledgements</a>
        </li>
        <li>
          <a href="#references"
            class="hover:text-white">References</a>
        </li>
        <li>
          <a href="#appendix-a"
            class="hover:text-white">
            Appendix A: Pattern Search Algorithm</a>
        </li>
      </ol>
    </nav>

    <!-- ====================================================== -->
    <!-- ABSTRACT                                               -->
    <!-- ====================================================== -->

    <section id="abstract" class="mb-12">
      <h2 class="text-2xl font-bold mb-4">Abstract</h2>
      <p class="text-gray-300">
        The HADES design strategy combines the classical SPN
        construction with the Partial SPN (PSPN)
        construction, in which at every encryption round,
        the non-linear layer is applied to only a part of
        the state. In a HADES design, a middle layer that
        consists of PSPN rounds is surrounded by outer
        layers of SPN rounds. The security arguments of
        HADES with respect to statistical attacks use only
        the SPN rounds, disregarding the PSPN rounds. This
        allows the designers to not pose any restriction on
        the MDS matrix used as the linear mixing operation.
      </p>
      <p class="text-gray-300">
        In this paper we show that the choice of the MDS
        matrix significantly affects the security level
        provided by HADES designs. If the MDS is chosen
        properly, then the security level of the scheme
        against differential and linear attacks is
        significantly higher than claimed by the designers.
        On the other hand, weaker choices of the MDS allow
        for extremely large invariant subspaces that pass
        the entire middle layer without activating any
        non-linear operation (a.k.a. S-box).
      </p>
      <p class="text-gray-300">
        We showcase our results on the Starkad and Poseidon
        instantiations of HADES. For Poseidon, we
        significantly improve the lower bounds on the number
        of active S-boxes with respect to both differential
        and linear cryptanalysis provided by the
        designers&mdash;for example, from 28 to 60 active
        S-boxes for the
        <span class="math">t = 6</span> variant. For
        Starkad, we show that for any variant with
        <span class="math">t</span> (i.e., the number of
        S-boxes in each round) divisible by 4, the cipher
        admits a huge invariant subspace that passes any
        number of PSPN rounds without activating any S-box
        (e.g., a subspace of size
        <span class="math">2^&#123;1134&#125;</span> for
        the <span class="math">t = 24</span> variant).
        Furthermore, for various choices of the parameters,
        this invariant subspace can be used to mount a
        preimage attack on the hash function that breaks its
        security claims. On the other hand, we show that the
        problem can be fixed easily by replacing
        <span class="math">t</span> with any value that is
        not divisible by four.
      </p>
      <p class="text-gray-300">
        Following our paper, the designers of Starkad and
        Poseidon amended their design, by adding
        requirements which ensure that the MDS matrix is
        chosen properly.
      </p>
    </section>

    <!-- ====================================================== -->
    <!-- 1. INTRODUCTION                                        -->
    <!-- ====================================================== -->

    <section id="sec-1" class="mb-12">
      <h2 class="text-2xl font-bold mb-4">
        1 Introduction
      </h2>

      <h3 id="sec-1.1" class="text-xl font-semibold mt-8 mb-3">
        1.1 Background
      </h3>
      <p class="text-gray-300">
        Substitution-permutation network (SPN) is a classical
        design strategy of cryptographic permutations, used
        in the AES [NIST01] and in numerous other modern
        cryptosystems. An SPN iterates many times a sequence
        of operations called &lsquo;round&rsquo;, which
        consists of a layer of local non-linear operations
        (S-boxes) and a global linear mixing layer. The wide
        trail strategy, employed in the AES, allows
        designing SPNs with an easily provable lower bound
        on the number of active S-boxes in any differential
        or linear characteristic, thus providing a security
        guarantee with respect to the most common
        statistical cryptanalytic attacks.
      </p>
      <p class="text-gray-300">
        In 2013, G&eacute;rard et al. [GGNS13] proposed the
        Partial SPN (PSPN) construction, in which the S-box
        layer is applied to only a part of the state in each
        round (in exchange for somewhat increasing the
        number of rounds). This approach, that has obvious
        performance advantages in various scenarios, was
        used in the block ciphers Zorro [GGNS13] and LowMC [ARS+15].
        A drawback of this approach is that
        &lsquo;clean&rsquo; security arguments (like the
        wide trail strategy) are not applicable for PSPNs,
        and thus, the security of these designs was argued
        by more ad-hoc approaches. These turned out to be
        insufficient, as Zorro was practically broken in [BDD+15]
        and the security of the initial versions of LowMC
        was shown in [DLMW15, DEM15] to be significantly lower than
        claimed by the designers.
      </p>
      <p class="text-gray-300">
        At Eurocrypt 2020, Grassi et al. [GLR+20] proposed the
        HADES design strategy that combines the classical
        SPN construction with the PSPN construction. In a
        HADES design, a middle layer of PSPN rounds is
        surrounded by two layers of SPN rounds. The scheme
        allows enjoying &lsquo;the best of the two
        worlds&rsquo;&mdash;the efficiency provided by the
        PSPN construction, along with the clean security
        arguments applicable for the SPN construction.
        Specifically, the security arguments of the
        cryptosystem with respect to statistical (e.g.,
        differential and linear) attacks are provided only
        by the SPN (a.k.a. &lsquo;full&rsquo;) rounds,
        using the wide trail strategy. The security
        arguments with respect to algebraic attacks use also
        the PSPN rounds, and take advantage of the fact
        that a partial non-linear layer increases the
        algebraic degree in essentially the same way as a
        &lsquo;full&rsquo; non-linear layer. The linear
        layer in the HADES design is implemented by an MDS
        matrix (see [NIST01]), which guarantees that if the
        number of S-boxes in any full round is
        <span class="math">t</span>, then any differential
        or linear characteristic over two full rounds
        activates at least
        <span class="math">t + 1</span> S-boxes. Since the
        PSPN rounds are not used in the security arguments
        with respect to statistical attacks, the HADES
        designers do not impose any restriction on the MDS
        used in the scheme. As a specific example, they
        propose using Cauchy matrices over finite fields
        (to be defined in Sec. 2).
      </p>
      <p class="text-gray-300">
        The designers of HADES presented applications of
        their strategy for securing data transfers with
        distributed databases using secure multiparty
        computation (MPC). Subsequently, Grassi et al.
        proposed Starkad [GKK+19, initial version] and Poseidon
        [GKR+21]&mdash;hash functions whose underlying
        permutations are instantiations of the HADES
        methodology, aimed at applications for practical
        proof systems, such as SNARKs, STARKs, or
        Bulletproofs. The HADES family of algorithms
        (including various Starkad and Poseidon variants)
        was a candidate in the STARK-Friendly Hash Challenge
        [SW20].
      </p>

      <h3 id="sec-1.2" class="text-xl font-semibold mt-8 mb-3">
        1.2 Our Results
      </h3>
      <p class="text-gray-300">
        In this paper we study the effect of the MDS matrix
        on the security level of HADES designs. We show that
        when the MDS is chosen properly, the PSPN rounds can
        be taken into consideration in the security
        arguments against differential and linear attacks,
        leading to a very significant improvement in the
        lower bound on the number of active S-boxes in
        differential and linear characteristics. On the
        other hand, we show that a weaker choice of the MDS
        matrix may lead to existence of huge invariant
        subspaces for the entire middle layer that do not
        activate any S-box (for any number of PSPN rounds).
        Furthermore, for certain instances (albeit, not for
        the specific instances chosen in [GKK+19, initial
        version] and [SW20]), these invariant subspaces allow
        breaking the hash function with a Gr&ouml;bner-basis
        [BW91] preimage attack.
      </p>
      <p class="text-gray-300">
        To be specific, we focus on the variants of Starkad
        and Poseidon suggested in [GKK+19, initial version].
        Interestingly, our results point out a sharp
        difference between the cases of a prime field
        (Poseidon) and a binary field (Starkad).
      </p>
      <p class="text-gray-300">
        <strong>Analysis of Poseidon.</strong> In the case
        of Poseidon (which operates over a prime field
        <span class="math">\text&#123;GF&#125;(p)</span>),
        for all variants proposed in [GKK+19, 11], we
        significantly improve the lower bound on the number
        of active S-boxes in differential and linear
        characteristics. The improvement is especially large
        for variants with a small number of S-boxes in each
        round (denoted in [GLR+20] by
        <span class="math">t</span>). For example, for
        <span class="math">t = 6</span> (which is the main
        reference variant provided in the supplementary
        material of [GKK+19]), the designers claim a lower bound
        of
        <span class="math">4 \cdot (6 + 1) = 28</span>
        active S-boxes, based on application of the wide
        trail strategy to the &lsquo;full&rsquo; rounds. We
        prove that the PSPN rounds must activate at least 32
        S-boxes, thus more than doubling the lower bound on
        the number of active S-boxes to 60. For the
        <span class="math">t = 2</span> variant, the
        improvement is most striking: there are at least 41
        active S-boxes in the PSPN rounds, while the
        designers&rsquo; bound for the SPN rounds is 12
        S-boxes. We obtain the new lower bounds using an
        automated characteristic search tool for PSPNs
        proposed in [BDD+15]. A comparison of our new lower
        bounds and the lower bounds of the designers is
        presented in Table 1.
      </p>

      <!-- Table 1 -->
      <div class="my-6 overflow-x-auto">
        <table class="w-full text-sm">
          <caption class="text-gray-400 text-xs mb-2">
            <strong>Table 1.</strong> The lower bound on the
            number of active S-boxes in a
            differential/linear characteristic, for the full
            rounds (shown by the designers) and for the PSPN
            rounds (our results), for various versions of
            Poseidon.
          </caption>
          <thead>
            <tr class="border-b border-gray-700">
              <th class="px-3 py-2 text-left">Security Level</th>
              <th class="px-3 py-2 text-left">
                <span class="math">t</span></th>
              <th class="px-3 py-2 text-left">
                <span class="math">R_F</span></th>
              <th class="px-3 py-2 text-left">
                <span class="math">R_P</span></th>
              <th class="px-3 py-2 text-left">
                S-boxes in
                <span class="math">R_F</span></th>
              <th class="px-3 py-2 text-left">
                S-boxes in
                <span class="math">R_P</span></th>
              <th class="px-3 py-2 text-left">
                S-boxes in total</th>
            </tr>
          </thead>
          <tbody class="text-gray-300">
            <tr class="border-b border-gray-800">
              <td class="px-3 py-2">128</td>
              <td class="px-3 py-2">2</td>
              <td class="px-3 py-2">8</td>
              <td class="px-3 py-2">82</td>
              <td class="px-3 py-2">12</td>
              <td class="px-3 py-2">41</td>
              <td class="px-3 py-2">53</td>
            </tr>
            <tr class="border-b border-gray-800">
              <td class="px-3 py-2">128</td>
              <td class="px-3 py-2">4</td>
              <td class="px-3 py-2">8</td>
              <td class="px-3 py-2">83</td>
              <td class="px-3 py-2">20</td>
              <td class="px-3 py-2">36</td>
              <td class="px-3 py-2">56</td>
            </tr>
            <tr class="border-b border-gray-800">
              <td class="px-3 py-2">128</td>
              <td class="px-3 py-2">6</td>
              <td class="px-3 py-2">8</td>
              <td class="px-3 py-2">84</td>
              <td class="px-3 py-2">28</td>
              <td class="px-3 py-2">32</td>
              <td class="px-3 py-2">60</td>
            </tr>
            <tr class="border-b border-gray-800">
              <td class="px-3 py-2">256</td>
              <td class="px-3 py-2">8</td>
              <td class="px-3 py-2">8</td>
              <td class="px-3 py-2">127</td>
              <td class="px-3 py-2">36</td>
              <td class="px-3 py-2">42</td>
              <td class="px-3 py-2">78</td>
            </tr>
            <tr class="border-b border-gray-800">
              <td class="px-3 py-2">128</td>
              <td class="px-3 py-2">16</td>
              <td class="px-3 py-2">8</td>
              <td class="px-3 py-2">64</td>
              <td class="px-3 py-2">68</td>
              <td class="px-3 py-2">12</td>
              <td class="px-3 py-2">80</td>
            </tr>
          </tbody>
        </table>
      </div>

      <p class="text-gray-300">
        <strong>Analysis of Starkad.</strong> In the case of
        Starkad (which operates over a binary field
        <span class="math">\text&#123;GF&#125;(2^n)</span>),
        perhaps surprisingly, there is a significant
        difference between different values of
        <span class="math">t</span>. For
        <span class="math">t = 24</span> (which is the main
        reference variant), we show that there exists an
        invariant subspace
        <span class="math">U</span> of size
        <span class="math">2^&#123;18 \cdot 63&#125; = 2^&#123;1134&#125;</span>
        that does not activate the S-box in the PSPN rounds.
        This means that
        <span class="math">U</span> passes any number of
        PSPN rounds, without activating any S-box! On the
        other hand, for
        <span class="math">t = 47</span> and
        <span class="math">t = 51</span>, there are no
        <span class="math">t</span>-round differential or
        linear characteristics that do not activate any
        S-box.
      </p>

      <div class="formal-block formal-block-theorem">
        <div class="formal-block-title text-green-400">
          Theorem 1
        </div>
        <div class="formal-block-content">
          <p class="text-sm text-gray-300">
            Let
            <span class="math">\mathbb&#123;F&#125; = \text&#123;GF&#125;(2^n)</span>
            be a binary field. Let
            <span class="math">t = 2^k \cdot s</span> where
            <span class="math">s \in \mathbb&#123;N&#125;</span>.
            Let
            <span class="math">M</span> be a
            <span class="math">t</span>-by-<span class="math">t</span>
            Cauchy matrix over
            <span class="math">\mathbb&#123;F&#125;</span>
            constructed according to the Starkad
            specification. Then there exists a linear
            subspace
            <span class="math">U \subset \mathbb&#123;F&#125;^t</span>
            of dimension at least
            <span class="math">(1 - \frac&#123;k+1&#125;&#123;2^k&#125;)t</span>
            such that for any
            <span class="math">\ell \in \mathbb&#123;N&#125;</span>
            and for any
            <span class="math">x \in U</span>, the top
            <span class="math">n</span> bits of
            <span class="math">M^\ell x</span> are equal to
            zero. Consequently, application of any number of
            PSPN rounds to any
            <span class="math">x \in U</span> does not
            activate any S-box.
          </p>
        </div>
      </div>

      <p class="text-gray-300">
        Theorem 1 implies that for any
        <span class="math">t</span> that is divisible by 4,
        there is a huge subspace
        <span class="math">U</span> of size at least
        <span class="math">2^&#123;nt/4&#125;</span> that
        passes any number of PSPN rounds without activating
        any S-box.
      </p>

      <!-- Table 2 -->
      <div class="my-6 overflow-x-auto">
        <table class="w-full text-sm">
          <caption class="text-gray-400 text-xs mb-2">
            <strong>Table 2.</strong> The dimension of the
            invariant subspace whose elements do not activate
            S-boxes for any number of PSPN rounds, as a
            function of
            <span class="math">t</span>, for a Starkad
            cipher over the field
            <span class="math">\text&#123;GF&#125;(2^&#123;63&#125;)</span>.
          </caption>
          <thead>
            <tr class="border-b border-gray-700">
              <th class="px-3 py-2 text-left">
                <span class="math">t</span></th>
              <th class="px-3 py-2 text-left">Dim.</th>
              <th class="px-3 py-2 text-left">
                <span class="math">t</span></th>
              <th class="px-3 py-2 text-left">Dim.</th>
              <th class="px-3 py-2 text-left">
                <span class="math">t</span></th>
              <th class="px-3 py-2 text-left">Dim.</th>
            </tr>
          </thead>
          <tbody class="text-gray-300">
            <tr class="border-b border-gray-800">
              <td class="px-3 py-2">4</td>
              <td class="px-3 py-2">2</td>
              <td class="px-3 py-2">6</td>
              <td class="px-3 py-2">0</td>
              <td class="px-3 py-2">8</td>
              <td class="px-3 py-2">6</td>
            </tr>
            <tr class="border-b border-gray-800">
              <td class="px-3 py-2">10</td>
              <td class="px-3 py-2">0</td>
              <td class="px-3 py-2">13</td>
              <td class="px-3 py-2">0</td>
              <td class="px-3 py-2">16</td>
              <td class="px-3 py-2">14</td>
            </tr>
            <tr class="border-b border-gray-800">
              <td class="px-3 py-2">18</td>
              <td class="px-3 py-2">0</td>
              <td class="px-3 py-2">21</td>
              <td class="px-3 py-2">0</td>
              <td class="px-3 py-2">24</td>
              <td class="px-3 py-2">18</td>
            </tr>
            <tr class="border-b border-gray-800">
              <td class="px-3 py-2">28</td>
              <td class="px-3 py-2">14</td>
              <td class="px-3 py-2">32</td>
              <td class="px-3 py-2">30</td>
              <td class="px-3 py-2">42</td>
              <td class="px-3 py-2">0</td>
            </tr>
            <tr class="border-b border-gray-800">
              <td class="px-3 py-2">46</td>
              <td class="px-3 py-2">0</td>
              <td class="px-3 py-2">47</td>
              <td class="px-3 py-2">0</td>
              <td class="px-3 py-2">48</td>
              <td class="px-3 py-2">42</td>
            </tr>
            <tr class="border-b border-gray-800">
              <td class="px-3 py-2">50</td>
              <td class="px-3 py-2">0</td>
              <td class="px-3 py-2">51</td>
              <td class="px-3 py-2">0</td>
              <td class="px-3 py-2">52</td>
              <td class="px-3 py-2">26</td>
            </tr>
            <tr class="border-b border-gray-800">
              <td class="px-3 py-2">56</td>
              <td class="px-3 py-2">42</td>
              <td class="px-3 py-2">64</td>
              <td class="px-3 py-2">62</td>
              <td class="px-3 py-2">70</td>
              <td class="px-3 py-2">0</td>
            </tr>
          </tbody>
        </table>
      </div>

      <p class="text-gray-300">
        An especially notable case is Starkad variants with
        <span class="math">t = 2^k</span>. For such
        variants, we show that the MDS is essentially an
        <em>involution</em>.
      </p>

      <div class="formal-block formal-block-theorem">
        <div class="formal-block-title text-green-400">
          Theorem 2
        </div>
        <div class="formal-block-content">
          <p class="text-sm text-gray-300">
            Let
            <span class="math">\mathbb&#123;F&#125; = \text&#123;GF&#125;(2^n)</span>
            be a binary field, and let
            <span class="math">t = 2^k</span> for
            <span class="math">k \in \mathbb&#123;N&#125;</span>.
            Let
            <span class="math">M</span> be a
            <span class="math">t</span>-by-<span class="math">t</span>
            Cauchy matrix over
            <span class="math">\mathbb&#123;F&#125;</span>
            constructed according to the Starkad
            specification. Then
            <span class="math">M^2 = \alpha I</span>, where
            <span class="math">\alpha = \bigl(\sum_&#123;j=2^k&#125;^&#123;2^&#123;k+1&#125;-1&#125; j^&#123;-1&#125;\bigr)^2</span>.
            Consequently, there exists a linear subspace
            <span class="math">U \subset \mathbb&#123;F&#125;^t</span>
            of dimension at least
            <span class="math">t - 2</span> such that for
            any
            <span class="math">\ell \in \mathbb&#123;N&#125;</span>
            and for any
            <span class="math">x \in U</span>, the top
            <span class="math">n</span> bits of
            <span class="math">M^\ell x</span> are equal to
            zero.
          </p>
        </div>
      </div>

      <p class="text-gray-300">
        We obtain Theorems 1 and 2 via an extensive study of
        properties of Cauchy matrices over binary fields. As
        Cauchy matrices are widely used (e.g., for error
        correcting codes, see [RL89]), these linear-algebraic
        results are of independent interest.
      </p>
      <p class="text-gray-300">
        We show that the invariant subspaces can be used to
        mount a Gr&ouml;bner-basis preimage attack proposed
        by Beyne et al. [6, Sec. 6.2], and that for certain
        choices of the parameters, the resulting attack
        breaks the security claims of the hash function. On
        the other hand, our results show that this
        deficiency can be fixed easily: it is sufficient to
        choose a value of
        <span class="math">t</span> that is not divisible
        by 4 (see Table 2). Furthermore, various other mild
        changes (such as slightly altering the way in which
        the sequences
        <span class="math">\&#123;x_i\&#125;, \&#123;y_j\&#125;</span>
        used in the construction of the Cauchy matrix are
        selected) are also sufficient for avoiding the
        existence of an invariant subspace.
      </p>

      <h3 id="sec-1.3" class="text-xl font-semibold mt-8 mb-3">
        1.3 Practical Impact of Our Results and Subsequent
        Work
      </h3>
      <p class="text-gray-300">
        <strong>Our results for strong MDS matrices.</strong>
        The designers of Starkad and Poseidon accepted our
        results and included them in the amended security
        analysis presented in [GKK+19, updated version, Sec.
        5.4.1] and [GKR+21]. In particular, the authors agreed
        with our claim that as far as statistical attacks are
        concerned, several full rounds could be replaced by
        partial rounds without reducing the security claims.
        Nevertheless, they decided to not reduce the number
        of full rounds in the amended version, since the
        full rounds are advantageous over partial rounds also
        with respect to certain algebraic attacks, such as
        Gr&ouml;bner basis attacks.
      </p>
      <p class="text-gray-300">
        <strong>Our results for weak MDS matrices.</strong>
        Following our results, the designers of Starkad and
        Poseidon amended the design in such a way that
        invariant subspaces that pass an infinite number of
        PSPN rounds would not be possible. To this end, they
        adopted the amendments we proposed (and in
        particular, required
        <span class="math">t</span> to be odd), along with
        other amendments.
      </p>
      <p class="text-gray-300">
        In addition, the STARK-Friendly Hash Challenge [SW20]
        cryptanalytic committee used our results, alongside
        other results, to motivate their recommendation to
        remove Starkad from consideration in the challenge
        (see [4, Sec. 4]).
      </p>
      <p class="text-gray-300">
        <strong>Subsequent work.</strong> Motivated by our
        results, Grassi et al. [GRS20] presented a systematic
        study of linear layers for which the cipher admits
        an invariant subspace that passes all PSPN rounds
        for free. The results of the analysis were used to
        determine the requirements on the MDS matrix used in
        the amended variant of Starkad and Poseidon [GKK+19,
        updated version].
      </p>

      <h3 id="sec-1.4" class="text-xl font-semibold mt-8 mb-3">
        1.4 Organization of the Paper
      </h3>
      <p class="text-gray-300">
        This paper is organized as follows. We briefly
        describe the HADES construction and its
        instantiations, Starkad and Poseidon, in
        <a href="#sec-2">Section 2</a>. In
        <a href="#sec-3">Section 3</a> we present our
        results on variants of Poseidon. In
        <a href="#sec-4">Section 4</a> we explore a special
        class of matrices over binary fields and obtain the
        linear-algebraic results required for proving
        Theorems 1 and 2. In
        <a href="#sec-5">Section 5</a> we present our
        results on variants of Starkad, and in particular,
        prove Theorems 1 and 2. We conclude the paper with a
        discussion and open problems in
        <a href="#sec-6">Section 6</a>.
      </p>
    </section>

    <!-- ====================================================== -->
    <!-- 2. THE HADES CONSTRUCTION                              -->
    <!-- ====================================================== -->

    <section id="sec-2" class="mb-12">
      <h2 class="text-2xl font-bold mb-4">
        2 The HADES Construction
      </h2>
      <p class="text-gray-300">
        In this section we briefly describe the structure of
        a HADES permutation [GLR+20]. A block cipher /
        permutation designed according to the HADES strategy
        employs four types of operations:
      </p>
      <ol class="list-decimal list-inside text-gray-300
        space-y-2 my-4">
        <li>
          <strong>AddRoundKey</strong>, denoted by
          <span class="math">\text&#123;ARK&#125;(\cdot)</span>:
          a bitwise XOR of a round subkey (or a round
          constant for unkeyed designs) with the state;
        </li>
        <li>
          <strong>Full S-box Layer</strong>, denoted by
          <span class="math">S(\cdot)</span>: parallel
          application of
          <span class="math">t</span> copies of an identical
          S-box to the entire state;
        </li>
        <li>
          <strong>Partial S-box Layer</strong>, denoted by
          <span class="math">S^*(\cdot)</span>: application
          of a single S-box to a part of the state, while
          the rest of the state remains unchanged;
        </li>
        <li>
          <strong>Mixing Layer</strong>, denoted by
          <span class="math">M(\cdot)</span>: multiplication
          of the entire state by an MDS matrix.
        </li>
      </ol>
      <p class="text-gray-300">
        A full round is defined as
        <span class="math">M \circ S \circ \text&#123;ARK&#125;(\cdot)</span>,
        and a partial round is defined as
        <span class="math">M \circ S^* \circ \text&#123;ARK&#125;(\cdot)</span>.
        The cipher consists of
        <span class="math">R_f</span> full rounds, followed
        by
        <span class="math">R_P</span> partial rounds,
        followed by
        <span class="math">R_f</span> full rounds, where
        the parameters
        <span class="math">R_P, R_f</span> are chosen by a
        complex rule intended mainly to thwart algebraic
        attacks.
      </p>
      <p class="text-gray-300">
        In this paper, we study the Poseidon and Starkad
        permutations [10], built according to the HADES
        design strategy. Poseidon works over a finite field
        <span class="math">\text&#123;GF&#125;(p)</span>,
        while Starkad works over a binary field
        <span class="math">\text&#123;GF&#125;(2^n)</span>.
        Starkad uses only the S-box
        <span class="math">S(x) = x^3</span>, while
        Poseidon uses also
        <span class="math">x^&#123;-1&#125;</span> and
        <span class="math">x^5</span>. For our purposes,
        the choice of the S-box is not relevant.
      </p>
      <p class="text-gray-300">
        The block ciphers are parameterized by
        <span class="math">R_P, R_f</span> (as in HADES),
        <span class="math">n</span>&mdash;the logarithm of
        the field size, and
        <span class="math">t</span>&mdash;the number of
        S-boxes applied in each full round.
      </p>
      <p class="text-gray-300">
        <strong>The MDS matrix.</strong> The design component
        on which we focus is the MDS matrix used in the
        linear layer. In the case of a binary field
        <span class="math">\text&#123;GF&#125;(2^n)</span>,
        the matrix is a so-called Cauchy matrix, constructed
        as follows. First, a constant
        <span class="math">r</span> is chosen. Then, one
        sets up two sequences
        <span class="math">\&#123;x_i\&#125;</span>,
        <span class="math">\&#123;y_j\&#125;</span> of
        length <span class="math">t</span>, by choosing a
        starting point
        <span class="math">x_0</span> and setting
      </p>
      <div class="math-block">
        \forall i \in [t] : x_i \triangleq x_0 + i - 1,
        \quad y_i \triangleq x_i + r,
      </div>
      <p class="text-gray-300">
        where <span class="math">+</span> denotes integer
        addition. The
        <span class="math">t</span>-by-<span class="math">t</span>
        MDS matrix
        <span class="math">M</span> is set as
      </p>
      <div class="math-block">
        M_&#123;i,j&#125; = (x_i \oplus y_j)^&#123;-1&#125;,
      </div>
      <p class="text-gray-300">
        where the inversion is taken in the field
        <span class="math">\text&#123;GF&#125;(2^n)</span>.
        In all Starkad variants presented in [GKK+19], the
        parameters
        <span class="math">x_0, r</span> are set to
        <span class="math">0, t</span>, respectively.
      </p>
    </section>

    <!-- ====================================================== -->
    <!-- 3. IMPROVED SECURITY BOUNDS FOR POSEIDON               -->
    <!-- ====================================================== -->

    <section id="sec-3" class="mb-12">
      <h2 class="text-2xl font-bold mb-4">
        3 Improved Security Bounds for Poseidon
        Permutations
      </h2>
      <p class="text-gray-300">
        In this section we show that the lower bounds on the
        number of active S-boxes in a differential or a
        linear characteristic obtained by the designers of
        Poseidon, can be improved significantly by taking
        into consideration active S-boxes in PSPN rounds and
        lower bounding their number.
      </p>
      <p class="text-gray-300">
        In order to lower-bound the number of active
        S-boxes, we use a generic characteristic search
        algorithm for PSPNs, presented by Bar-On et al. [BDD+15]
        at Eurocrypt 2015. For a parameter
        <span class="math">a</span>, the algorithm allows
        computing the (provably) minimal number
        <span class="math">r</span> of rounds such that any
        <span class="math">r</span>-round
        differential/linear characteristic must activate at
        least
        <span class="math">a + 1</span> S-boxes.
      </p>
      <p class="text-gray-300">
        For
        <span class="math">t = 2</span>, the algorithm is
        not needed. Indeed, the MDS property of the matrix
        guarantees that both S-boxes are active every second
        round, and hence, the lower bound on the number of
        active S-boxes in an
        <span class="math">r</span>-round characteristic
        is at least
        <span class="math">r/2</span>. The
        <span class="math">t = 2</span> variant of Poseidon
        has 82 PSPN rounds, and thus, any characteristic
        over the PSPN rounds has at least 41 active S-boxes.
        Interestingly, the lower bound obtained by the
        designers using the wide trail strategy is much
        lower&mdash;only 12 active S-boxes.
      </p>
      <p class="text-gray-300">
        For
        <span class="math">t = 6</span>, which is the main
        variant proposed by the designers, we were able to
        run the algorithm up to
        <span class="math">a = 8</span>, showing that there
        is no characteristic with at most 8 active S-boxes
        for 22 rounds. As this variant of Poseidon contains
        84 partial rounds, our result implies that any
        characteristic for the PSPN rounds of Poseidon
        activates at least 32 S-boxes. This number is higher
        than the lower bound proved by the
        designers&mdash;28 active S-boxes in the SPN rounds.
        Combining the bounds, we obtain a provable lower
        bound of 60 active S-boxes for the entire cipher,
        more than doubling the bound proved by the
        designers.
      </p>
      <p class="text-gray-300">
        For large values of
        <span class="math">t</span> (e.g.,
        <span class="math">t = 16</span>), the lower bound
        that follows from the wide trail strategy becomes
        much more effective, and on the other hand, the
        number of PSPN rounds is reduced. As a result, our
        lower bound for the PSPN rounds is less effective
        for these variants.
      </p>
      <p class="text-gray-300">
        It should be emphasized that for all variants and for
        all values of
        <span class="math">a</span> we were able to check,
        the minimal number of rounds for which any
        characteristic must activate at least
        <span class="math">a + 1</span> S-boxes is
        <span class="math">t + 2a</span>&mdash;matching
        exactly the generic estimate of [BDD+15]. This suggests
        that in this respect, the MDS matrices of all
        Poseidon variants achieve the effect of
        &lsquo;random&rsquo; matrices.
      </p>

      <!-- Table 3 -->
      <div class="my-6 overflow-x-auto">
        <table class="w-full text-sm">
          <caption class="text-gray-400 text-xs mb-2">
            <strong>Table 3.</strong> Lower bounds on the
            number of active S-boxes in a differential or
            linear characteristic over the PSPN rounds, for
            variants of Poseidon.
          </caption>
          <thead>
            <tr class="border-b border-gray-700">
              <th class="px-3 py-2 text-left">Security</th>
              <th class="px-3 py-2 text-left">
                <span class="math">t</span></th>
              <th class="px-3 py-2 text-left">
                <span class="math">R_F</span></th>
              <th class="px-3 py-2 text-left">
                <span class="math">R_P</span></th>
              <th class="px-3 py-2 text-left">Field</th>
              <th class="px-3 py-2 text-left">
                <span class="math">a</span></th>
              <th class="px-3 py-2 text-left">
                S-boxes in
                <span class="math">R_f</span></th>
              <th class="px-3 py-2 text-left">
                S-boxes in
                <span class="math">R_P</span></th>
              <th class="px-3 py-2 text-left">Total</th>
            </tr>
          </thead>
          <tbody class="text-gray-300">
            <tr class="border-b border-gray-800">
              <td class="px-3 py-2">128</td>
              <td class="px-3 py-2">2</td>
              <td class="px-3 py-2">8</td>
              <td class="px-3 py-2">82</td>
              <td class="px-3 py-2">
                <span class="math">\text&#123;GF&#125;(p)</span></td>
              <td class="px-3 py-2">&ndash;</td>
              <td class="px-3 py-2">12</td>
              <td class="px-3 py-2">41</td>
              <td class="px-3 py-2">53</td>
            </tr>
            <tr class="border-b border-gray-800">
              <td class="px-3 py-2">128</td>
              <td class="px-3 py-2">4</td>
              <td class="px-3 py-2">8</td>
              <td class="px-3 py-2">83</td>
              <td class="px-3 py-2">
                <span class="math">\text&#123;GF&#125;(p)</span></td>
              <td class="px-3 py-2">12</td>
              <td class="px-3 py-2">20</td>
              <td class="px-3 py-2">36</td>
              <td class="px-3 py-2">56</td>
            </tr>
            <tr class="border-b border-gray-800">
              <td class="px-3 py-2">128</td>
              <td class="px-3 py-2">6</td>
              <td class="px-3 py-2">8</td>
              <td class="px-3 py-2">84</td>
              <td class="px-3 py-2">
                <span class="math">\text&#123;GF&#125;(p)</span></td>
              <td class="px-3 py-2">8</td>
              <td class="px-3 py-2">28</td>
              <td class="px-3 py-2">32</td>
              <td class="px-3 py-2">60</td>
            </tr>
            <tr class="border-b border-gray-800">
              <td class="px-3 py-2">256</td>
              <td class="px-3 py-2">8</td>
              <td class="px-3 py-2">8</td>
              <td class="px-3 py-2">127</td>
              <td class="px-3 py-2">
                <span class="math">\text&#123;GF&#125;(p)</span></td>
              <td class="px-3 py-2">7</td>
              <td class="px-3 py-2">36</td>
              <td class="px-3 py-2">42</td>
              <td class="px-3 py-2">78</td>
            </tr>
            <tr class="border-b border-gray-800">
              <td class="px-3 py-2">128</td>
              <td class="px-3 py-2">16</td>
              <td class="px-3 py-2">8</td>
              <td class="px-3 py-2">64</td>
              <td class="px-3 py-2">
                <span class="math">\text&#123;GF&#125;(p)</span></td>
              <td class="px-3 py-2">5</td>
              <td class="px-3 py-2">68</td>
              <td class="px-3 py-2">12</td>
              <td class="px-3 py-2">80</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- ====================================================== -->
    <!-- 4. A CLASS OF MATRICES OVER A BINARY FIELD             -->
    <!-- ====================================================== -->

    <section id="sec-4" class="mb-12">
      <h2 class="text-2xl font-bold mb-4">
        4 A Class of Matrices over a Binary Field and its
        Properties
      </h2>
      <p class="text-gray-300">
        In this section we study the properties of a certain
        class of matrices over commutative rings with
        characteristic 2 (e.g., binary fields
        <span class="math">\text&#123;GF&#125;(2^n)</span>).
        As we will show in
        <a href="#sec-5">Section 5</a>, the MDS matrix used
        in Starkad belongs to this class (for all variants
        of Starkad), and thus, the results of this section
        will allow us to study the security of the middle
        layer of Starkad constructions.
      </p>

      <h3 id="sec-4.1" class="text-xl font-semibold mt-8 mb-3">
        4.1 Special Matrices and Their Basic Properties
      </h3>

      <div class="formal-block formal-block-definition">
        <div class="formal-block-title text-blue-400">
          Definition 1 (Special Matrix)
        </div>
        <div class="formal-block-content">
          <p class="text-sm text-gray-300">
            For
            <span class="math">k=0</span>, any
            <span class="math">1 \times 1</span> matrix over
            <span class="math">R</span> is a special matrix.
            For
            <span class="math">k \geq 1</span>, a matrix
            <span class="math">M \in R^&#123;2^k \times 2^k&#125;</span>
            is a special matrix if
            <span class="math">M = \begin&#123;bmatrix&#125; A &amp; B \\ B &amp; A \end&#123;bmatrix&#125;</span>,
            where
            <span class="math">A</span> and
            <span class="math">B</span> are special
            matrices.
          </p>
        </div>
      </div>

      <div class="formal-block formal-block-proposition">
        <div class="formal-block-title text-violet-400">
          Proposition 1
        </div>
        <div class="formal-block-content">
          <p class="text-sm text-gray-300">
            Let
            <span class="math">R</span> be a ring, let
            <span class="math">k \geq 0</span>, and let
            <span class="math">S_k</span> be the set of all
            <span class="math">2^k \times 2^k</span> special
            matrices over
            <span class="math">R</span>. Then
            <span class="math">S_k</span> is a commutative
            subring of
            <span class="math">R^&#123;2^k \times 2^k&#125;</span>.
          </p>
        </div>
      </div>

      <p class="text-gray-300">
        <em>Proof.</em> We have to show that for any
        <span class="math">k \geq 0</span>, if
        <span class="math">M_1, M_2 \in R^&#123;2^k \times 2^k&#125;</span>
        are special matrices, then (1)
        <span class="math">-M_1</span>,
        <span class="math">M_1 + M_2</span>, and
        <span class="math">M_1 \cdot M_2</span> are special
        matrices; (2)
        <span class="math">M_1</span> and
        <span class="math">M_2</span> commute.
      </p>
      <p class="text-gray-300">
        The proof is a simple induction on
        <span class="math">k</span>. For
        <span class="math">k = 0</span> the claim is
        obvious. For
        <span class="math">k > 0</span>, assume the claim
        holds for
        <span class="math">k - 1</span>, and let
      </p>
      <div class="math-block">
        M_1 = \begin&#123;bmatrix&#125; A &amp; B \\ B &amp; A \end&#123;bmatrix&#125;, \quad
        M_2 = \begin&#123;bmatrix&#125; C &amp; D \\ D &amp; C \end&#123;bmatrix&#125;
      </div>
      <p class="text-gray-300">
        be
        <span class="math">2^k \times 2^k</span> special
        matrices. We have
        <span class="math">M_1 + M_2 = \begin&#123;bmatrix&#125; A+C &amp; B+D \\ B+D &amp; A+C \end&#123;bmatrix&#125;</span>.
        As by the induction hypothesis,
        <span class="math">A+C</span> and
        <span class="math">B+D</span> are special matrices,
        <span class="math">M_1 + M_2</span> is a special
        matrix as well. Similarly, for any
        <span class="math">c \in R</span>,
        <span class="math">c \cdot M_1</span> is a special
        matrix.
      </p>
      <p class="text-gray-300">
        Furthermore, we have
      </p>
      <div class="math-block">
        M_1 \cdot M_2 = \begin&#123;bmatrix&#125;
          AC + BD &amp; AD + BC \\
          AD + BC &amp; AC + BD
        \end&#123;bmatrix&#125; = \begin&#123;bmatrix&#125;
          X &amp; Y \\ Y &amp; X
        \end&#123;bmatrix&#125;,
      </div>
      <p class="text-gray-300">
        where
        <span class="math">X = AC + BD</span> and
        <span class="math">Y = AD + BC</span>. By the
        induction hypothesis
        <span class="math">X</span> and
        <span class="math">Y</span> are special matrices,
        and thus,
        <span class="math">M_1 \cdot M_2</span> is a
        special matrix as well. To show that special
        matrices commute, we first observe that they are
        symmetric, i.e.,
        <span class="math">M_1^T = M_1</span> (by induction
        on <span class="math">k</span>). Then
        <span class="math">M_1 \cdot M_2 = (M_1 \cdot M_2)^T = M_2^T \cdot M_1^T = M_2 \cdot M_1</span>.
        <span class="math">\square</span>
      </p>

      <h3 id="sec-4.2" class="text-xl font-semibold mt-8 mb-3">
        4.2 Special Matrices over Commutative Rings of
        Characteristic 2
      </h3>

      <div class="formal-block formal-block-proposition">
        <div class="formal-block-title text-violet-400">
          Proposition 2
        </div>
        <div class="formal-block-content">
          <p class="text-sm text-gray-300">
            Let
            <span class="math">R</span> be a commutative
            ring of characteristic 2, let
            <span class="math">k \in \mathbb&#123;N&#125; \cup \&#123;0\&#125;</span>,
            and let
            <span class="math">M \in R^&#123;2^k \times 2^k&#125;</span>
            be a special matrix. Then:
          </p>
          <ol class="list-decimal list-inside text-sm
            text-gray-300 space-y-1 my-2">
            <li>
              <span class="math">M</span> has exactly one
              eigenvalue, which is the sum of elements in
              each of its rows. Consequently, the
              characteristic polynomial of
              <span class="math">M</span> is
              <span class="math">f_M(x) = (x - \lambda(M))^&#123;2^k&#125;</span>,
              and
              <span class="math">\det(M) = \lambda(M)^&#123;2^k&#125;</span>.
            </li>
            <li>
              We have
              <span class="math">M^2 = \lambda(M)^2 \cdot I</span>.
            </li>
          </ol>
        </div>
      </div>

      <p class="text-gray-300">
        <em>Proof.</em> By induction on
        <span class="math">k</span>. For
        <span class="math">k = 0</span> the claim is
        obvious. For
        <span class="math">k > 0</span>, let
        <span class="math">M = \begin&#123;bmatrix&#125; A &amp; B \\ B &amp; A \end&#123;bmatrix&#125;</span>.
        The characteristic polynomial satisfies
      </p>
      <div class="math-block">
        f_M(\lambda)
          = \det(\lambda I - A + B) \cdot \det(\lambda I - A - B)
          = \det(\lambda I - (A+B))^2
          = f_&#123;A+B&#125;(\lambda)^2.
      </div>
      <p class="text-gray-300">
        Since
        <span class="math">A + B</span> is a special
        matrix, the induction hypothesis gives
        <span class="math">f_M(x) = (x - \lambda(A+B))^&#123;2^k&#125;</span>.
        For part (2), since
        <span class="math">\text&#123;char&#125;(R) = 2</span>
        and special matrices commute, we have
      </p>
      <div class="math-block">
        M^2 = \begin&#123;bmatrix&#125; A^2 + B^2 &amp; 0 \\
          0 &amp; A^2 + B^2 \end&#123;bmatrix&#125;
        = \begin&#123;bmatrix&#125; (A+B)^2 &amp; 0 \\
          0 &amp; (A+B)^2 \end&#123;bmatrix&#125;
        = \lambda(M)^2 \cdot I.
        \quad \square
      </div>

      <div class="formal-block formal-block-proposition">
        <div class="formal-block-title text-violet-400">
          Proposition 3
        </div>
        <div class="formal-block-content">
          <p class="text-sm text-gray-300">
            Let
            <span class="math">R</span> be a commutative
            ring of characteristic 2, let
            <span class="math">k \in \mathbb&#123;N&#125; \cup \&#123;0\&#125;</span>,
            and let
            <span class="math">M_1, M_2 \in R^&#123;2^k \times 2^k&#125;</span>
            be special matrices. Then
            (1)
            <span class="math">\det(M_1 + M_2) = \det(M_1) + \det(M_2)</span>;
            (2)
            <span class="math">\lambda(M_1 + M_2) = \lambda(M_1) + \lambda(M_2)</span>;
            (3)
            <span class="math">\lambda(M_1 \cdot M_2) = \lambda(M_1) \cdot \lambda(M_2)</span>.
          </p>
        </div>
      </div>

      <h3 id="sec-4.3" class="text-xl font-semibold mt-8 mb-3">
        4.3 Nilpotent Special Matrices over Commutative
        Rings with Characteristic 2
      </h3>
      <p class="text-gray-300">
        In this subsection we consider the subring
        <span class="math">N_k</span> of
        <span class="math">S_k</span> which consists of the
        special matrices
        <span class="math">M</span> that are nilpotent
        (i.e.,
        <span class="math">N_k = \&#123;M \in S_k : \exists\, t,\; M^t = 0\&#125;</span>).
        By Proposition 2,
        <span class="math">N_k</span> has a simple
        characterization:
        <span class="math">N_k = \&#123;M \in S_k : \lambda(M) = 0\&#125;</span>.
        We aim at showing that the product of any
        <span class="math">k+1</span> matrices in
        <span class="math">N_k</span> equals zero.
      </p>

      <div class="formal-block formal-block-definition">
        <div class="formal-block-title text-blue-400">
          Definition 2 (Star Operator)
        </div>
        <div class="formal-block-content">
          <p class="text-sm text-gray-300">
            For any
            <span class="math">k \geq 1</span>, the
            operator
            <span class="math">* : S_k \to S_&#123;k-1&#125;</span>
            is defined as follows. For any special matrix
            <span class="math">M = \begin&#123;bmatrix&#125; A &amp; B \\ B &amp; A \end&#123;bmatrix&#125; \in S_k</span>,
            we define
            <span class="math">M^* = A + B</span>.
          </p>
        </div>
      </div>

      <div class="formal-block formal-block-proposition">
        <div class="formal-block-title text-violet-400">
          Proposition 4
        </div>
        <div class="formal-block-content">
          <p class="text-sm text-gray-300">
            Let
            <span class="math">M_1, M_2 \in S_k</span> for
            some
            <span class="math">k \geq 1</span>. We have:
            (1)
            <span class="math">(M_1 + M_2)^* = M_1^* + M_2^*</span>;
            (2)
            <span class="math">(M_1 \cdot M_2)^* = M_1^* \cdot M_2^*</span>;
            (3)
            <span class="math">\lambda(M_1^*) = \lambda(M_1)</span>.
          </p>
        </div>
      </div>

      <div class="formal-block formal-block-definition">
        <div class="formal-block-title text-blue-400">
          Definition 3 (Depth-<span class="math">\ell</span>
          Zero)
        </div>
        <div class="formal-block-content">
          <p class="text-sm text-gray-300">
            For
            <span class="math">\ell = 0</span> and for any
            <span class="math">k \in \mathbb&#123;N&#125;</span>,
            a matrix
            <span class="math">M \in S_k</span> is a
            depth-0 zero if and only if
            <span class="math">\lambda(M) = 0</span>.
          </p>
          <p class="text-sm text-gray-300">
            For any
            <span class="math">\ell, k</span> such that
            <span class="math">\ell \geq k</span>, a matrix
            <span class="math">M \in S_k</span> is a
            depth-<span class="math">\ell</span> zero if and
            only if it is the zero matrix.
          </p>
          <p class="text-sm text-gray-300">
            For all
            <span class="math">k > \ell \geq 1</span>, a
            matrix
            <span class="math">M = \begin&#123;bmatrix&#125; A &amp; B \\ B &amp; A \end&#123;bmatrix&#125; \in S_k</span>
            is a
            depth-<span class="math">\ell</span> zero if:
            (1)
            <span class="math">A</span> and
            <span class="math">B</span> are
            depth-<span class="math">(\ell-1)</span> zeros,
            and (2)
            <span class="math">M^* = A + B</span> is a
            depth-<span class="math">\ell</span> zero.
          </p>
        </div>
      </div>

      <div class="formal-block formal-block-proposition">
        <div class="formal-block-title text-violet-400">
          Proposition 5
        </div>
        <div class="formal-block-content">
          <p class="text-sm text-gray-300">
            Let
            <span class="math">M_1, M_2 \in S_k</span> be
            special matrices over a commutative ring
            <span class="math">R</span> with characteristic
            2 that are
            depth-<span class="math">\ell</span> zeros, and
            let
            <span class="math">c \in R</span>. Then
            <span class="math">c \cdot M_1</span> and
            <span class="math">M_1 + M_2</span> are
            depth-<span class="math">\ell</span> zeros as
            well.
          </p>
        </div>
      </div>

      <div class="formal-block formal-block-proposition">
        <div class="formal-block-title text-violet-400">
          Proposition 6
        </div>
        <div class="formal-block-content">
          <p class="text-sm text-gray-300">
            Let
            <span class="math">M, L \in S_k</span> be
            special matrices over a commutative ring
            <span class="math">R</span> with characteristic
            2, and assume that (1)
            <span class="math">M</span> is a
            depth-<span class="math">\ell</span> zero for
            some
            <span class="math">\ell &lt; k</span>; (2)
            <span class="math">L</span> is a depth-0 zero.
            Then
            <span class="math">M \cdot L</span> is a
            depth-<span class="math">(\ell + 1)</span> zero.
          </p>
        </div>
      </div>

      <div class="formal-block formal-block-proposition">
        <div class="formal-block-title text-violet-400">
          Proposition 7
        </div>
        <div class="formal-block-content">
          <p class="text-sm text-gray-300">
            Let
            <span class="math">M_1, \ldots, M_&#123;k+1&#125;</span>
            be
            <span class="math">2^k</span>-by-<span class="math">2^k</span>
            nilpotent special matrices over a commutative
            ring
            <span class="math">R</span> with characteristic
            2. Then
          </p>
          <div class="math-block">
            \prod_&#123;i=1&#125;^&#123;k+1&#125; M_i = 0.
          </div>
        </div>
      </div>

      <p class="text-gray-300">
        <em>Proof.</em> By applying Proposition 6 on the
        sequence of products
        <span class="math">P_j = \prod_&#123;i=1&#125;^j M_i</span>,
        we deduce that for all
        <span class="math">j \geq 1</span>,
        <span class="math">P_j</span> is a
        depth-<span class="math">(j-1)</span> zero. In
        particular,
        <span class="math">P_&#123;k+1&#125;</span> is a
        depth-<span class="math">k</span> zero, which means
        that it is the zero matrix by the definition of zero
        depth.
        <span class="math">\square</span>
      </p>

      <h3 id="sec-4.4" class="text-xl font-semibold mt-8 mb-3">
        4.4 Block Matrices with Special Blocks
      </h3>
      <p class="text-gray-300">
        In this subsection we consider
        <span class="math">s</span>-by-<span class="math">s</span>
        block matrices over a commutative ring
        <span class="math">R</span> with characteristic 2,
        in which each block is a special
        <span class="math">2^k</span>-by-<span class="math">2^k</span>
        matrix. We aim at showing that the
        <em>minimal polynomial</em> of any such matrix is of
        degree at most
        <span class="math">s(k+1)</span>.
      </p>

      <div class="formal-block formal-block-theorem">
        <div class="formal-block-title text-green-400">
          Theorem 3
        </div>
        <div class="formal-block-content">
          <p class="text-sm text-gray-300">
            Let
            <span class="math">\ell, m \in \mathbb&#123;N&#125;</span>.
            Let
            <span class="math">R</span> be a commutative
            ring and let
            <span class="math">S</span> be a commutative
            subring of
            <span class="math">R^&#123;\ell \times \ell&#125;</span>.
            Let
            <span class="math">X \in S^&#123;m \times m&#125;</span>
            be an
            <span class="math">m</span>-by-<span class="math">m</span>
            block matrix over
            <span class="math">R</span> with
            <span class="math">\ell</span>-by-<span class="math">\ell</span>
            blocks in
            <span class="math">S</span>. Then
            <span class="math">\det_R(X) = \det_R(\det_S(X))</span>.
          </p>
        </div>
      </div>

      <div class="formal-block formal-block-proposition">
        <div class="formal-block-title text-violet-400">
          Proposition 8
        </div>
        <div class="formal-block-content">
          <p class="text-sm text-gray-300">
            Let
            <span class="math">k, s \in \mathbb&#123;N&#125;</span>.
            Let
            <span class="math">R</span> be a commutative
            ring with characteristic 2, and let
            <span class="math">M</span> be an
            <span class="math">s</span>-by-<span class="math">s</span>
            block matrix over
            <span class="math">R</span>, each of whose
            blocks is a
            <span class="math">2^k</span>-by-<span class="math">2^k</span>
            special matrix. Denote the blocks by
            <span class="math">\&#123;M_&#123;i,j&#125;\&#125;</span>.
            Let
            <span class="math">M' \in R^&#123;s \times s&#125;</span>
            be defined by
            <span class="math">M'_&#123;i,j&#125; = \det(M_&#123;i,j&#125;)</span>.
            Then
            <span class="math">\det(M) = \det(M')</span>.
          </p>
        </div>
      </div>

      <div class="formal-block formal-block-proposition">
        <div class="formal-block-title text-violet-400">
          Proposition 9
        </div>
        <div class="formal-block-content">
          <p class="text-sm text-gray-300">
            Let
            <span class="math">k, s \in \mathbb&#123;N&#125;</span>.
            Let
            <span class="math">R</span> be a commutative
            ring with characteristic 2, and let
            <span class="math">M</span> be an
            <span class="math">s</span>-by-<span class="math">s</span>
            block matrix whose blocks are
            <span class="math">2^k</span>-by-<span class="math">2^k</span>
            special matrices. Let
            <span class="math">M'' \in R^&#123;s \times s&#125;</span>
            be defined by
            <span class="math">M''_&#123;i,j&#125; = \lambda(M_&#123;i,j&#125;)</span>.
            Denote by
            <span class="math">p(x) = f_M(x)</span> and
            <span class="math">q(x) = f_&#123;M''&#125;(x)</span>
            the characteristic polynomials of
            <span class="math">M</span> and
            <span class="math">M''</span>, respectively.
            Then
            <span class="math">p(x) = q(x)^&#123;2^k&#125;</span>.
          </p>
        </div>
      </div>

      <div class="formal-block formal-block-proposition">
        <div class="formal-block-title text-violet-400">
          Proposition 10
        </div>
        <div class="formal-block-content">
          <p class="text-sm text-gray-300">
            Let
            <span class="math">k, s \in \mathbb&#123;N&#125;</span>.
            Let
            <span class="math">R</span> be a commutative
            ring with characteristic 2, and let
            <span class="math">M</span> be an
            <span class="math">s</span>-by-<span class="math">s</span>
            block matrix whose blocks are
            <span class="math">2^k</span>-by-<span class="math">2^k</span>
            special matrices. Let
            <span class="math">M''</span> and
            <span class="math">q(x) = f_&#123;M''&#125;(x)</span>
            be as in Proposition 9. Then
            <span class="math">q(M)^&#123;k+1&#125; = 0</span>.
          </p>
        </div>
      </div>

      <p class="text-gray-300">
        <em>Proof.</em> First, we claim that
        <span class="math">q(M)</span> is a block matrix
        whose blocks are <em>nilpotent</em> special
        matrices. Indeed, by Proposition 3,
        <span class="math">\lambda(q(M)_&#123;i,j&#125;) = (q(M''))_&#123;i,j&#125; = 0</span>,
        where the last equality holds by the Cayley&ndash;Hamilton
        theorem. Now, by Proposition 7, each block of
        <span class="math">q(M)^&#123;k+1&#125;</span> is a
        sum of products of
        <span class="math">k+1</span> nilpotent
        <span class="math">2^k</span>-by-<span class="math">2^k</span>
        special matrices, hence each product is the zero
        matrix, and thus
        <span class="math">q(M)^&#123;k+1&#125; = 0</span>.
        <span class="math">\square</span>
      </p>

      <h3 id="sec-4.5" class="text-xl font-semibold mt-8 mb-3">
        4.5 A Stronger Conjectured Bound
      </h3>

      <div class="formal-block formal-block-definition">
        <div class="formal-block-title text-blue-400">
          Conjecture 1
        </div>
        <div class="formal-block-content">
          <p class="text-sm text-gray-300">
            Let
            <span class="math">k, s \in \mathbb&#123;N&#125;</span>.
            Let
            <span class="math">R</span> be a commutative
            ring with characteristic 2, and let
            <span class="math">M</span> be an
            <span class="math">s</span>-by-<span class="math">s</span>
            block matrix whose blocks are
            <span class="math">2^k</span>-by-<span class="math">2^k</span>
            special matrices. Let
            <span class="math">q(x) = f_&#123;M''&#125;(x)</span>
            be as in Proposition 10. Then
            <span class="math">q(M)^2 = 0</span>.
          </p>
        </div>
      </div>

      <p class="text-gray-300">
        We proved this conjecture for
        <span class="math">s = 2</span> by a direct
        computation, and verified it experimentally for many
        values of
        <span class="math">t</span>, over various binary
        fields. In particular, it matches all sizes of
        invariant subspaces presented in Table 2.
      </p>
    </section>

    <!-- ====================================================== -->
    <!-- 5. A LARGE INVARIANT SUBSPACE IN STARKAD               -->
    <!-- ====================================================== -->

    <section id="sec-5" class="mb-12">
      <h2 class="text-2xl font-bold mb-4">
        5 A Large Invariant Subspace in the Middle Layer of
        Starkad Permutations
      </h2>
      <p class="text-gray-300">
        In this section we apply the results on special
        matrices obtained in
        <a href="#sec-4">Section 4</a> to show that for many
        choices of
        <span class="math">t</span>, the Starkad permutation
        admits a huge invariant subspace that allows
        bypassing any number of PSPN rounds without
        activating any S-box. We then explain how the
        invariant subspace can be used to mount a
        Gr&ouml;bner basis preimage attack on Starkad, and
        subsequently show that these invariant subspaces can
        be easily avoided.
      </p>

      <h3 id="sec-5.1" class="text-xl font-semibold mt-8 mb-3">
        5.1 The Starkad MDS and Special Matrices
      </h3>

      <div class="formal-block formal-block-proposition">
        <div class="formal-block-title text-violet-400">
          Proposition 11
        </div>
        <div class="formal-block-content">
          <p class="text-sm text-gray-300">
            Let
            <span class="math">M \in \text&#123;GF&#125;(2^n)^&#123;2^k \times 2^k&#125;</span>
            be a Cauchy matrix generated from the sequences
            <span class="math">\&#123;x_i\&#125;, \&#123;y_j\&#125;</span>,
            where for each
            <span class="math">1 \leq i \leq 2^k</span>, we
            have
            <span class="math">x_i = i - 1</span> and
            <span class="math">y_i = x_i + r</span>
            (integer summation), for some
            <span class="math">r</span> such that
            <span class="math">2^k \mid r</span>. Then
            <span class="math">M</span> is a special matrix.
          </p>
        </div>
      </div>

      <p class="text-gray-300">
        <strong>Corollary 1.</strong> For any
        <span class="math">t = 2^k</span>, the MDS in
        Starkad with
        <span class="math">t</span> S-boxes in each SPN
        round is a special matrix.
      </p>

      <div class="formal-block formal-block-proposition">
        <div class="formal-block-title text-violet-400">
          Proposition 12
        </div>
        <div class="formal-block-content">
          <p class="text-sm text-gray-300">
            Let
            <span class="math">t = 2^k \cdot s</span>, for
            <span class="math">k \geq 0</span> and
            <span class="math">s \geq 1</span>. Let
            <span class="math">M \in \text&#123;GF&#125;(2^n)^&#123;t \times t&#125;</span>
            be a Cauchy matrix generated from the sequences
            <span class="math">\&#123;x_i\&#125;, \&#123;y_j\&#125;</span>,
            where for each
            <span class="math">1 \leq i \leq 2^k</span>, we
            have
            <span class="math">x_i = i - 1</span> and
            <span class="math">y_i = x_i + r</span>
            (integer summation), for some
            <span class="math">r</span> such that
            <span class="math">2^k \mid r</span>. Then
            <span class="math">M</span> is an
            <span class="math">s \times s</span> block
            matrix of
            <span class="math">2^k \times 2^k</span>
            special matrices.
          </p>
        </div>
      </div>

      <p class="text-gray-300">
        <strong>Corollary 2.</strong> For any
        <span class="math">t = 2^k \cdot s</span>, the MDS
        in Starkad with
        <span class="math">t</span> S-boxes in each SPN
        round is an
        <span class="math">s</span>-by-<span class="math">s</span>
        block matrix, each of whose blocks is a special
        matrix.
      </p>

      <h3 id="sec-5.2" class="text-xl font-semibold mt-8 mb-3">
        5.2 A Large Invariant Subspace in Starkad with
        <span class="math">4\ell</span> S-Boxes in Each
        Full Round
      </h3>

      <p class="text-gray-300">
        <em>Proof of Theorem 1.</em> Let
        <span class="math">M</span> be a matrix satisfying
        the assumptions. By Corollary 2, it is an
        <span class="math">s</span>-by-<span class="math">s</span>
        block matrix, where each block is a
        <span class="math">2^k</span>-by-<span class="math">2^k</span>
        special matrix. Hence, by Proposition 10, there
        exists a polynomial
        <span class="math">q'</span> of degree
        <span class="math">s(k+1)</span> such that
        <span class="math">q'(M) = 0</span>. Let
      </p>
      <div class="math-block">
        U = \&#123;x \in \text&#123;GF&#125;(2^n)^t :
        \forall\, 0 \leq i \leq s(k+1) - 1,\;
        (M^i x)_1 = 0\&#125;,
      </div>
      <p class="text-gray-300">
        where
        <span class="math">(X)_1</span> stands for the top
        <span class="math">n</span> bits. Clearly,
        <span class="math">U</span> is a linear subspace of
        dimension at least
        <span class="math">s(2^k - (k+1)) = (1 - \frac&#123;k+1&#125;&#123;2^k&#125;)t</span>.
        For any
        <span class="math">\ell \in \mathbb&#123;N&#125;</span>
        and
        <span class="math">x \in U</span>, using polynomial
        division we write
        <span class="math">M^\ell = q'(M) \cdot q_0(M) + q_1(M)</span>,
        where
        <span class="math">\deg(q_1) &lt; s(k+1)</span>.
        Then
        <span class="math">(M^\ell x)_1 = (q_1(M)x)_1 = 0</span>
        since
        <span class="math">q'(M) = 0</span> and
        <span class="math">x \in U</span>.
        <span class="math">\square</span>
      </p>

      <p class="text-gray-300">
        <em>Proof of Theorem 2.</em> By Corollary 1,
        <span class="math">M</span> is a special matrix. By
        Proposition 2,
        <span class="math">M^2 = \lambda(M)^2 \cdot I</span>,
        where
        <span class="math">\lambda(M)</span> is the sum of
        elements in each row. By the construction of the
        Starkad MDS, these elements are the inverses of
        <span class="math">\&#123;2^k + i\&#125;_&#123;i=0&#125;^&#123;2^k - 1&#125;</span>.
        Hence
        <span class="math">\alpha = (\sum_&#123;j=2^k&#125;^&#123;2^&#123;k+1&#125;-1&#125; j^&#123;-1&#125;)^2</span>.
        The dimension of
        <span class="math">U</span> is at least
        <span class="math">t - 2</span>, since it suffices
        to require
        <span class="math">x_1 = 0</span> and
        <span class="math">(Mx)_1 = 0</span>.
        <span class="math">\square</span>
      </p>

      <h3 id="sec-5.3" class="text-xl font-semibold mt-8 mb-3">
        5.3 Using the Invariant Subspaces for a Preimage
        Attack
      </h3>
      <p class="text-gray-300">
        In [6, Sec. 6.2], Beyne et al. showed that if the
        linear layer of Starkad or Poseidon was an
        involution, this could be used to mount a
        Gr&ouml;bner basis preimage attack on the scheme.
        The basic idea behind the attack is simple. Assuming
        that the linear layer is involutionary, there exists
        an invariant subspace of dimension
        <span class="math">t - 2</span> over the field that
        passes all PSPN rounds without activating any S-box.
        Hence, if we restrict ourselves to plaintexts whose
        intermediate values lie in the invariant subspace, a
        Gr&ouml;bner basis attack on the scheme can bypass
        all PSPN rounds for free. The preimage is then found
        by representing the full rounds as a system of
        equations, adding the linear constraints, and
        solving the resulting system using Gr&ouml;bner
        basis methods.
      </p>
      <p class="text-gray-300">
        The authors of [BCD+20] conclude that a preimage can be
        found in time
      </p>
      <div class="math-block">
        2\gamma(2\pi)^&#123;-\omega/2&#125;
        (c+2)^&#123;2-\omega/2&#125;
        e^&#123;\omega(c+2)&#125;
        3^&#123;(\omega(c+2)+1)(R_F-1)&#125;, \tag&#123;1&#125;
      </div>
      <p class="text-gray-300">
        where the parameters
        <span class="math">\gamma</span> and
        <span class="math">\omega</span> are such that the
        computational cost of computing the row-reduced
        echelon form of an
        <span class="math">m</span>-by-<span class="math">n</span>
        matrix is
        <span class="math">\gamma m n^\omega</span>.
      </p>
      <p class="text-gray-300">
        <strong>Application of the attack in our
        scenario.</strong> The preimage attack of [BCD+20] is
        presented in terms of the multiplicative order of
        the linear layer. However, it is easy to see that
        the multiplicative order of the matrix can be
        replaced by the co-dimension of the invariant
        subspace that passes the PSPN rounds without
        activating any S-box. Therefore, the attack can be
        applied to Starkad, where in the formula
        <span class="math">c + 2</span> is replaced with
        <span class="math">c + d_0</span>, where
        <span class="math">d_0</span> is the degree of the
        minimal polynomial of
        <span class="math">M</span>. In particular, if we
        take a variant of Starkad with the binary field
        <span class="math">\text&#123;GF&#125;(2^&#123;127&#125;)</span>
        and
        <span class="math">t</span> any power of 2, then
        the scheme admits a preimage attack of complexity
        about
        <span class="math">2^&#123;220&#125;</span>, which
        breaks the 256-bit security bound. We note however
        that for all actually proposed sets of parameters,
        the complexity of the preimage attack does not break
        the security bound.
      </p>

      <h3 id="sec-5.4" class="text-xl font-semibold mt-8 mb-3">
        5.4 The Invariant Subspaces Can Be Avoided Easily
      </h3>
      <p class="text-gray-300">
        While it is not clear whether the invariant subspaces
        can be exploited to attack the Starkad hash
        function, their existence is an undesirable feature.
        The &lsquo;good news&rsquo; are that these subspaces
        can be easily avoided, by a careful choice of
        parameters. We present three possible ways:
      </p>
      <p class="text-gray-300">
        <strong>Choosing the value of
        <span class="math">t</span> carefully.</strong> One
        possible way is to choose
        <span class="math">t</span> that is not divisible
        by 4.
      </p>
      <p class="text-gray-300">
        <strong>Changing the parameter
        <span class="math">r</span>.</strong> Another
        possible way is to change the parameter
        <span class="math">r</span> used in the generation
        of the MDS matrix. Our experiments indicate that
        whenever
        <span class="math">r</span> is not divisible by 4,
        there is no invariant subspace of the form described
        above.
      </p>

      <!-- Table 4 -->
      <div class="my-6 overflow-x-auto">
        <table class="w-full text-sm">
          <caption class="text-gray-400 text-xs mb-2">
            <strong>Table 4.</strong> The dimension of the
            invariant subspace as a function of
            <span class="math">r</span>, for a Starkad
            permutation over
            <span class="math">\text&#123;GF&#125;(2^&#123;63&#125;)</span>
            with
            <span class="math">t = 24</span>.
          </caption>
          <thead>
            <tr class="border-b border-gray-700">
              <th class="px-3 py-2 text-left">
                <span class="math">r</span></th>
              <th class="px-3 py-2 text-left">Dim.</th>
              <th class="px-3 py-2 text-left">
                <span class="math">r</span></th>
              <th class="px-3 py-2 text-left">Dim.</th>
              <th class="px-3 py-2 text-left">
                <span class="math">r</span></th>
              <th class="px-3 py-2 text-left">Dim.</th>
            </tr>
          </thead>
          <tbody class="text-gray-300">
            <tr class="border-b border-gray-800">
              <td class="px-3 py-2">24</td>
              <td class="px-3 py-2">18</td>
              <td class="px-3 py-2">25</td>
              <td class="px-3 py-2">0</td>
              <td class="px-3 py-2">26</td>
              <td class="px-3 py-2">0</td>
            </tr>
            <tr class="border-b border-gray-800">
              <td class="px-3 py-2">27</td>
              <td class="px-3 py-2">0</td>
              <td class="px-3 py-2">28</td>
              <td class="px-3 py-2">12</td>
              <td class="px-3 py-2">29</td>
              <td class="px-3 py-2">0</td>
            </tr>
            <tr class="border-b border-gray-800">
              <td class="px-3 py-2">30</td>
              <td class="px-3 py-2">0</td>
              <td class="px-3 py-2">31</td>
              <td class="px-3 py-2">0</td>
              <td class="px-3 py-2">32</td>
              <td class="px-3 py-2">20</td>
            </tr>
            <tr class="border-b border-gray-800">
              <td class="px-3 py-2">40</td>
              <td class="px-3 py-2">18</td>
              <td class="px-3 py-2">47</td>
              <td class="px-3 py-2">0</td>
              <td class="px-3 py-2">52</td>
              <td class="px-3 py-2">12</td>
            </tr>
            <tr class="border-b border-gray-800">
              <td class="px-3 py-2">64</td>
              <td class="px-3 py-2">20</td>
              <td class="px-3 py-2">101</td>
              <td class="px-3 py-2">0</td>
              <td class="px-3 py-2">128</td>
              <td class="px-3 py-2">20</td>
            </tr>
          </tbody>
        </table>
      </div>

      <p class="text-gray-300">
        <strong>Shifting the sequence
        <span class="math">\&#123;x_i\&#125;</span>.</strong>
        A third possible mild change is shifting the
        sequence
        <span class="math">\&#123;x_i\&#125;</span>, namely,
        taking
        <span class="math">x_i = x_0 + i - 1</span> for
        some
        <span class="math">x_0 \neq 0</span>.
      </p>

      <!-- Table 5 -->
      <div class="my-6 overflow-x-auto">
        <table class="w-full text-sm">
          <caption class="text-gray-400 text-xs mb-2">
            <strong>Table 5.</strong> The dimension of the
            invariant subspace as a function of
            <span class="math">x_0</span>, for a Starkad
            cipher over
            <span class="math">\text&#123;GF&#125;(2^&#123;63&#125;)</span>
            with
            <span class="math">t = 24</span>.
          </caption>
          <thead>
            <tr class="border-b border-gray-700">
              <th class="px-3 py-2 text-left">
                <span class="math">x_0</span></th>
              <th class="px-3 py-2 text-left">Dim.</th>
              <th class="px-3 py-2 text-left">
                <span class="math">x_0</span></th>
              <th class="px-3 py-2 text-left">Dim.</th>
              <th class="px-3 py-2 text-left">
                <span class="math">x_0</span></th>
              <th class="px-3 py-2 text-left">Dim.</th>
            </tr>
          </thead>
          <tbody class="text-gray-300">
            <tr class="border-b border-gray-800">
              <td class="px-3 py-2">0</td>
              <td class="px-3 py-2">18</td>
              <td class="px-3 py-2">1</td>
              <td class="px-3 py-2">6</td>
              <td class="px-3 py-2">2</td>
              <td class="px-3 py-2">0</td>
            </tr>
            <tr class="border-b border-gray-800">
              <td class="px-3 py-2">3</td>
              <td class="px-3 py-2">0</td>
              <td class="px-3 py-2">4</td>
              <td class="px-3 py-2">12</td>
              <td class="px-3 py-2">5</td>
              <td class="px-3 py-2">0</td>
            </tr>
            <tr class="border-b border-gray-800">
              <td class="px-3 py-2">6</td>
              <td class="px-3 py-2">0</td>
              <td class="px-3 py-2">7</td>
              <td class="px-3 py-2">12</td>
              <td class="px-3 py-2">8</td>
              <td class="px-3 py-2">18</td>
            </tr>
            <tr class="border-b border-gray-800">
              <td class="px-3 py-2">9</td>
              <td class="px-3 py-2">6</td>
              <td class="px-3 py-2">10</td>
              <td class="px-3 py-2">0</td>
              <td class="px-3 py-2">11</td>
              <td class="px-3 py-2">0</td>
            </tr>
            <tr class="border-b border-gray-800">
              <td class="px-3 py-2">12</td>
              <td class="px-3 py-2">12</td>
              <td class="px-3 py-2">13</td>
              <td class="px-3 py-2">0</td>
              <td class="px-3 py-2">14</td>
              <td class="px-3 py-2">0</td>
            </tr>
            <tr class="border-b border-gray-800">
              <td class="px-3 py-2">15</td>
              <td class="px-3 py-2">12</td>
              <td class="px-3 py-2">16</td>
              <td class="px-3 py-2">18</td>
              <td class="px-3 py-2">17</td>
              <td class="px-3 py-2">6</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- ====================================================== -->
    <!-- 6. DISCUSSION AND OPEN PROBLEMS                        -->
    <!-- ====================================================== -->

    <section id="sec-6" class="mb-12">
      <h2 class="text-2xl font-bold mb-4">
        6 Discussion and Open Problems
      </h2>

      <h3 id="sec-6.1" class="text-xl font-semibold mt-8 mb-3">
        6.1 Discussion: PSPN Rounds vs. SPN Rounds
      </h3>
      <p class="text-gray-300">
        In this paper we showed that the MDS matrix used in
        HADES constructions significantly affects the
        security level provided by the cryptosystem. This
        emphasizes the need of choosing the MDS matrix in
        the construction carefully, but also gives rise to a
        more general question regarding the design strategy.
      </p>
      <p class="text-gray-300">
        Specifically, we showed in
        <a href="#sec-3">Section 3</a> that when the MDS
        matrix is chosen properly (which is the case for all
        suggested variants of Poseidon), the lower bound on
        the number of active S-boxes in differential and
        linear characteristics can be significantly improved
        by taking into consideration the PSPN rounds. In
        some of the cases, the lower bound we obtain on the
        number of active S-boxes in the PSPN rounds is much
        larger than the lower bound obtained by the
        designers using the wide-trail strategy.
      </p>
      <p class="text-gray-300">
        This gives rise to the question, whether full SPN
        rounds are &lsquo;cost effective&rsquo; compared to
        PSPN rounds, in scenarios where the complexity is
        dominated by the number of S-boxes in the
        construction. The wide trail strategy provides a
        tight lower bound of
        <span class="math">t + 1</span> active S-boxes over
        two rounds which employ
        <span class="math">2t</span> S-boxes in total. For
        PSPN rounds with a single S-box in each round, the
        analysis of [BDD+15] suggests that for a
        &lsquo;good&rsquo; MDS, the minimal number of
        active S-boxes over
        <span class="math">m</span> rounds (which employ
        <span class="math">m</span> S-boxes) is
        <span class="math">\frac&#123;m - t&#125;&#123;2&#125; + 1</span>.
        While the ratio
        <span class="math">\frac&#123;t+1&#125;&#123;2t&#125;</span>
        obtained by SPN rounds is somewhat larger than the
        ratio
        <span class="math">\frac&#123;m-t+2&#125;&#123;2m&#125;</span>
        obtained for PSPN rounds, the asymptotic difference
        between the ratios is small.
      </p>

      <h3 id="sec-6.2" class="text-xl font-semibold mt-8 mb-3">
        6.2 Open Problems
      </h3>
      <p class="text-gray-300">
        <strong>Finding better ways to exploit the invariant
        subspace in Starkad.</strong> The first open problem
        arising from this paper is, whether there are more
        efficient ways to exploit the large invariant
        subspaces found for variants of Starkad to mount
        attacks on the schemes.
      </p>
      <p class="text-gray-300">
        <strong>Optimal bound on the size of the invariant
        subspace.</strong> Another open problem is to prove
        Conjecture 1&mdash;namely, to show that the
        dimension of the invariant subspace for
        <span class="math">t = 2^k \cdot s</span> is at
        least
        <span class="math">t - 2s</span>. Numerous
        experiments suggest that the conjecture (which would
        be tight if proved) indeed holds, and it seems that
        a proof is not out of reach.
      </p>
      <p class="text-gray-300">
        <strong>Improved cryptanalysis techniques for PSPN
        rounds.</strong> As was pointed out by the HADES
        designers, the cryptanalysis tools available for PSPN
        designs are very scarce. Developing new tools may
        enable a wider use of PSPN rounds, and further
        development of designs based on them.
      </p>
      <p class="text-gray-300">
        <strong>Balancing the number of SPN vs. PSPN rounds
        in HADES designs.</strong> Our results may suggest
        that one can design more efficient instantiations of
        HADES by choosing the MDS properly, taking into
        consideration the middle layer, and changing the
        balance between SPN and PSPN rounds.
      </p>

      <div class="formal-block formal-block-definition">
        <div class="formal-block-title text-blue-400">
          Question 1
        </div>
        <div class="formal-block-content">
          <p class="text-sm text-gray-300">
            Consider a variant of Poseidon in which the
            <span class="math">2R_f</span> SPN rounds are
            replaced by
            <span class="math">tR_f</span> PSPN rounds (and
            so, the cipher has only PSPN rounds, and the
            total number of S-boxes is reduced by
            <span class="math">tR_f</span>). What is the
            security level of the new variant, compared to
            the initial variant?
          </p>
        </div>
      </div>
    </section>

    <!-- ====================================================== -->
    <!-- ACKNOWLEDGEMENTS                                       -->
    <!-- ====================================================== -->

    <section id="acknowledgements" class="mb-12">
      <h2 class="text-2xl font-bold mb-4">
        Acknowledgements
      </h2>
      <p class="text-gray-300">
        The authors are grateful to Tim Beyne, Itai Dinur,
        Lorenzo Grassi and Christian Rechberger, for helpful
        discussions and suggestions.
      </p>
    </section>

    <!-- ====================================================== -->
    <!-- REFERENCES                                             -->
    <!-- ====================================================== -->

    <section id="references" class="mb-12">
      <h2 class="text-2xl font-bold mb-4">References</h2>
      <ul class="space-y-2 text-gray-400 text-sm list-none">
        <li>
          <span class="text-gray-500">[ARS+15]</span>
          Albrecht, M.R., Rechberger, C., Schneider, T.,
          Tiessen, T., Zohner, M.: Ciphers for MPC and FHE.
          EUROCRYPT 2015, LNCS 9056, pp. 430&ndash;454.
          Springer (2015).
        </li>
        <li>
          <span class="text-gray-500">[BDD+15]</span>
          Bar-On, A., Dinur, I., Dunkelman, O., Lallemand,
          V., Keller, N., Tsaban, B.: Cryptanalysis of SP
          networks with partial non-linear layers. EUROCRYPT
          2015, LNCS 9056, pp. 315&ndash;342. Springer
          (2015).
        </li>
        <li>
          <span class="text-gray-500">[BW91]</span>
          Becker, T., Weispfenning, V.: Gr&ouml;bner
          bases&mdash;a computational approach to
          commutative algebra (1991).
        </li>
        <li>
          <span class="text-gray-500">[BGL+20]</span>
          Ben-Sasson, E., Goldberg, L., Levit, D.: STARK
          friendly hash&mdash;survey and recommendation.
          IACR ePrint 2020/948.
        </li>
        <li>
          <span class="text-gray-500">[Bey20]</span>
          Beyne, T.: Personal communication (2020).
        </li>
        <li>
          <span class="text-gray-500">[BCD+20]</span>
          Beyne, T., Canteaut, A., Dinur, I., Eichlseder,
          M., Leander, G., Leurent, G., Naya-Plasencia, M.,
          Perrin, L., Sasaki, Y., Todo, Y., Wiemer, F.: Out
          of oddity&mdash;new cryptanalytic techniques
          against symmetric primitives optimized for
          integrity proof systems. CRYPTO 2020, LNCS 12172,
          pp. 299&ndash;328. Springer (2020).
          <a href="/papers/out-of-oddity-2020"
            class="text-blue-400 hover:text-blue-300">
            [page on this site]</a>
        </li>
        <li>
          <span class="text-gray-500">[DLMW15]</span>
          Dinur, I., Liu, Y., Meier, W., Wang, Q.:
          Optimized interpolation attacks on LowMC.
          ASIACRYPT 2015, LNCS 9453, pp. 535&ndash;560.
          Springer (2015).
        </li>
        <li>
          <span class="text-gray-500">[DEM15]</span>
          Dobraunig, C., Eichlseder, M., Mendel, F.:
          Higher-order cryptanalysis of LowMC. ICISC 2015,
          LNCS 9558, pp. 87&ndash;101. Springer (2015).
        </li>
        <li>
          <span class="text-gray-500">[GGNS13]</span>
          G&eacute;rard, B., Grosso, V., Naya-Plasencia,
          M., Standaert, F.: Block ciphers that are easier
          to mask: How far can we go? CHES 2013, LNCS 8086,
          pp. 383&ndash;399. Springer (2013).
        </li>
        <li>
          <span class="text-gray-500">[GKK+19]</span>
          Grassi, L., Kales, D., Khovratovich, D., Roy, A.,
          Rechberger, C., Schofnegger, M.: Starkad and
          Poseidon: New hash functions for zero knowledge
          proof systems. IACR ePrint 2019/458.
          <a href="/papers/poseidon-2019"
            class="text-blue-400 hover:text-blue-300">
            [page on this site]</a>
        </li>
        <li>
          <span class="text-gray-500">[GKR+21]</span>
          Grassi, L., Khovratovich, D., Rechberger, C., Roy,
          A., Schofnegger, M.: Poseidon: A New Hash Function
          for Zero-Knowledge Proof Systems. USENIX Security
          2021.
          <a href="/papers/poseidon-2019"
            class="text-blue-400 hover:text-blue-300">
            [page on this site]</a>
        </li>
        <li>
          <span class="text-gray-500">[GLR+20]</span>
          Grassi, L., L&uuml;ftenegger, R., Rechberger, C.,
          Rotaru, D., Schofnegger, M.: On a Generalization
          of Substitution-Permutation Networks: The HADES
          Design Strategy. EUROCRYPT 2020, LNCS 12106,
          pp. 674&ndash;704. Springer (2020).
          <a href="/papers/hades-2019"
            class="text-blue-400 hover:text-blue-300">
            [page on this site]</a>
        </li>
        <li>
          <span class="text-gray-500">[GRS20]</span>
          Grassi, L., Rechberger, C., Schofnegger, M.: Weak
          linear layers in word-oriented partial SPN and
          HADES-like ciphers. IACR ePrint 2020/500.
          <a href="/papers/subspace-trails-2020"
            class="text-blue-400 hover:text-blue-300">
            [page on this site]</a>
        </li>
        <li>
          <span class="text-gray-500">[NIST01]</span>
          NIST: Advanced Encryption Standard, FIPS 197
          (2001).
        </li>
        <li>
          <span class="text-gray-500">[RL89]</span>
          Roth, R.M., Lempel, A.: On MDS codes via Cauchy
          matrices. IEEE Trans. Information Theory 35(6),
          1314&ndash;1319 (1989).
        </li>
        <li>
          <span class="text-gray-500">[Sil00]</span>
          Silvester, J.R.: Determinants of block matrices.
          The Mathematical Gazette 84(501), 460&ndash;467
          (2000).
        </li>
        <li>
          <span class="text-gray-500">[SW20]</span>
          StarkWare: STARK-Friendly Hash Challenge
          (2019&ndash;2020).
        </li>
      </ul>
    </section>

    <!-- ====================================================== -->
    <!-- APPENDIX A                                             -->
    <!-- ====================================================== -->

    <section id="appendix-a" class="mb-12">
      <h2 class="text-2xl font-bold mb-4">
        Appendix A: Detailed Description of the Pattern
        Search Algorithm
      </h2>

      <h3 class="text-xl font-semibold mt-6 mb-3">
        A.1 Checking a Single Pattern
      </h3>
      <p class="text-gray-300">
        In order to check whether there exists a
        differential characteristic following a specific
        pattern, one can use the following algorithm:
      </p>
      <div class="my-4 p-4 rounded-lg text-sm text-gray-300
        font-mono whitespace-pre-wrap"
        style="background: rgba(255,255,255,0.03);
               border: 1px solid rgba(255,255,255,0.06);">algorithm Check-Pattern(pattern):
1. ST := (I_t; 0_(a+t))
2. E := empty set
3. s := t + 1
4. for every i = 1 : n
   (a) if i in pattern: ST_1 &larr; e_s, s &larr; s + 1
   (b) if i not in pattern: E &larr; E union ST_1
   (c) ST &larr; M * ST
5. Solve the equation system E, return TRUE
   iff there exists a nontrivial solution</div>
      <p class="text-gray-300">
        Each row of the state corresponds to the
        coefficients in the linear combination of the
        <span class="math">t + a</span> variables. On a
        non-active S-box, we get a linear restriction by the
        coefficients in the first row. On an active S-box,
        we replace the first row by a new variable.
      </p>

      <h3 class="text-xl font-semibold mt-6 mb-3">
        A.2 Checking All
        <span class="math">r</span>-Round Patterns with
        <span class="math">a</span> Active S-Boxes
      </h3>
      <p class="text-gray-300">
        We can also iterate over all the patterns of length
        <span class="math">r</span> with
        <span class="math">a</span> active S-boxes, using
        the following simple recursive algorithm:
      </p>
      <div class="my-4 p-4 rounded-lg text-sm text-gray-300
        font-mono whitespace-pre-wrap"
        style="background: rgba(255,255,255,0.03);
               border: 1px solid rgba(255,255,255,0.06);">function Search-Pattern(pref, s, a, i, n):
1. if i &ge; n - 1 and Check-Pattern(pref):
     output pref
2. if i &lt; t + 2s:
     Search-Pattern(pref, s, a, i + 1, n)
3. if s &lt; a and 2s &lt; i:
     Search-Pattern(pref union &#123;i&#125;, s + 1, a, i + 1, n)</div>
      <p class="text-gray-300">
        The function should be called with
        <span class="math">\text&#123;pattern&#125; = \emptyset</span>,
        <span class="math">s = 0</span>,
        <span class="math">a</span>,
        <span class="math">i = 2</span>,
        <span class="math">n = t + 2a</span>.
      </p>
    </section>

  </article>
</BaseLayout>
