---
import BaseLayout from '../../layouts/BaseLayout.astro';
import PaperDisclaimer from '../../components/PaperDisclaimer.astro';
import PaperHistory from '../../components/PaperHistory.astro';

const EPRINT_URL = 'https://eprint.iacr.org/2017/832';
const CRAWLER = 'marker';
const CONVERTED_DATE = '2026-02-16';
const TITLE_HTML = 'Mixture Differential Cryptanalysis and Structural Truncated Differential Attacks on round-reduced AES';
const AUTHORS_HTML = 'Lorenzo Grassi';

const CONTENT = `    <section id="abstract" class="mb-10">
      <h2 class="text-2xl font-bold">Abstract</h2>
      <p class="text-gray-300">At Eurocrypt 2017 the first secret-key distinguisher for 5-round AES -- based on the &ldquo;multiple-of-8&rdquo; property -- has been presented. Although it allows to distinguish a random permutation from an AES-like one, it seems rather hard to implement a key-recovery attack different than brute-force like using such a distinguisher.

In this paper we introduce &ldquo;Mixture Differential Cryptanalysis&rdquo; on round-reduced AES-like ciphers, a way to translate the (complex) &ldquo;multiple-of-8&rdquo; 5-round distinguisher into a simpler and more convenient one (though, on a smaller number of rounds).
Given a pair of chosen plaintexts, the idea is to construct new pairs of plaintexts by mixing the generating variables of the original pair of plaintexts. Here we theoretically prove that for 4-round AES the corresponding ciphertexts of the original pair of plaintexts lie in a particular subspace if and only if the corresponding pairs of ciphertexts of the new pairs of plaintexts have the same property. Such secret-key distinguisher -- which is independent of the secret-key, of the details of the S-Box and of the MixColumns matrix (except for the branch number equal to 5) -- can be used as starting point to set up new key-recovery attacks on round-reduced AES. Besides a theoretical explanation, we also provide a practical verification both of the
distinguisher and of the attack.

As a second contribution, we show how to combine this new 4-round distinguisher with a modified version of a truncated differential distinguisher in order to set up new 5-round distinguishers, that exploit properties which are independent of the secret key, of the details of the S-Box and of the MixColumns matrix. As a result, while a &ldquo;classical&rdquo; truncated differential distinguisher exploits the probability that a couple of texts satisfies or not a given differential trail independently of the others couples, our distinguishers work with sets of N &gt;&gt; 1 (related) couples of texts. In particular, our new 5-round AES distinguishers exploit the fact that such sets of texts satisfy some properties with a different probability than a random permutation.

Even if such 5-round distinguishers have higher complexity than e.g. the &ldquo;multiple-of-8&rdquo; one present in the literature, one of them can be used as starting point to set up the first key-recovery attack on 6-round AES that exploits directly a 5-round secret-key distinguisher. The goal of this paper is indeed to present and explore new approaches, showing that even a distinguisher like the one presented at Eurocrypt -- believed to be hard to exploit - can be used to set up a key-recovery attack.</p>
    </section>

      <h4 id="sec-5.1.1" class="text-lg font-semibold mt-6">5.1.1 Proof using the &quot;super-Sbox&quot; Notation</h4>

    <p class="text-gray-300">As first thing, we prove the previous result using the &quot;super-Sbox&quot; notation - introduced in [DR06] by the designers of AES, where</p>

    <p class="text-gray-300"><span class="math">$super-Sbox(\\cdot) = S-Box \\circ ARK \\circ MC \\circ S-Box(\\cdot)</span>$
(11)</p>

    <p class="text-gray-300">Consider two pairs of texts  <span class="math">(p^1, p^2)</span>  and  <span class="math">(\\hat{p}^1, \\hat{p}^2)</span>  in a coset of  <span class="math">C_0 \\cap D_{0,3}</span>  - that is  <span class="math">(C_0 \\cap D_{0,3}) \\oplus a</span>  for a fixed a, such that</p>

    <p class="text-gray-300"><span class="math">$p^{i} \\equiv a \\oplus \\begin{bmatrix} z^{i} &amp; 0 &amp; 0 &amp; 0 \\\\ w^{i} &amp; 0 &amp; 0 &amp; 0 \\\\ 0 &amp; 0 &amp; 0 &amp; 0 \\\\ 0 &amp; 0 &amp; 0</span>$</p>

    <p class="text-gray-300">for i=1,2, that is  <span class="math">p^i\\equiv(z^i,w^i)</span>  and  <span class="math">\\hat{p}^i\\equiv(z^i,w^{3-i}).</span></p>

    <p class="text-gray-300">The goal is to prove that</p>

    <p class="text-gray-300"><span class="math">$R^4(p^1) \\oplus R^4(p^2) \\in \\mathcal{M}_{\\text{J}} \\quad \\text{ if and only if } \\quad R^4(\\hat{p}^1) \\oplus R^4(\\hat{p}^2) \\in \\mathcal{M}_{\\text{J}}.</span>$</p>

    <p class="text-gray-300">Since  <span class="math">Prob(R^2(x) \\oplus R^2(y) \\in \\mathcal{M}_I \\mid x \\oplus y \\in \\mathcal{D}_I) = 1</span>  (see (2)), this is equivalent to prove that</p>

    <p class="text-gray-300"><span class="math">$R^2(p^1) \\oplus R^2(p^2) \\in \\mathcal{D}_J</span>$
if and only if  <span class="math">R^2(\\hat{p}^1) \\oplus R^2(\\hat{p}^2) \\in \\mathcal{D}_J</span> .</p>

    <p class="text-gray-300"> <span class="math">&lt;sup&gt;^{11}\\&lt;/sup&gt;mathrm{We}</span>  mention that the result proposed in Lemma 4 is already included - as a special case - in the results proposed in Theorem 3.</p>

    <p class="text-gray-300">First of all, observe that  <span class="math">p^1 \\oplus p^2 \\in (\\mathcal{C}_0 \\cap \\mathcal{D}_{0,3}) \\subseteq \\mathcal{D}_{0,3}</span> , and that  <span class="math">R^2(p^1) \\oplus R^2(p^2) \\in \\mathcal{M}_{0,3}</span> . Since  <span class="math">\\mathcal{M}_{0,3} \\cap \\mathcal{D}_J \\neq \\{0\\}</span>  if and only if |J| = 3 (see (3) for details),  <span class="math">R^2(p^1) \\oplus R^2(p^2) \\in \\mathcal{D}_J</span>  can occur if and only if |J| = 3.</p>

    <p class="text-gray-300">As it is well known, 2-round encryption can be rewritten using the super-Sbox notation</p>

    <p class="text-gray-300"><span class="math">$R^{2}(\\cdot) = ARK \\circ MC \\circ SR \\circ super-Sbox \\circ SR(\\cdot).</span>$</p>

    <p class="text-gray-300">Since ShiftRows and MixColumns operations are linear, it is sufficient to prove that</p>

    <p class="text-gray-300"><span class="math">super-Sbox(q^1) \\oplus super-Sbox(q^2) \\in \\mathcal{W}_J \\quad iff \\quad super-Sbox(\\hat{q}^1) \\oplus super-Sbox(\\hat{q}^2) \\in \\mathcal{W}_J</span></p>

    <p class="text-gray-300">where</p>

    <p class="text-gray-300"><span class="math">$q^i = SR(p^i) \\equiv SR(a) \\oplus \\begin{bmatrix} z^i &amp; 0 &amp; 0 &amp; 0 \\\\ 0 &amp; 0 &amp; 0 &amp; w^i \\\\ 0 &amp; 0 &amp; 0 &amp; 0 \\\\ 0 &amp; 0 &amp; 0 &amp; 0 \\end{bmatrix} \\quad \\text{and} \\quad \\hat{q}^i = SR(\\hat{p}^i) \\equiv SR(a) \\oplus \\begin{bmatrix} z^i &amp; 0 &amp; 0 &amp; 0 \\\\ 0 &amp; 0 &amp; 0 &amp; w^{3-i} \\\\ 0 &amp; 0 &amp; 0 &amp; 0 \\\\ 0 &amp; 0 &amp; 0 &amp; 0 \\end{bmatrix}</span>$</p>

    <p class="text-gray-300">for i=1,2 (note that  <span class="math">SR(\\mathcal{D}_{0,3}\\cap\\mathcal{C}_0)=\\mathcal{C}_{0,3}\\cap\\mathcal{ID}_0</span>  by definition) and where the subspace  <span class="math">\\mathcal{W}_I</span>  is defined as</p>

    <p class="text-gray-300">
<span class="math">$\\mathcal{W}_J := SR^{-1} \\circ MC^{-1}(\\mathcal{D}_J). \\tag{12}</span>$</p>

    <p class="text-gray-300">Since each column of  <span class="math">q^1</span>  and  <span class="math">q^2</span>  depends on different and independent variables, since the super-Sbox works independently on each column and since the XOR-sum is commutative, it follows that</p>

    <p class="text-gray-300"><span class="math">$super-Sbox(q^1) \\oplus super-Sbox(q^2) = super-Sbox(\\hat{q}^1) \\oplus super-Sbox(\\hat{q}^2)</span>$</p>

    <p class="text-gray-300">which implies the thesis.</p>

      <h4 id="sec-5.1.2" class="text-lg font-semibold mt-6">5.1.2 Data and Computational Cost</h4>

    <p class="text-gray-300"><strong>Data Cost.</strong> Since a coset of  <span class="math">C_0 \\cap D_{0,3}</span>  contains  <span class="math">2^{16}</span>  plaintexts, it is possible to construct  <span class="math">2^{15} \\cdot (2^{16} - 1) \\simeq 2^{31}</span>  different couples. For our goal, we consider only the pairs of texts  <span class="math">p^1 \\equiv (z^1, w^1)</span>  and  <span class="math">p^2 \\equiv (z^2, w^2)</span>  with different generating variables, that is  <span class="math">z^1 \\neq z^2</span>  and  <span class="math">w^1 \\neq w^2</span>  (if  <span class="math">z^1 = z^2</span>  or  <span class="math">w^1 = w^2</span> , then  <span class="math">p^1 \\oplus p^2 \\in (C_0 \\cap D_k) \\subseteq D_k</span>  for a certain  <span class="math">k \\in \\{0, 3\\}</span> , which implies that  <span class="math">R^4(p^1) \\oplus R^4(p^2) \\notin \\mathcal{M}_J</span>  for each J due to Prop. 1). Using formula (10), the number of pairs with two different generating variables is given by  <span class="math">2^{15} \\cdot (2^8 - 1)^2 \\simeq 2^{30.989}</span> . As we have just seen, only half of them - that is,  <span class="math">2^{29.989}</span>  - are independent.</p>

    <p class="text-gray-300">In order to distinguish 4-round AES from a random permutation, one has to check that</p>

    <p class="text-gray-300"><span class="math">$c^1 \\oplus c^2 = R^4 (p^1 \\equiv (z^1, w^1)) \\oplus R^4 (p^2 \\equiv (z^2, w^2)) \\in \\mathcal{M}_J</span>$</p>

    <p class="text-gray-300">if and only if</p>

    <p class="text-gray-300"><span class="math">$\\hat{c}^1 \\oplus \\hat{c}^2 = R^4 (\\hat{p}^1 \\equiv (z^1, w^2)) \\oplus R^4 (\\hat{p}^2 \\equiv (z^2, w^1)) \\in \\mathcal{M}_J.</span>$</p>

    <p class="text-gray-300">If this property is not satisfied for at least one couple, then it is possible to conclude that the analyzed permutation is a random one.</p>

    <p class="text-gray-300">Given a random permutation  <span class="math">\\Pi(\\cdot)</span> , what is the probability that  <span class="math">c^1 \\oplus c^2 \\equiv \\Pi(p^1) \\oplus \\Pi(p^2) \\in \\mathcal{M}_J</span>  and  <span class="math">\\hat{c}^1 \\oplus \\hat{c}^2 \\equiv \\Pi(\\hat{p}^1) \\oplus \\Pi(\\hat{p}^2) \\notin \\mathcal{M}_J</span>  - or vice-versa - for a certain  <span class="math">J \\subset \\{0, 1, 2, 3\\}</span>  with |J| = 3? Since there are 4 different indexes J with |J| = 3 and since  <span class="math">Prob(t \\in \\mathcal{M}_J) = 2^{-32 \\cdot (4-|J|)}</span> , this event happens with probability (approximately) equal to</p>

    <p class="text-gray-300"><span class="math">$2 \\cdot 4 \\cdot 2^{-32} \\cdot (1 - 2^{-32}) \\simeq 2^{-29}</span>$</p>

    <p class="text-gray-300">As a result, in order to distinguish a random permutation from 4-round AES with probability higher than pr, it is sufficient that the previous event occurs for at least one couple of</p>

    <pre><code class="language-text">Data: 2 cosets of \\mathcal{D}_{0,3} \\cap \\mathcal{C}_0 (e.g. (\\mathcal{C}_0 \\cap \\mathcal{D}_{0,3}) \\oplus a_i for a_0, a_1 \\in (\\mathcal{D}_{0,3} \\cap \\mathcal{C}_0)^{\\perp}) and
             corresponding ciphertexts after 4 rounds
Result: 0 \\equiv \\text{Random permutation } or 1 \\equiv 4\\text{-round AES} - \\text{Prob. } 95\\%
for each coset (\\mathcal{D}_{0,3} \\cap \\mathcal{C}_0) \\oplus a_x for x = 0, 1 do
      for each I\\subseteq\\{0,1,2,3\\} with |I|=3 do | let (p^i,c^i) for i=0,...,2^{16}-1 be the 2^{16} (plaintexts, ciphertexts) of
              (\\mathcal{D}_{0.3} \\cap \\mathcal{C}_0) \\oplus a_x;
            re-order this set of elements w.r.t. the partial order \\leq described in Def. 10
              s.t. c^k \\leq c^{k+1} for each k;
                                                                                                                        // \\leq depends on I
            \\begin{aligned} i \\leftarrow 0; \\ \\text{while} \\ i &lt; 2^{16} - 1 \\ \\text{do} \\ | \\ j \\leftarrow i; \\ \\text{while} \\ c^j \\oplus c^{j+1} \\in \\mathcal{M}_I \\ \\text{do} \\ | \\ j \\leftarrow j+1; \\end{aligned}
                   for each k from i to j do
                         for each l from k+1 to j do
                             given p^k \\equiv (z^1, w^1) and p^l \\equiv (z^2, w^2), let q^1 \\equiv (z^1, w^2) and q^2 \\equiv (z^2, w^1) in (\\mathcal{D}_{0,3} \\cap \\mathcal{C}_0) \\oplus a_i; if R^4(q^1) \\oplus R^4(q^2) \\notin \\mathcal{M}_I // Remember that R^4(p^k) \\oplus R^4(p^l) \\in \\mathcal{M}_I then
                                                                                                               // Random permutation
      end
end
                                                                                 // 4-round AES permutation - Prob. 95\\%
return 1.
                  Algorithm 1: Secret-Key Distinguisher for 4-round of AES.
</code></pre>

    <p class="text-gray-300">two pairs of texts with probability higher than pr (in order to recognize the random permutation). It follows that one needs approximately n different <em>independent</em> pairs of texts such that  <span class="math">pr \\geq 1 - (1 - 2^{-29})^n</span> , that is</p>

    <p class="text-gray-300"><span class="math">$n \\ge \\frac{\\log(1-pr)}{\\log(1-2^{-29})} \\approx -2^{29} \\cdot \\log(1-pr).</span>$</p>

    <p class="text-gray-300">For pr = 95%, one needs approximately  <span class="math">n \\ge 2^{30.583}</span>  different <em>independent</em> pairs of texts, that is approximately 2 different cosets  <span class="math">C_0 \\cap D_{0,3}</span>  for a total data cost of  <span class="math">2^{16} \\cdot 2 = 2^{17}</span>  chosen plaintexts.</p>

    <p class="text-gray-300">Computational Cost. We limit here to report the computational cost of the distinguisher, and we refer to App. B for all the details. In order to implement the distinguisher, the idea is to re-order the ciphertexts using a particular partial order  <span class="math">\\leq</span>  as defined in Def. 10, and to work in the way described in Algorithm 1.</p>

    <p class="text-gray-300">Instead of checking the previous property for all possible couples of texts, the idea is to check it only for the couples of texts for which the two ciphertexts belong to the same coset of  <span class="math">\\mathcal{M}_J</span> . In other words, if  <span class="math">c^1 \\oplus c^2 \\in \\mathcal{M}_J</span> , then one checks that  <span class="math">\\hat{c}^1 \\oplus \\hat{c}^2 \\in \\mathcal{M}_J</span>  (prob. 1 for 4-round AES vs prob.  <span class="math">2^{-32}</span>  for a random permutation). Instead, if  <span class="math">c^1 \\oplus c^2 \\notin \\mathcal{M}_J</span> , then one doesn't check that  <span class="math">\\hat{c}^1 \\oplus \\hat{c}^2 \\notin \\mathcal{M}_J</span> . Note that the probability of this last event is very close for the AES and for the random permutation (prob. 1 for 4-round AES vs prob.</p>

    <p class="text-gray-300"><span class="math">1-2^{-32}</span>  for a random permutation). In other words, checking that &quot;if  <span class="math">c^1 \\oplus c^2 \\in \\mathcal{M}_J</span>  then  <span class="math">\\hat{c}^1 \\oplus \\hat{c}^2 \\in \\mathcal{M}_J</span> &quot; is sufficient to distinguish 4-round AES from a random permutation.</p>

    <p class="text-gray-300">The reason of this strategy is that it allows to save and minimize the computational cost, which is well approximated by  <span class="math">2^{23.09}</span>  table look-ups, or approximately  <span class="math">2^{16.75}</span>  four-round encryptions (assuming  <span class="math">^{12}</span>  20 table look-ups  <span class="math">\\approx 1</span>  round of encryption), where we limit to remember that the cost to re-order a set of n texts w.r.t. a given partial order is</p>

    <p class="text-gray-300"><span class="math">$\\mathcal{O}(n \\cdot \\log n)</span>$
table look-ups.</p>

    <p class="text-gray-300"><strong>Definition 8.</strong> Let  <span class="math">I \\subset \\{0,1,2,3\\}</span>  with |I| = 3 and let  <span class="math">l \\in \\{0,1,2,3\\} \\setminus I</span> . Let  <span class="math">t^1, t^2 \\in \\mathbb{F}_{2^8}^{4 \\times 4}</span>  with  <span class="math">t^1 \\neq t^2</span> . Text  <span class="math">t^1</span>  is less or equal than text  <span class="math">t^2</span>  w.r.t. the partial order  <span class="math">\\preceq</span>  (i.e.  <span class="math">t^1 \\preceq t^2</span> ) if and only if one of the two following conditions is satisfied (indexes are taken modulo 4):</p>

    <ul class="list-disc list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li>there exists  <span class="math">j \\in \\{0,1,2,3\\}</span>  s.t.  <span class="math">MC^{-1}(t^1)_{i,l-i} = MC^{-1}(t^2)_{i,l-i}</span>  for all i &lt; j and  <span class="math">MC^{-1}(t^1)_{j,l-j} &lt; MC^{-1}(t^2)_{j,l-j}</span> ;</li>
      <li><span class="math">MC^{-1}(t^1)_{i,l-i} = MC^{-1}(t^2)_{i,l-i}</span>  for all i=0,....,3, and  <span class="math">MC^{-1}(t^1) &lt; MC^{-1}(t^2)</span>  where &lt; is defined in Def. 6.</li>
    </ul>

      <h4 id="sec-5.1.3" class="text-lg font-semibold mt-6">5.1.3 Practical Verification</h4>

    <p class="text-gray-300">Using a C/C++ implementation<sup>13</sup>, we have practically verified the distinguishers just described both for full size AES and a small scale variant of AES, as presented in [CMR05]. While for full size AES each word is composed of 8 bits, in the small scale variant each word is composed of 4 bits (we refer to [CMR05] for a complete description of this small scale AES). We highlight that the previous results hold exactly in the same way also for this small scale variant of AES, since the previous argumentation is independent of the fact that each word of AES is of 4 or 8 bits.</p>

    <p class="text-gray-300">The distinguisher just presented works in the same way for full and small scale AES, and it is able to distinguish AES from a random permutation using  <span class="math">2 \\cdot (2^8)^2 = 2^{17}</span>  chosen plaintexts in the first case and  <span class="math">2 \\cdot (2^4)^2 = 2^9</span>  in the second one (i.e. 2 cosets of  <span class="math">\\mathcal{C}_0 \\cap \\mathcal{D}_{0,3}</span> , each one of size  <span class="math">2^{16}</span>  and  <span class="math">2^8</span>  respectively for full and small scale AES<sup>14</sup>) as expected. For full size AES, while the theoretical computational cost is of  <span class="math">2^{23}</span>  table look-ups, the practical one is on average  <span class="math">2^{22}</span>  in the case of a random permutation and  <span class="math">2^{24}</span>  in the case of an AES permutation. We emphasize that for a random permutation, it is sufficient to find <em>one</em> couple of two pairs of texts that doesn't satisfy the required property (to recognize the random permutation). In the case of the AES permutation, the difference between the theoretical and the practical cases (i.e. a factor 2) is due to the fact that the cost of the merge sort algorithm is  <span class="math">O(n \\cdot \\log n)</span>  and by the definition of the big  <span class="math">O(\\cdot)</span>  notation<sup>15</sup>.</p>

    <p class="text-gray-300">For the small scale AES, using 2 different initial cosets of  <span class="math">C_0 \\cap D_{0,3}</span> , the theoretical computational cost is well approximated by  <span class="math">2 \\cdot 4 \\cdot 2^8 \\cdot (\\log 2^8 + 1) \\simeq 2^{14.2}</span>  table look-ups. The practical cost is approximately  <span class="math">2^{13.5}</span>  for the case of a random permutation and  <span class="math">2^{15}</span>  for the AES case.</p>

    <p class="text-gray-300"> <span class="math">&lt;sup&gt;^{12}&lt;/sup&gt;</span> We highlight that even if this approximation is not formally correct - the size of the table of an S-Box look-up is lower than the size of the table used for ours distinguisher, it allows to give a comparison between our distinguishers and the others currently present in the literature. This approximation is largely used in the literature.</p>

    <p class="text-gray-300"><sup>&amp;</sup>lt;sup&gt;13</sup>The source codes of the distinguishers/attacks are available at https://github.com/Krypto-iaik/Distinguisher_5RoundAES</p>

    <p class="text-gray-300">Distinguisher_5RoundAES</p>

    <p class="text-gray-300"><sup>14</sup>Following the same analysis proposed in Sect. 5.1, here we show that 2 initial cosets are necessary to set up the attack also for the small scale case. Using the same notation of Sect. 5.1.1, the probability that  <span class="math">R^4(p^1) \\oplus R^4(p^2) \\in \\mathcal{M}_J</span>  and  <span class="math">R^4(\\hat{p}^1) \\oplus R^4(\\hat{p}^2) \\notin \\mathcal{M}_J</span>  (or vice-versa) for a (small scale) random permutation is  <span class="math">2 \\cdot 4 \\cdot 2^{-16} \\cdot (1-2^{-16}) = 2^{-13}</span> . It follows that one needs  <span class="math">n \\geq 2^{14.583}</span>  different independent pairs of texts to set up the attack with probability higher than 95%, that is approximately 2 different cosets  <span class="math">\\mathcal{C}_0 \\cap \\mathcal{D}_{0,3}</span>  (note that for each coset it is possible to construct  <span class="math">\\frac{1}{2} \\cdot {2^8 \\choose 2} \\approx 2^{14}</span>  independent pairs of texts).</p>

    <p class="text-gray-300"><sup>&amp;</sup>lt;sup&gt;15</sup>A similar difference among the theoretical and the practical cases was present also in [GRR17a].</p>

      <h3 id="sec-5.2" class="text-xl font-semibold mt-8">5.2 Generic Mixture Differential Distinguishers for 4-round AES</h3>

    <p class="text-gray-300">Using results presented in [GRR17a] and recalled in detail in Sect. 4, it is possible to set up alternative 4-round &quot;mixture differential&quot; distinguishers also for any pair of plaintexts  <span class="math">p^1</span>  and  <span class="math">p^2</span>  that have different generating variables or that belong to the same coset of a subspace  <span class="math">\\mathcal{C}_I</span>  for each  <span class="math">I \\subseteq \\{0,1,2,3\\}</span> . For sake of simplicity, we don't list all possible cases, but we limit to (formally) present two cases that are used to set up new secret-key distinguishers - see Sect. 7 for details - and new key-recovery attacks for AES - see Sect. 6. The proof of the following distinguishers is based on the one just proposed, adapted to the analyzed case. As before, also the following distinguishers work in both the decryption and encryption direction<sup>16</sup>.</p>

    <p class="text-gray-300">Starting Point for 5-round Distinguisher proposed in Sect. 7. As first case, we present a generalization of the result proposed in Lemma 4.</p>

    <p class="text-gray-300"><strong>Theorem 3.</strong> Given the subspace  <span class="math">C_0 \\cap D_{0,3} \\equiv \\langle e_{0,0}, e_{1,0} \\rangle \\subseteq C_0</span> , consider two plaintexts  <span class="math">p^1</span>  and  <span class="math">p^2</span>  in the same coset  <span class="math">(C_0 \\cap D_{0,3}) \\oplus a</span>  generated by  <span class="math">p^1 \\equiv (z^1, w^1)</span>  and  <span class="math">p^2 \\equiv (z^2, w^2)</span> . Let  <span class="math">\\tilde{p}^1, \\tilde{p}^2 \\in C_0 \\oplus a</span>  be two other plaintexts generated by</p>

    <p class="text-gray-300"><span class="math">$\\tilde{p}^1 \\equiv (z^1, w^1, x, y), \\ \\tilde{p}^2 \\equiv (z^2, w^2, x, y) \\quad or \\quad \\tilde{p}^1 \\equiv (z^1, w^2, x, y), \\ \\tilde{p}^2 \\equiv (z^1, w^2, x, y)</span>$</p>

    <p class="text-gray-300">where x and y can take any possible value in  <span class="math">\\mathbb{F}_{2^8}</span> . The following event</p>

    <p class="text-gray-300"><span class="math">$R^4(p^1) \\oplus R^4(p^2) \\in \\mathcal{M}_J</span>$
if and only if  <span class="math">R^4(\\tilde{p}^1) \\oplus R^4(\\tilde{p}^2) \\in \\mathcal{M}_J</span></p>

    <p class="text-gray-300">holds with prob. 1 for 4-round AES, independently of the secret key, of the details of the S-Box and of the MixColumns matrix (except for the branch number equal to 5).</p>

    <p class="text-gray-300">The proof of this result is equivalent to the one proposed in Sect. 5.1.1. In particular, let  <span class="math">q^1 = SR(p^1)</span>  and  <span class="math">q^2 = SR(p^2)</span>  as before. If a column of  <span class="math">q^1</span>  is equal to the corresponding column of  <span class="math">q^2</span> , it follows that the difference super-Sbox <span class="math">(q^1) \\oplus</span>  super-Sbox <span class="math">(q^2)</span>  is independent of the value of such column. As a result, the difference  <span class="math">R^2(p^1) \\oplus R^2(p^2)</span>  is independent of the generating variables which are equal for  <span class="math">p^1</span>  and  <span class="math">p^2</span> . It follows that</p>

    <p class="text-gray-300"><span class="math">$R^{2}(p^{1}) \\oplus R^{2}(p^{2}) = R^{2}(\\tilde{p}^{1} \\equiv (z^{1}, w^{1}, x, y)) \\oplus R(\\tilde{p}^{2} \\equiv (z^{2}, w^{2}, x, y)) =</span>$</p>

    <p class="text-gray-300"><span class="math">$= R^{2}(\\tilde{p}^{1} \\equiv (z^{1}, w^{2}, x, y)) \\oplus R(\\tilde{p}^{2} \\equiv (z^{2}, w^{1}, x, y)),</span>$</p>

    <p class="text-gray-300">which implies the result since  <span class="math">Prob(R^2(x) \\oplus R^2(y) \\in \\mathcal{M}_J \\mid x \\oplus y \\in \\mathcal{D}_J) = 1</span> .</p>

    <p class="text-gray-300">Such result is the starting point for new 5-round secret-key distinguisher of AES, as proposed in Sect. 7. We finally emphasize that the previous result is based on Lemma 3 (proposed in [GRR17a]).</p>

    <p class="text-gray-300">Starting Point for Key-Recovery Attack of Sect. 6. As second case, we consider two plaintexts in a coset of  <span class="math">C_0</span>  (or more generally  <span class="math">C_I</span>  for |I| = 1) generated by different generating variables.</p>

    <p class="text-gray-300"><strong>Theorem 4.</strong> Given the subspace  <span class="math">C_0 \\equiv \\langle e_{0,0}, e_{1,0}, e_{2,0}, e_{3,0} \\rangle</span> , consider two plaintexts  <span class="math">p^1</span>  and  <span class="math">p^2</span>  in the same coset  <span class="math">C_0 \\oplus a</span>  generated by  <span class="math">p^1 \\equiv (x^1, y^1, z^1, w^1)</span>  and  <span class="math">p^2 \\equiv (x^2, y^2, z^2, w^2)</span> . Let  <span class="math">\\tilde{p}^1, \\tilde{p}^2 \\in C_0 \\oplus a</span>  be two other plaintexts generated by</p>

    <p class="text-gray-300"><span class="math">$\\begin{array}{llllllllllllllllllllllllllllllllllll</span>$</p>

    <p class="text-gray-300"><sup>&amp;</sup>lt;sup&gt;16</sup>This is due to the fact that such distinguishers re-exploit the one proposed in [GRR17a], which has the property to work in both directions.</p>

    <p class="text-gray-300"><span class="math">$R^4(p^1) \\oplus R^4(p^2) \\in \\mathcal{M}_J</span>$
if and only if  <span class="math">R^4(\\tilde{p}^1) \\oplus R^4(\\tilde{p}^2) \\in \\mathcal{M}_J</span></p>

    <p class="text-gray-300">holds with prob. 1 for 4-round AES, independently of the secret key, of the details of the S-Box and of the MixColumns matrix (except for the branch number equal to 5).</p>

    <p class="text-gray-300">The proof of this result is equivalent to the one proposed in Sect. 5.1.1. In particular, let  <span class="math">q^1 = SR(p^1)</span>  and  <span class="math">q^2 = SR(p^2)</span>  as before. Since (1st) the super-Sbox(&middot;) works independently on each column of  <span class="math">q^1</span>  and  <span class="math">q^2</span> , (2nd) the columns of  <span class="math">q^1</span>  and  <span class="math">q^2</span>  depend on different and independent variables and (3rd) the XOR sum is commutative, it follows that</p>

    <p class="text-gray-300"><span class="math">$super-Sbox(q^1) \\oplus super-Sbox(q^2) = super-Sbox(\\tilde{q}^1) \\oplus super-Sbox(\\tilde{q}^2)</span>$</p>

    <p class="text-gray-300">where  <span class="math">\\tilde{q}^i = SR(\\tilde{p}^i)</span>  and where  <span class="math">\\tilde{p}^i</span>  are defined as before. Thus,  <span class="math">R^2(p^1) \\oplus R^2(p^2) = R^2(\\tilde{p}^1) \\oplus R^2(\\tilde{p}^2)</span> , which implies the result since  <span class="math">Prob(R^2(x) \\oplus R^2(y) \\in \\mathcal{M}_J \\mid x \\oplus y \\in \\mathcal{D}_J) = 1</span> .</p>

    <p class="text-gray-300">Such result is used in Sect. 6 to set up a new key-recovery attack on 5-round AES. We finally emphasize that the previous result is based on Lemma 2 (proposed in [GRR17a]).</p>

    <p class="text-gray-300">Here we highlight the major differences with respect to the other 4-round AES secret-key distinguishers present in the literature. Omitting the integral one (which exploits a completely different property), we focus on the impossible and the truncated differential distinguishers, on the polytopic cryptanalysis, on the &quot;multiple-of-8&quot; distinguisher (adapted - in a natural way - to the 4-round case) and on the yoyo distinguisher.</p>

    <p class="text-gray-300"><strong>Impossible Differential.</strong> The impossible differential distinguisher is based on Prop. 1, that is it exploits the property that  <span class="math">\\mathcal{M}_I \\cap \\mathcal{D}_J = \\{0\\}</span>  for  <span class="math">|I| + |J| \\le 4</span> . In our case, we consider plaintexts in the same coset of  <span class="math">\\mathcal{C}_0 \\cap \\mathcal{D}_I \\subseteq \\mathcal{D}_I</span>  where  <span class="math">|I| \\ge 2</span>  (e.g.  <span class="math">I = \\{0, 3\\}</span> ) and looks for collisions in  <span class="math">\\mathcal{M}_J</span>  with |J| = 3. Since  <span class="math">|I| + |J| \\ge 5</span> , the property exploited by the impossible differential distinguisher cannot be applied here.</p>

    <p class="text-gray-300"><strong>Truncated Differential.</strong> The truncated differential distinguisher has instead some aspects in common with our distinguisher. In this case, given pairs of plaintexts with certain difference on certain bytes (i.e. that belong to the same coset of a subspace  <span class="math">\\mathcal{X}</span> ), one considers the probability that the corresponding ciphertexts belong to the same coset of a subspace  <span class="math">\\mathcal{Y}</span> . For 2-round AES it is possible to exploit truncated differential trails with probability 1, while for the 3-round case there exist truncated differential trails with probability lower than 1 but higher than for the random case<sup>17</sup> (in both cases,  <span class="math">\\mathcal{X} \\equiv \\mathcal{D}_I</span>  and  <span class="math">\\mathcal{Y} \\equiv \\mathcal{M}_J</span> ).</p>

    <p class="text-gray-300">Our distinguisher works in a similar way and exploits a similar property. However, instead of working with a single couple of texts independently of the others, in our distinguisher one basically considers sets of 2 &quot;non-independent&quot; couples of texts and exploits the relationships that hold among the couples of texts that belong to the same set.</p>

    <p class="text-gray-300"><strong>Polytopic Cryptanalysis.</strong> Polytopic cryptanalysis [Tie16] has been introduced by Tiessen at Eurocrypt 2016, and it can be viewed as a generalization of standard differential cryptanalysis. Consider a set of  <span class="math">d \\geq 2</span>  couples of plaintexts  <span class="math">(p^0, p^0 \\oplus \\alpha^1), (p^0, p^0 \\oplus \\alpha^2), ...(p^0, p^0 \\oplus \\alpha^d)</span>  with one plaintext in common (namely  <span class="math">p^0</span> ), called d-poly. The idea of polytopic cryptanalysis is to exploit the probability that the input set of differences</p>

    <p class="text-gray-300">Target 3-round AES it holds that  <span class="math">Prob(R^3(x) \\oplus R^3(y) \\in \\mathcal{M}_J \\mid x \\oplus y \\in \\mathcal{D}_I) = \\left(2^{8\\cdot |I|}\\right)^{-4+|J|}</span> , while for a random permutation  <span class="math">\\Pi(\\cdot)</span>  it holds that  <span class="math">Prob(\\Pi(x) \\oplus \\Pi(y) \\in \\mathcal{M}_J \\mid x \\oplus y \\in \\mathcal{D}_I) = \\left(2^{32}\\right)^{-4+|J|}</span> .</p>

    <p class="text-gray-300"><span class="math">\\alpha \\equiv (\\alpha^1, \\alpha^2, ..., \\alpha^d)</span>  is mapped into an output set of differences  <span class="math">\\beta \\equiv (\\beta^1, \\beta^2, ..., \\beta^d)</span>  after r rounds. If this probability  <span class="math">^{18}</span>  - which depends on the S-Box details - is different from the corresponding probability in the case of a random permutation, it is possible to set up distinguishers or key-recovery attacks. Impossible polytopic cryptanalysis focuses on the case in which the probability of the previous event is zero. In [Tie16], an impossible 8-polytopic is proposed for 2-round AES, which allows to set up key-recovery attacks on 4- and 5-round AES.</p>

    <p class="text-gray-300">Our proposed distinguisher works in a similar way, since also in our case we consider sets of &quot;non-independent&quot; couples of texts and we focus on the input/output differences. However, instead of working with a set of couples of plaintexts with one plaintext in common, we consider sets of couples of texts for which particular relationships between the generating variables of the texts hold. Moreover, instead of considering the probability that &quot;generic&quot; input differences  <span class="math">\\alpha</span>  are mapped into output differences  <span class="math">\\beta</span> , the way in which the texts are divided in sets guarantees the two ciphertexts of all couples satisfy or not an output (truncated) difference independently of the S-Box details (that is, it is not possible that some of them satisfy this output difference and some others not).</p>

    <p class="text-gray-300">&quot;Multiple-of-8&quot; Distinguisher. The &quot;multiple-of-8&quot; distinguisher [GRR17a] can be adapted to the 4-round case, e.g. considering plaintexts in the same coset of  <span class="math">C_J</span> , counting the number of collisions of the ciphertexts in the same coset of  <span class="math">\\mathcal{M}_I</span>  and checking if it is (or not) a multiple of 8. Since our distinguisher exploits more information (that is, the relationships that hold among the generating variables of the couples of plaintexts in the same set, beside the fact that the previous number is a multiple of 8), its data and computational costs are lower than [GRR17a], in particular  <span class="math">2^{17}</span>  chosen plaintexts/ciphertexts instead of  <span class="math">2^{33}</span>  and approximately  <span class="math">2^{23}</span>  table look-ups instead of  <span class="math">2^{40}</span> .</p>

    <p class="text-gray-300"><strong>Yoyo Distinguisher.</strong> The basic idea exploited by the <em>yoyo distinguisher</em> [RBH17] proposed at Asiacrypt 2017 is similar to the one exploited by our distinguisher. Consider 4-round AES, where the initial and the final ShiftRows and the final MixColumns operations are omitted <sup>19</sup>. Given a pair of plaintexts in the same coset of a column space  <span class="math">\\mathcal{C}_I</span>  - that is  <span class="math">p^1, p^2 \\in \\mathcal{C}_I \\oplus a</span> , consider the corresponding ciphertexts  <span class="math">c^1</span>  and  <span class="math">c^2</span>  after 4 rounds. In the yoyo game, the idea is to construct a new pair of ciphertexts  <span class="math">\\hat{c}^1</span>  and  <span class="math">\\hat{c}^2</span>  by swapping the columns of  <span class="math">c^1</span>  and  <span class="math">c^2</span> . E.g., if  <span class="math">c^i \\equiv (c^i_0, c^i_1, c^i_2, c^i_3)</span>  for i=1,2 where  <span class="math">c^i_j</span>  denotes the j-th column of  <span class="math">c^i</span> , one can define the new pair of ciphertexts as  <span class="math">\\hat{c}^1 \\equiv (c^0_0, c^1_1, c^1_2, c^1_3)</span>  and  <span class="math">\\hat{c}^2 \\equiv (c^1_0, c^2_1, c^2_2, c^2_3)</span> . As proved in [RBH17], the corresponding plaintexts  <span class="math">\\hat{p}^1 = R^{-4}(\\hat{c}^1)</span>  and  <span class="math">\\hat{p}^2 = R^{-4}(\\hat{c}^2)</span>  belong to the same coset of  <span class="math">\\mathcal{C}_I</span>  with prob. 1 for 4-round AES (that is,  <span class="math">\\hat{p}^1 \\oplus \\hat{p}^2 \\in \\mathcal{C}_I</span>  with prob. 1), while this happens with prob.  <span class="math">2^{-32\\cdot(4-|I|)}</span>  for a random permutation.</p>

    <p class="text-gray-300">Our distinguisher and the yoyo one are very similar. Both ones exploit particular relationships that hold among the generating variables of a pair of texts and particular properties which depend on such relations to distinguish 4-round AES from a random permutation. However, we emphasize that while the yoyo distinguisher requires adaptive chosen ciphertexts in order to construct new pairs of texts related to the original one, in our case such new pairs of texts are constructed directly from the chosen plaintexts. In other words, ours distinguisher doesn't require adaptive chosen plaintexts/ciphertexts.</p>

    <p class="text-gray-300"><sup>&amp;</sup>lt;sup&gt;18</sup>We mention that the probability of polytopic trails is usually much lower than the probability of trails in differential cryptanalysis, that is simple polytopic cryptanalysis can not in general outperform standard differential cryptanalysis - see Sect. 2 of [Tie16] for details.</p>

    <p class="text-gray-300"> <span class="math">&lt;sup&gt;^{19}&lt;/sup&gt;</span> The distinguisher works as well also in the case in which these linear operations are not omitted. We refer to [RBH17] for all the details.</p>

    <p class="text-gray-300">The modified version of the previous 4-round secret-key distinguisher proposed in Sect. 5.2 can be used as starting point to set up a new (practical verified) key-recovery attack on 5-round AES.</p>

    <p class="text-gray-300">W.l.o.g. consider two plaintexts  <span class="math">p^1</span>  and  <span class="math">p^2</span>  in the same coset of  <span class="math">\\mathcal{D}_0</span> , e.g.  <span class="math">\\mathcal{D}_0 \\oplus a</span>  for  <span class="math">a \\in \\mathcal{D}_0^{\\perp}</span> , such that  <span class="math">p^i = x^i \\cdot e_{0,0} \\oplus y^i \\cdot e_{1,1} \\oplus z^i \\cdot e_{2,2} \\oplus w^i \\cdot e_{3,3} \\oplus a</span>  or equivalently  <span class="math">p^i \\equiv (x^i, y^i, z^i, w^i)</span> . By Theorem 1, there exists  <span class="math">b \\in \\mathcal{C}_0^{\\perp}</span>  such that</p>

    <p class="text-gray-300"><span class="math">$R(p^i) = \\begin{bmatrix} \\hat{x}^i &amp; 0 &amp; 0 &amp; 0 \\\\ \\hat{y}^i &amp; 0 &amp; 0 &amp; 0 \\\\ \\hat{z}^i &amp; 0 &amp; 0 &amp; 0 \\\\ \\hat{w}^i &amp; 0 &amp; 0 &amp; 0 \\end{bmatrix} \\oplus b \\equiv MC \\cdot \\begin{bmatrix} \\text{S-Box}(x^i \\oplus k_{0,0}) &amp; 0 &amp; 0 &amp; 0 \\\\ \\text{S-Box}(y^i \\oplus k_{1,1}) &amp; 0 &amp; 0 &amp; 0 \\\\ \\text{S-Box}(z^i \\oplus k_{2,2}) &amp; 0 &amp; 0 &amp; 0 \\\\ \\text{S-Box}(w^i \\oplus k_{3,3}) &amp; 0 &amp; 0 &amp; 0 \\end{bmatrix} \\oplus b</span>$</p>

    <p class="text-gray-300">for i = 1, 2, that is</p>

    <p class="text-gray-300"><span class="math">$R(p^{i}) \\equiv (\\hat{x}^{i}, \\hat{y}^{i}, \\hat{z}^{i}, \\hat{w}^{i}) \\equiv \\hat{x}^{i} \\cdot e_{0,0} \\oplus \\hat{y}^{i} \\cdot e_{1,0} \\oplus \\hat{z}^{i} \\cdot e_{2,0} \\oplus \\hat{w}^{i} \\cdot e_{3,0} \\oplus b.</span>$</p>

    <p class="text-gray-300">The idea is to filter wrongly guessed keys of the first round by exploiting the previous distinguisher.</p>

    <p class="text-gray-300">In particular, given plaintexts in the same coset of  <span class="math">\\mathcal{D}_0</span> , the idea of the attack is simply to guess 4 bytes of the first diagonal of the secret key k, that is  <span class="math">k_{i,i}</span>  for each  <span class="math">i \\in \\{0, 1, 2, 3\\}</span> , to (partially) compute  <span class="math">R_k(p^1)</span>  and  <span class="math">R_k(p^2)</span>  and to exploit the following consideration: if the guessed key is the right one, then</p>

    <p class="text-gray-300"><span class="math">$R^4[R_k(p^1)] \\oplus R^4[R_k(p^2)] \\in \\mathcal{M}_J</span>$</p>

    <p class="text-gray-300">if and only if there exist other pairs of texts  <span class="math">R_k(q^1)</span>  and  <span class="math">R_k(q^2)</span>  with the same property, that is</p>

    <p class="text-gray-300"><span class="math">$R^4[R_k(q^1)] \\oplus R^4[R_k(q^2)] \\in \\mathcal{M}_J</span>$</p>

    <p class="text-gray-300">where  <span class="math">R_k(q^1)</span>  and  <span class="math">R_k(q^2)</span>  are defined by a different combination of the generating variables of  <span class="math">R_k(p^1)</span>  and  <span class="math">R_k(p^2)</span> . If this property is not satisfied and due to the distinguisher just proposed, then it is possible to claim that the guessed key is a wrong candidate. As we are going to show, this attack works because the variables that define the (other) pairs of texts  <span class="math">R_k(q^1)</span>  and  <span class="math">R_k(q^2)</span>  depend on the guessed key (besides on the texts  <span class="math">p^1</span>  and  <span class="math">p^2</span> ).</p>

    <h4 id="sec-misc-1" class="text-lg font-semibold mt-6"><strong>Details of the Attack</strong></h4>

    <p class="text-gray-300">In the following we give all the details of the attack. As for the distinguisher just presented, consider a pair of texts  <span class="math">p^1</span>  and  <span class="math">p^2</span>  in the same coset of  <span class="math">\\mathcal{D}_0</span>  such that</p>

    <ul class="list-disc list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li><span class="math">c^1 \\oplus c^2 \\equiv R^5(p^1) \\oplus R^5(p^2) \\in \\mathcal{M}_J</span>  (observe that this condition is independent of the (partially) guessed key);</li>
      <li><span class="math">R(p^i) \\equiv (\\hat{x}^i, \\hat{y}^i, \\hat{z}^i, \\hat{w}^i)</span>  for i = 1, 2 as before, s.t.  <span class="math">\\hat{x}^1 \\neq \\hat{x}^2, \\ \\hat{y}^1 \\neq \\hat{y}^2, \\ \\hat{z}^1 \\neq \\hat{z}^2</span>  and  <span class="math">\\hat{w}^1 \\neq \\hat{w}^2</span> .</li>
    </ul>

    <p class="text-gray-300">For completeness, we emphasize that the attack works even if one or two generating variables of  <span class="math">R(p^1)</span>  and  <span class="math">R(p^2)</span>  are equal (e.g. if two generating variables are equal, in the following it is sufficient to exploit Lemma 3 instead of Lemma 2). We limit to discuss the case in which the generating variables are all different <em>only</em> for sake of simplicity, and since this is the event that happens with highest probability (the probability that all the generating variables are different is  <span class="math">[(256 \\cdot 255)/256^2]^4 = \\frac{255^4}{256^4} \\simeq 98.45\\%</span> ). Due to the definition of  <span class="math">\\hat{x}^i, \\hat{y}^i, \\hat{z}^i, \\hat{w}^i</span></p>

    <p class="text-gray-300"><span class="math">$[\\hat{x}^i,\\,\\hat{y}^i\\,\\hat{z}^i\\,\\hat{w}^i]^T\\equiv MC\\cdot[\\operatorname{S-Box}(x^i\\oplus k_{0,0}),\\,\\operatorname{S-Box}(y^i\\oplus k_{1,1}),\\,\\operatorname{S-Box}(z^i\\oplus k_{2,2}),\\,\\operatorname{S-Box}(w^i\\oplus k_{3,3})]^T,</span>$</p>

    <p class="text-gray-300">note that the second condition depends on the (partially) guessed key.</p>

    <p class="text-gray-300">Given  <span class="math">p^1</span>  and  <span class="math">p^2</span>  as before, we have to define  <span class="math">R_k(q^1)</span>  and  <span class="math">R_k(q^2)</span>  in order to set up the distinguisher. Using Lemma 2 and the &quot;super-Sbox&quot; argumentation given in Sect. 5.1.1, it is possible to construct 7 different pairs of - intermediate - texts  <span class="math">R_k(q^1)</span>  and  <span class="math">R_k(q^2)</span>  in  <span class="math">\\mathcal{C}_0 \\oplus b</span>  defined by the following combinations of generating variables</p>

    <p class="text-gray-300"><span class="math">$\\begin{array}{llllllllllllllllllllllllllllllllllll</span>$</p>

    <p class="text-gray-300">that must satisfy the required property</p>

    <p class="text-gray-300"><span class="math">$R^4[R_k(p^1)] \\oplus R^4[R_k(p^2)] \\in \\mathcal{M}_J \\quad iff \\quad R^4[R_k(q^1)] \\oplus R^4[R_k(q^2)] \\in \\mathcal{M}_J.</span>$</p>

    <p class="text-gray-300">Using this observation, it is possible to filter all the wrong keys. Again, since  <span class="math">R^5(p^1) \\oplus R^5(p^2) \\in \\mathcal{M}_J</span> , all these pairs of - intermediate - texts  <span class="math">(R_k(q^1), R_k(q^2))</span>  must belong to the same coset of  <span class="math">\\mathcal{M}_J</span>  after 4 rounds if the guessed key is the right one. If this property is not satisfied, then one can simply deduce that the guessed key is wrong (for a wrong guessed key, the behavior is similar to the one of a random permutation).</p>

    <p class="text-gray-300">Why does the attack work? Wrong-Key Randomization Hypothesis! One of the assumption required by the proposed attack is the &quot;wrong-key randomization hypothesis&quot;. This hypothesis states that when decrypting one or several rounds with a wrong key guess creates a function that behaves like a random function. For our setting, we formulate it as following:</p>

    <p class="text-gray-300">Wrong-key randomization hypothesis. When the pairs of - intermediate - texts  <span class="math">R_k(q^1)</span>  and  <span class="math">R_k(q^2)</span>  are generated using a wrongly guessed key, the probability that the resulting pairs of ciphertexts satisfy the required property is equal to the probability given for the case of a random permutation.</p>

    <p class="text-gray-300">In the following we show that such assumption holds. The crucial point is that the new pairs of texts  <span class="math">R_k(q^1)</span>  and  <span class="math">R_k(q^2)</span>  (and the way in which they are constructed) depend on the guessed key.</p>

    <p class="text-gray-300">In the proposed attack, the wrong-key randomization hypothesis follows immediately from the definition of the generating variables and from the fact that the S-Box is a non-linear operation. To have more evidence of this fact, let k be the secret key and  <span class="math">\\tilde{k}</span>  be a guessed key. Given  <span class="math">R_k(p^1) \\equiv (x^1, y^1, z^1, w^1)</span>  and  <span class="math">R_k(p^2) \\equiv (x^2, y^2, z^2, w^2)</span>  in  <span class="math">C_0 \\oplus b</span>  as before, the generating variables of  <span class="math">R_{\\tilde{k}}(q^1) \\equiv (\\tilde{x}^1, \\tilde{y}^1, \\tilde{z}^1, \\tilde{w}^1)</span>  and  <span class="math">R_{\\tilde{k}}(q^2) \\equiv (\\tilde{x}^2, \\tilde{y}^2, \\tilde{z}^2, \\tilde{w}^2)</span>  in  <span class="math">C_0 \\oplus b</span>  are given by</p>

    <p class="text-gray-300"><span class="math">$\\begin{bmatrix} \\tilde{x}^i \\\\ \\tilde{y}^i \\\\ \\tilde{z}^i \\\\ \\tilde{w}^i \\end{bmatrix} = MC \\circ \\text{S-Box} \\circ \\begin{pmatrix} \\begin{bmatrix} \\tilde{k}_{0,0} \\oplus k_{0,0} \\\\ \\tilde{k}_{1,1} \\oplus k_{1,1} \\\\ \\tilde{k}_{2,2} \\oplus k_{2,2} \\\\ \\tilde{k}_{3,3} \\oplus k_{3,3} \\end{bmatrix} \\oplus \\text{S-Box}^{-1} \\circ MC^{-1} \\circ \\begin{bmatrix} x^h \\\\ y^j \\\\ z^k \\\\ w^l \\end{bmatrix} \\end{pmatrix}</span>$</p>

    <p class="text-gray-300">for certain  <span class="math">h, j, k, l \\in \\{1, 2\\}</span> . For a wrongly guessed key  <span class="math">\\tilde{k} \\neq k</span> , the relations among the generating variables  <span class="math">[\\tilde{x}^i, \\tilde{y}^i, \\tilde{z}^i, \\tilde{w}^i] = [x^h, y^j, z^k, w^l]</span>  do not hold<sup>20</sup>. It follows that if  <span class="math">k \\neq \\tilde{k}</span> , then the attacker is considering random pairs of texts, which implies that the required property is - in general - not satisfied (as for the case of a random permutation).</p>

    <p class="text-gray-300">Note that if  <span class="math">k = \\tilde{k}</span> , then  <span class="math">\\tilde{x}^i = x^h</span> ,  <span class="math">\\tilde{y}^i = y^j</span> ,  <span class="math">\\tilde{z}^i = z^k</span>  and  <span class="math">\\tilde{w}^i = w^l</span>  (which implies that the required property is satisfied) as expected.</p>

    <pre><code class="language-text">Data: 1 coset of \\mathcal{D}_0 (e.g. \\mathcal{D}_0 \\oplus a for a \\in \\mathcal{D}_0^{\\perp}) and corresponding ciphertexts after 5
         rounds - more generally a coset of \\mathcal{D}_i for i \\in \\{0, 1, 2, 3\\}
Result: 4 bytes of the secret key - (k_{0,0}, k_{1,1}, k_{2,2}, k_{3,3})
let (p^i, c^i) for i = 0, ..., 2^{32} - 1 be the 2^{32} (plaintexts, ciphertexts) of \\mathcal{D}_0 \\oplus a;
do
    find indexes j and h s.t. c^j \\oplus c^h \\in \\mathcal{M}_I;
    for each one of the 2^{32} combinations of \\hat{k} = (k_{0.0}, k_{1.1}, k_{2.2}, k_{3.3}) do
         (partially) compute R_{\\hat{k}}(p^j) and R_{\\hat{k}}(p^h);
         for each couple (q^1, R^5(q^1)) and (q^2, R^5(q^2)) where R_{\\hat{k}}(q^1) and R_{\\hat{k}}(q^2) are
           constructed by a different combination of the generating variables of R_k(p^j)
           and R_{\\hat{k}}(p^h) do
              if R^{5}(q^{1}) \\oplus R^{5}(q^{2}) \\notin \\mathcal{M}_{I} then
                   flag \\leftarrow 1;
                  fiag \\leftarrow 1;
next combination of (k_{0,0}, k_{1,1}, k_{2,2}, k_{3,3});
              end
         if flag = 0 then
          identify (k_{0.0}, k_{1.1}, k_{2.2}, k_{3.3}) as candidate of the key;
         end
</code></pre>

    <p class="text-gray-300">while more than a single candidate of the key is found - Repeat the procedure for different indexes j, h (and I) // usually not necessary - only one candidate is found; return  <span class="math">(k_{0,0}, k_{1,1}, k_{2,2}, k_{3,3})</span></p>

    <p class="text-gray-300"><strong>Algorithm 2:</strong> 5-round AES Key-Recovery Attack. The attack exploits the 4-round distinguisher presented in Sect. 5.2. For sake of simplicity, in this pseudo-code we limit to describe the attack of 4 bytes - 1 diagonal of the secret key (the same attack can be used to recover the entire key).</p>

    <p class="text-gray-300">Before going on, we emphasize that this result also implies the <em>impossibility to set up a</em> 5-round distinguisher similar to the one just presented in this section choosing plaintexts in the same coset of a diagonal space  <span class="math">\\mathcal{D}_I</span>  instead of a column space  <span class="math">\\mathcal{C}_I</span> . Indeed, given  <span class="math">p^1</span>  and  <span class="math">p^2</span>  as before in the same coset of  <span class="math">\\mathcal{D}_I</span>  (instead of  <span class="math">\\mathcal{C}_I</span> ), since the key k is secret and the S-Box is non-linear, there is no way to find  <span class="math">\\hat{p}^1</span>  and  <span class="math">\\hat{p}^2</span>  in the coset of  <span class="math">\\mathcal{D}_I</span>  s.t.  <span class="math">R^5(p^1) \\oplus R^5(p^2) \\in \\mathcal{M}_J</span>  if and only if  <span class="math">R^5(\\hat{p}^1) \\oplus R^5(\\hat{p}^2) \\in \\mathcal{M}_J</span>  without guessing the secret key.</p>

    <p class="text-gray-300"><strong>Data Cost.</strong> First of all, since the cardinality of a coset of  <span class="math">\\mathcal{D}_I</span>  for |I|=1 is  <span class="math">2^{32}</span>  and since  <span class="math">Prob(t \\in \\mathcal{M}_J) = 4 \\cdot 2^{-32} = 2^{-30}</span>  for |J|=3, the average number of collisions for each coset of  <span class="math">\\mathcal{D}_I</span>  is approximately  <span class="math">2^{-30} \\cdot \\binom{2^{32}}{2} \\simeq 2^{-30} \\cdot 2^{63} \\simeq 2^{33}</span> , so it's very likely that two (plaintexts, ciphertexts) pairs  <span class="math">(p^1, c^1)</span>  and  <span class="math">(p^2, c^2)</span>  exist such that  <span class="math">c^1 \\oplus c^2 \\in \\mathcal{M}_J</span>  and for which the two plaintexts have different generating variables.</p>

    <p class="text-gray-300">Given a couple of plaintexts  <span class="math">p^1</span>  and  <span class="math">p^2</span>  for which the corresponding ciphertext  <span class="math">c^1</span>  and  <span class="math">c^2</span>  belong to the same coset of  <span class="math">\\mathcal{M}_J</span> , consider the other 7 couples of plaintexts  <span class="math">q^1</span>  and  <span class="math">q^2</span>  defined as before (that is, such that  <span class="math">R(q^1)</span>  and  <span class="math">R(q^2)</span>  are defined by a different combination of the generating variables of  <span class="math">R(p^1)</span>  and  <span class="math">R(p^2)</span> ). For a wrong key, the probability that the two ciphertexts of each one of the other 7 couples belong to the same coset of  <span class="math">\\mathcal{M}_J</span>  for a fixed J (that is, the probability that a wrong key passes the test) is  <span class="math">(2^{-32})^7 = 2^{-224}</span> .</p>

    <p class="text-gray-300">Since there are  <span class="math">2^{32}-1</span>  wrong candidates for the diagonal of the key, the probability that at least one of them passes the test is approximately  <span class="math">1-(1-2^{-224})^{2^{32}-1} \\simeq 2^{-192}</span> . Thus, one couple of plaintexts  <span class="math">p^1</span>  and  <span class="math">p^2</span>  (for which the corresponding ciphertexts belong</p>

    <p class="text-gray-300">to the same coset of  <span class="math">\\mathcal{M}_J</span> ) together with the corresponding other 7 couples of texts  <span class="math">q^1</span>  and  <span class="math">q^2</span>  are (largely) sufficient to discard all the wrong candidates for a diagonal of the key. Actually, in general only two different couples  <span class="math">q^1</span>  and  <span class="math">q^2</span>  (that is, two couples of texts given by two different combinations of the generating variables) are sufficient to discard all the wrong candidates, so it is not necessary to consider all the 7 pairs of texts  <span class="math">q^1</span>  and  <span class="math">q^2</span> . Indeed, given two couples, the probability that at least one wrong key passes the test is approximately  <span class="math">1 - (1 - 2^{-32 \\cdot 2})^{2^{3^2} - 1} \\simeq 2^{-32} \\ll 1</span> , which means that all the wrong candidates are discarded with high probability.</p>

    <p class="text-gray-300">As a result, the attack requires  <span class="math">2^{33.6}</span>  chosen plaintexts.</p>

    <p class="text-gray-300">Computational Cost. Each coset of  <span class="math">\\mathcal{D}_I</span>  with |I|=1 is composed of  <span class="math">2^{32}</span>  texts, thus on average  <span class="math">2^{63} \\cdot 2^{-32} = 2^{31}</span>  different pairs of ciphertexts belong to the same coset of  <span class="math">\\mathcal{M}_J</span>  for a fixed J with |J|=3. However, it is sufficient to find one collision in order to implement the attack and to find the key.</p>

    <p class="text-gray-300">In order to find it, the best strategy is to re-order the ciphertexts with respect to the partial order  <span class="math">\\leq</span>  and then to work on consecutive elements, as done in Sect. 5.1.2. For each initial coset of  <span class="math">\\mathcal{D}_I</span>  and for a fixed J, the cost to re-order the ciphertexts with respect to the partial order  <span class="math">\\leq</span>  (for  <span class="math">\\mathcal{M}_J</span>  with J fixed - |J|=3) and to find a collision is approximately of  <span class="math">2^{32} \\cdot (\\log 2^{32} + 1) = 2^{37}</span>  table look-ups.</p>

    <p class="text-gray-300">When such a collision is found, one has to guess 4 bytes of the key and to construct at least - two other different couples given by a different combination of the generating variables of  <span class="math">R(p^1)</span>  and  <span class="math">R(p^2)</span>  (observe that the condition  <span class="math">\\hat{x}^1 \\neq \\hat{x}^2</span> ,  <span class="math">\\hat{y}^1 \\neq \\hat{y}^2</span> ,  <span class="math">\\hat{z}^1 \\neq \\hat{z}^2</span>  and  <span class="math">\\hat{w}^1 \\neq \\hat{w}^2</span>  is satisfied with probability  <span class="math">(255/256)^4 \\approx 1</span> ). In order to perform this step efficiently, the idea is to re-order - and to store separately a second copy of - the (plaintexts, ciphertexts) pairs w.r.t. the partial order  <span class="math">\\leq</span>  as defined in Def. 6 s.t.  <span class="math">p^i \\leq p^{i+1}</span>  for each i. Using the same strategy proposed for the 4-round distinguisher (see App. B for all details), this allows to construct these two new different couples (and to check if the corresponding ciphertexts satisfy or not the required property) with only 4 table look-ups. As a result, the cost of this step is of  <span class="math">2^{32} \\cdot 2 \\cdot 4 = 2^{35}</span>  S-Box and of  <span class="math">2^{32} \\cdot 4 = 2^{34}</span>  table look-ups.</p>

    <p class="text-gray-300">It follows that the cost to find one diagonal of the key is well approximated by  <span class="math">2^{35}</span>  S-Box look-ups and  <span class="math">2^{37.17}</span>  table look-ups, that is approximately  <span class="math">2^{30.95}</span>  five-round encryptions. The idea is to use this approach for three different diagonals, and to find the last one by brute force. As a result, the total computational cost is of  <span class="math">2^{32} + 3 \\cdot 2^{30.95} = 2^{33.28}</span>  five-round encryptions, while the data cost is of  <span class="math">3 \\cdot 2^{32} = 2^{33.6}</span>  chosen plaintexts.</p>

    <p class="text-gray-300"><strong>Summary.</strong> As a result, the attack - practical verified on a small scale AES - requires  <span class="math">2^{33.6}</span>  chosen plaintexts and has a computational cost of  <span class="math">2^{33.28}</span>  five-round encryptions. The pseudo-code of the attack is given in Algorithm 2. We remark for completeness that the same attack works also in the decryption/reverse direction, using chosen ciphertexts instead of plaintexts.</p>

      <h3 id="sec-6.2" class="text-xl font-semibold mt-8">6.2 Practical Verification</h3>

    <p class="text-gray-300">Using a C/C++ implementation, we have practically verified the attack just described<sup>21</sup> on the small scale AES [CMR05]. We emphasize that since the proposed attack is independent of the fact that each word of AES is composed of 4 or 8 bits, our verification on the small scale variant of AES is strong evidence for it to hold for the real AES.</p>

    <p class="text-gray-300"><strong>Practical Results.</strong> For simplicity, we limit to report the result for a single diagonal of the key. First of all, a single coset of a diagonal space  <span class="math">\\mathcal{D}_i</span>  is largely sufficient to find one</p>

    <p class="text-gray-300"><sup>&amp;</sup>lt;sup&gt;21</sup>The source codes of the distinguishers/attacks are available at https://github.com/Krypto-iaik/Distinguisher_5RoundAES</p>

    <p class="text-gray-300">diagonal of the key. In more detail, given two (plaintexts, ciphertexts) pairs  <span class="math">(p^1, c^1)</span>  and  <span class="math">(p^2, c^2)</span> , then other two different couples  <span class="math">q^1</span>  and  <span class="math">q^2</span>  (out of the seven possible ones) are sufficient to discard all the wrong candidates of the diagonal of the key, as predicted.</p>

    <p class="text-gray-300">About the computational cost, the theoretical cost for the small scale AES case is well approximated by  <span class="math">4 \\cdot 2^{16} \\cdot (\\log 2^{16} + 1) + 2^{16} \\cdot 4 = 2^{21}</span>  table look-ups and  <span class="math">2^{16} \\cdot 4 \\cdot 3 = 2^{19.6}</span>  S-Box look-ups, for a total of  <span class="math">2^{19.6} + 2^{21} = 2^{21.5}</span>  table look-ups (assuming that the cost of 1 S-Box look-up is approximately equal to the cost of 1 table look-up). The average practical computational cost is of  <span class="math">2^{21.5}</span>  table look-ups, approximately the same as the theoretical one.</p>

    <p class="text-gray-300">Using the 4-round distinguisher just presented in Theorem 3 as starting point, we propose a way to extend it by 1 round at the end. As a result, we are able to set up a new probabilistic 5-round secret-key distinguisher for AES which exploits a property which is independent of the secret key, of the details of the S-Box and of the MixColumns matrix (expect for the branch number equal to 5). Even if such a distinguisher has higher complexity than the deterministic one presented in [GRR17a], it can be used to set up a key-recovery attack on 6-round AES (better than a brute-force one) exploiting a distinguisher of the type [GRR17a] - believed to be hard to exploit. As a result, this is the first key-recovery attack for 6-round AES set up by a 5-round secret-key distinguisher for AES. For completeness, since the 4-round distinguisher works also in the decryption direction, this new 5-round distinguisher - and the corresponding 6-round key-recovery attack - can also be set up in the reverse direction (i.e. using chosen ciphertexts instead of plaintexts).</p>

    <p class="text-gray-300">Given n (plaintexts, ciphertexts) pairs, the idea is to divide them in sets such that particular relations hold among the variables that define the plaintexts that lie in the same set (similar to before). The distinguisher that we are going to present exploits the following property:</p>

    <p class="text-gray-300">&bull; consider the number of sets for which two ciphertexts of at least one couple lie in the same subspace  <span class="math">\\mathcal{M}_J</span>  for |J|=3 (in other words, the number of sets for which two ciphertexts of at least one couple are equal in one anti-diagonal - if the final MixColumns operation is omitted). If the sets are properly defined, it is possible to prove that this number of sets is a little lower for 5-round AES than for a random permutation, independently of the secret key.</p>

    <p class="text-gray-300">This property allows to set up a new distinguisher which is independent of the secret key, of the details of the S-Box and of the MixColumns matrix, and a new key-recovery attack on 6-round. In the following, we give all the details.</p>

      <h4 id="sec-7.1.1" class="text-lg font-semibold mt-6">7.1.1 Details of the 5-round &quot;Probabilistic Mixture Diff.&quot; Distinguisher</h4>

    <p class="text-gray-300">Consider  <span class="math">2^{32}</span>  chosen plaintexts with one active column (4 active bytes), e.g. a coset of  <span class="math">C_0</span> , and the corresponding ciphertexts after 5-round. For each  <span class="math">(x_0, x_1), (y_0, y_1) \\in \\mathbb{F}^2_{2^8}</span>  such that  <span class="math">x_0 \\neq y_0</span>  and  <span class="math">x_1 \\neq y_1</span> , let the set  <span class="math">S^{0,1}_{(x_0,x_1),(y_0,y_0)}</span>  of couples of plaintexts be defined as follows</p>

    <p class="text-gray-300"><span class="math">$\\mathcal{S}_{(x_0,x_1),(y_0,y_1)}^{0,1} = \\left\\{ (p,q) \\in \\mathbb{F}_{2^8}^{4 \\times 4} \\times \\mathbb{F}_{2^8}^{4 \\times 4} \\,\\middle|\\, p \\equiv (x_0,x_1,A,B), q \\equiv (y_0,y_1,A,B) \\right.</span>$
or  <span class="math">p \\equiv (x_0,y_1,A,B), q \\equiv (y_0,x_1,A,B)</span>  for each  <span class="math">A,B \\in \\mathbb{F}_{2^8} \\right\\}.</span></p>

    <p class="text-gray-300">In other words, the couples of plaintexts  <span class="math">p,q\\in\\mathcal{C}_0\\oplus a</span>  in  <span class="math">\\mathcal{S}^{0,1}_{(x_0,x_1),(y_0,y_1)}</span>  are of the form</p>

    <p class="text-gray-300"><span class="math">$p \\equiv a \\oplus \\begin{bmatrix} x_0 &amp; 0 &amp; 0 &amp; 0 \\\\ x_1 &amp; 0 &amp; 0 &amp; 0 \\\\ A &amp; 0 &amp; 0 &amp; 0 \\\\ B &amp; 0 &amp; 0 &amp; 0 \\end{bmatrix} \\qquad q \\equiv a \\oplus \\begin{bmatrix} y_0 &amp; 0 &amp; 0 &amp; 0 \\\\ y_1 &amp; 0 &amp; 0 &amp; 0 \\\\ A &amp; 0 &amp; 0 &amp; 0 \\\\ B &amp; 0 &amp; 0 &amp; 0 \\end{bmatrix},</span>$</p>

    <p class="text-gray-300">or</p>

    <p class="text-gray-300"><span class="math">$p \\equiv a \\oplus \\begin{bmatrix} x_0 &amp; 0 &amp; 0 &amp; 0 \\\\ y_1 &amp; 0 &amp; 0 &amp; 0 \\\\ A &amp; 0 &amp; 0 &amp; 0 \\\\ B &amp; 0 &amp; 0 &amp; 0 \\end{bmatrix} \\qquad q \\equiv a \\oplus \\begin{bmatrix} y_0 &amp; 0 &amp; 0 &amp; 0 \\\\ x_1 &amp; 0 &amp; 0 &amp; 0 \\\\ A &amp; 0 &amp; 0 &amp; 0 \\\\ B &amp; 0 &amp; 0 &amp; 0 \\end{bmatrix}.</span>$</p>

    <p class="text-gray-300">Similar definitions can be given for the set  <span class="math">S_{(x_0,x_1),(y_0,y_1)}^{i,j}</span>  for  <span class="math">i \\neq j</span> , where the active bytes are in row i and j. Given  <span class="math">2^{32}</span>  plaintexts as before, it is possible to construct  <span class="math">\\frac{1}{2^{17}} \\cdot 6 \\cdot 2^{31} \\cdot (2^8 - 1)^2 \\simeq 2^{32.574}</span>  different sets (the number of pairs of texts with 2 equal generating variables is given by formula (10)), where each set contains exactly  <span class="math">2^{17}</span>  different couples of plaintexts (we emphasize that these couples of plaintexts are not independent, in the sense that a particular relationship - among the generating variables - holds).</p>

    <p class="text-gray-300">Consider  <span class="math">n \\gg 1</span>  sets, and count the number of sets that contain at least one couple of plaintexts for which the corresponding ciphertexts (generated by 5-round AES or by a random permutation) belong to the same coset of a subspace  <span class="math">\\mathcal{M}_J</span>  for  <span class="math">J \\subseteq \\{0,1,2,3\\}</span>  and |J|=3. As we are going to prove, this number is on average lower for AES than for a random permutation, independently of the secret key, of the details of the S-Box and of the MixColumns matrix. In more details, the numbers of sets that satisfy the required property for 5-round AES - denoted by  <span class="math">n_{AES}</span>  - and for a random permutation - denoted by  <span class="math">n_{rand}</span>  - are well approximated by</p>

    <p class="text-gray-300"><span class="math">$n_{AES} \\simeq n \\cdot p_{AES}</span>$
<span class="math">n_{rand} \\simeq n \\cdot p_{rand}</span></p>

    <p class="text-gray-300">where</p>

    <p class="text-gray-300"><span class="math">$p_{AES} \\simeq 2^{-13} - 524287 \\cdot 2^{-46} - \\underbrace{22370411853 \\cdot 2^{-77}}_{\\approx 2.604 \\cdot 2^{-44}} + \\dots</span>$
<span class="math">$p_{rand} \\simeq 2^{-13} - 524287 \\cdot 2^{-46} + \\underbrace{45812722347 \\cdot 2^{-77}}_{\\approx 5.333 \\cdot 2^{-44}} + \\dots</span>$</p>

    <p class="text-gray-300">Even if the difference between the two probabilities is small, it is possible to distinguish the two cases with probability higher than 95% if the number n of sets  <span class="math">\\mathcal{S}^{i,j}_{(x_0,x_1),(y_0,y_1)}</span>  -  <span class="math">\\mathcal{S}</span>  for simplicity - satisfies  <span class="math">n \\geq 2^{71.243}</span> .</p>

    <p class="text-gray-300">In the following, we prove this result (which has been practically tested on a small scale AES) and we give all the details about the data and the computational costs.</p>

    <p class="text-gray-300">Similarity with &quot;classical&quot; Truncated Differential Attack. Before going on, we emphasize the similarity with the 3-round distinguisher that exploits a truncated differential trail. In that case, the idea is to count the number of pairs of texts that satisfies the truncated differential trail. In particular, given pairs of plaintexts in the same coset of a diagonal space  <span class="math">\\mathcal{D}_i</span> , one counts the number of pairs for which the corresponding ciphertexts belong in the same coset of a mixed space  <span class="math">\\mathcal{M}_J</span>  for |J|=3. Since the probability of this event is higher for an AES permutation than for a random one<sup>22</sup>, one can distinguish the two cases simply counting the number of pairs that satisfy the previous property. The idea of our disitinguisher is similar. However, instead of working on single couples,</p>

    <p class="text-gray-300"> <span class="math">&lt;sup&gt;\\&lt;/sup&gt;overline{\\ ^{22}}</span> As recalled in Sect. 3.2, this probability is approximately equal to  <span class="math">2^{-6}</span>  for the AES case and  <span class="math">2^{-30}</span>  for the random case.</p>

    <p class="text-gray-300">one works with particular sets S of couples and counts the number of sets for which at least one couple satisfies the (given) differential trail. Similar considerations hold for the distinguisher proposed in Sect. 9.1.</p>

      <h4 id="sec-7.1.2" class="text-lg font-semibold mt-6">7.1.2 <strong>Proof</strong></h4>

    <h4 id="sec-misc-2" class="text-lg font-semibold mt-6">Proof - 5-round AES</h4>

    <p class="text-gray-300">As first thing, we prove the results just given, starting with the 5-round AES case.</p>

    <p class="text-gray-300">Initial Considerations - 5-round AES. Our 5-round distinguisher is based on Theorem 3. Given plaintexts in the same coset of  <span class="math">C_0</span>  and for a fixed  <span class="math">J \\subseteq \\{0, 1, 2, 3\\}</span> , each set  <span class="math">S_{(x_0, x_1), (y_0, y_1)}^{i, j}</span>  just defined has the following property after 4 rounds:</p>

    <ul class="list-disc list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li><ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li>for each couple, the two texts after 4-round belong to the same coset of  <span class="math">\\mathcal{M}_I</span> ;</li>
    </ol></li>
      <li><ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li>for each couple, the two texts after 4-round don't belong to the same coset of  <span class="math">\\mathcal{M}_I</span> .</li>
    </ol></li>
    </ul>

    <p class="text-gray-300">In other words, for a given set  <span class="math">S_{(x_0,x_1),(y_0,y_1)}</span> , it is not possible that the two texts of somenot all - couples belong to the same coset of  <span class="math">\\mathcal{M}_J</span>  after 4-round and others not, while this can happen for a random permutation.</p>

    <p class="text-gray-300">What is the probability of the two previous events for an AES permutation? Given a set  <span class="math">\\mathcal{S}^{i,j}_{(x_0,x_1),(y_0,y_1)}</span> , the probability that the two texts of each couple belong to the same coset of  <span class="math">\\mathcal{M}_J</span>  after 4-round is approximately  <span class="math">2^{-30}</span> .</p>

    <p class="text-gray-300">To prove this fact, let the event  <span class="math">\\mathcal{E}_i^r</span>  be defined as following.</p>

    <p class="text-gray-300"><strong>Definition 9.</strong> Let  <span class="math">J \\subseteq \\{0,1,2,3\\}</span>  be fixed. Given a set  <span class="math">\\mathcal{S}_{(x_0,x_1),(y_0,y_1)}</span> , we define  <span class="math">\\mathcal{E}_i^r</span>  as the event that the <em>i</em>-th couple of  <span class="math">\\mathcal{S}_{(x_0,x_1),(y_0,y_1)}</span>  for  <span class="math">i=1,2,...,2^{17}</span>  belong to the same coset of  <span class="math">\\mathcal{M}_J</span>  after r rounds.</p>

    <p class="text-gray-300">For the following, let  <span class="math">\\overline{\\mathcal{E}_i^r}</span>  be the complementary event of  <span class="math">\\mathcal{E}_i^r</span> . It follows that</p>

    <p class="text-gray-300"><span class="math">$Prob(\\mathcal{E}_{1}^{4} \\wedge \\mathcal{E}_{2}^{4} \\wedge ... \\wedge \\mathcal{E}_{2^{17}}^{4}) = Prob(\\mathcal{E}_{1}^{4}) \\cdot Prob(\\mathcal{E}_{2}^{4} \\wedge ... \\wedge \\mathcal{E}_{2^{17}}^{4} | \\mathcal{E}_{1}^{4}) =</span>$</p>

    <p class="text-gray-300"><span class="math">$= Prob(\\mathcal{E}_{1}^{4}) \\equiv p_{3} = 2^{-30} - 3 \\cdot 2^{-63} + 2^{-94},</span>$</p>

    <p class="text-gray-300">where  <span class="math">p_3</span>  is defined as in (6). Indeed, note that  <span class="math">Prob(\\mathcal{E}_i^4 | \\mathcal{E}_1^4) = 1</span>  for each  <span class="math">i = 2, ..., 2^{17}</span>  since if two texts of one couple belong (or not) to the same coset of  <span class="math">\\mathcal{M}_J</span>  after 4 rounds, then the texts of all the other couples have the same property. We remark again that this is due to the way in which the sets  <span class="math">\\mathcal{S}</span>  are defined/constructed.</p>

    <p class="text-gray-300">Using these initial considerations as starting point, we analyze in detail our proposed 5-round distinguisher.</p>

    <p class="text-gray-300">1st Case. As we have just seen, the two texts of all the couples of each set belong to the same coset of a subspace  <span class="math">\\mathcal{M}_I</span>  for |I|=3 after 4-round with probability  <span class="math">p_3\\simeq 2^{-30}</span> . In other words, on average there are  <span class="math">2^{-30}\\cdot n</span>  sets  <span class="math">\\mathcal{S}</span>  such that the two texts of all the couples belong to the same coset of a subspace  <span class="math">\\mathcal{M}_J</span>  for |J|=3 after 4-round.</p>

    <p class="text-gray-300">Let |J|=3. Since  <span class="math">Prob(R(x) \\oplus R(y) \\in \\mathcal{M}_J | x \\oplus y \\in \\mathcal{M}_I) = p_{3,3} \\simeq 2^{-22}</span>  (see (7) for details) and since each set is composed of  <span class="math">2^{17}</span>  different couples, the probability that the two ciphertexts of at least one couple of  <span class="math">\\mathcal{S}</span>  belong to the same coset of  <span class="math">\\mathcal{M}_J</span>  for |J|=3 after 5 rounds is well approximated by</p>

    <p class="text-gray-300"><span class="math">$1 - \\left(1 - \\hat{p}_{3,3}\\right)^{2^{17}} = 1 - \\left(1 - \\frac{p_3 \\cdot (1 - p_{3,3})}{1 - p_3}\\right)^{2^{17}} = 2^{-13} - 526327 \\cdot 2^{-46} + \\dots</span>$</p>

    <p class="text-gray-300">where  <span class="math">\\hat{p}_{3,3}</span>  is defined in (8).</p>

    <p class="text-gray-300"><strong>2nd</strong> Case. In the same way, the two texts of all the couples of each set don't belong to the same coset of a subspace  <span class="math">\\mathcal{M}_J</span>  for |J|=3 after 4-round with probability  <span class="math">1-p_3\\simeq 1-2^{-30}</span> . In other words, on average there are  <span class="math">(1-2^{-30})\\cdot n</span>  sets  <span class="math">\\mathcal{S}</span>  such that the two ciphertexts of all the couples of each set don't belong to the same coset of a subspace  <span class="math">\\mathcal{M}_J</span>  for |J|=3 after 4-round.</p>

    <p class="text-gray-300">Let |J|=3. Since  <span class="math">Prob(R(x)\\oplus R(y)\\in \\mathcal{M}_J\\,|\\,x\\oplus y\\notin \\mathcal{M}_I)=\\hat{p}_{3,3}\\simeq 2^{-30}</span>  (see (8) for details) and since each set is composed of  <span class="math">2^{17}</span>  different couples, the probability that the two texts of at least one couple of  <span class="math">\\mathcal{S}</span>  belong to the same coset of  <span class="math">\\mathcal{M}_J</span>  for |J|=3 after 5 rounds is well approximated by</p>

    <p class="text-gray-300"><span class="math">$1 - (1 - p_{3,3})^{2^{17}} = 2^{-5} - 524287 \\cdot 2^{-30} + 45812722347 \\cdot 2^{-53} + \\dots</span>$</p>

    <p class="text-gray-300"><strong>Final Result.</strong> The desired result is finally obtained using the law (or formula) of total probability</p>

    <p class="text-gray-300"><span class="math">$Prob(A) = \\sum_{i} Prob(A \\mid B_i) \\cdot Prob(B_i)</span>$</p>

    <p class="text-gray-300">which holds for each event A such that  <span class="math">\\bigcup_i B_i</span>  is the <em>sample space</em>, i.e. the set of all the possible outcomes.</p>

    <p class="text-gray-300">Given a set S, the probability that two ciphertexts  <span class="math">c^1</span>  and  <span class="math">c^2</span>  of at least one couple satisfy the required property (i.e.  <span class="math">c^1 \\oplus c^2 \\in \\mathcal{M}_J</span>  for |J| = 3) is given by</p>

    <p class="text-gray-300"><span class="math">$p_{AES} = \\left[1 - Prob(\\overline{\\mathcal{E}}_{1}^{5} \\wedge \\overline{\\mathcal{E}}_{2}^{5} \\wedge \\dots \\wedge \\overline{\\mathcal{E}}_{2^{17}}^{5} \\mid \\mathcal{E}_{i}^{4})\\right] \\cdot Prob(\\mathcal{E}_{i}^{4}) + \\\\ + \\left[1 - Prob(\\overline{\\mathcal{E}}_{1}^{5} \\wedge \\overline{\\mathcal{E}}_{2}^{5} \\wedge \\dots \\wedge \\overline{\\mathcal{E}}_{2^{17}}^{5} \\mid \\overline{\\mathcal{E}}_{i}^{4})\\right] \\cdot Prob(\\overline{\\mathcal{E}}_{i}^{4}) = \\\\ = (1 - p_{3}) \\cdot \\left[1 - \\left(1 - \\frac{p_{3} \\cdot (1 - p_{3,3})}{1 - p_{3}}\\right)^{2^{17}}\\right] + p_{3} \\cdot \\left[1 - \\left(1 - p_{3,3}\\right)^{2^{17}}\\right] = \\\\ = 2^{-13} - 524287 \\cdot 2^{-46} - \\underbrace{22370411853 \\cdot 2^{-77}}_{\\approx 2.604 \\cdot 2^{-44}} + \\dots \\right]</span>$</p>

    <p class="text-gray-300"><span class="math">$(13)</span>$</p>

    <p class="text-gray-300">for a certain  <span class="math">i \\in \\{1, ..., 2^{17}\\}</span> . Note that  <span class="math">Prob(\\mathcal{E}_i^5 \\wedge \\mathcal{E}_j^5) = Prob(\\mathcal{E}_i^5) \\times Prob(\\mathcal{E}_j^5)</span>  since the events  <span class="math">\\mathcal{E}_i^5</span>  and  <span class="math">\\mathcal{E}_i^5</span>  are independent for  <span class="math">i \\neq j</span> .</p>

    <h4 id="sec-misc-3" class="text-lg font-semibold mt-6"><strong>Proof</strong> - Random Permutation</h4>

    <p class="text-gray-300">For a random permutation, given a set S defined as before, what is the probability that two ciphertexts - generated by a random permutation - of at least one couple satisfy the required property? By simple computation, such event occurs with (approximately) probability</p>

    <p class="text-gray-300"><span class="math">$p_{rand} = 1 - (1 - p_3)^{2^{17}} = 1 - \\left[1 - (2^{-30} - 3 \\cdot 2^{-63} + 2^{-94})\\right]^{2^{17}} =</span>$</p>

    <p class="text-gray-300"><span class="math">$= 2^{-13} - 524287 \\cdot 2^{-46} + \\underbrace{45812722347 \\cdot 2^{-77}}_{\\approx 5.333 \\cdot 2^{-44}} + \\dots</span>$
(14)</p>

    <p class="text-gray-300"><strong>Remark.</strong> Before going on, we emphasize again that while a &quot;classical&quot; truncated differential distinguisher counts the number of pairs of texts that satisfy a particular differential trail, in our case we consider the number of sets of texts for which at least one pair satisfies a particular differential trail. This implies a difference between the probabilities that the previous event occurs for a random permutation -  <span class="math">p_{rand}</span>  - and for 5-round AES -  <span class="math">p_{AES}</span> .</p>

      <h3 id="sec-7.2" class="text-xl font-semibold mt-8">7.2 Data and Computational Complexity</h3>

      <h4 id="sec-7.2.1" class="text-lg font-semibold mt-6">7.2.1 Data Complexity</h4>

    <p class="text-gray-300">First of all, given a single coset of a column space  <span class="math">C_I</span>  for |I|=1, the number of different couples with two equal generating variables is given by  <span class="math">6 \\cdot 2^{16} \\cdot 2^{15} \\cdot (2^8 - 1)^2 \\simeq 2^{49.574}</span>  (see Eq. (10)), while the number of sets S that one can construct is well approximated by  <span class="math">2^{49.574}/2^{17} \\simeq 2^{32.574}</span> .</p>

    <p class="text-gray-300">As we have just said, the difference between the number of sets that satisfy the required property for the AES case (i.e.  <span class="math">n_{AES}</span> ) and for the random case (i.e.  <span class="math">n_{rand}</span> ) is very small compared to the total number  <span class="math">n_{AES}</span>  or  <span class="math">n_{rand}</span> :</p>

    <p class="text-gray-300"><span class="math">$\\frac{|n_{AES} - n_{rand}|}{n_{AES}} \\simeq \\frac{|n_{AES} - n_{rand}|}{n_{rand}} \\ll 1.</span>$</p>

    <p class="text-gray-300">Since the difference between the two probabilities is very small, what is the minimum number of sets S (or equivalently of cosets  <span class="math">C_I</span> ) to guarantee that the distinguisher works with high probability? Our goal here is to derive a good approximation for the number of initial cosets of  <span class="math">C_I</span>  that is sufficient to appreciate this difference with probability prob.</p>

    <p class="text-gray-300">To solve this problem, note that given n sets S of  <span class="math">2^{17}</span>  couples defined as before, the distribution probability of our model is simply described by a binomial distribution. By definition, a binomial distribution with parameters n and p is the discrete probability distribution of the number of successes in a sequence of n independent yes/no experiments, each of which yields success with probability p. In our case, given n sets S, each of them satisfies or not the above property/requirement with a certain probability. Thus, this model can be described using a binomial distribution. We recall that for a random variable Z that follows the binomial distribution, that is  <span class="math">Z \\sim \\mathcal{B}(n,p)</span> , the mean  <span class="math">\\mu</span>  and the variance  <span class="math">\\sigma^2</span>  are respectively given by  <span class="math">\\mu = n \\cdot p</span>  and  <span class="math">\\sigma^2 = n \\cdot p \\cdot (1-p)</span> .</p>

    <p class="text-gray-300">To derive concrete numbers for our distinguisher and based on De Moivre-Laplace theorem, we approximate the binomial distribution with a normal one. Moreover, we can simply consider the difference of the two distributions, which is again a normal distribution. That is, given  <span class="math">X \\sim \\mathcal{N}(\\mu_1, \\sigma_1^2)</span>  and  <span class="math">Y \\sim \\mathcal{N}(\\mu_2, \\sigma_2^2)</span> , then  <span class="math">X - Y \\sim \\mathcal{N}(\\mu, \\sigma^2) = N(\\mu_1 - \\mu_2, \\sigma_1^2 + \\sigma_2^2)</span> . Indeed, in order to distinguish the two cases, note that it is sufficient to guarantee that the number of sets that satisfy the required property in the random case is higher than for the 5-round AES case. As a result, the mean  <span class="math">\\mu</span>  and the variance  <span class="math">\\sigma^2</span>  of the difference between the AES distribution and the random one are given by:</p>

    <p class="text-gray-300"><span class="math">$\\mu = n \\cdot |p_{rand} - p_{AES}|</span>$
<span class="math">\\sigma^2 = n \\cdot [p_{rand} \\cdot (1 - p_{rand}) + p_{AES} \\cdot (1 - p_{AES})].</span></p>

    <p class="text-gray-300">Since the probability density of the normal distribution is  <span class="math">f(x \\mid \\mu, \\sigma^2) = \\frac{1}{\\sigma\\sqrt{2\\pi}} e^{-\\frac{(x-\\mu)^2}{2\\sigma^2}}</span> , it follows that</p>

    <p class="text-gray-300"><span class="math">$prob = \\int_{-\\infty}^{0} \\frac{1}{\\sigma\\sqrt{2\\pi}} e^{-\\frac{(x-\\mu)^2}{2\\sigma^2}} dx = \\int_{-\\infty}^{-\\mu/\\sigma} \\frac{1}{\\sqrt{2\\pi}} e^{-\\frac{x^2}{2}} dx = \\frac{1}{2} \\left[ 1 + \\text{erf}\\left(\\frac{-\\mu}{\\sigma\\sqrt{2}}\\right) \\right],</span>$</p>

    <p class="text-gray-300">where  <span class="math">\\operatorname{erf}(x)</span>  is the error function, defined as the probability of a random variable with normal distribution of mean 0 and variance 1/2 falling in the range [-x, x]. We emphasize that the integral is computed in the range  <span class="math">(-\\infty, 0]</span>  since we work in the case in which the number of sets with the required property for AES is lower than for the random case.</p>

    <p class="text-gray-300">To have a probability of success higher than prob, the number of sets n has to satisfy:</p>

    <p class="text-gray-300"><span class="math">$n &gt; \\frac{2 \\cdot [p_{rand} \\cdot (1 - p_{rand}) + p_{AES} \\cdot (1 - p_{AES})]}{(p_{rand} - p_{AES})^2} \\cdot \\left[ \\text{erfinv} \\left( 2 \\cdot prob - 1 \\right) \\right]^2.</span>$</p>

    <p class="text-gray-300">where erfinv(x) is the inverse error function. For the case  <span class="math">p_{rand}, p_{AES} \\ll 1</span> , a good approximation of n is given by<sup>23</sup></p>

    <p class="text-gray-300">
<span class="math">$n &gt; \\frac{4 \\cdot \\max(p_{rand}, p_{AES})}{(p_{rand} - p_{AES})^2} \\cdot \\left[ \\operatorname{erfinv} \\left( 2 \\cdot prob - 1 \\right) \\right]^2.</span>$
(15)</p>

    <p class="text-gray-300">We emphasize that the formula given in (15) is equivalent to the one proposed by Matsui in [Mat94] for the linear cryptanalysis case, which has been rigorously studied in the literature (e.g. in [BJV04], [Sel08]). Without going into the details, in linear cryptanalysis one has to construct &quot;good&quot; linear equations relating plaintext, ciphertext and key bits. In order to find the secret key, the idea is to exploit the fact that such linear approximation holds with probability 1/2 for a wrong key, while they hold with probability  <span class="math">1/2 \\pm \\varepsilon</span>  for the right key. Exploiting this (usually small) difference between the two probabilities, one can discover the secret key. Note that also these events can be described by binomial variables, that is  <span class="math">\\mathcal{B}(n,1/2)</span>  for a wrongly guessed key and  <span class="math">\\mathcal{B}(n,1/2\\pm\\varepsilon)</span>  for the right guessed key, where n is the number of texts used. Our case is completely equivalent, since the probability  <span class="math">p_{AES}</span>  for the AES case is related to the probability  <span class="math">p_{rand}</span>  for the random case by  <span class="math">p_{AES} = p_{rand} \\pm \\varepsilon</span> , for a small difference  <span class="math">\\varepsilon</span> .</p>

    <p class="text-gray-300"><strong>Data Cost.</strong> For a probability of success of approximately 95% and since  <span class="math">|p_{AES} - p_{rand}| \\simeq 2^{-41.01}</span>  and  <span class="math">p_{AES} \\simeq p_{rand} \\simeq 2^{-13}</span> , it follows that n must satisfy  <span class="math">n &gt; 2^{71.243}</span> . Since a single coset of  <span class="math">C_I</span>  for |I| = 1 contains approximately  <span class="math">2^{32.574}</span>  different sets S, one needs approximately  <span class="math">2^{71.243} \\cdot 2^{-32.574} \\simeq 2^{38.669}</span>  different initial cosets of  <span class="math">C_I</span> , that is approximately  <span class="math">2^{38.669} \\cdot 2^{32} \\simeq 2^{70.67}</span>  chosen plaintexts.</p>

    <p class="text-gray-300">For completeness, we mention that it is possible to set up a modified version of this distinguisher that requires lower data (and computational) cost(s). In particular, in App. C.2 we show that a similar distinguisher can be set up using only  <span class="math">2^{52}</span>  chosen plaintexts in the same initial coset of  <span class="math">C_I</span>  with |I| = 2. Our choice to present a &quot;less competitive&quot; distinguisher is due to the fact that it will be the starting point for a key-recovery attack on 6-round, as shown in detail in the next section.</p>

    <p class="text-gray-300">Remark &ndash; On the Approximation of a Binomial Distribution using a Normal One. As well known, the binomial distribution is well approximated by a Poisson distribution. However, we recall that a normal distribution is a valid approximation in the case in which the skewness (i.e. the asymmetry) of the binomial distribution is close to zero (see [Ser80] for more details). The skewness  <span class="math">\\gamma</span>  of a binomial distribution  <span class="math">\\mathcal{B}(n,p)</span>  is given by  <span class="math">\\gamma = \\frac{1-2p}{\\sqrt{np(1-p)}}</span> , that is it is close to zero when p = 1/2 and/or  <span class="math">n \\cdot p \\gg 1</span> . Since we are working under the assumption  <span class="math">n \\cdot p \\gg 1</span> , the normal distribution is a valid approximation<sup>24</sup>.</p>

      <h4 id="sec-7.2.2" class="text-lg font-semibold mt-6">7.2.2 Computational Complexity</h4>

    <p class="text-gray-300">Here we discuss the computational cost for the case of cosets of  <span class="math">\\mathcal{C}_I</span>  with |I|=1. As for the 4-round distinguisher, a first possibility is to construct all the couples, to divide them in sets  <span class="math">\\mathcal{S}</span>  defined above, and to count the number of sets that satisfy the required property working on each set separately. Since just the cost to construct all the couples given  <span class="math">2^{38.67}</span>  cosets is approximately of  <span class="math">2^{38.67} \\cdot 2^{31} \\cdot (2^{32} - 1) \\simeq 2^{101.67}</span>  table look-ups, we present a more efficient way to implement the distinguisher. Before presenting the details, we highlight</p>

    <p class="text-gray-300"> <span class="math">&lt;sup&gt;\\&lt;/sup&gt;overline{^{23}\\text{Observe:}}\\ p_{rand} \\cdot (1 - p_{rand}) + p_{AES} \\cdot (1 - p_{AES}) &lt; p_{rand} + p_{AES} &lt; 2 \\cdot \\max(p_{rand}, p_{AES}).</span></p>

    <p class="text-gray-300"><span class="math">&lt;sup&gt;^{24}&lt;/sup&gt;</span> We also highlight that such approximation is largely used in literature, especially in the case of linear approximation as discussed in [Sel08] and in [SS16]. In particular, also in the case of linear cryptanalysis, the common assumption is to approximate the binomial distributions by normal ones, under the assumption that the skew is  <span class="math">\\approx 0</span> .</p>

    <pre><code class="language-text">Data: 2^{32} plaintexts in 1 coset of C_0 (e.g. C_0 \\oplus a) and corresponding ciphertexts after 5 rounds
</code></pre>

    <p class="text-gray-300"><strong>Result:</strong> Number of sets S such that two ciphertexts of at least one couple of plaintexts belong to the same coset of  <span class="math">\\mathcal{M}_J</span>  for a certain J with |J|=3 Let A[0,...,N-1] be an array initialized to zero, where  <span class="math">N=3\\cdot 2^{15}\\cdot (2^8-1)^2//A[i]</span>  refers to the i-th set S</p>

    <pre><code class="language-text">for each j from 0 to 3 let J = \\{0, 1, 2, 3\\} \\setminus j \\ (|J| = 3) do
     let (p^i, c^i) for i = 0, ..., 2^{32} - 1 be the (plaintexts, ciphertexts) in \\mathcal{C}_0 \\oplus a;
     re-order this set of elements w.r.t. the partial order \\leq defined in Def. 10; //\\leq
     i \\leftarrow 0:
     while i &lt; 2^{32} - 1 do
          while c^j \\oplus c^{j+1} \\in \\mathcal{M}_J do j \\leftarrow j+1;
          for each k from i to j do
               for each l from k+1 to j do
                    if p^k \\oplus p^l \\in D_I for a certain |I| = 2 (p^k and p^l have two equal
                      generating variables)
                                                        // necessary condition s.t. p^k \\oplus p^l \\in \\mathcal{S}^{x,y} for
                      x, y \\in \\{0, 1, 2, 3\\} with x \\neq y then
                         A[\\varphi(p^k, p^l)] \\leftarrow 1; \\ // \\ \\varphi(p^k, p^l) defined in (16) returns the index of the set \\mathcal{S}^{x,y} s.t. p^k \\oplus p^l \\in \\mathcal{S}^{x,y} - this step can be improved if one considers
                           ordered plaintexts - see App. E for details
               end
n \\leftarrow \\sum_{i=0}^{N-1} A[i];
</code></pre>

    <p class="text-gray-300"><strong>Algorithm 3:</strong> Given (plaintexts, ciphertexts) pairs in the same coset of  <span class="math">C_0</span> , this algorithm counts the number of sets S for which two ciphertext of at least one couple belong in the same coset of  <span class="math">\\mathcal{M}_J</span>  for |J| = 3.</p>

    <p class="text-gray-300">that the same analysis works also for modified version of the distinguisher proposed in App. C.2. The computational cost of this modified version (that requires only  <span class="math">2^{52}</span>  chosen plaintexts) is well approximated by  <span class="math">2^{71.5}</span>  table look-ups or equivalently  <span class="math">2^{64.9}</span>  five-round encryptions.</p>

    <p class="text-gray-300">First of all, we introduce a partial order  <span class="math">\\leq</span> .</p>

    <p class="text-gray-300"><strong>Definition 10.</strong> Let  <span class="math">I \\subset \\{0, 1, 2, 3\\}</span>  with |I| = 3 and let  <span class="math">l \\in \\{0, 1, 2, 3\\} \\setminus I</span> . Let  <span class="math">t^1, t^2 \\in \\mathbb{F}_{2^8}^{4 \\times 4}</span>  with  <span class="math">t^1 \\neq t^2</span> . Text  <span class="math">t^1</span>  is less or equal than text  <span class="math">t^2</span>  w.r.t. the partial order  <span class="math">\\preceq</span>  (i.e.  <span class="math">t^1 \\preceq t^2</span> ) if and only if one of the two following conditions is satisfied (indexes are taken modulo 4):</p>

    <ul class="list-disc list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li>there exists  <span class="math">j \\in \\{0,1,2,3\\}</span>  s.t.  <span class="math">MC^{-1}(t^1)_{i,l-i} = MC^{-1}(t^2)_{i,l-i}</span>  for all i &lt; j and  <span class="math">MC^{-1}(t^1)_{j,l-j} &lt; MC^{-1}(t^2)_{j,l-j}</span> ;</li>
      <li><span class="math">MC^{-1}(t^1)_{i,l-i} = MC^{-1}(t^2)_{i,l-i}</span>  for all i = 0,....,3, and  <span class="math">MC^{-1}(t^1) &lt; MC^{-1}(t^2)</span>  where &lt; is defined in Def. 6.</li>
    </ul>

    <p class="text-gray-300">Let  <span class="math">J \\subseteq \\{0,1,2,3\\}</span>  with |J|=3. First of all, one has to re-order the ciphertexts with</p>

    <p class="text-gray-300">respect to a partial order  <span class="math">\\leq</span>  just defined. The cost to re-order a set of n texts w.r.t. a given partial order is  <span class="math">\\mathcal{O}(n \\cdot \\log n)</span>  table look-ups.</p>

    <p class="text-gray-300">For each coset of  <span class="math">C_0</span> , given ordered (plaintexts, ciphertexts) and working only on consecutive ciphertexts, the idea is to count the number of collisions for each set  <span class="math">S^{i,j}_{(x_0,x_1),(y_0,y_1)}</span> . In more details, for each coset of  <span class="math">C_0</span>  it is possible to construct  <span class="math">N=3\\cdot 2^{15}\\cdot (2^8-1)^2</span>  different sets  <span class="math">S^{i,j}_{(x_0,x_1),(y_0,y_1)}</span>  for each  <span class="math">i,j\\in\\{0,1,2,3\\}</span>  with  <span class="math">i\\neq j</span>  and for each  <span class="math">x_0\\neq y_0</span>  and  <span class="math">x_1\\neq y_1</span> . The idea is to consider a vector A[0,...,N-1] such that</p>

    <p class="text-gray-300"><span class="math">$A[x] = \\begin{cases} 1 &amp; \\text{if the } x\\text{-th set } \\mathcal{S} \\text{ satisfies the required property;} \\\\ 0 &amp; \\text{otherwise} \\end{cases}</span>$</p>

    <p class="text-gray-300">All details are given in the following &ndash; pseudo-code is given in Algorithm 3.</p>

    <p class="text-gray-300">To set up the distinguisher, it is sufficient to define a function  <span class="math">\\varphi</span>  that returns the index of a set  <span class="math">\\mathcal{S}^{i,j}_{(x_0,x_1),(y_0,y_1)}</span>  (where i&lt; j) in the vector A[0,...,N-1]. Assuming  <span class="math">x_0&lt; y_0</span>  and  <span class="math">x_1&lt; y_1</span>  (note that a set  <span class="math">\\mathcal{S}</span>  contains all plaintexts generated by different combinations of these four variables, so this condition is always fulfilled), the function  <span class="math">\\varphi(\\cdot): (\\mathbb{F}_{2^8})^4\\times (\\{0,1,2,3\\})^2\\to \\mathbb{N}</span>  can be defined as</p>

    <p class="text-gray-300">
<span class="math">$\\varphi(x_0, x_1, y_0, y_1, i, j) = 1065369600 \\times \\phi(i, j) + \\Phi(x_0, x_1, y_0, y_1)</span>$
(16)</p>

    <p class="text-gray-300">where  <span class="math">1\\,065\\,369\\,600 = 32\\,640^2</span>  (where  <span class="math">32\\,640 = 2^{n-1}\\cdot(2^n-1)</span>  for n=8), where  <span class="math">\\phi(0,1)=0</span> ,  <span class="math">\\phi(0,2)=1,\\ \\phi(0,3)=2,\\ \\phi(1,2)=3,\\ \\phi(1,3)=4,\\ \\phi(2,3)=5</span>  and</p>

    <p class="text-gray-300"><span class="math">$\\Phi(x_0, x_1, y_0, y_1) = \\left[x_0 + \\frac{y_0 \\times (y_0 - 1)}{2}\\right] + 32640 \\times \\left[x_1 + \\frac{y_1 \\times (y_1 - 1)}{2}\\right]</span>$</p>

    <p class="text-gray-300">where each value of  <span class="math">x_0, x_1, y_0, y_1 \\in \\mathbb{F}_{2^8}</span>  is replaced by its corresponding number in  <span class="math">\\{0, 1, ..., 255\\}</span> . The previous formula for  <span class="math">\\Phi</span>  is obtained by observing that</p>

    <ul class="list-disc list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li><ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li>for a fixed  <span class="math">y \\ge 1</span> , there are exactly y different pairs (x,y) that satisfy  <span class="math">x \\ge 0</span>  and x &lt; y;</li>
    </ol></li>
      <li><ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li>for a fixed  <span class="math">z \\ge 1</span> , there are exactly  <span class="math">\\sum_{i=1}^{z-1} i = \\frac{z \\cdot (z-1)}{2}</span>  different pairs (x,y) that satisfy  <span class="math">x,y \\ge 0</span>  and  <span class="math">x &lt; y \\le z</span> .</li>
    </ol></li>
      <li><ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li>given a pair (w, z) (where  <span class="math">0 \\le w &lt; z</span> ), there are exactly</li>
    </ol></li>
    </ul>

    <p class="text-gray-300"><span class="math">$w + \\frac{z \\cdot (z-1)}{2}</span>$</p>

    <p class="text-gray-300">different pairs (x, y) that satisfy (1) y &lt; z or (2) y = z and  <span class="math">x \\le w</span> .</p>

    <p class="text-gray-300">As a result, using Algorithm 3 to implement the distinguisher, the computational cost is well approximated by</p>

    <p class="text-gray-300"><span class="math">$4 \\cdot \\left[ 2^{32} \\cdot \\log(2^{32}) \\text{ (re-ordering process) } + \\left( 2^{32} + 2^{31} \\right) \\text{ (access to } (p^i, c^i) \\text{ and to } A[\\cdot] - \\left( 2^{32} + 2^{31} \\right) \\right] \\right]</span>$</p>

    <ul class="list-disc list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li>increment number of collisions)
<span class="math">$\\left] + \\frac{1}{2^{18}} \\cdot 6 \\cdot 2^{16} \\cdot (2^8 - 1)^2 \\text{ (final &quot;for&quot;)} \\simeq 2^{39.07} \\right]</span>$</li>
    </ul>

    <p class="text-gray-300">table look-ups for each initial coset, where  <span class="math">\\binom{2^{3^2}}{2} \\cdot 2^{-32} \\simeq 2^{31}</span>  is the average number of couples such that the two ciphertexts belong to the same coset of  <span class="math">\\mathcal{M}_J</span>  for J fixed with |J|=3. Since the attacker must use  <span class="math">2^{38.66}</span>  different initial cosets to have a probability of success higher than 95%, the <em>total computational cost</em> is of  <span class="math">2^{39.07} \\cdot 2^{38.66} = 2^{77.73}</span>  table look-ups, or equivalently  <span class="math">2^{71.1}</span>  five-round encryptions.</p>

    <p class="text-gray-300">For completeness, we mention that the proposed implementation can be (in some cases) slightly improved<sup>25</sup>. The idea - described in detail in App. E - is to order both the ciphertexts and the plaintexts with respect to particular partial orders. As a result, consider a set of ciphertexts  <span class="math">c^i, c^{i+1}, ..., c^j</span>  s.t.  <span class="math">c^l \\oplus c^k \\in \\mathcal{M}_J</span>  for each  <span class="math">i \\leq k, l \\leq j</span> . Instead of constructing all the possible pairs of plaintexts and to check if they belong to the same coset of  <span class="math">\\mathcal{D}_I</span> , the idea is to work with ordered plaintexts w.r.t. a partial order similar to  <span class="math">\\leq</span>  as defined in Def. 10 s.t. two plaintexts are consecutive if they belong to the same coset of  <span class="math">\\mathcal{D}_I</span> . In this way, it is not necessary to construct all the possible pairs of plaintexts - as also highlighted in Algorithm 3.</p>

      <h3 id="sec-7.3" class="text-xl font-semibold mt-8">7.3 Practical Verification on small scale AES</h3>

    <p class="text-gray-300">In order to have a practical verification of the proposed distinguisher (and of the following key-recovery attack), we have practically verified the probabilities  <span class="math">p_{AES}</span>  and  <span class="math">p_{rand}</span>  given above<sup>26</sup>. In particular, we verified them using a small scale AES, as proposed in [CMR05]. We emphasize that our verification on the small scale variant of AES is strong evidence for it to hold for the real AES, since the strategy used to theoretically compute such probabilities is independent of the fact that each word of AES is of 4 or 8 bits.</p>

    <p class="text-gray-300">To compare the practical values with the theoretical ones, we list the theoretical probabilities  <span class="math">p_{AES}</span>  and  <span class="math">p_{rand}</span>  for the small scale case. First of all, for small scale AES the probabilities  <span class="math">p_3</span>  and  <span class="math">p_{3,3}</span>  are respectively equal to  <span class="math">p_3 = 2^{-14} - 3 \\cdot 2^{-31} + 2^{-46}</span>  and  <span class="math">p_{3,3} = 2^{-10} - 3 \\cdot 2^{-23} + 2^{-34}</span> .</p>

    <p class="text-gray-300">W.l.o.g. we used cosets of  <span class="math">\\mathcal{C}_0</span>  to practically test the two probabilities. Using the previous procedure and formula, the (approximately) probabilities that a set  <span class="math">\\mathcal{S}</span>  satisfies the required property for 5-round small scale AES and for the random case are respectively</p>

    <p class="text-gray-300"><span class="math">$p_{AES} = 2^{-5} - 2047 \\cdot 2^{-22} - \\underbrace{221773 \\cdot 2^{-37}}_{\\approx 3.384 \\cdot 2^{-21}} + \\dots</span>$
<span class="math">$p_{rand} = 2^{-5} - 2047 \\cdot 2^{-22} + \\underbrace{698027 \\cdot 2^{-37}}_{\\approx 10.651 \\cdot 2^{-21}} + \\dots</span>$</p>

    <p class="text-gray-300">As a result, using formula (15) for  <span class="math">p_{rand} \\simeq p_{AES} \\simeq 2^{-5}</span>  and  <span class="math">|p_{rand} - p_{AES}| \\simeq 2^{-17.19}</span> , it follows that  <span class="math">n \\geq 2^{31.6}</span>  different sets S are sufficient to set up the distinguisher with probability higher than 95%.</p>

    <p class="text-gray-300">Note that for small scale AES, a single coset of  <span class="math">\\mathcal{C}_0</span>  contains  <span class="math">2^{16}</span>  (plaintexts, ciphertexts) pairs, or approximately  <span class="math">2^{15} \\cdot (2^{16}-1) \\simeq 2^{31}</span>  different couples. Since the number of couples with two equal generating variables is given by  <span class="math">6 \\cdot 2^8 \\cdot 2^7 \\cdot (2^4-1)^2 \\simeq 2^{25.4}</span>  (also tested by computer test), it is possible to construct  <span class="math">3 \\cdot 2^7 \\cdot (2^4-1)^2 = 86400 \\simeq 2^{16.4}</span>  sets  <span class="math">\\mathcal{S}</span>  of  <span class="math">2^9</span>  couples. As a result, it follows that  <span class="math">2^{31.6} \\cdot 2^{-16.4} = 2^{15.2}</span>  different initial cosets of  <span class="math">\\mathcal{C}_0</span>  must be used, for a cost of  <span class="math">2^{47.2}</span>  chosen plaintexts.</p>

    <p class="text-gray-300">For our tests, we used  <span class="math">2^{16}</span>  different initial cosets of  <span class="math">C_0</span>  (keys used to encrypt the plaintexts in the AES case are randomly chosen and different for each coset - the key is not fixed). For each coset, we have used Algorithm 3 to count the number of sets S that satisfy the required property (i.e. the number of sets for which two ciphertexts of at least one couple are in the same coset of  <span class="math">\\mathcal{M}_J</span>  for certain J with |J|=3). As a result, for each initial coset  <span class="math">C_0</span>  the (average) theoretical number of sets S that satisfy the required property for the random case - given by  <span class="math">n_{rand}^T = 86\\,400 \\cdot p_{rand}</span>  - and the (average) practical one found in our experiments - denoted by  <span class="math">n_{rand}^P</span>  - are respectively:</p>

    <p class="text-gray-300"><span class="math">$n_{rand}^T \\simeq 2\\,658.27 \\qquad \\qquad n_{rand}^P \\simeq 2\\,658.23</span>$</p>

    <p class="text-gray-300"><sup>&amp;</sup>lt;sup&gt;25</sup>We highlight that the proposed improvement doesn't affect the computational cost of the distinguisher proposed in this section, but it is exploited e.g. for the ones proposed in Sect. 9.1 and in App. C.2.</p>

    <p class="text-gray-300"><sup>&amp;</sup>lt;sup&gt;26</sup>The source codes of the distinguishers/attacks are available at https://github.com/Krypto-iaik/Distinguisher_5RoundAES</p>

    <p class="text-gray-300">    <img src="_page_34_Figure_0.jpeg" alt="" class="my-4 max-w-full" />
</p>

    <p class="text-gray-300"><strong>Figure 2:</strong> Probabilistic distributions of the number of sets S that satisfy the required property for 5-round small scale AES and for a random permutation - using 20 000 initial cosets.</p>

    <p class="text-gray-300">Similarly, the (average) theoretical number of sets  <span class="math">\\mathcal S</span>  that satisfy the required property for 5-round small scale AES - given by  <span class="math">n_{AES}^T=86\\,400\\cdot p_{AES}</span>  - and the (average) practical one found in our experiments - denoted by  <span class="math">n_{AES}^P</span>  - are respectively:</p>

    <p class="text-gray-300"><span class="math">$n_{AES}^T \\simeq 2\\,657.69</span>$
<span class="math">n_{AES}^P \\simeq 2\\,657.65</span></p>

    <p class="text-gray-300">In more details, the <em>total</em> numbers of sets S - for all the  <span class="math">2^{16}</span>  different initial cosets of  <span class="math">C_0</span>  - that satisfy the required property for 5-round small scale AES and for a random permutation are given by</p>

    <p class="text-gray-300"><span class="math">$n_{rand}^T \\simeq 174\\,212\\,383</span>$
<span class="math">n_{AES}^T \\simeq 174\\,174\\,372</span>   <span class="math">n_{rand}^P \\simeq 174\\,209\\,761</span>   <span class="math">n_{AES}^P \\simeq 174\\,171\\,751</span></p>

    <p class="text-gray-300">Note that the numbers of sets found in our experiments are close to the theoretical ones, and that the average number of sets for AES case is lower than for the random one, as predicted.</p>

    <p class="text-gray-300">For completeness, the probabilistic distributions of the number of collisions for the AES and the random cases are given in Fig. 2. In both cases, the practical distribution is obtained using  <span class="math">20\\,000 \\equiv 2^{14.3}</span>  initial cosets. It is possible to observe that e.g. the theoretical variance matches the practical one in both cases.</p>

    <p class="text-gray-300">Using the previous distinguisher on 5-round AES (based on a property which is independent of the secret key) as starting point, we propose the first key-recovery attack on 6 rounds of AES that exploits a 5-round secret-key distinguisher. The strategy of the attack is similar to the one largely exploited by linear and differential cryptanalysis.</p>

    <p class="text-gray-300">For the distinguisher just presented, the idea is to consider plaintexts in cosets of  <span class="math">C_I</span>  for  <span class="math">I \\subseteq \\{0,1,2,3\\}</span>  with |I|=1, construct all the possible couples of two (plaintexts, ciphertexts) pairs with two equal generating variables, divide them into sets S of  <span class="math">2^{17}</span>  couples and count the number of sets for which two ciphertexts of at least one couple belong to the same coset of  <span class="math">\\mathcal{M}_J</span>  for |J|=3. To set up the key-recovery attack, the idea is simply to start with cosets of  <span class="math">\\mathcal{D}_I</span>  for  <span class="math">I \\in \\{0,1,2,3\\}</span> , and to repeat the previous procedure for each guessed combination of the I-th diagonal of the secret key. The crucial point is that the guessed 4-bytes of the key influence the way in which the couples of texts are divided into the sets S. As a consequence, if the 4 guessed bytes are wrong (i.e. different from the right ones), the couples are divided into sets S in a random way.</p>

    <p class="text-gray-300">As we are going to prove, for a wrongly guessed key the probability that a set S satisfies the required property (that is, two ciphertexts of at least one couple belong to the same coset of  <span class="math">\\mathcal{M}_J</span> ) is (approximately) equal to the probability of the random case  <span class="math">p_{rand}</span> , which is higher than the probability  <span class="math">p_{AES}</span>  for the case of the right key. As a result, the number of sets S for which two ciphertexts of at least one couple belong to the same coset of  <span class="math">\\mathcal{M}_J</span>  for |J|=3 is minimum for the right key. This allows to recover one diagonal of the secret key. In the following we present all the details.</p>

    <h2 id="sec-misc-4" class="text-2xl font-bold">Key-Recovery Attack - Details</h2>

    <p class="text-gray-300">Consider texts in a coset of  <span class="math">\\mathcal{C}_I</span>  which is obtained by 1-round encryption of a coset of  <span class="math">\\mathcal{D}_I</span>  with respect to a (partially) guessed key. Here we theoretically compute the probability that a set  <span class="math">\\mathcal{S}</span>  satisfies the required property (that is, two ciphertexts of at least one couple belong to the same coset of  <span class="math">\\mathcal{M}_J</span> ) when the guessed key is not the right one. In other words, we are going to show that the behavior in the case of a wrongly guessed key (for the following denoted by &quot;AES with a wrong key&quot;) is similar to the one of a random permutation.</p>

    <p class="text-gray-300">Observe that the main difference between &quot;AES with a wrong key&quot; and a random permutation is given by the possibility in the first case to study the distribution of the couples after each round - note that for a random permutation it is meaningless to consider the distribution of the texts after (e.g.) one round. In particular, a coset of a diagonal space  <span class="math">\\mathcal{D}_I</span>  is always mapped into a coset of a column space  <span class="math">\\mathcal{C}_I</span>  after one round independently of the key. On the other hand, we stress that the way in which the couples are distributed in the sets  <span class="math">\\mathcal{S}</span>  depends on the guessed key.</p>

    <p class="text-gray-300">Consider a key-recovery attack on 6-round AES</p>

    <p class="text-gray-300"><span class="math">$\\mathcal{D}_{I} \\oplus a \\xrightarrow{R(\\cdot)} \\underbrace{\\text{5-round Secret-Key Distinguisher of Sect. 7}}_{\\text{(x,y)}} \\mathcal{S}^{i,j}_{\\mathbf{x,y}} \\subseteq \\mathcal{C}_{I} \\oplus b \\xrightarrow{R(\\cdot)} \\underbrace{\\mathcal{M}_{I} \\oplus c \\xrightarrow{R(\\cdot)} \\mathcal{D}_{J} \\oplus a&#x27; \\xrightarrow{R^{2}(\\cdot)} \\mathcal{M}_{J} \\oplus c&#x27;}_{\\text{prob. 1}} \\mathcal{M}_{J} \\oplus c&#x27; \\xrightarrow{R(\\cdot)} \\mathcal{M}_{K} \\oplus c&#x27;&#x27;}</span>$</p>

    <p class="text-gray-300">and focus on the middle round  <span class="math">\\mathcal{M}_I \\oplus c \\xrightarrow{R(\\cdot)} \\mathcal{D}_J \\oplus a&#x27;</span>  for |I| = 1 and |J| = 3. Assume the guessed key is wrong, and consider one set  <span class="math">\\mathcal{S}^{i,j}_{(x_0,x_1),(y_0,y_1)}</span> . For this set, the number of couples that belong to the same coset of  <span class="math">\\mathcal{M}_J</span>  after four rounds can take any possible value between 0 and  <span class="math">2^{17}</span>  (that is, 0, 1, 2, ... or  <span class="math">2^{17}</span> ). Indeed, since the couples are divided in sets  <span class="math">\\mathcal{S}^{i,j}_{(x_0,x_1),(y_0,y_1)}</span>  in a random way, it is not possible to guarantee that the number of couples that belong to the same coset of  <span class="math">\\mathcal{M}_J</span>  after 4 rounds is only 0 or  <span class="math">2^{17}</span>  (as for &quot;AES with the right key&quot;).</p>

    <p class="text-gray-300">Using the same calculation as before and for a wrongly guessed key, given a set  <span class="math">S_{(x_0,x_1),(y_0,y_1)}^{i,j}</span> , the probability  <span class="math">p_{AES}^{WrongKey}</span>  that two texts of at least one couple belong to the same coset of  <span class="math">\\mathcal{M}_K</span>  for a certain |K|=3 after 6 rounds is given by</p>

    <p class="text-gray-300"><span class="math">$p_{AES}^{WrongKey} = \\sum_{n=0}^{2^{17}} \\binom{2^{17}}{n} \\cdot p_3^n \\cdot (1-p_3)^{2^{17}-n} \\cdot \\left[1 - \\left(1-p_{3,3}\\right)^n \\cdot \\left(1 - \\frac{p_3 \\cdot (1-p_{3,3})}{1-p_3}\\right)^{2^{17}-n}\\right],</span>$</p>

    <p class="text-gray-300">which is well approximated by</p>

    <p class="text-gray-300"><span class="math">$p_{AES}^{WrongKey} = 2^{-13} - 524\\,287 \\cdot 2^{-46} + 45\\,812\\,722\\,347 \\cdot 2^{-77} + \\dots</span>$</p>

    <p class="text-gray-300">Note that this probability is approximately equal to the one of the random case (see (14) for details), while we remember that the probability for &quot;AES with the right key&quot; is</p>

    <p class="text-gray-300"><span class="math">$p_{AES} = 2^{-13} - 524287 \\cdot 2^{-46} - 22370411853 \\cdot 2^{-77} + \\dots</span>$</p>

    <p class="text-gray-300">where the difference between these two probabilities is approximately  <span class="math">|p_{AES}^{WrongKey}-p_{AES}|\\simeq 2^{-41.011}</span> .</p>

    <h2 id="sec-misc-5" class="text-2xl font-bold"><strong>Data and Computational Costs</strong></h2>

    <p class="text-gray-300"><strong>Data Cost.</strong> Assume the goal is to discover the <em>I</em>-th diagonal of the key with probability higher than 95%. Equivalently, the goal is to guarantee that the number of sets  <span class="math">S_{(x_0,x_1),(y_0,y_1)}^{i,j}</span>  that satisfy the required property is the lowest one for the right key with probability higher than 95%.</p>

    <p class="text-gray-300">To compute the data cost, the idea is to use the same analysis proposed for the 5-round distinguisher in Sect. 7.2. In particular, since there are  <span class="math">2^{32}</span>  candidates for each diagonal of the keys, one has to guarantee that the number of sets  <span class="math">S_{(x_0,x_1),(y_0,y_1)}^{i,j}</span>  that satisfy the previous required property is the lowest one for the right key with probability higher than  <span class="math">(0.95)^{2^{-32}}</span>  (note that the  <span class="math">2^{32}</span>  tests - one for each candidate - are all independent).</p>

    <p class="text-gray-300">Using formula (15), one needs approximately  <span class="math">2^{73.343}</span>  different sets  <span class="math">S_{(x_0,x_1),(y_0,y_1)}^{i,j}</span>  for each candidate of the <em>i</em>-th diagonal of the key. Since it is possible to construct approximately  <span class="math">3 \\cdot 2^{15} \\cdot (2^8 - 1)^2 \\approx 2^{32.574}</span>  different sets for each initial coset of  <span class="math">\\mathcal{D}_I</span> , one needs approximately  <span class="math">2^{73.343} \\cdot 2^{-32.573} = 2^{40.77}</span>  different initial cosets of  <span class="math">\\mathcal{D}_I</span>  to discover the <em>I</em>-th diagonal of the key with probability higher than 95%, for a total cost of  <span class="math">2^{40.77} \\cdot 2^{32} = 2^{72.77}</span>  chosen plaintexts.</p>

    <p class="text-gray-300">When one diagonal of the key is found<sup>27</sup>, due to the computational cost of this step we propose to find the entire key (i.e. the other three diagonals) using a brute force attack.</p>

    <p class="text-gray-300">Computational Cost. In order to implement the attack, the idea is to use Algorithm 3 for each possible guessed key in order to count the number of sets S that satisfy the required property (i.e. two ciphertexts of at least one couple belong to the same coset of  <span class="math">\\mathcal{M}_J</span>  for a certain J with |J|=3). Since this number of sets is higher for a wrongly guessed key than for the right one, it is possible to recover the right candidate of the key.</p>

    <p class="text-gray-300">An implementation of the attack is described by the pseudo-code given in Algorithm 4. To compute the computational cost, it is sufficient to re-consider the cost of the 5-round distinguisher. Given a coset of  <span class="math">C_0</span> , the cost to count the number of sets S with the required property is  <span class="math">2^{39.1}</span>  table look-ups. This step is repeated for each one of the  <span class="math">2^{32}</span>  (partially) guessed key and for each one of the  <span class="math">2^{40.77}</span>  initial cosets of  <span class="math">D_0</span> , for a cost of  <span class="math">2^{39.05} \\cdot 2^{40.77} \\cdot 2^{32} = 2^{111.82}</span>  table look-ups. Moreover, one needs to partially compute 1-round encryption for each possible guessed key and for each initial coset, for a cost of  <span class="math">4 \\cdot 2^{32} \\cdot 2^{40.77} \\cdot 2^{32} = 2^{106.77}</span>  S-Box look-ups. As a result, the total cost to find one diagonal of the key is well approximated by  <span class="math">2^{111.82}</span>  table look-ups, or equivalently  <span class="math">2^{104.92}</span>  six-round encryptions (under the assumption 20 table/S-Box look-ups  <span class="math">\\approx</span>  1-round encryption). The total cost to find the entire key (using brute force on the last three diagonal) is of  <span class="math">2^{104.92} + 2^{96} = 2^{104.93}</span>  six-round encryptions.</p>

    <p class="text-gray-300">As last thing, in App. C.3 we explain why it is <em>not</em> possible to set up the key-recovery attack using cosets of  <span class="math">\\mathcal{D}_I</span>  with |I|=2 instead of |I|=1 (that is, why it is not possible to</p>

    <p class="text-gray-300"> <span class="math">&lt;sup&gt;^{27}&lt;/sup&gt;</span> For completeness, we mention that it is possible to (slightly) reduce the data cost by relaxing the property that the number of sets S that satisfy the required property is the lowest one for the right key.</p>

    <pre><code class="language-text">Data: 2^{40.77} cosets of \\mathcal{D}_0 (e.g. \\mathcal{D}_0 \\oplus a_i for a_i \\in \\mathcal{D}_0^{\\perp}) and corresponding ciphertexts
         after 6 rounds
Result: 4 bytes of the secret key - (k_{0,0}, k_{1,1}, k_{2,2}, k_{3,3})
Let N[0,...,2^{32}-1] be an array initialized to zero; //N[k] denotes the number of sets
 S that satisfy the required property for the key k
/* 1st Step: for each guessed key, count the number of sets S with the required property */
for each \\hat{k} from (0x00, 0x00, 0x00, 0x00) to (0xff, 0xff, 0xff, 0xff) do
    for each coset \\mathcal{D}_0 \\oplus a_i do
        (partially) encrypt the 2^{32} plaintexts w.r.t. the guessed key \\hat{k};
        use Algorithm 3 to count the number n of sets S that satisfy the required
       property; N[\\psi(\\hat{k})] \\leftarrow N[\\psi(\\hat{k})] + n; // where \\psi(\\hat{k} \\equiv (k_0, k_1, k_2, k_3)) = \\sum_{i=0}^{3} k_i \\cdot 2^{8 \\cdot i}
end
/* 2nd Step: look for the key for which number of sets S is minimum
min \\leftarrow N[0];
                                                                      // minimum number of sets
\\delta \\leftarrow (0x00, 0x00, 0x00, 0x00);
for each \\hat{k} from (0x00, 0x00, 0x00, 0x00) to (0xff, 0xff, 0xff, 0xff) do
    if N[\\varphi(\\hat{k})] &lt; min then
   end
return \\delta - candidate of (k_{0,0}, k_{1,1}, k_{2,2}, k_{3,3})
</code></pre>

    <p class="text-gray-300"><strong>Algorithm 4:</strong> 6-round key-recovery attack on AES exploiting a 5-round secret-key distinguisher. The goal of the attack is to find 4 bytes of the secret key. The remaining bytes (the entire key) are found by brute force.</p>

    <p class="text-gray-300">exploit the modified version of the previous distinguisher proposed in App. C.2). Without going into the details, one has to guess 64 bits of the key instead of 32 for the attack that exploits the distinguisher proposed in App. C.2. As a consequence, this modified attack requires approximately  <span class="math">2^{88.1}</span>  chosen plaintexts (in  <span class="math">2^{24.1}</span>  different initial cosets of  <span class="math">\\mathcal{D}_I</span>  with |I|=2) and it has a total computational cost of approximately  <span class="math">2^{176.2}</span>  six-round encryptions, which is (much) higher than the cost of a brute force attack.</p>

    <p class="text-gray-300">To conclude, we present other possible properties that are <em>independent</em> of the secret key and that can be exploited to set up secret-key distinguishers for 5-round AES. Given sets of (plaintexts, ciphertexts) pairs - defined in a similar way to the previous ones, it is possible to exploit the following properties:</p>

    <ul class="list-disc list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li>consider the number of sets with the following property: the number of couples for which the two ciphertexts belong to the same coset of  <span class="math">\\mathcal{M}_I</span>  for |I|=2 is higher than a certain number  <span class="math">Z \\in \\mathbb{N}</span> ; if this number Z and the sets are properly defined, then this number of sets is higher for 5-round AES than for a random permutation:</li>
      <li>if the sets are properly defined, for 5-round AES there exists at least one set for which the two ciphertexts of <em>each</em> couple in that set don't belong to the same coset of  <span class="math">\\mathcal{M}_I</span>  for each I with |I| = 3; in contrast, for a random permutation, for each set</li>
    </ul>

    <p class="text-gray-300">there exists at least one couple for which the two ciphertexts belong to the same coset of  <span class="math">\\mathcal{M}_I</span>  for |I| = 3.</p>

    <p class="text-gray-300">In the following, we give all the details and a theoretical explanation of the previous properties. We also highlight that these two distinguishers work both in the encryption (i.e. using chosen plaintexts) and in the decryption direction (i.e. using chosen ciphertexts)</p>

    <p class="text-gray-300">The first distinguisher that we are going to present exploits the following property:</p>

    <p class="text-gray-300">&bull; consider the number of sets  <span class="math">\\mathcal{Z}</span>  with the following property: the number of couples for which the two ciphertexts belong to the same coset of  <span class="math">\\mathcal{M}_I</span>  for |I|=2 is higher than a certain threshold  <span class="math">Z \\in \\mathbb{N}</span> ; if this number Z and the sets Z are properly defined, then this number of sets is higher for 5-round AES than for a random permutation.</p>

    <p class="text-gray-300">As first thing, we define the sets  <span class="math">\\mathcal{Z}_{(\\mathbf{x},\\mathbf{y})}</span>  - where  <span class="math">\\mathbf{x}=(x_0,x_1,...,x_7)</span>  and  <span class="math">\\mathbf{y}=(y_0,y_1,...,y_7)</span>  such that  <span class="math">(x_0,x_1,x_2,x_3)\\neq (y_0,y_1,y_2,y_3)</span>  and  <span class="math">(x_4,x_5,x_6,x_7)\\neq (y_4,y_5,y_6,y_7)</span>  - that we are going to use</p>

    <p class="text-gray-300"><span class="math">$\\mathcal{Z}_{(\\mathbf{x},\\mathbf{y})} \\equiv \\left\\{ (p,q) \\in \\mathbb{F}_{2^8}^{4 \\times 4} \\times \\mathbb{F}_{2^8}^{4 \\times 4} \\,\\middle|\\, p = a \\oplus \\begin{bmatrix} x_0 &amp; C &amp; E &amp; x_7 \\\\ x_4 &amp; x_1 &amp; F &amp; G \\\\ A &amp; x_5 &amp; x_2 &amp; H \\\\ B &amp; D &amp; x_6 &amp; x_3 \\end{bmatrix} \\, q = a \\oplus \\begin{bmatrix} y_0 &amp; C &amp; E &amp; y_7 \\\\ y_4 &amp; y_1 &amp; F &amp; G \\\\ A &amp; y_5 &amp; y_2 &amp; H \\\\ B &amp; D &amp; y_6 &amp; y_3 \\end{bmatrix} \\right.</span>$
or  <span class="math">p = a \\oplus \\begin{bmatrix} x_0 &amp; C &amp; E &amp; y_7 \\\\ y_4 &amp; x_1 &amp; F &amp; G \\\\ A &amp; y_5 &amp; x_2 &amp; H \\\\ B &amp; D &amp; y_6 &amp; x_3 \\end{bmatrix} \\, q = a \\oplus \\begin{bmatrix} y_0 &amp; C &amp; E &amp; x_7 \\\\ x_4 &amp; y_1 &amp; F &amp; G \\\\ A &amp; x_5 &amp; y_2 &amp; H \\\\ B &amp; D &amp; x_6 &amp; y_3 \\end{bmatrix} \\quad \\forall A, B, C, ..., H \\in \\mathbb{F}_{2^8} \\, \\right\\}</span></p>

    <p class="text-gray-300">for a fixed  <span class="math">a \\in \\mathbb{F}_{2^8}^{4 \\times 4}</span> . Each set contains  <span class="math">2^{65}</span>  different couples of two (plaintext, ciphertext) pairs, and it is possible to construct approximately  <span class="math">\\frac{1}{4} \\cdot (2^{32} \\cdot (2^{32} - 1))^2 = 2^{126}</span>  different sets.</p>

    <p class="text-gray-300">To set up the distinguisher, consider (at least)  <span class="math">2^{47}</span>  different sets  <span class="math">\\mathcal{Z}</span>  (each one of  <span class="math">2^{65}</span>  different couples), and count the number of sets with the following property: the number of different couples for which the two ciphertexts belong to the same coset of  <span class="math">\\mathcal{M}_I</span>  for a certain I with |I|=2 is higher than a given number  <span class="math">Z=3\\cdot 2^{18}=786\\,432</span> . Independently of the secret key, of the details of the S-Box and of the MixColumns matrix, it is possible to prove that</p>

    <ul class="list-disc list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li>for 5-round AES, the number of sets  <span class="math">\\mathcal{Z}</span>  with the required property is on average <em>higher</em> than  <span class="math">2^{16}</span> ;</li>
      <li>for a random permutation, the number of sets  <span class="math">\\mathcal{Z}</span>  with the required property is on average <em>lower</em> than  <span class="math">2^{11.415}</span> .</li>
    </ul>

    <p class="text-gray-300">This allows to distinguish the two cases. All details are given in the following. We emphasize that - for our goal - it is sufficient to prove that a lower bound of the number of sets that satisfy the required property for the AES case is higher than an upper bound of the corresponding number for the random permutation case.</p>

      <h4 id="sec-9.1.1" class="text-lg font-semibold mt-6">9.1.1 Details and Proof</h4>

    <p class="text-gray-300">For the following, we recall the <em>Chebyshev Inequality</em></p>

    <p class="text-gray-300"><span class="math">$Prob(|X - \\mu| \\ge k \\cdot \\sigma) \\le \\frac{1}{k^2} \\qquad \\forall k &gt; 0</span>$</p>

    <p class="text-gray-300">where X is a random variable with mean  <span class="math">\\mu</span>  and variance  <span class="math">\\sigma^2</span> .</p>

    <h4 id="sec-misc-6" class="text-lg font-semibold mt-6"><strong>Proof - AES</strong></h4>

    <p class="text-gray-300">As first thing, we prove the results just given, starting with the 5-round AES case.</p>

    <p class="text-gray-300"><strong>Initial Considerations - 4-round AES.</strong> Our 5-round distinguisher is based on Theorem 3. Given a set  <span class="math">\\mathcal{Z}</span>  just defined, after 4-round encryption, only two events can happen:</p>

    <ul class="list-disc list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li><ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li>for each  <span class="math">(p,q) \\in \\mathcal{Z}</span> , then  <span class="math">R^4(p) \\oplus R^4(q) \\in \\mathcal{M}_J</span>  for a certain  <span class="math">J \\subseteq \\{0,1,2,3\\}</span> ;</li>
    </ol></li>
      <li><ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li>for each  <span class="math">(p,q) \\in \\mathcal{Z}</span> , then  <span class="math">R^4(p) \\oplus R^4(q) \\notin \\mathcal{M}_J</span>  for all  <span class="math">J \\subseteq \\{0,1,2,3\\}</span> .</li>
    </ol></li>
    </ul>

    <p class="text-gray-300">Observe that  <span class="math">p \\oplus q \\in \\mathcal{D}_{0,3}</span>  by definition, that is  <span class="math">R^2(p) \\oplus R^2(q) \\in \\mathcal{M}_{0,3}</span> . Thus, the event  <span class="math">R^4(p) \\oplus R^4(q) \\in \\mathcal{M}_J</span>  can happen if and only if |J| = 3.</p>

    <p class="text-gray-300">Moreover, as showed in Sect. 7.1.2, if |J| = 3 then the first event occurs with (approximately) prob.  <span class="math">2^{-30}</span> , while the second one occurs with (approximately) prob.  <span class="math">1 - 2^{-30}</span> .</p>

    <p class="text-gray-300"><strong>Proof.</strong> In order to obtain a lower bound for the AES case (and so the desired result), it is sufficient to consider the first event, that is the set  <span class="math">\\mathcal{Z}</span>  for which  <span class="math">R^4(p) \\oplus R^4(q) \\in \\mathcal{M}_J</span>  for all  <span class="math">(p,q) \\in \\mathcal{Z}</span>  and for |J|=3. Given  <span class="math">2^{47}</span>  initial sets  <span class="math">\\mathcal{Z}</span> , the average number of sets that satisfy this property is  <span class="math">2^{47} \\cdot p_3 = 2^{47} \\cdot (2^{-30} - 3 \\cdot 2^{-63} + 2^{-94}) = 2^{17} - 2^{-14} + 2^{-47} \\simeq 2^{17}</span> .</p>

    <p class="text-gray-300">Given a set as before, what is the number of couples for which the two ciphertexts belong to the same coset of  <span class="math">\\mathcal{M}_I</span>  for |I|=2 after 5-round? Considering sets  <span class="math">\\mathcal{Z}</span>  that satisfy the first event, since  <span class="math">Prob(R(x) \\oplus R(y) \\in \\mathcal{M}_I | x \\oplus y \\in \\mathcal{M}_J) = p_{2,3} \\simeq 3 \\cdot 2^{-47}</span>  (see (7) for details) and since each set is composed of  <span class="math">2^{65}</span>  different couples, the average number of couples of ciphertexts that belong to the same coset of  <span class="math">\\mathcal{M}_I</span>  after 5-round for |I|=2 is  <span class="math">2^{65} \\cdot 3 \\cdot 2^{-47} = 3 \\cdot 2^{18}</span>  (which is equal to the number Z).</p>

    <p class="text-gray-300">As we are going to show in the following, on average half of the previous sets satisfy the required property (that is, that the number of couples of ciphertexts that belong to  <span class="math">\\mathcal{M}_I</span>  is higher than Z). As a result, the average number of sets Z that satisfy the required property is (higher<sup>28</sup> than)  <span class="math">2^{16}</span> .</p>

    <p class="text-gray-300">Proof - Half of the Sets  <span class="math">\\mathcal{Z}</span>  satisfy the Required Property. Working on sets  <span class="math">\\mathcal{Z}</span>  for which  <span class="math">R^4(p) \\oplus R^4(q) \\in \\mathcal{M}_J</span>  for all  <span class="math">(p,q) \\in \\mathcal{Z}</span>  and for |J|=3, in order to prove the previous result, we must show that on average half of the previous sets  <span class="math">\\mathcal{Z}</span>  satisfy the required property. To do this, note that the probabilistic distribution of the number of different pairs of ciphertexts of a set  <span class="math">\\mathcal{Z}</span>  that belong to the same coset of  <span class="math">\\mathcal{M}_I</span>  is well described by a binomial distribution<sup>29</sup>  <span class="math">\\mathcal{B}(n,p)</span> . In particular, if we limit to consider the sets  <span class="math">\\mathcal{Z}</span>  for which  <span class="math">R^4(p) \\oplus R^4(q) \\in \\mathcal{M}_J</span>  for all  <span class="math">(p,q) \\in \\mathcal{Z}</span>  and for |J|=3, then the mean value is given by  <span class="math">\\mu=n\\cdot p_{2,3}=3\\cdot 2^{18}</span>  and the variance is given by  <span class="math">\\sigma^2=n\\cdot p_{2,3}\\cdot (1-p_{2,3})=3\\cdot 2^{18}</span> .</p>

    <p class="text-gray-300">If the previous distribution is symmetric with respect to the mean value, given a set Z as before, then the number of pairs for which the two ciphertexts are in the same coset of  <span class="math">\\mathcal{M}_I</span>  is higher than  <span class="math">\\mu = 3 \\cdot 2^{18} = Z</span>  with probability 50%. A parameter that measures the asymmetry of a probabilistic distribution is the  <span class="math">skewness^{30}</span> , where the skewness is zero if and only if the distribution is symmetric. For the particular case of a binomial distribution  <span class="math">\\mathcal{B}(n,p)</span> , the skewness is given by</p>

    <p class="text-gray-300"><span class="math">$\\gamma = \\frac{1 - 2 \\cdot p}{\\sqrt{n \\cdot p \\cdot (1 - p)}}.</span>$</p>

    <p class="text-gray-300"><sup>&amp;</sup>lt;sup&gt;28</sup>Note that this is a lower bound, since we are considering only the sets  <span class="math">\\mathcal{Z}</span>  s.t.  <span class="math">R^4(s) \\oplus R^4(t) \\in \\mathcal{M}_J</span>  for all  <span class="math">(p,q) \\in \\mathcal{Z}</span>  and for |J| = 3.</p>

    <p class="text-gray-300"> <span class="math">&lt;sup&gt;^{29}&lt;/sup&gt;</span> We refer to Sect. 7.2.1 for a discussion of the binomial distribution. Observe that given a set  <span class="math">\\mathcal{Z}</span>  with n pairs, each of them satisfies or not the above property (the two ciphertexts belong to the same coset of  <span class="math">\\mathcal{M}_I</span> ) with a certain probability.</p>

    <p class="text-gray-300"><sup>&amp;</sup>lt;sup&gt;30</sup>The skewness  <span class="math">\\gamma</span>  of a random variable X is defined as  <span class="math">\\gamma = \\mathbb{E}\\left[\\left(\\frac{X-\\mu}{\\sigma}\\right)^3\\right] = \\frac{\\mathbb{E}\\left[(X-\\mu)^3\\right]}{(\\mathbb{E}\\left[(X-\\mu)^2\\right])^{3/2}}</span> .</p>

    <p class="text-gray-300">Since in our case  <span class="math">n=2^{65}</span>  and  <span class="math">p=3\\cdot 2^{-47}</span> , it follows that the skewness is well approximated by  <span class="math">\\gamma\\simeq 2^{-9.8}\\simeq 0.001128</span> , which implies that the distribution is <em>almost</em> symmetric with respect to the mean. By definition of positive skewness, it follows that the mass of the (binomial) distribution is concentrated on the left of the mode (i.e. the value at which its probability mass function takes its maximum value). For a binomial distribution  <span class="math">\\mathcal{B}(n,p)</span> , the mode is given by  <span class="math">\\lfloor (n+1)\\cdot p\\rfloor</span> , that is the mode for our particular case is  <span class="math">\\lfloor (2^{65}+1)\\cdot (3\\cdot 2^{-47}-3\\cdot 2^{-70})\\rfloor = 3\\cdot 2^{18}</span>  (equal to the mean value). As a result, given a set  <span class="math">\\mathcal{Z}</span> , the probability of the event &quot;the number of pairs for which the two ciphertexts are in the same coset of  <span class="math">\\mathcal{M}_I</span>  is higher than  <span class="math">\\mu=3\\cdot 2^{18}=Z</span> &quot; is at least 50%, that is 50% is a lower bound for the required probability. This concludes the proof.</p>

    <h4 id="sec-misc-7" class="text-lg font-semibold mt-6"><strong>Proof - Random Permutation</strong></h4>

    <p class="text-gray-300">As second thing, we prove the previous result for the case of a random permutation. Since  <span class="math">Prob(x \\in \\mathcal{M}_I) = p_2 \\simeq 3 \\cdot 2^{-63}</span>  for |I| = 2, given a set of  <span class="math">2^{65}</span>  pairs, the number of couples that belong to the same coset of  <span class="math">\\mathcal{M}_I</span>  for |I| = 2 is on average  <span class="math">3 \\cdot 2^{-63} \\cdot 2^{65} = 12</span> .</p>

    <p class="text-gray-300">What is the probability that the previous number of couples that satisfy the required property - denoted by X - is higher than  <span class="math">Z=3\\cdot 2^{18}</span> ? To compute this probability, we exploit (1) the Chebyshev Inequality and (2) the fact that probabilistic distribution of the number of collisions of each set is well described by a binomial distribution  <span class="math">\\mathcal{B}(\\mu,\\sigma^2)</span>  with mean  <span class="math">\\mu=2^{65}\\cdot p_2=12</span>  and variance  <span class="math">\\sigma^2=2^{65}\\cdot p_2\\cdot (1-p_2)=12</span> . Thus, using the Chebyshev Inequality, it follows that</p>

    <p class="text-gray-300"><span class="math">$Prob(X \\ge Z = 3 \\cdot 2^{18}) = Prob(X - \\mu \\ge Z - \\mu) \\le Prob(|X - \\mu| \\ge Z - \\mu) \\le \\frac{\\sigma^2}{(Z - \\mu)^2}</span>$</p>

    <p class="text-gray-300">where  <span class="math">Z - \\mu &gt; 0</span> . It follows that the previous event occurs with probability less than  <span class="math">12/(3 \\cdot 2^{18} - 12)^2 \\simeq 2^{-35.585}</span> .</p>

    <p class="text-gray-300">As a result, given  <span class="math">2^{47}</span>  sets Z and for a random permutation, the number of set Z with the required property (i.e. for which the number of couples of ciphertexts that belong to the same coset of  <span class="math">\\mathcal{M}_I</span>  is higher than  <span class="math">Z = 3 \\cdot 2^{18}</span> ) is on average less than  <span class="math">2^{47} \\cdot 2^{-35.585} = 2^{11.415}</span> .</p>

      <h4 id="sec-9.1.2" class="text-lg font-semibold mt-6">9.1.2 Data and Computational Costs</h4>

    <p class="text-gray-300">In order to set up the distinguisher, one needs at least  <span class="math">2^{47}</span>  different sets  <span class="math">\\mathcal{Z}</span> , each one of  <span class="math">2^{65}</span>  different couples of two (plaintext, ciphertext) pairs. Given a set of  <span class="math">2^{89}</span>  plaintexts of the form</p>

    <p class="text-gray-300"><span class="math">$\\begin{bmatrix} A &amp; A &amp; A &amp; C \\\\ A &amp; cccaaaaa &amp; A &amp; A \\\\ A &amp; ccccaaaa &amp; C &amp; A \\\\ A &amp; A &amp; C &amp; C \\end{bmatrix}</span>$</p>

    <p class="text-gray-300">where <em>cccaaaaa</em> denotes a byte with 5 active bits and 3 constant bits (similar for <em>ccccaaaa</em>), then it is possible to construct  <span class="math">\\frac{1}{4} \\cdot (2^{13} \\cdot (2^{13} - 1)) \\cdot (2^{12} \\cdot (2^{12} - 1)) = 2^{48}</span>  sets  <span class="math">\\mathcal{Z}</span>  defined as before. As a result,  <span class="math">2^{89}</span>  chosen plaintexts are (largely) sufficient to set up the distinguisher.</p>

    <p class="text-gray-300">What about the computational cost? The idea is to use Algorithm 3 modified as proposed in App. E in order to implement the distinguisher, where the plaintexts and the ciphertexts are re-order w.r.t. the partial order  <span class="math">\\sqsubseteq</span>  as defined in Def. 11. It follows that the computational cost is well approximated by</p>

    <p class="text-gray-300"><span class="math">$6 \\cdot \\left[2^{89} \\cdot \\log 2^{89} + \\left(2^{89} + 2^{49}\\right)\\right] + 2^{48} \\simeq 2^{98.1}</span>$
table look-ups</p>

    <p class="text-gray-300">where  <span class="math">\\binom{2^{89}}{2} \\cdot 2^{-64} \\cdot 2^{-64} = 2^{49}</span>  is the average number of couples such that the two ciphertexts belong to the same coset of  <span class="math">\\mathcal{M}_J</span>  for a fixed J with |J|=2 and the two plaintexts are in the same coset of  <span class="math">\\mathcal{D}_{0,3}</span>  (by definition of  <span class="math">\\mathcal{Z}</span> ). Equivalently, the total computational cost is well approximated by  <span class="math">2^{91.5}</span>  five-round encryptions.</p>

      <h3 id="sec-9.2" class="text-xl font-semibold mt-8">9.2 Impossible Mixture Differential Secret-Key Distinguisher</h3>

    <p class="text-gray-300">The second distinguisher that we are going to present exploits the following property:</p>

    <p class="text-gray-300">&bull; if the sets  <span class="math">\\mathcal{Q}</span>  are properly defined, for 5-round AES there exists at least one set for which the two ciphertexts of each couple in that set don't belong to the same coset of  <span class="math">\\mathcal{M}_I</span>  for each I with |I|=3; in contrast, for a random permutation, for each set there exists at least one couple for which the two ciphertexts belong to the same coset of  <span class="math">\\mathcal{M}_I</span>  for |I|=3.</p>

    <p class="text-gray-300">As first thing, we define the sets  <span class="math">\\mathcal{Q}_{(\\mathbf{x},\\mathbf{y})}</span>  - where  <span class="math">\\mathbf{x} = (x_0, x_1, ..., x_7)</span>  and  <span class="math">\\mathbf{y} = (y_0, y_1, ..., y_7)</span>  such that  <span class="math">x_i \\neq y_i</span>  for each i - that we are going to use. Sets  <span class="math">\\mathcal{Q}_{(\\mathbf{x},\\mathbf{y})}</span>  are similar to the set  <span class="math">\\mathcal{Z}</span>  previously defined, with the only difference that in this case we consider <em>all</em> the possible different combinations of these 16 variables. That is, a set  <span class="math">\\mathcal{Q}_{(\\mathbf{x},\\mathbf{y})}</span>  is defined as</p>

    <p class="text-gray-300"><span class="math">$\\mathcal{Q}_{(\\mathbf{x},\\mathbf{y})} \\equiv \\left\\{ (p,q) \\in \\mathbb{F}_{2^8}^{4 \\times 4} \\times \\mathbb{F}_{2^8}^{4 \\times 4} \\,\\middle|\\, p = a \\oplus \\begin{bmatrix} x_0 &amp; 0 &amp; C &amp; x_7 \\\\ x_4 &amp; x_1 &amp; 0 &amp; 0 \\\\ A &amp; x_5 &amp; x_2 &amp; 0 \\\\ 0 &amp; B &amp; x_6 &amp; x_3 \\end{bmatrix} q = a \\oplus \\begin{bmatrix} y_0 &amp; 0 &amp; C &amp; y_7 \\\\ y_4 &amp; y_1 &amp; 0 &amp; 0 \\\\ A &amp; y_5 &amp; y_2 &amp; 0 \\\\ 0 &amp; B &amp; y_6 &amp; y_3 \\end{bmatrix} \\right\\}</span>$
or  <span class="math">p = a \\oplus \\begin{bmatrix} y_0 &amp; 0 &amp; C &amp; x_7 \\\\ x_4 &amp; x_1 &amp; 0 &amp; 0 \\\\ A &amp; x_5 &amp; x_2 &amp; 0 \\\\ 0 &amp; B &amp; x_6 &amp; x_3 \\end{bmatrix} q = a \\oplus \\begin{bmatrix} x_0 &amp; 0 &amp; C &amp; y_7 \\\\ y_4 &amp; y_1 &amp; 0 &amp; 0 \\\\ A &amp; y_5 &amp; y_2 &amp; 0 \\\\ 0 &amp; B &amp; y_6 &amp; y_3 \\end{bmatrix}</span>  or  <span class="math">\\dots \\forall A, B, C \\in \\mathbb{F}_{2^8} \\right\\}</span></p>

    <p class="text-gray-300">where we emphasize that with respect to the previous set  <span class="math">\\mathcal{Z}</span> , here we consider all the possible combinations of the 16 variables, that is we don't limit to consider the combinations of the two diagonals as before. As a result, since there are  <span class="math">2^{24}</span>  different possible values of A, B, C and since it is possible to consider  <span class="math">2^{15}</span>  different combinations of  <span class="math">\\mathbf{x}</span>  and  <span class="math">\\mathbf{y}</span> , each set  <span class="math">\\mathcal{Q}_{(\\mathbf{x},\\mathbf{y})}</span>  is composed of  <span class="math">2^{24} \\cdot 2^{15} = 2^{39}</span>  different couples of two (plaintext, ciphertext) pairs. Moreover, it is possible to construct approximately  <span class="math">\\frac{1}{2^{15}} \\cdot 2^{63} \\cdot (2^8 - 1)^8 \\simeq 2^{111.954}</span>  different sets  <span class="math">\\mathcal{Q}_{(\\mathbf{x},\\mathbf{y})}</span>  just defined.</p>

    <p class="text-gray-300">To set up the distinguisher, consider (at least)  <span class="math">3 \\cdot 2^{96}</span>  different sets  <span class="math">\\mathcal{Q}</span> , each one of  <span class="math">2^{39}</span>  different couples of two (plaintext, ciphertext) pairs, and check if there exists at least one set  <span class="math">\\mathcal{Q}</span>  for which the two ciphertexts of each couple don't belong to the same coset of  <span class="math">\\mathcal{M}_I</span>  for |I| = 3 after 5-round. Independently of the secret key, of the details of the S-Box and of the MixColumns matrix, it is possible to prove that</p>

    <ul class="list-disc list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li>for 5-round AES, there exists at least one set Q that satisfy the previous property with approximately prob. 99.9995%;</li>
      <li>for a random permutation, for each set Q there exists at least one couple for which the two ciphertexts belong to the same coset of  <span class="math">\\mathcal{M}_I</span>  for |I| = 3 with prob. close to 1.</li>
    </ul>

    <p class="text-gray-300">This allows to distinguish the two cases. In the following we present all the details.</p>

    <p class="text-gray-300">Similarity with &quot;classical&quot; Impossible Differential Attack. Before going on, note that this distinguisher on 5 rounds has something in common with the 4-round distinguisher based on impossible differential trails first proposed by Biham and Keller in [BK01], in the same way in which the 5-round distinguisher just presented in Sect. 7 has something in common with the 3-round distinguisher based on the truncated differential cryptanalysis. For an impossible differential trail, one exploits the fact that given two plaintexts in the same coset of  <span class="math">\\mathcal{D}_I</span> , then they don't belong to the same coset of  <span class="math">\\mathcal{M}_J</span>  after four rounds for each  <span class="math">I,J\\in\\{0,1,2,3\\}</span>  with  <span class="math">|I|+|J|\\leq 4</span>  (see Prop. 1), while this happens with a probability different from zero for a random permutation. Here we use the same technique, but working on sets of couples of texts and not on single couples of texts independently of the others.</p>

      <h4 id="sec-9.2.1" class="text-lg font-semibold mt-6">9.2.1 Details and Proof</h4>

    <h4 id="sec-misc-8" class="text-lg font-semibold mt-6"><strong>Proof - AES</strong></h4>

    <p class="text-gray-300"><strong>Initial Considerations - 1-round AES.</strong> Our 5-round distinguisher is based on the following property. Consider a set Q just defined. <em>After 1-round encryption</em>, only two events can happen:</p>

    <ul class="list-disc list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li><ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li>for each  <span class="math">(p,q) \\in \\mathcal{Q}</span> , then  <span class="math">R(p) \\oplus R(q) \\in \\mathcal{D}_J</span>  for a certain  <span class="math">J \\subseteq \\{0,1,2,3\\}</span> ;</li>
    </ol></li>
      <li><ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li>for each  <span class="math">(p,q) \\in \\mathcal{Q}</span> , then  <span class="math">R(p) \\oplus R(q) \\notin \\mathcal{D}_J</span>  for all  <span class="math">J \\subseteq \\{0,1,2,3\\}</span> .</li>
    </ol></li>
    </ul>

    <p class="text-gray-300">Observe that  <span class="math">p \\oplus q \\notin \\mathcal{C}_I</span>  for each I s.t.  <span class="math">|I| \\leq 3</span> , by definition. Since  <span class="math">R(p) \\oplus R(q) \\notin \\mathcal{M}_I</span>  for each I s.t.  <span class="math">|I| \\leq 3</span> , the event  <span class="math">R(p) \\oplus R(q) \\in \\mathcal{D}_J</span>  can occur for each  <span class="math">|J| \\geq 1</span> .</p>

    <p class="text-gray-300">To prove the previous result, we exploit a strategy similar to the one proposed in Sect. 5.1.1 in order to prove the mixture differential distinguisher. To do this, note that</p>

    <p class="text-gray-300"><span class="math">$R(p) \\oplus R(q) \\in \\mathcal{D}_J</span>$
if and only if S-Box <span class="math">(p) \\oplus</span>  S-Box <span class="math">(q) \\in \\mathcal{W}_J</span></p>

    <p class="text-gray-300">where  <span class="math">W_J := SR^{-1} \\circ MC^{-1}(\\mathcal{D}_J)</span> , as defined in (12). Since the S-Box(&middot;) works on each byte independently of the others and since the XOR sum is commutative, it follows that</p>

    <p class="text-gray-300"><span class="math">$S\\text{-Box}(p) \\oplus S\\text{-Box}(q) = S\\text{-Box}(p&#x27;) \\oplus S\\text{-Box}(q&#x27;)</span>$</p>

    <p class="text-gray-300">where the texts p' and q' are given by a different combinations of the generating variables of the texts p and q.</p>

    <p class="text-gray-300">For the following, we also recall that the first case occurs with approximately probability  <span class="math">\\binom{4}{|J|} \\cdot 2^{-32 \\cdot (4-|J|)}</span> , while the second one occurs with approximately probability  <span class="math">1 - \\binom{4}{|J|} \\cdot 2^{-32 \\cdot (4-|J|)}</span>  (as we have seen in Sect. 7.1.2).</p>

    <p class="text-gray-300"><strong>Proof.</strong> To obtain the desired result, we focus on the first event only, that is  <span class="math">R(p) \\oplus R(q) \\in \\mathcal{D}_J</span>  for all  <span class="math">(p,q) \\in \\mathcal{Q}</span>  and for |J| = 1. Since this event happens with prob.  <span class="math">2^{-94}</span> , given  <span class="math">3 \\cdot 2^{96}</span>  initial sets  <span class="math">\\mathcal{Q}</span> , then the average number of sets that satisfy this property is  <span class="math">3 \\cdot 2^{96} \\cdot 2^{-94} = 12</span> .</p>

    <p class="text-gray-300">Due to Prop. 1,  <span class="math">\\operatorname{Prob}(R^4(x) \\oplus R^4(y) \\in \\mathcal{M}_I \\mid x \\oplus y \\in \\mathcal{D}_J) = 0</span>  if  <span class="math">I, J \\subseteq \\{0, 1, 2, 3\\}</span>  such that  <span class="math">|I| + |J| \\leq 4</span>  and  <span class="math">x \\neq y</span> . It follows that if  <span class="math">R(p) \\oplus R(q) \\in \\mathcal{D}_J</span>  for all  <span class="math">(p, q) \\in \\mathcal{Q}</span>  and for |J| = 1, then  <span class="math">R^5(p) \\oplus R^5(q) \\notin \\mathcal{M}_I</span>  for all  <span class="math">(p, q) \\in \\mathcal{Q}</span>  and for |I| = 3. As a result, on average 12 sets satisfy the required property.</p>

    <p class="text-gray-300">In other words, what is the probability that at least one set Q satisfies the required property? By simple computation, it is approximately</p>

    <p class="text-gray-300"><span class="math">$1 - (1 - 2^{-94})^{3 \\cdot 2^{96}} \\simeq 1 - e^{-12} \\approx 99.9995\\%.</span>$</p>

    <h4 id="sec-misc-9" class="text-lg font-semibold mt-6"><strong>Proof - Random Permutation</strong></h4>

    <p class="text-gray-300">As second thing, we prove the previous result for the case of a random permutation. The goal is to show that for a random permutation, for each set there exists at least one couple for which the two ciphertexts belong to the same coset of  <span class="math">\\mathcal{M}_I</span>  for |I|=3 for each set.</p>

    <p class="text-gray-300">First of all, since  <span class="math">Prob(x \\in \\mathcal{M}_I) = p_3 \\simeq 2^{-30}</span>  for |I| = 3, given a set of  <span class="math">2^{39}</span>  couples, the number of couples of ciphertexts that belong to the same coset of  <span class="math">\\mathcal{M}_I</span>  for |I| = 3 is on average  <span class="math">2^{-30} \\cdot 2^{39} = 2^9 = 512</span> .</p>

    <p class="text-gray-300">What is the probability that for each set at least one couple for which the two ciphertexts that belong to the same coset of  <span class="math">\\mathcal{M}_I</span>  for |I|=3? By simple computation</p>

    <p class="text-gray-300"><span class="math">$\\left[1 - (1 - 2^{-30})^{2^{39}}\\right]^{3 \\cdot 2^{96}} \\simeq \\left[1 - e^{-2^9}\\right]^{3 \\cdot 2^{96}} \\simeq \\exp\\left(-\\frac{1}{2^{415.8}}\\right) \\simeq 1.</span>$</p>

      <h4 id="sec-9.2.2" class="text-lg font-semibold mt-6">9.2.2 Data and Computational Costs</h4>

    <p class="text-gray-300">In order to set up the distinguisher, one needs at least  <span class="math">3 \\cdot 2^{96} \\simeq 2^{97.6}</span>  different sets Q, each one of  <span class="math">2^{39}</span>  different couples of two (plaintext, ciphertext) pairs. Given a set of  <span class="math">2^{82}</span>  plaintexts of the form</p>

    <p class="text-gray-300"><span class="math">$\\begin{bmatrix} A &amp; C &amp; A &amp; cccaaaaa \\\\ A &amp; A &amp; C &amp; C \\\\ A &amp; A &amp; A &amp; C \\\\ C &amp; A &amp; A &amp; cccaaaaa \\end{bmatrix}</span>$</p>

    <p class="text-gray-300">where <em>cccaaaaa</em> denotes a byte with 5 active bits and 3 constant bits, then it is possible to construct  <span class="math">\\frac{1}{2^{15}} \\cdot 2^{58} \\cdot (2^8 - 1)^6 \\cdot (2^5 - 1)^2 = 2^{100.8}</span>  sets  <span class="math">\\mathcal{Q}</span>  defined as before. As a result,  <span class="math">2^{82}</span>  chosen plaintexts are (largely) sufficient to set up the distinguisher.</p>

    <p class="text-gray-300">What about the computational cost? The idea is to use Algorithm 3 as described in Sect. 7.2 to implement the distinguisher. It follows that the computational cost is well approximated by</p>

    <p class="text-gray-300"><span class="math">$4 \\cdot \\left[2^{82} \\cdot \\log 2^{82} + \\left(2^{82} + 2^{65}\\right)\\right] + 3 \\cdot 2^{96} \\simeq 2^{97.8}</span>$
table look-ups</p>

    <p class="text-gray-300">where  <span class="math">\\binom{2^{82}}{2} \\cdot 2^{-96} = 2^{65}</span>  is the average number of couples such that two ciphertexts are in the same coset of  <span class="math">\\mathcal{M}_J</span>  for fixed J with |J|=1. Equivalently, the total computational cost is well approximated by  <span class="math">2^{91.1}</span>  five-round encryptions.</p>

    <p class="text-gray-300"><strong>Acknowledgements.</strong> The author thanks Christian Rechberger for fruitful discussions and comments that helped to improve the quality of the paper. The author also thanks the anonymous reviewers and Anne Canteaut for their valuable comments and suggestions.</p>

    <ul class="list-disc list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li><p class="text-gray-300">[BBS99] Eli Biham, Alex Biryukov, and Adi Shamir. Cryptanalysis of Skipjack Reduced to 31 Rounds Using Impossible Differentials. In <em>Advances in Cryptology</em>&mdash; <em>EUROCRYPT 1999</em>, volume 1592 of <em>LNCS</em>, pages 12&ndash;23, 1999.</p></li>
      <li><p class="text-gray-300">[BEK16] Asli Bay, Oguzhan Ersoy, and Ferhat Karako&ccedil;. Universal Forgery and Key Recovery Attacks on ELmD Authenticated Encryption Algorithm. In Advances in Cryptology - ASIACRYPT 2016, volume 10031 of LNCS, pages 354&ndash;368, 2016.</p></li>
      <li><p class="text-gray-300">[BG11] C&eacute;line Blondeau and Beno&icirc;t G&eacute;rard. Multiple Differential Cryptanalysis: Theory and Practice. In Fast Software Encryption - FSE 2011, volume 6733 of LNCS, 2011.</p></li>
      <li><p class="text-gray-300">[BJV04] Thomas Baign&egrave;res, Pascal Junod, and Serge Vaudenay. How Far Can We Go Beyond Linear Cryptanalysis? In <em>Advances in Cryptology - ASIACRYPT</em> 2004, number 3329 in LNCS, pages 432&ndash;450, 2004.</p></li>
      <li><p class="text-gray-300">[BK01] Eli Biham and Nathan Keller. Cryptanalysis of Reduced Variants of Rijndael. unpublished, 2001. http://csrc.nist.gov/archive/aes/round2/conf3/papers/35-ebiham.pdf.</p></li>
      <li><p class="text-gray-300">[BKR11] Andrey Bogdanov, Dmitry Khovratovich, and Christian Rechberger. Biclique Cryptanalysis of the Full AES. In <em>Advances in Cryptology &ndash; ASIACRYPT</em> 2011, number 7073 in LNCS, pages 344&ndash;371, 2011.</p></li>
      <li><p class="text-gray-300">[BLN17] C&eacute;line Blondeau, Gregor Leander, and Kaisa Nyberg. Differential-Linear Cryptanalysis Revisited. <em>Journal of Cryptology</em>, 30(3):859&ndash;888, 2017.</p></li>
      <li><p class="text-gray-300">[BODK<sup>+</sup>18] Achiya Bar-On, Orr Dunkelman, Nathan Keller, Eyal Ronen, and Adi Shamir. Improved Key-Recovery Attacks on AES with Practical Data and Memory Complexities, 2018. Accepted at CRYPTO 2018.</p></li>
      <li><p class="text-gray-300">[BS90] Eli Biham and Adi Shamir. Differential Cryptanalysis of DES-like Cryptosystems. In <em>Advances in Cryptology - CRYPTO 1990</em>, volume 537 of <em>LNCS</em>, pages 2&ndash;21. Springer, 1990.</p></li>
      <li><p class="text-gray-300">[BS91] Eli Biham and Adi Shamir. Differential Cryptanalysis of DES-like Cryptosystems. <em>Journal of Cryptology</em>, 4(1):3&ndash;72, 1991.</p></li>
      <li><p class="text-gray-300">[CAE] CAESAR: Competition for Authenticated Encryption: Security, Applicability, and Robustness. <a href="http://competitions.cr.yp.to/caesar.html" target="_blank" rel="noopener noreferrer">http://competitions.cr.yp.to/caesar.html</a>.</p></li>
      <li><p class="text-gray-300">[CKK<sup>+</sup>02] Jung Hee Cheon, MunJu Kim, Kwangjo Kim, Lee Jung-Yeun, and SungWoo Kang. Improved Impossible Differential Cryptanalysis of Rijndael and Crypton. In <em>Information Security and Cryptology &mdash; ICISC 2001</em>, volume 2288 of <em>LNCS</em>, pages 39&ndash;49, 2002.</p></li>
      <li><p class="text-gray-300">[CMR05] Carlos Cid, Sean Murphy, and Matthew J. B. Robshaw. Small Scale Variants of the AES. In <em>Fast Software Encryption - FSE 2005</em>, volume 3557 of <em>LNCS</em>, pages 145&ndash;162, 2005.</p></li>
      <li><p class="text-gray-300">[Der13] Patrick Derbez. Meet-in-the-middle attacks on AES. PhD Thesis, Ecole Normale Sup&eacute;rieure de Paris - ENS Paris, 2013. <a href="https://tel.archives-ouvertes.fr/tel-00918146" target="_blank" rel="noopener noreferrer">https://tel.</a> <a href="https://tel.archives-ouvertes.fr/tel-00918146" target="_blank" rel="noopener noreferrer">archives-ouvertes.fr/tel-00918146</a>.</p></li>
      <li><p class="text-gray-300">[DF13] Patrick Derbez and Pierre-Alain Fouque. Exhausting demirci-sel&ccedil;uk meet-inthe-middle attacks against reduced-round AES. In <em>Fast Software Encryption - FSE 2013</em>, volume 8424 of <em>LNCS</em>, pages 541&ndash;560, 2013.</p></li>
      <li><p class="text-gray-300">[DFJ13] Patrick Derbez, Pierre-Alain Fouque, and J&eacute;r&eacute;my Jean. Improved Key Recovery Attacks on Reduced-Round AES in the Single-Key Setting. In <em>Advances in Cryptology &ndash; EUROCRYPT 2013</em>, volume 7881 of <em>LNCS</em>, pages 371&ndash;387, 2013.</p></li>
      <li><p class="text-gray-300">[DKR97] Joan Daemen, Lars R. Knudsen, and Vincent Rijmen. The Block Cipher Square. In <em>Fast Software Encryption - FSE 1997</em>, volume 1267 of <em>LNCS</em>, pages 149&ndash;165, 1997.</p></li>
      <li><p class="text-gray-300">[DN] Nilanjan Datta and Mridul Nandi. ELmD. <a href="https://competitions.cr.yp.to/round1/elmdv10.pdf" target="_blank" rel="noopener noreferrer">https://competitions.cr.yp.</a> <a href="https://competitions.cr.yp.to/round1/elmdv10.pdf" target="_blank" rel="noopener noreferrer">to/round1/elmdv10.pdf</a>.</p></li>
      <li><p class="text-gray-300">[DR02] Joan Daemen and Vincent Rijmen. <em>The Design of Rijndael: AES - The Advanced Encryption Standard</em>. Information Security and Cryptography. Springer, 2002.</p></li>
      <li><p class="text-gray-300">[DR06] Joan Daemen and Vincent Rijmen. Understanding Two-Round Differentials in AES. In <em>Security and Cryptography for Networks - SCN 2006:, 5th International Conference, Italy. Proceedings</em>, volume 4116 of <em>LNCS</em>, pages 78&ndash;94, 2006.</p></li>
      <li><p class="text-gray-300">[GM16] Shay Gueron and Nicky Mouha. Simpira v2: A Family of Efficient Permutations Using the AES Round Function. In <em>Advances in Cryptology - ASIACRYPT 2016</em>, volume 10031 of <em>LNCS</em>, pages 95&ndash;125, 2016.</p></li>
      <li><p class="text-gray-300">[GR17] Lorenzo Grassi and Christian Rechberger. New and Old Limits for AES Known-Key Distinguishers. Cryptology ePrint Archive, Report 2017/255, 2017. <a href="https://eprint.iacr.org/2017/255" target="_blank" rel="noopener noreferrer">https://eprint.iacr.org/2017/255</a>.</p></li>
      <li><p class="text-gray-300">[GR18] Lorenzo Grassi and Christian Rechberger. New Rigorous Analysis of Truncated Differentials for 5-round AES. Cryptology ePrint Archive, Report 2018/182, 2018. <a href="https://eprint.iacr.org/2018/182" target="_blank" rel="noopener noreferrer">https://eprint.iacr.org/2018/182</a>.</p></li>
      <li><p class="text-gray-300">[GRR17a] Lorenzo Grassi, Christian Rechberger, and Sondre R&oslash;njom. A New Structural-Differential Property of 5-Round AES. In <em>Advances in Cryptology - EURO-CRYPT 2017</em>, volume 10211 of <em>LNCS</em>, pages 289&ndash;317. Springer, 2017.</p></li>
      <li><p class="text-gray-300">[GRR17b] Lorenzo Grassi, Christian Rechberger, and Sondre R&oslash;njom. Subspace Trail Cryptanalysis and its Applications to AES. <em>IACR Transactions on Symmetric Cryptology</em>, 2016(2):192&ndash;225, 2017.</p></li>
      <li><p class="text-gray-300">[Knu95] Lars R. Knudsen. Truncated and higher order differentials. In <em>Fast Software Encryption - FSE 1994</em>, volume 1008 of <em>LNCS</em>, pages 196&ndash;211, 1995.</p></li>
      <li><p class="text-gray-300">[Knu98] Lars Ramkilde Knudsen. DEAL - a 128-bit block cipher. Technical Report 151, Department of Informatics, University of Bergen, Norway, Feb. 1998.</p></li>
      <li><p class="text-gray-300">[LH94] Susan K. Langford and Martin E. Hellman. Differential-Linear Cryptanalysis. In <em>Advances in Cryptology - CRYPTO 1994</em>, volume 839 of <em>LNCS</em>, pages 17&ndash;25, 1994.</p></li>
      <li><p class="text-gray-300">[Mat94] Mitsuru Matsui. Linear Cryptanalysis Method for DES Cipher. In <em>Advances in Cryptology &mdash; EUROCRYPT 1993</em>, number 765 in LNCS, pages 386&ndash;397, 1994.</p></li>
      <li><p class="text-gray-300">[Mur11] Sean Murphy. The Return of the Cryptographic Boomerang. <em>IEEE Trans. Information Theory</em>, 57(4):2517&ndash;2521, 2011.</p></li>
      <li><p class="text-gray-300">[RBH17] Sondre R&oslash;njom, Navid Ghaedi Bardeh, and Tor Helleseth. Yoyo Tricks with AES. In <em>Advances in Cryptology - ASIACRYPT 2017</em>, volume 10624 of <em>LNCS</em>, pages 217&ndash;243, 2017.</p></li>
      <li><p class="text-gray-300">[Sel08] Ali Ayd&#305;n Sel&ccedil;uk. On Probability of Success in Linear and Differential Cryptanalysis. <em>Journal of Cryptology</em>, 21(1):131&ndash;147, 2008.</p></li>
      <li><p class="text-gray-300">[Ser80] Robert J. Serfling. <em>Approximation Theorems of Mathematical Statistics</em>. Wiley Series in Probability and Mathematical Statistics, 1980.</p></li>
      <li><p class="text-gray-300">[SS16] Subhabrata Samajder and Palash Sarkar. Another look at normal approximations in cryptanalysis. <em>Journal of Mathematical Cryptology</em>, 10(2):69&ndash;99, 2016.</p></li>
      <li><p class="text-gray-300">[Tie16] Tyge Tiessen. Polytopic Cryptanalysis. In <em>Advances in Cryptology - EURO-CRYPT 2016</em>, volume 9665 of <em>LNCS</em>, pages 214&ndash;239, 2016.</p></li>
      <li><p class="text-gray-300">[Tun12] Michael Tunstall. Improved &quot;Partial Sums&quot;-based Square Attack on AES. In <em>International Conference on Security and Cryptography - SECRYPT 2012</em>, volume 4817 of <em>LNCS</em>, pages 25&ndash;34, 2012.</p></li>
      <li><p class="text-gray-300">[Wag99] David A. Wagner. The Boomerang Attack. In <em>Fast Software Encryption - FSE 1999</em>, volume 1636 of <em>LNCS</em>, pages 156&ndash;170, 1999.</p></li>
      <li><p class="text-gray-300">[WP] Hongjun Wu and Bart Preneel. A Fast Authenticated Encryption Algorithm. <a href="http://competitions.cr.yp.to/round1/aegisv11.pdf" target="_blank" rel="noopener noreferrer">http://competitions.cr.yp.to/round1/aegisv11.pdf</a>.</p></li>
    </ul>

    <p class="text-gray-300">[ZWF07] Wentao Zhang, Wenling Wu, and Dengguo Feng. New Results on Impossible Differential Cryptanalysis of Reduced AES. In <em>Information Security and Cryptology - ICISC 2007</em>, number 4817 in LNCS, pages 239&ndash;250, 2007.</p>

    <p class="text-gray-300">In this section, we prove the probabilities given in Sect. <a href="#page-10-0">3.2.</a> Let <em>I, J</em> &sube; {0<em>,</em> 1<em>,</em> 2<em>,</em> 3}. We recall that</p>

    <p class="text-gray-300">
<span class="math">$\\mathcal{M}_I \\cap \\mathcal{M}_J = \\mathcal{M}_{I \\cap J}. \\tag{17}</span>$</p>

    <p class="text-gray-300">where M<em><sup>I</sup></em> &cap; M<em><sup>J</sup></em> = {0} if <em>I</em> &cap; <em>J</em> = &empty;. Moreover, referring to <a href="#page-45-11">[GRR17b]</a>, we recall that the probability that a random text <em>x</em> belongs to M<em><sup>I</sup></em> is well approximated by <em>P rob</em>(<em>x</em> &isin; M<em><sup>I</sup></em> ) = 2 &minus;32&middot;(4&minus;|<em>I</em>|) , while given two random texts <em>x</em> 6= <em>y</em></p>

    <p class="text-gray-300"><span class="math">$Prob(R(x) \\oplus R(y) \\in \\mathcal{M}_J \\mid x \\oplus y \\in \\mathcal{M}_I) = (2^8)^{-4 \\cdot |I| + |I| \\cdot |J|}.</span>$</p>

    <p class="text-gray-300"><strong>Proposition 2.</strong> <em>The probability p</em>|<em>I</em><sup>|</sup> <em>that a random text x belongs to the subspace</em> M<em><sup>I</sup> for a certain I</em> &sube; {0<em>,</em> 1<em>,</em> 2<em>,</em> 3} <em>with</em> |<em>I</em>| = <em>l fixed is well approximated by</em></p>

    <p class="text-gray-300"><span class="math">$p_{|I|} = Prob(\\exists I \\subseteq \\{0, 1, 2, 3\\} \\, |I| = l \\ \\text{s.t.} \\ x \\in \\mathcal{M}_I) = (-1)^{|I|} \\cdot \\sum_{i=4-|I|}^3 (-1)^i \\cdot c_{|I|,i} \\cdot \\binom{4}{i} \\cdot 2^{-32 \\cdot i}</span>$</p>

    <p class="text-gray-300"><em>where c</em>2<em>,</em><sup>3</sup> = 3 <em>and c</em><sup>|</sup><em>I</em>|<em>,i</em> = 1 <em>for</em> {|<em>I</em>|<em>, i</em>} 6= {2<em>,</em> 3}<em>.</em></p>

    <p class="text-gray-300"><em>Proof.</em> By definition, given the events <em>A</em>1<em>, ..., A<sup>n</sup></em> in a probability space (&Omega;<em>,</em> F<em>,</em> P) then:</p>

    <p class="text-gray-300"><span class="math">$Prob\\left(\\bigcup_{i=1}^{n} A_i\\right) = \\sum_{k=1}^{n} \\left((-1)^{k-1} \\sum_{\\substack{I \\subset \\{1,\\dots,n\\}\\\\|I|=k}} Prob(A_I)\\right),</span>$</p>

    <p class="text-gray-300">where the last sum runs over all subsets <em>I</em> of the indexes 1<em>, ..., n</em> which contain exactly <em>k</em> elements<a href="#page-46-2">31</a> and</p>

    <p class="text-gray-300"><span class="math">$A_I := \\bigcap_{i \\in I} A_i</span>$</p>

    <p class="text-gray-300">denotes the intersection of all those <em>A<sup>i</sup></em> with index in <em>I</em>.</p>

    <p class="text-gray-300">Due to <a href="#page-46-3">(17)</a>, it follows that for |<em>I</em>| = 1</p>

    <p class="text-gray-300"><span class="math">$Prob(\\exists I \\subseteq \\{0, 1, 2, 3\\} | I| = 1 \\text{ s.t. } x \\oplus y \\in \\mathcal{M}_I) =</span>$</p>

    <p class="text-gray-300">=  <span class="math">\\sum_{I \\subseteq \\{0, 1, 2, 3\\}, |I| = 1} Prob(x \\oplus y \\in \\mathcal{M}_I) = 4 \\cdot 2^{-96}.</span></p>

    <p class="text-gray-300">For |<em>I</em>| = 3, the probability is given by:</p>

    <p class="text-gray-300"><span class="math">$\\begin{split} &amp; Prob(\\exists I \\subseteq \\{0,1,2,3\\} \\ |I| = 3 \\ \\text{s.t.} \\ x \\in \\mathcal{M}_I) = \\\\ &amp; = \\sum_{I \\subseteq \\{0,1,2,3\\}, \\ |I| = 3} Prob(x \\in \\mathcal{M}_I) - \\sum_{I \\subseteq \\{0,1,2,3\\}, \\ |I| = 2} Prob(x \\in \\mathcal{M}_I) + \\\\ &amp; + \\sum_{I \\subseteq \\{0,1,2,3\\}, \\ |I| = 1} Prob(x \\in \\mathcal{M}_I) = 4 \\cdot 2^{-32} - 6 \\cdot 2^{-64} + 4 \\cdot 2^{-96}, \\end{split}</span>$</p>

    <p class="text-gray-300"><sup>31</sup>For example for <em>n</em> = 2, it follows that <em>P rob</em>(<em>A</em><sup>1</sup> &cup; <em>A</em>2) = <em>P rob</em>(<em>A</em>1) + <em>P rob</em>(<em>A</em>2) &minus; P(<em>A</em><sup>1</sup> &cap; <em>A</em>2), while for <em>n</em> = 3 it follows that <em>P rob</em>(<em>A</em><sup>1</sup> &cup; <em>A</em><sup>2</sup> &cup; <em>A</em>3) = <em>P rob</em>(<em>A</em>1) + <em>P rob</em>(<em>A</em>2) + <em>P rob</em>(<em>A</em>3) &minus; <em>P rob</em>(<em>A</em><sup>1</sup> &cap; <em>A</em>2) &minus; <em>P rob</em>(<em>A</em><sup>1</sup> &cap; <em>A</em>3) &minus; <em>P rob</em>(<em>A</em><sup>2</sup> &cap; <em>A</em>3) + <em>P rob</em>(<em>A</em><sup>1</sup> &cap; <em>A</em><sup>2</sup> &cap; <em>A</em>3).</p>

    <p class="text-gray-300">since given 4 different sets  <span class="math">\\mathcal{M}_I</span>  for |I|=3 there are  <span class="math">\\binom{4}{2}=6</span>  possible intersections of 2 sets and  <span class="math">\\binom{4}{3}=4</span>  possible intersections of 3 sets (all intersections are not empty). Finally for |I|=2</p>

    <p class="text-gray-300"><span class="math">$Prob(\\exists I \\subseteq \\{0, 1, 2, 3\\} | I| = 2 \\text{ s.t. } x \\oplus y \\in \\mathcal{M}_I) =</span>$</p>

    <p class="text-gray-300"><span class="math">$= \\sum_{I \\subseteq \\{0, 1, 2, 3\\}, |I| = 2} Prob(x \\oplus y \\in \\mathcal{M}_I) - \\sum_{I \\subseteq \\{0, 1, 2, 3\\}, |I| = 1} Prob(x \\oplus y \\in \\mathcal{M}_I) =</span>$</p>

    <p class="text-gray-300"><span class="math">$= 6 \\cdot 2^{-64} - 12 \\cdot 2^{-96},</span>$</p>

    <p class="text-gray-300">since given 6 different sets  <span class="math">\\mathcal{M}_I</span>  for |I|=2 there are  <span class="math">\\binom{6}{2}=15</span>  possible intersections of 2 sets. However, note that only 12 of them are not empty (since  <span class="math">\\mathcal{M}_{0,1}\\cap\\mathcal{M}_{2,3}=\\mathcal{M}_{0,2}\\cap\\mathcal{M}_{1,3}=\\mathcal{M}_{0,3}\\cap\\mathcal{M}_{1,2}=\\emptyset</span> ).</p>

    <p class="text-gray-300"><span class="math">$\\mathcal{M}_{0,3} \\cap \\mathcal{M}_{1,2} = \\emptyset</span>$
).
Since  <span class="math">\\binom{6}{1} = \\binom{4}{2} = 6</span>  and  <span class="math">\\binom{6}{2} - 3 = \\binom{4}{3} \\cdot 3 = 12</span> , we obtain the desired result.</p>

    <p class="text-gray-300"><strong>Proposition 3.</strong> Let x, y be two random elements. Assume that there exists  <span class="math">I \\subseteq \\{0, 1, 2, 3\\}</span>  such that  <span class="math">x \\oplus y \\in \\mathcal{M}_I</span>  ( <span class="math">x \\oplus y \\notin \\mathcal{M}_L</span>  for all  <span class="math">L \\subseteq \\{0, 1, 2, 3\\}</span>  with |L| &lt; |I|). The probability that  <span class="math">\\exists J \\subseteq \\{0, 1, 2, 3\\}</span>  with |J| = l fixed such that  <span class="math">R(x) \\oplus R(y) \\in \\mathcal{M}_J</span>  is well approximated by</p>

    <p class="text-gray-300"><span class="math">$p_{|J|,|I|} \\equiv Prob(\\exists J \\, |J| = l \\ s.t. \\ R(x) \\oplus R(y) \\in \\mathcal{M}_J \\, | \\, x \\oplus y \\in \\mathcal{M}_I) =</span>$
<span class="math">$= (-1)^{|J|} \\cdot \\sum_{i=4-|J|}^{3} (-1)^i \\cdot c_{|J|,i} \\cdot \\binom{4}{i} \\cdot 2^{-8 \\cdot i \\cdot |I|}.</span>$</p>

    <p class="text-gray-300">where  <span class="math">c_{2,3} = 3</span>  and  <span class="math">c_{|J|,i} = 1</span>  for  <span class="math">\\{|J|, i\\} \\neq \\{2, 3\\}</span> .</p>

    <p class="text-gray-300"><em>Proof.</em> As before, for |J| = 3:</p>

    <p class="text-gray-300"><span class="math">$Prob(\\exists J | J| = 3 \\text{ s.t. } R(x) \\oplus R(y) \\in \\mathcal{M}_{J} | x \\oplus y \\in \\mathcal{M}_{I}) =</span>$</p>

    <p class="text-gray-300"><span class="math">$= \\sum_{J \\subseteq \\{0,1,2,3\\}, |J| = 3} Prob(R(x) \\oplus R(y) \\in \\mathcal{M}_{J} | x \\oplus y \\in \\mathcal{M}_{I}) +</span>$</p>

    <p class="text-gray-300"><span class="math">$- \\sum_{J \\subseteq \\{0,1,2,3\\}, |J| = 2} Prob(R(x) \\oplus R(y) \\in \\mathcal{M}_{J} | x \\oplus y \\in \\mathcal{M}_{I}) +</span>$</p>

    <p class="text-gray-300"><span class="math">$+ \\sum_{J \\subseteq \\{0,1,2,3\\}, |J| = 1} Prob(R(x) \\oplus R(y) \\in \\mathcal{M}_{J} | x \\oplus y \\in \\mathcal{M}_{I}) =</span>$</p>

    <p class="text-gray-300"><span class="math">$= 4 \\cdot 2^{-8 \\cdot |I|} - 6 \\cdot 2^{-16 \\cdot |I|} + 4 \\cdot 2^{-24 \\cdot |I|} =</span>$</p>

    <p class="text-gray-300"><span class="math">$= (-1)^{3} \\cdot \\sum_{i=1}^{3} (-1)^{i} \\cdot {4 \\choose i} \\cdot 2^{-8 \\cdot i \\cdot |I|}.</span>$</p>

    <p class="text-gray-300">By simple computation, it is possible to obtain similar results for |J|=2 and |J|=1, that is the thesis.</p>

    <p class="text-gray-300"><strong>Proposition 4.</strong> Let x, y be two random elements such that  <span class="math">x \\oplus y \\notin \\mathcal{M}_I</span>  for each  <span class="math">I \\subseteq \\{0, 1, 2, 3\\}</span> . Then, the probability that  <span class="math">\\exists J \\subseteq \\{0, 1, 2, 3\\}</span>  for |J| = l fixed such that  <span class="math">R(x) \\oplus R(y) \\in \\mathcal{M}_J</span>  is well approximated by</p>

    <p class="text-gray-300"><span class="math">$\\hat{p}_{|J|,3} \\equiv Prob(\\exists J \\ s.t. \\ R(x) \\oplus R(y) \\in \\mathcal{M}_J \\mid x \\oplus y \\notin \\mathcal{M}_I \\, \\forall I) = \\frac{p_{|J|} - p_{|J|,3} \\cdot p_3}{1 - p_3}.</span>$</p>

    <p class="text-gray-300"><em>Proof.</em> Let A and B be two events, and let C be the event such that  <span class="math">A \\cup C</span>  is equal to the sample space and such that  <span class="math">A \\cap C = \\emptyset</span> . By definition</p>

    <p class="text-gray-300"><span class="math">$Prob(B) = Prob(B \\mid A) \\cdot Prob(A) + Prob(B \\mid C) \\cdot Prob(C).</span>$</p>

    <p class="text-gray-300">Thus</p>

    <p class="text-gray-300"><span class="math">$\\begin{aligned} p_{|J|} &amp;\\equiv Prob(\\exists J \\text{ s.t. } R(x) \\oplus R(y) \\in \\mathcal{M}_J) = \\\\ &amp;= Prob(\\exists J \\text{ s.t. } R(x) \\oplus R(y) \\in \\mathcal{M}_J \\,|\\, x \\oplus y \\notin \\mathcal{M}_I \\,\\forall I) \\cdot Prob(x \\oplus y \\notin \\mathcal{M}_I \\,\\forall I) + \\\\ &amp;+ Prob(\\exists J \\text{ s.t. } R(x) \\oplus R(y) \\in \\mathcal{M}_J \\,|\\, \\exists I \\text{ s.t. } x \\oplus y \\in \\mathcal{M}_I) \\cdot Prob(\\exists I \\text{ s.t. } x \\oplus y \\in \\mathcal{M}_I). \\end{aligned}</span>$</p>

    <p class="text-gray-300">Note that  <span class="math">^{32}</span></p>

    <p class="text-gray-300"><span class="math">$\\begin{split} &amp;Prob(\\exists I \\text{ s.t. } x \\oplus y \\in \\mathcal{M}_I) = Prob\\bigg(x \\oplus y \\in \\bigcup_{\\forall I \\subseteq \\{0,1,2,3\\}} \\mathcal{M}_I\\bigg) = \\\\ &amp;= &amp;Prob\\bigg(x \\oplus y \\in \\bigcup_{I \\subseteq \\{0,1,2,3\\}, \\, |I| = 3} \\mathcal{M}_I\\bigg) \\equiv p_3. \\end{split}</span>$</p>

    <p class="text-gray-300">It follows that</p>

    <p class="text-gray-300"><span class="math">$p_{|J|} = p_{|J|,3} \\cdot p_3 + \\hat{p}_{|J|,3} \\cdot (1 - p_3),</span>$</p>

    <p class="text-gray-300">&#1055;</p>

    <p class="text-gray-300">that is the thesis.</p>

    <p class="text-gray-300"><strong>Proposition 5.</strong> Let x and y such that  <span class="math">x \\oplus y \\notin \\mathcal{M}_I</span>  for each  <span class="math">I \\subseteq \\{0, 1, 2, 3\\}</span> . Then, the probability that  <span class="math">\\exists J \\subseteq \\{0, 1, 2, 3\\}</span>  with |J| = l fixed and  <span class="math">|I| + |J| \\le 4</span>  such that  <span class="math">R^2(x) \\oplus R^2(y) \\in \\mathcal{M}_J</span>  is well approximated by</p>

    <p class="text-gray-300"><span class="math">$\\tilde{p}_{|J|,3} \\equiv Prob(\\exists J \\ s.t. \\ R^2(x) \\oplus R^2(y) \\in \\mathcal{M}_J \\mid x \\oplus y \\notin \\mathcal{M}_I) = \\frac{p_{|J|}}{1 - p_3}.</span>$</p>

    <p class="text-gray-300">Proof. Remember that</p>

    <p class="text-gray-300"><span class="math">$Prob(\\exists J \\text{ s.t. } R^2(x) \\oplus R^2(y) \\in \\mathcal{M}_J \\mid \\exists I \\text{ s.t. } x \\oplus y \\notin \\mathcal{M}_I) = 0.</span>$</p>

    <p class="text-gray-300">Since</p>

    <p class="text-gray-300"><span class="math">$Prob(\\exists J \\text{ s.t. } R^{2}(x) \\oplus R^{2}(y) \\in \\mathcal{M}_{J}) =</span>$</p>

    <p class="text-gray-300"><span class="math">$= Prob(\\exists J \\text{ s.t. } R^{2}(x) \\oplus R^{2}(y) \\in \\mathcal{M}_{J} \\mid x \\oplus y \\notin \\mathcal{M}_{I} \\forall I) \\cdot Prob(x \\oplus y \\notin \\mathcal{M}_{I} \\forall I) +</span>$</p>

    <p class="text-gray-300"><span class="math">$+ Prob(\\exists J \\text{ s.t. } R^{2}(x) \\oplus R^{2}(y) \\in \\mathcal{M}_{J} \\mid \\exists I \\text{ s.t. } x \\oplus y \\in \\mathcal{M}_{I}) \\cdot Prob(\\exists I \\text{ s.t. } x \\oplus y \\in \\mathcal{M}_{I})</span>$</p>

    <p class="text-gray-300">and using the same argumentation as before, it follows that</p>

    <p class="text-gray-300"><span class="math">$p_{|J|} = \\tilde{p}_{|J|,3} \\cdot (1 - p_3),</span>$</p>

    <p class="text-gray-300">that is the thesis.</p>

    <p class="text-gray-300">Given texts in the same cosets of  <span class="math">C_I</span>  (and similar for  <span class="math">\\mathcal{M}_I</span> ) for  <span class="math">I \\subseteq \\{0, 1, 2, 3\\}</span> , the number of couples of texts with n equal &quot;generating variable(s) in  <span class="math">(\\mathbb{F}_{2^8})^{|I|}</span> &quot; for  <span class="math">0 \\le n \\le 3</span>  is given by</p>

    <p class="text-gray-300"><span class="math">$\\binom{4}{n} \\cdot 2^{32 \\cdot |I| - 1} \\cdot (2^{8 \\cdot |I|} - 1)^{4 - n}.</span>$</p>

    <p class="text-gray-300">Here we prove this result.</p>

    <p class="text-gray-300">W.l.o.g. consider for simplicity the case |I|=1. First of all, note that there are  <span class="math">\\binom{4}{n}</span>  different combinations of  <span class="math">n \\leq 4</span>  variables. If  <span class="math">n \\geq 1</span> , the n variables that must be equal for the two texts of the couple can take  <span class="math">(2^8)^n</span>  different values. For each one of the remaining 4-n variables, the variables must be different for the two texts of each couple. Thus, these 4-n variables can take exactly  <span class="math">\\left[(2^8)^{4-n} \\cdot (2^8-1)^{4-n}\\right]/2</span>  different values. The result follows immediately. In particular, for |I|=1 there are:</p>

    <p class="text-gray-300"><sup>&amp;</sup>lt;sup&gt;32</sup>If  <span class="math">x \\oplus y \\in \\overline{\\mathcal{M}_I}</span>  for |I| &lt; 3, then  <span class="math">\\exists J</span>  with |J| = 3 and  <span class="math">I \\subseteq J</span>  such that  <span class="math">x \\oplus y \\in \\mathcal{M}_J</span> .</p>

    <ul class="list-disc list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li>2 63 &middot; (2<sup>8</sup> &minus; 1)<sup>4</sup> couples for which the two texts have different generating variables;</li>
      <li>2 33 &middot; (2<sup>8</sup> &minus; 1)<sup>3</sup> couples for which the two texts have one equal generating variable;</li>
      <li>3 &middot; 2 32 &middot; (2<sup>8</sup> &minus; 1)<sup>2</sup> couples for which the two texts have two equal generating variables;</li>
      <li>2 33 &middot; (2<sup>8</sup> &minus; 1) couples for which the two texts have three equal generating variables.</li>
    </ul>

    <p class="text-gray-300">Note that the total number of all the possible couples is 2 31 &middot; (2<sup>32</sup> &minus; 1).</p>

    <p class="text-gray-300">The formula for the other cases is obtained in an analogous way.</p>

    <p class="text-gray-300"><em>Remark.</em> The proposed formula is used in the context of the 5-round distinguisher presented in <a href="#page-45-5">[GRR17a]</a>, and for the distinguishers proposed in this paper. As explained in Sect. <a href="#page-11-0">4,</a> in these distinguishers we work with &quot;generating variables&quot; in (F<sup>2</sup> 8 ) |<em>I</em>| . If |<em>I</em>| = 1, then this corresponds to work independently on each variable. In the other cases, this means to work with <em>sets of variables</em> in (F<sup>2</sup> 8 ) |<em>I</em>| for |<em>I</em>| &ge; 2.</p>

    <p class="text-gray-300">For example, given <em>p</em> 1 <em>, p</em><sup>2</sup> &isin; C0<em>,</em><sup>1</sup> &oplus; <em>a</em> s.t. <em>p <sup>i</sup></em> = <em>a</em> &oplus; L<sup>3</sup> <em>j</em>=0 L<sup>1</sup> <em><sup>k</sup></em>=0 <em>p i j,k</em> &middot; <em>ej,k</em>, one works with the following sets of variables: (<em>p i</em> 0<em>,</em>0 <em>, p<sup>i</sup></em> 1<em>,</em>1 )<em>,</em>(<em>p i</em> 1<em>,</em>0 <em>, p<sup>i</sup></em> 2<em>,</em>1 )<em>,</em>(<em>p i</em> 2<em>,</em>0 <em>, p<sup>i</sup></em> 3<em>,</em>1 )<em>,</em>(<em>p i</em> 3<em>,</em>0 <em>, p<sup>i</sup></em> 0<em>,</em>1 ) (and not independently on each variable).</p>

    <p class="text-gray-300">As a result, <em>this formula doesn't apply if one works independently on each generating variable also in the cases</em> |<em>I</em>| &ge; 2<em>,</em> that is with generating variables in F<sup>2</sup> <sup>8</sup> also for |<em>I</em>| &ge; 2. In this last case, the required formula becomes</p>

    <p class="text-gray-300"><span class="math">$\\binom{4}{n} \\cdot 2^{32 \\cdot |I| - 1} \\cdot (2^8 - 1)^{(4-n) \\cdot |I|}.</span>$</p>

    <p class="text-gray-300">(note that the two formul&aelig; are identical only for |<em>I</em>| = 1).</p>

    <p class="text-gray-300">In Sect. <a href="#page-10-0">3.2,</a> we list some useful probabilities largely used in the following. As we have already said, <em>all those probabilities are not the exact ones, but &quot;good enough&quot; approximations useful for the target of the paper</em>. Here we give more details about this statement.</p>

    <p class="text-gray-300">As first thing, consider the following simple example. Consider the probability that a pair of texts <em>t</em> <sup>1</sup> and <em>t</em> <sup>2</sup> belong to the same coset of M<em><sup>I</sup></em> . This probability is usually approximated by <em>P rob</em>(<em>x</em> &isin; M<em><sup>I</sup></em> ) = 2<sup>&minus;</sup>32&middot;(4&minus;|<em>I</em>|) . On the other hand, in order to set up a (truncated) differential attack, one is interested to the case <em>t</em> <sup>1</sup> 6= <em>t</em> 2 (equivalently, <em>x</em> 6= 0). Thus, the &quot;correct&quot; probability should be</p>

    <p class="text-gray-300"><span class="math">$Prob(x \\in \\mathcal{M}_I \\mid x \\neq 0) = \\frac{2^{32 \\cdot |I|} - 1}{2^{128} - 1} = 2^{-32 \\cdot (4 - |I|)} - 2^{-128} + 2^{-128 - 32 \\cdot (4 - |I|)} + \\dots</span>$</p>

    <p class="text-gray-300">We also remark that it is important to have in mind that <em>the assumption behind the probabilities given in Sect. <a href="#page-10-0">3.2</a> is that the elements x and y are uniform distributed, or (at least) very close to be uniform distributed. In particular, we emphasize that this assumption is satisfied for all the events considered in this paper to set up distinguishers and key-recovery attacks on 5- and 6-round AES.</em></p>

    <p class="text-gray-300">To understand the importance of this assumption, consider the following example regarding the 4-round AES impossible differential trail. Consider plaintexts in the same coset of D<em><sup>I</sup></em> , and the corresponding ciphertexts after 4-round. It is well known that</p>

    <p class="text-gray-300"><span class="math">$Prob(R^4(x) \\oplus R^4(y) \\in \\mathcal{M}_J \\mid x \\oplus y \\in \\mathcal{D}_I) = 0 \\quad \\forall J \\text{ s.t. } |I| + |J| \\le 4.</span>$</p>

    <p class="text-gray-300">On the other hand, one can compute this probability using the probabilities given in Sect. <a href="#page-10-0">3.2.</a> Assume for simplicity <em>I</em> fixed with |<em>I</em>| = 1. By Theorem <a href="#page-9-3">1,</a> each coset of D<em><sup>I</sup></em> is mapped</p>

    <p class="text-gray-300">into a coset of  <span class="math">\\mathcal{M}_I</span>  after 2-round. Moreover, remember that</p>

    <p class="text-gray-300"><span class="math">$Prob(R(x) \\oplus R(y) \\in \\mathcal{M}_K \\mid x \\oplus y \\in \\mathcal{M}_I) = (-1)^{|K|} \\cdot \\sum_{i=4-|K|}^{3} (-1)^i \\cdot {4 \\choose i} \\cdot 2^{-8 \\cdot i}.</span>$</p>

    <p class="text-gray-300">for each K. Thus</p>

    <p class="text-gray-300"><span class="math">$Prob(R^{4}(x) \\oplus R^{4}(y) \\in \\mathcal{M}_{J} \\mid x \\oplus y \\in \\mathcal{D}_{I}) =</span>$</p>

    <p class="text-gray-300"><span class="math">$= \\sum_{K \\subset \\{0,1,2,3\\}} Prob(R^{4}(x) \\oplus R^{4}(y) \\in \\mathcal{M}_{J} \\mid R^{3}(x) \\oplus R^{3}(y) \\in \\mathcal{M}_{K} \\text{ and } x \\oplus y \\in \\mathcal{D}_{I}) \\times</span>$</p>

    <p class="text-gray-300"><span class="math">$\\times Prob(R^{3}(x) \\oplus R^{3}(y) \\in \\mathcal{M}_{K} \\mid x \\oplus y \\in \\mathcal{D}_{I}) +</span>$</p>

    <p class="text-gray-300"><span class="math">$+Prob(R^{4}(x) \\oplus R^{4}(y) \\in \\mathcal{M}_{J} \\mid R^{3}(x) \\oplus R^{3}(y) \\notin \\mathcal{M}_{K} \\forall K \\text{ and } x \\oplus y \\in \\mathcal{D}_{I}) \\times</span>$</p>

    <p class="text-gray-300"><span class="math">$\\times Prob(R^{3}(x) \\oplus R^{3}(y) \\notin \\mathcal{M}_{K} \\forall K \\mid x \\oplus y \\in \\mathcal{D}_{I}).</span>$</p>

    <p class="text-gray-300">If one approximates the probability  <span class="math">Prob(R^4(x) \\oplus R^4(y) \\in \\mathcal{M}_J \\mid R^3(x) \\oplus R^3(y) \\in \\mathcal{M}_K</span>  and  <span class="math">x \\oplus y \\in \\mathcal{D}_I</span> ) with  <span class="math">Prob(R^4(x) \\oplus R^4(y) \\in \\mathcal{M}_J \\mid R^3(x) \\oplus R^3(y) \\in \\mathcal{M}_K)</span> , by simple computation it follows that</p>

    <p class="text-gray-300"><span class="math">$Prob(R^4(x) \\oplus R^4(y) \\in \\mathcal{M}_J \\,|\\, x \\oplus y \\in \\mathcal{D}_I) \\approx 2^{-28} + 2^{-30} + \\dots</span>$</p>

    <p class="text-gray-300">which is obviously wrong, since for all  <span class="math">|I| + |J| \\le 4</span></p>

    <p class="text-gray-300"><span class="math">$Prob(R^{4}(x) \\oplus R^{4}(y) \\in \\mathcal{M}_{J} \\mid R^{3}(x) \\oplus R^{3}(y) \\in \\mathcal{M}_{K} \\text{ and } x \\oplus y \\in \\mathcal{D}_{I}) =</span>$</p>

    <p class="text-gray-300"><span class="math">$= Prob(R^{4}(x) \\oplus R^{4}(y) \\in \\mathcal{M}_{J} \\mid R^{3}(x) \\oplus R^{3}(y) \\in \\mathcal{M}_{K} \\text{ and } R^{2}(x) \\oplus R^{2}(y) \\in \\mathcal{D}_{I}) = 0.</span>$</p>

    <p class="text-gray-300">In this section, we give all the details about the computational cost of the 4-round secret-key distinguisher for AES presented in Sect. 5. We refer to Sect. 5 for all the details about the distinguisher.</p>

    <p class="text-gray-300">Given  <span class="math">2^{16}</span>  chosen plaintexts in the same coset of  <span class="math">(\\mathcal{C}_0 \\cap \\mathcal{D}_{0,3}) \\oplus a</span>  and the corresponding ciphertexts, a first possibility is to construct all the possible pairs, to divide them in sets S of non-independent pairs defined as</p>

    <p class="text-gray-300"><span class="math">$S = \\left\\{ (p^{1}, p^{2}), (\\hat{p}^{1}, \\hat{p}^{2}) \\in \\left( \\mathcal{C}_{0} \\cap \\mathcal{D}_{0,3} \\oplus a \\right)^{2} \\, \\middle| \\, \\left[ \\left( p^{1} \\equiv (x^{1}, x^{2}), c^{1} = R^{4}(p^{1}) \\right), \\left( p^{2} \\equiv (y^{1}, y^{2}), c^{2} = R^{4}(p^{1}) \\right) \\right]; \\left[ \\left( \\hat{p}^{1} \\equiv (y^{1}, x^{2}), \\hat{c}^{1} = R^{4}(\\hat{p}^{1}) \\right), \\left( \\hat{p}^{2} \\equiv (x^{1}, y^{2}), \\hat{c}^{2} = R^{4}(\\hat{p}^{2}) \\right) \\right] \\right\\}</span>$</p>

    <p class="text-gray-300">where  <span class="math">(\\mathcal{C}_0 \\cap \\mathcal{D}_{0,3} \\oplus a)^2 \\equiv ((\\mathcal{C}_0 \\cap \\mathcal{D}_{0,3}) \\oplus a) \\times ((\\mathcal{C}_0 \\cap \\mathcal{D}_{0,3}) \\oplus a)</span> , and to check for each set if the required property is satisfied (or not).</p>

    <p class="text-gray-300">The cost to check if the property</p>

    <p class="text-gray-300"><span class="math">$c^1 \\oplus c^2 \\in \\mathcal{M}_J</span>$
if and only if  <span class="math">\\hat{c}^1 \\oplus \\hat{c}^2 \\in \\mathcal{M}_J</span></p>

    <p class="text-gray-300">is satisfied (or not) is equal to 2 XOR and 2 MixColumns operations<sup>33</sup>, which is negligible with respect to the total cost to construct all the couples of two pairs of texts. For this reason, we focus on the cost to construct the sets S. Using the previous strategy, since the number of pairs is approximately  <span class="math">2^{31}</span>  for each coset, the cost is of approximately  <span class="math">2 \\cdot 2^{31} = 2^{32}</span>  table look-ups.</p>

    <p class="text-gray-300"><sup>33</sup>Given x, y, then  <span class="math">x \\oplus y \\in \\mathcal{M}_I</span>  if and only if  <span class="math">MC^{-1}(x \\oplus y) \\in \\mathcal{ID}_I</span>  for each I.</p>

    <p class="text-gray-300">In order to reduce the computational cost, a possibility is to re-order the ciphertexts with respect to a partial order  <span class="math">\\leq</span>  as defined in Def. 10 (see also [GRR17a]). Note that  <span class="math">\\leq</span>  depends on an index J. Using a merge-sort algorithm, the cost to re-order n texts is of  <span class="math">O(n \\cdot \\log n)</span>  table look-ups. When the ciphertexts have been re-ordered, it is no more necessary to construct all the possible pairs and it is sufficient to work only on consecutive texts with respect to  <span class="math">\\leq</span> .</p>

    <p class="text-gray-300">In more detail, first one stores all the plaintext/ciphertext pairs twice, (1) once in which the plaintexts are ordered with respect to the partial order  <span class="math">\\leq</span>  defined in Def. 6 and (2) once in which the ciphertexts are ordered with respect to the partial order  <span class="math">\\leq</span>  defined in Def. 10. Then, working on this second set, one focuses only on consecutive ciphertexts  <span class="math">c^i</span>  and  <span class="math">c^{i+1}</span>  for each i, and checks if  <span class="math">c^i \\oplus c^{i+1} \\in \\mathcal{M}_J</span>  or not. Assume that  <span class="math">c^i \\oplus c^{i+1} \\in \\mathcal{M}_J</span>  for a certain J fixed previously. The idea is to take the corresponding plaintexts  <span class="math">p^i \\equiv (x^1, y^1)</span>  and  <span class="math">p^{i+1} \\equiv (x^2, y^2)</span> , to construct the corresponding set S and to check if the ciphertexts  <span class="math">\\hat{c}^1</span>  and  <span class="math">\\hat{c}^2</span>  of the corresponding plaintexts  <span class="math">\\hat{p}^1 \\equiv (x^1, y^2)</span>  and  <span class="math">\\hat{p}^2 \\equiv (x^2, y^1)</span>  satisfy the condition  <span class="math">\\hat{c}^1 \\oplus \\hat{c}^2 \\in \\mathcal{M}_J</span>  for the same J. If not, by previous observations one can simply deduce that this is a random permutation. Note that if there are r consecutive ciphertexts  <span class="math">c^i, c^{i+1}, ..., c^{i+r-1}</span>  such that  <span class="math">c^j \\oplus c^l \\in \\mathcal{M}_J</span>  for  <span class="math">i \\leq j, l &lt; i + r</span> , then one has to repeat the above procedure for all these  <span class="math">\\binom{r}{2} = r \\cdot (r-1)/2</span>  possible pairs<sup>34</sup>.</p>

    <p class="text-gray-300">To optimize the computational cost, note that the plaintexts  <span class="math">\\hat{p}^1</span>  and  <span class="math">\\hat{p}^2</span>  are respectively in positions  <span class="math">x^1 + 2^8 \\cdot y^2</span>  and  <span class="math">x^2 + 2^8 \\cdot y^1</span>  in the first set of plaintext/ciphertext pairs (i.e. in the set where the plaintexts are ordered with respect to the partial order  <span class="math">\\leq</span> ). Thus, the cost to get these two elements is only of 2 table look-ups. Moreover, we emphasize that it is sufficient to work only on (consecutive) ciphertexts  <span class="math">c^i</span>  and  <span class="math">c^j</span>  such that  <span class="math">c^i \\oplus c^j \\in \\mathcal{M}_J</span> . Indeed, consider the case in which the two ciphertexts  <span class="math">c^i</span>  and  <span class="math">c^j</span>  don't belong to the same coset of  <span class="math">\\mathcal{M}_J</span> , i.e.  <span class="math">c^i \\oplus c^j \\notin \\mathcal{M}_J</span> . If the corresponding ciphertexts  <span class="math">\\hat{c}^1</span>  and  <span class="math">\\hat{c}^2</span>  - defined as before - don't belong to the same coset of  <span class="math">\\mathcal{M}_J</span> , then the property is (obviously) verified. Instead if  <span class="math">\\hat{c}^1 \\oplus \\hat{c}^2 \\in \\mathcal{M}_J</span> , then this case is surely analyzed. The pseudo-code of such strategy can be found in Algorithm 1.</p>

    <p class="text-gray-300">Using this procedure, the memory cost is well approximated by  <span class="math">4 \\cdot 2^{17} \\cdot 16 = 2^{23}</span>  bytes&mdash;the same plaintext/ciphertext pairs in two different ways. The cost to order the ciphertexts for each possible J with |J|=3 and for each one of the two cosets is approximately of  <span class="math">2 \\cdot 4 \\cdot 2^{16} \\cdot \\log 2^{16} \\simeq 2^{23}</span>  table look-ups, while the cost to construct all the possible pairs of consecutive ciphertexts is of  <span class="math">2 \\cdot 4 \\cdot 2^{16} = 2^{19}</span>  table look-ups. Since the probability that a pair of ciphertexts belong to the same coset of  <span class="math">\\mathcal{M}_J</span>  for |J|=3 is  <span class="math">2^{-30}</span>  and since each coset contains approximately  <span class="math">2^{31}</span>  different pairs, then one has to do on average  <span class="math">2 \\cdot 4 \\cdot 2^{-30} \\cdot 2^{31} = 2^4</span>  table look-ups in the plaintext/ciphertext pairs ordered with respect to the plaintexts. Thus, the total cost of this distinguisher is well approximated by  <span class="math">2^{23} + 2^{19} + 16 \\simeq 2^{23.09}</span>  table look-ups, or approximately  <span class="math">2^{16.75}</span>  four-round encryptions (using the approximation 20 table look-ups  <span class="math">\\approx 1</span>  round of encryption).</p>

    <p class="text-gray-300">In this section, we propose two variants of the 5-round secret-key distinguisher proposed in Sect. 7. The second one is the most competitive distinguisher (from the point of view of the data and the computational costs), but it can not be used for a key-recovery attacks, as discuss in the following.</p>

    <p class="text-gray-300">To set up the distinguisher, we must recall one result from [GRR17a]:</p>

    <p class="text-gray-300"><strong>Theorem 5.</strong> Given the subspace  <span class="math">C_0 \\cap D_{0,2,3} \\equiv \\langle e_{0,0}, e_{1,0}, e_{2,0} \\rangle \\subseteq C_0</span> , consider two plaintexts  <span class="math">p^1</span>  and  <span class="math">p^2</span>  in the same coset of  <span class="math">(C_0 \\cap D_{0,2,3}) \\oplus a</span>  generated by  <span class="math">p^1 \\equiv (x^1, y^1, w^1)</span>  and</p>

    <p class="text-gray-300"><sup>&amp;</sup>lt;sup&gt;34</sup>Since  <span class="math">\\mathcal{M}_J</span>  is a subspace, given a, b, c such that  <span class="math">a \\oplus b \\in \\mathcal{M}_J</span>  and  <span class="math">b \\oplus c \\in \\mathcal{M}_J</span> , then  <span class="math">a \\oplus c \\in \\mathcal{M}_J</span> .</p>

    <p class="text-gray-300"><span class="math">p^2 \\equiv (x^2, y^2, w^2)</span> . Let  <span class="math">\\hat{p}^1, \\hat{p}^2 \\in (\\mathcal{D}_{0,2,3} \\cap \\mathcal{C}_0) \\oplus a</span>  be other two plaintexts generated by</p>

    <ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li><span class="math">$(x^1, y^1, w^1, z)</span>$
and  <span class="math">(x^2, y^2, w^2, z)</span> ; 2.  <span class="math">(x^2, y^1, w^1, z)</span>  and  <span class="math">(x^1, y^2, w^2, z)</span> ; 3.  <span class="math">(x^1, y^2, w^1, z)</span>  and  <span class="math">(x^2, y^1, w^2, z)</span> : 4.  <span class="math">(x^1, y^1, w^2, z)</span>  and  <span class="math">(x^2, y^2, w^1, z)</span> .</li>
    </ol>

    <p class="text-gray-300">where z can take any possible value in  <span class="math">\\mathbb{F}_{2^8}</span> . The following event</p>

    <p class="text-gray-300"><span class="math">$R^4(p^1) \\oplus R^4(p^2) \\in \\mathcal{M}_J</span>$
if and only if  <span class="math">R^4(\\hat{p}^1) \\oplus R^4(\\hat{p}^2) \\in \\mathcal{M}_J</span></p>

    <p class="text-gray-300">holds with prob. 1 for 4-round AES, independently of the secret key, of the details of the S-Box and of the MixColumns matrix.</p>

    <p class="text-gray-300">In the following, we give all the details of the distinguisher.</p>

      <h4 id="app-c.1.1" class="text-lg font-semibold mt-6">C.1.1 Details of the Distinguisher</h4>

    <p class="text-gray-300">Consider  <span class="math">2^{32}</span>  chosen plaintexts with one active column (4 active bytes), e.g. a coset of  <span class="math">C_0</span> , and the corresponding ciphertexts after 5-round. For each  <span class="math">(x_0, x_1, x_2), (y_0, y_1, y_2) \\in \\mathbb{F}_{2^8}^6</span>  such that  <span class="math">x_i \\neq y_i</span>  for each i = 0, 1, 2, let the set  <span class="math">\\mathcal{T}^3_{(x_0, x_1, x_2), (y_0, y_0, y_2)}</span>  of pairs of plaintexts be defined as follows</p>

    <p class="text-gray-300"><span class="math">$\\begin{split} \\mathcal{T}^3_{(x_0,x_1,x_2),(y_0,y_1,y_2)} &amp;= \\left\\{ (p,q) \\in \\mathbb{F}_{2^8}^{4\\times 4} \\times \\mathbb{F}_{2^8}^{4\\times 4} \\,\\middle|\\, p \\equiv (x_0,x_1,x_2,A), q \\equiv (y_0,y_1,y_2,A) \\right. \\\\ &amp;\\text{or} \\quad p \\equiv (y_0,x_1,x_2,A), q \\equiv (x_0,y_1,y_2,A) \\quad \\text{or} \\quad p \\equiv (x_0,y_1,x_2,A), q \\equiv (y_0,x_1,y_2,A) \\\\ &amp;\\text{or} \\quad p \\equiv (x_0,x_1,y_2,A), q \\equiv (y_0,y_1,x_2,A) \\quad \\text{for each } A \\in \\mathbb{F}_{2^8} \\right\\}. \\end{split}</span>$</p>

    <p class="text-gray-300">In other words, the pair of plaintexts  <span class="math">p, q \\in \\mathcal{C}_0 \\oplus a</span>  can be of the form</p>

    <p class="text-gray-300"><span class="math">$p \\equiv a \\oplus \\begin{bmatrix} x_0 &amp; 0 &amp; 0 &amp; 0 \\\\ x_1 &amp; 0 &amp; 0 &amp; 0 \\\\ x_2 &amp; 0 &amp; 0 &amp; 0 \\\\ A &amp; 0 &amp; 0 &amp; 0 \\end{bmatrix} \\qquad q \\equiv a \\oplus \\begin{bmatrix} y_0 &amp; 0 &amp; 0 &amp; 0 \\\\ y_1 &amp; 0 &amp; 0 &amp; 0 \\\\ y_2 &amp; 0 &amp; 0 &amp; 0 \\\\ A &amp; 0 &amp; 0 &amp; 0 \\end{bmatrix},</span>$</p>

    <p class="text-gray-300">or</p>

    <p class="text-gray-300"><span class="math">$p \\equiv a \\oplus \\begin{bmatrix} y_0 &amp; 0 &amp; 0 &amp; 0 \\\\ x_1 &amp; 0 &amp; 0 &amp; 0 \\\\ x_2 &amp; 0 &amp; 0 &amp; 0 \\\\ A &amp; 0 &amp; 0 &amp; 0 \\end{bmatrix} \\qquad q \\equiv a \\oplus \\begin{bmatrix} x_0 &amp; 0 &amp; 0 &amp; 0 \\\\ y_1 &amp; 0 &amp; 0 &amp; 0 \\\\ y_2 &amp; 0 &amp; 0 &amp; 0 \\\\ A &amp; 0 &amp; 0 &amp; 0 \\end{bmatrix}</span>$</p>

    <p class="text-gray-300">and so on. Similar definitions can be given for the set  <span class="math">\\mathcal{T}^i_{(x_0,x_1,x_2),(y_0,y_1,y_2)}</span>  for each  <span class="math">i \\in \\{0,1,2,3\\}</span> , where the constant bytes is in row i. Given  <span class="math">2^{32}</span>  plaintexts as before, it is possible to construct  <span class="math">\\frac{1}{2^{10}} \\cdot 4 \\cdot 2^{31} \\cdot (2^8 - 1)^3 \\simeq 2^{46.983}</span>  different sets (using formula (10) to count the number of pairs of texts with 1 equal generating variable), where each set contains exactly  <span class="math">2^{10}</span>  different pairs of plaintexts (we emphasize that these pairs of plaintexts are not independent, in the sense that a particular relationships among the generating variable holds).</p>

    <p class="text-gray-300">Consider  <span class="math">n \\gg 1</span>  random sets, and count the number of sets for which two ciphertexts (generated by 5-round AES or by a random permutation) of at least one pairs of plaintexts belong to the same coset of a subspace  <span class="math">\\mathcal{M}_J</span>  for  <span class="math">J \\subseteq \\{0,1,2,3\\}</span>  and |J|=3. As we are going to prove, this number is on average lower for AES than for a random permutation, independently of the secret key, of the details of the S-Box and of the MixColumns matrix.</p>

    <p class="text-gray-300">In more details, the numbers of sets for 5-round AES  <span class="math">n_{AES}</span>  and for a random permutation  <span class="math">n_{rand}</span>  are well approximated by  <span class="math">n_{AES} \\simeq n \\cdot p_{AES}</span>  and  <span class="math">n_{rand} \\simeq n \\cdot p_{rand}</span>  where</p>

    <p class="text-gray-300"><span class="math">$\\begin{split} p_{AES} &amp;\\simeq 2^{-20} - 4095 \\cdot 2^{-53} - \\underbrace{529\\,370\\,445 \\cdot 2^{-84}}_{\\approx \\, 3.945 \\cdot 2^{-57}} + \\underbrace{374\\,996\\,306\\,937\\,593 \\cdot 2^{-117}}_{\\approx \\, 2.665 \\cdot 2^{-70}} + \\dots \\\\ p_{rand} &amp;\\simeq 2^{-20} - 4095 \\cdot 2^{-53} + \\underbrace{2\\,794\\,155 \\cdot 2^{-84}}_{\\approx \\, 2.665 \\cdot 2^{-64}} + \\dots \\end{split}</span>$</p>

    <p class="text-gray-300">Even if the difference between the two probabilities is small, it is possible to distinguish the two cases with probability higher than 95% if  <span class="math">n \\ge 2^{92.246}</span> .</p>

    <p class="text-gray-300">In the following, we prove this result (which has been practically tested on a small scale AES) and we give all the details about the data and the computational cost.</p>

      <h4 id="app-c.1.2" class="text-lg font-semibold mt-6">C.1.2 Proof</h4>

    <h4 id="sec-misc-10" class="text-lg font-semibold mt-6">Proof - 5-round AES</h4>

    <p class="text-gray-300">As first thing, we prove the results just given, starting with the 5-round AES case.</p>

    <p class="text-gray-300"><strong>Initial Considerations - 5-round AES.</strong> Our 5-round distinguisher is based on Theorem 5. Given plaintexts in the same coset of  <span class="math">C_0</span>  and for a fixed  <span class="math">J \\subseteq \\{0, 1, 2, 3\\}</span> , each set  <span class="math">\\mathcal{T}_{(x_0, x_1, x_2), (y_0, y_1, y_2)}</span>  just defined has the following property after 4 rounds:</p>

    <ul class="list-disc list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li><ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li>for each couple, the two texts after 4-round belong to the same coset of  <span class="math">\\mathcal{M}_I</span> ;</li>
    </ol></li>
      <li><ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li>for each couple, the two texts after 4-round don't belong to the same coset of  <span class="math">\\mathcal{M}_I</span> .</li>
    </ol></li>
    </ul>

    <p class="text-gray-300">In other words, for a given set  <span class="math">\\mathcal{T}_{(x_0,x_1,x_2),(y_0,y_1,y_2)}</span> , it is not possible that the two texts of only some - not all - couples belong to the same coset of  <span class="math">\\mathcal{M}_J</span>  after 4-round, while this can happen for a random permutation.</p>

    <p class="text-gray-300">What is the probability of the two previous events for an AES permutation? As showed in Sect. 7.1.2, given a set  <span class="math">\\mathcal{T}_{(x_0,x_1,x_2),(y_0,y_1,y_2)}</span> , the probability that the two texts of each couple belong to the same coset of  <span class="math">\\mathcal{M}_J</span>  after 4-round is approximately  <span class="math">p_3 \\simeq 2^{-30}</span> .</p>

    <p class="text-gray-300">Using these initial considerations as starting point, we analyze in details our proposed 5-round distinguisher.</p>

    <p class="text-gray-300">1st Case. As we have just seen, the two ciphertexts of each couple belong to the same coset of a subspace  <span class="math">\\mathcal{M}_I</span>  for |I|=3 after 4-round with probability  <span class="math">p_3\\simeq 2^{-30}</span> . In other words, on average there are  <span class="math">2^{-30}\\cdot n</span>  sets  <span class="math">\\mathcal{T}</span>  such that the two texts of each couple belong to the same coset of a subspace  <span class="math">\\mathcal{M}_J</span>  for |J|=3 after 4-round.</p>

    <p class="text-gray-300">Let |J| = 3. Since  <span class="math">\\operatorname{Prob}(R(x) \\oplus R(y) \\in \\mathcal{M}_J | x \\oplus y \\in \\mathcal{M}_I) = p_{3,3} \\simeq 2^{-22}</span>  (see (7) for details) and since each set is composed of  <span class="math">2^{10}</span>  different pairs, the probability that for at least one pair of  <span class="math">\\mathcal{S}</span> , the two ciphertexts of at least one couple belong to the same coset of  <span class="math">\\mathcal{M}_J</span>  for |J| = 3 after 5 rounds is well approximated by  <span class="math">1 - (1 - \\hat{p}_{3,3})^{2^{10}}</span> , where  <span class="math">\\hat{p}_{3,3}</span>  is defined in (8).</p>

    <p class="text-gray-300"><strong>2nd Case.</strong> In the same way, the two ciphertexts of each couple don't belong to the same coset of a subspace  <span class="math">\\mathcal{M}_J</span>  for |J|=3 after 4-round with probability  <span class="math">1-p_3\\simeq 1-2^{-30}</span> . In other words, on average there are  <span class="math">(1-2^{-30})\\cdot n</span>  sets  <span class="math">\\mathcal{T}</span>  such that the two texts of each couple don't belong to the same coset of a subspace  <span class="math">\\mathcal{M}_J</span>  for |J|=3 after 4-round.</p>

    <p class="text-gray-300">Let |I| = 3 and remember that  <span class="math">\\operatorname{Prob}(R(x) \\oplus R(y) \\in \\mathcal{M}_I \\mid x \\oplus y \\notin \\mathcal{M}_J) = \\hat{p}_{3,3} \\simeq 2^{-30}</span>  (see (8) for details). What is the probability that for at least one pair of  <span class="math">\\mathcal{S}</span> , the two ciphertexts belong to the same coset of a subspace  <span class="math">\\mathcal{M}_I</span>  after 5-round? By simple computation, this happens with probability  <span class="math">1 - \\left(1 - p_{3,3}\\right)^{2^{10}}</span> .</p>

    <p class="text-gray-300"><strong>Final Result.</strong> We finally obtain the desired result using the <em>law</em> (or formula) of total probability  <span class="math">Prob(A) = \\sum_{i} Prob(A \\mid B_i) \\cdot Prob(B_i)</span>  which holds for each event A such that  <span class="math">\\bigcup_{i} B_i</span>  is the <em>sample space</em>, i.e. the set of all the possible outcomes.</p>

    <p class="text-gray-300">Given a set  <span class="math">\\mathcal{T}</span> , the probability that the two ciphertexts of at least one couple of texts satisfy the required property is given by</p>

    <p class="text-gray-300"><span class="math">$\\begin{split} p_{AES} = &amp; \\left[ 1 - Prob(\\overline{\\mathcal{E}_{1}^{5}} \\wedge \\overline{\\mathcal{E}_{2}^{5}} \\wedge \\dots \\wedge \\overline{\\mathcal{E}_{1024}^{5}} \\, | \\, \\mathcal{E}_{i}^{4}) \\right] \\cdot Prob(\\mathcal{E}_{i}^{4}) + \\\\ &amp; + \\left[ 1 - Prob(\\overline{\\mathcal{E}_{1}^{5}} \\wedge \\overline{\\mathcal{E}_{2}^{5}} \\wedge \\dots \\wedge \\overline{\\mathcal{E}_{1024}^{5}} \\, | \\, \\overline{\\mathcal{E}_{i}^{4}}) \\right] \\cdot Prob(\\overline{\\mathcal{E}_{i}^{4}}) = \\\\ = &amp; (1 - p_{3}) \\cdot \\left[ 1 - \\left( 1 - \\frac{p_{3} \\cdot (1 - p_{3,3})}{1 - p_{3}} \\right)^{1024} \\right] + p_{3} \\cdot \\left[ 1 - \\left( 1 - p_{3,3} \\right)^{1024} \\right] = \\\\ = &amp; 2^{-20} - 4095 \\cdot 2^{-53} - \\underbrace{529\\,370\\,445 \\cdot 2^{-84}}_{\\approx \\, 3.945 \\cdot 2^{-57}} + \\underbrace{374\\,996\\,306\\,937\\,593 \\cdot 2^{-117}}_{\\approx \\, 2.665 \\cdot 2^{-70}} + \\dots \\end{split}</span>$</p>

    <p class="text-gray-300">for a certain  <span class="math">i \\in \\{1, ..., 2^{10}\\}</span> . Note that  <span class="math">Prob(\\mathcal{E}_i^5 \\wedge \\mathcal{E}_j^5) = Prob(\\mathcal{E}_i^5) \\times Prob(\\mathcal{E}_j^5)</span>  since the events  <span class="math">\\mathcal{E}_i^5</span>  and  <span class="math">\\mathcal{E}_j^5</span>  are independent for  <span class="math">i \\neq j</span> .</p>

    <h4 id="sec-misc-11" class="text-lg font-semibold mt-6"><strong>Proof</strong> - Random Permutation</h4>

    <p class="text-gray-300">For a random permutation, what is the probability that the two ciphertexts (generated by a random permutation) of at least one couple satisfy the required property? By simple computation, such event occurs with (approximately) probability</p>

    <p class="text-gray-300"><span class="math">$p_{rand} = 1 - (1 - p_3)^{1024} = 1 - \\left[1 - (2^{-30} - 3 \\cdot 2^{-63} + 2^{-94})\\right]^{1024} =</span>$</p>

    <p class="text-gray-300"><span class="math">$= 2^{-20} - 4095 \\cdot 2^{-53} + \\underbrace{2794155 \\cdot 2^{-84}}_{\\approx 2.665 \\cdot 2^{-64}} + \\dots</span>$</p>

      <h4 id="app-c.1.3" class="text-lg font-semibold mt-6">C.1.3 Data and Computational Costs</h4>

    <p class="text-gray-300"><strong>Data Cost.</strong> In order to compute the data cost, we use the same argumentation of Sect. 7.2.1. Since  <span class="math">|p_{AES} - p_{rand}| \\simeq 2^{-55.013}</span>  and  <span class="math">p_{AES} \\simeq p_{rand} \\simeq 2^{-20}</span> , it follows that n must satisfy  <span class="math">n &gt; 2^{92.246}</span>  for a probability of success of approximately 95%. Since a single coset of  <span class="math">C_I</span>  for |I| = 1 contains approximately  <span class="math">2^{46.983}</span>  different sets  <span class="math">\\mathcal{T}</span> , it follows that  <span class="math">2^{92.246} \\cdot 2^{-46.983} \\simeq 2^{45.263}</span>  initial cosets of  <span class="math">C_I</span>  for |I| = 1 are sufficient, for a total data cost of  <span class="math">2^{32} \\cdot 2^{45.263} \\simeq 2^{77.263}</span>  chosen plaintexts.</p>

    <p class="text-gray-300">Computational Cost. About the computational cost, the idea is to exploit Algorithm 3 as defined in Sect. 7.2.2 and adapted to the sets  <span class="math">\\mathcal{T}</span>  (observe that  <span class="math">p \\oplus q \\in \\mathcal{T}</span>  iff  <span class="math">p \\oplus q \\in \\mathcal{D}_I</span>  for |I| = 3). Working on a single coset of  <span class="math">\\mathcal{C}_I</span>  for |I| = 1, the cost to count the number of sets  <span class="math">\\mathcal{T}</span>  for which two ciphertexts of at least one pair of plaintexts belong to the same coset of  <span class="math">\\mathcal{M}_I</span>  is</p>

    <p class="text-gray-300"><span class="math">$4 \\cdot \\left[ 2^{32} \\cdot \\log(2^{32}) \\text{ (re-ordering process)} \\right. \\\\ \\left. + \\left( 2^{32} + 2^{31} \\right) \\text{ (access to } (p^i, c^i) \\text{ and to } A[\\cdot] \\text{ - increment number of collisions)} \\right] \\\\ + 2^{46.983} \\text{ (final &quot;for&quot;)} \\\\ \\simeq 2^{46.99}</span>$</p>

    <p class="text-gray-300">table look-ups, where  <span class="math">\\binom{2^{32}}{2} \\cdot 2^{-32} \\simeq 2^{31}</span>  is the average number of couples such that the two ciphertexts belong to the same coset of  <span class="math">\\mathcal{M}_J</span>  for a fixed J with |J|=3. Since the attacker must repeat this algorithm for each initial coset, the <em>total computational cost</em> is of  <span class="math">2^{46.99} \\cdot 2^{45.263} = 2^{92.253}</span>  table look-ups, or equivalently  <span class="math">2^{85.61}</span>  five-round encryptions.</p>

      <h4 id="app-c.1.4" class="text-lg font-semibold mt-6">C.1.4 Practical Verification on small scale AES</h4>

    <p class="text-gray-300">In order to have a practical verification of the proposed distinguisher (and of the following key-recovery attack), we have practically verified the probabilities  <span class="math">p_{AES}</span>  and  <span class="math">p_{rand}</span>  given above. In particular, we verified them using a small scale AES, proposed in [CMR05]. We emphasize that our verification on the small scale variant of AES is strong evidence for it to hold for the real AES, since the strategy used to theoretically compute such probabilities is independent of the fact that each word of AES is of 4 or 8 bits.</p>

    <p class="text-gray-300">Thus, in order to compare the practical values with the theoretical ones, we compute the theoretical probabilities  <span class="math">p_{AES}</span>  and  <span class="math">p_{rand}</span>  for the small scale case. First of all, for small scale AES the probabilities  <span class="math">p_3</span>  and  <span class="math">p_{3,3}</span>  are respectively equal to  <span class="math">p_3 = 2^{-14} - 3 \\cdot 2^{-31} + 2^{-46}</span>  and  <span class="math">p_{3,3} = 2^{-10} - 3 \\cdot 2^{-23} + 2^{-34}</span> .</p>

    <p class="text-gray-300"><strong>Practical Results.</strong> W.l.o.g. we used cosets of  <span class="math">C_0</span>  to practically test the two probabilities. Using the previous procedure and formula, (approximately) the probabilities that a set  <span class="math">\\mathcal{T}</span>  satisfies the required property for 5-round AES and the random case are respectively</p>

    <p class="text-gray-300"><span class="math">$\\begin{split} p_{AES} &amp;= 2^{-8} - 255 \\cdot 2^{-25} - 102\\,605 \\cdot 2^{-40} + \\dots \\\\ p_{rand} &amp;= 2^{-8} - 255 \\cdot 2^{-25} + 10\\,795 \\cdot 2^{-40} + \\dots \\end{split}</span>$</p>

    <p class="text-gray-300">As a result, using formula (15) for  <span class="math">p_{rand} \\simeq p_{AES} \\simeq 2^{-8}</span>  and  <span class="math">|p_{rand} - p_{AES}| \\simeq 2^{-23.21}</span> , it follows that  <span class="math">n \\geq 2^{40.64}</span>  different sets  <span class="math">\\mathcal{T}</span>  are sufficient to set up the distinguisher with probability higher than 95%.</p>

    <p class="text-gray-300">Since we work with small scale AES, a single coset of  <span class="math">\\mathcal{C}_0</span>  contains  <span class="math">4 \\cdot 2^4 \\cdot 2^{11} \\cdot (2^4 - 1)^3 \\simeq 2^{29 \\cdot 71}</span>  couples for which the two plaintexts have only one different generating variable (also tested by computer test). Thus, it is possible to construct  <span class="math">2^{11} \\cdot (2^4 - 1)^3 = 6\\,912\\,000 \\simeq 2^{23 \\cdot 721}</span>  sets  <span class="math">\\mathcal{T}</span>  such that all the generating variables of the couples of each of these sets are different. As a result, it follows that  <span class="math">2^{40.64} \\cdot 2^{-23 \\cdot 721} = 2^{16.92}</span>  different initial cosets of  <span class="math">\\mathcal{C}_0</span>  must be used, for a cost of  <span class="math">2^{38.566}</span>  chosen plaintexts.</p>

    <p class="text-gray-300">For our tests, we used  <span class="math">2^{17}</span>  different initial cosets of  <span class="math">C_0</span>  (keys used to encrypt the plaintexts in the AES case are randomly chosen and different for each coset - the key is not fixed). For each coset we exploited Algorithm 3 to count the number of sets  <span class="math">\\mathcal{T}</span>  that satisfy the required property (i.e. the number of sets for which two ciphertexts of at least one couple are in the same coset of  <span class="math">\\mathcal{M}_J</span>  for certain J with |J|=3). As a result, for each initial coset  <span class="math">C_0</span>  the (average) theoretical numbers of sets  <span class="math">\\mathcal{T}</span>  that satisfy the required property for the random and the AES cases - given by  <span class="math">n_X^T=6\\,912\\,000\\cdot p_X</span>  - and the (average) practical ones found in our experiments - denoted by  <span class="math">n_X^P</span>  - are given are:</p>

    <p class="text-gray-300"><span class="math">$n_{rand}^T \\simeq 26\\,497.54</span>$
<span class="math">n_{AES}^T \\simeq 26\\,496.83</span>   <span class="math">n_{rand}^P \\simeq 26\\,497.57</span>   <span class="math">n_{AES}^P \\simeq 26\\,496.91</span></p>

    <p class="text-gray-300">Note that these two numbers are close to the theoretical ones, and that the average number of sets for AES case is lower than for the random one, as predicted.</p>

      <h3 id="app-c.2" class="text-xl font-semibold mt-8">C.2 Second Variant of the 5-round Distinguisher of Sect. 7</h3>

      <h4 id="app-c.2.1" class="text-lg font-semibold mt-6">C.2.1 Details of the Distinguisher</h4>

    <p class="text-gray-300">Consider  <span class="math">2^{64}</span>  chosen plaintexts with two active column (8 active bytes), e.g. a coset of  <span class="math">C_{0,1}</span> , and the corresponding ciphertexts after 5-round. For each  <span class="math">(\\mathbf{x}, \\mathbf{y}) \\in \\mathbb{F}_{2^8}^6 \\times \\mathbb{F}_{2^8}^6</span>  where  <span class="math">\\mathbf{x} = (x_0, x_1, x_2, ..., x_5)</span>  and  <span class="math">\\mathbf{y} = (y_0, y_1, y_2, ..., y_5)</span>  such that  <span class="math">(x_0, x_1) \\neq (y_0, y_1)</span> ,  <span class="math">(x_2, x_3) \\neq (y_2, y_3)</span>  and  <span class="math">(x_4, x_5) \\neq (y_4, y_5)</span> , let the set  <span class="math">\\mathcal{T}_{(\\mathbf{x}, \\mathbf{y})}^3</span>  of pairs of plaintexts be defined</p>

    <p class="text-gray-300">as follows</p>

    <p class="text-gray-300"><span class="math">$\\begin{split} \\mathcal{T}^3_{(\\mathbf{x},\\mathbf{y})} &amp;= \\bigg\\{ \\big(p,q\\big) \\in \\mathbb{F}_{2^8}^{4\\times 4} \\times \\mathbb{F}_{2^8}^{4\\times 4} \\text{ s.t. for each } A, B \\in \\mathbb{F}_{2^8} : \\\\ p &amp;\\equiv \\big( \\big(x_0,x_2,x_3,A\\big), \\big(B,x_1,x_3,x_5\\big) \\big), q \\equiv \\big( \\big(y_0,y_2,y_3,A\\big), \\big(B,y_1,y_3,y_5\\big) \\big) \\text{ or } \\\\ p &amp;\\equiv \\big( \\big(y_0,x_2,x_3,A\\big), \\big(B,y_1,x_3,x_5\\big) \\big), q \\equiv \\big( \\big(x_0,y_2,y_3,A\\big), \\big(B,x_1,y_3,y_5\\big) \\text{ or } \\\\ p &amp;\\equiv \\big( \\big(x_0,y_2,x_3,A\\big), \\big(B,x_1,y_3,x_5\\big) \\big), q \\equiv \\big( \\big(y_0,x_2,y_3,A\\big), \\big(B,y_1,x_3,y_5\\big) \\text{ or } \\\\ p &amp;\\equiv \\big( \\big(x_0,x_2,y_3,A\\big), \\big(B,x_1,x_3,y_5\\big) \\big), q \\equiv \\big( \\big(y_0,y_2,x_3,A\\big), \\big(B,y_1,y_3,x_5\\big) \\bigg\\}. \\end{split}</span>$</p>

    <p class="text-gray-300">In other words, the pair of plaintexts  <span class="math">p, q \\in \\mathcal{C}_0 \\oplus a</span>  can be of the form</p>

    <p class="text-gray-300"><span class="math">$p \\equiv a \\oplus \\begin{bmatrix} x_0 &amp; B &amp; 0 &amp; 0 \\\\ x_2 &amp; x_1 &amp; 0 &amp; 0 \\\\ x_4 &amp; x_3 &amp; 0 &amp; 0 \\\\ A &amp; x_5 &amp; 0 &amp; 0 \\end{bmatrix} \\qquad q \\equiv a \\oplus \\begin{bmatrix} y_0 &amp; B &amp; 0 &amp; 0 \\\\ y_2 &amp; y_1 &amp; 0 &amp; 0 \\\\ y_4 &amp; y_3 &amp; 0 &amp; 0 \\\\ A &amp; y_5 &amp; 0 &amp; 0 \\end{bmatrix},</span>$</p>

    <p class="text-gray-300">or</p>

    <p class="text-gray-300"><span class="math">$p \\equiv a \\oplus \\begin{bmatrix} y_0 &amp; B &amp; 0 &amp; 0 \\\\ x_2 &amp; y_1 &amp; 0 &amp; 0 \\\\ x_4 &amp; x_3 &amp; 0 &amp; 0 \\\\ A &amp; x_5 &amp; 0 &amp; 0 \\end{bmatrix} \\qquad q \\equiv a \\oplus \\begin{bmatrix} x_0 &amp; B &amp; 0 &amp; 0 \\\\ y_2 &amp; x_1 &amp; 0 &amp; 0 \\\\ y_4 &amp; y_3 &amp; 0 &amp; 0 \\\\ A &amp; y_5 &amp; 0 &amp; 0 \\end{bmatrix},</span>$</p>

    <p class="text-gray-300">and so on. Similar definitions can be given for the set  <span class="math">\\mathcal{T}^i_{(\\mathbf{x},\\mathbf{y})}</span>  for each  <span class="math">i \\in \\{0,1,2,3\\}</span> , where the constant bytes is in the <em>i</em>-th diagonal. Given  <span class="math">2^{64}</span>  plaintexts as before, it is possible to construct  <span class="math">\\frac{1}{2^{18}} \\cdot 4 \\cdot 2^{63} \\cdot (2^{16} - 1)^3 \\simeq 2^{95}</span>  different sets, where each set contains exactly  <span class="math">2^{18}</span>  different pairs of plaintexts (we emphasize that these pairs of plaintexts are not independent, in the sense that a particular relationships among the generating variable holds).</p>

    <p class="text-gray-300">Consider  <span class="math">n\\gg 1</span>  random sets, and count the number of sets for which two ciphertexts (generated by 5-round AES or by a random permutation) of at least one couple of texts belong to the same coset of a subspace  <span class="math">\\mathcal{M}_J</span>  for  <span class="math">J\\subseteq\\{0,1,2,3\\}</span>  and |J|=3. As we are going to prove, this number is on average lower for AES than for a random permutation, independently of the secret key, of the details of the S-Box and of the MixColumns matrix. In more details, the numbers of sets for 5-round AES  <span class="math">n_{AES}</span>  and for a random permutation  <span class="math">n_{rand}</span>  are well approximated by  <span class="math">n_{AES} \\simeq n \\cdot p_{AES}</span>  and  <span class="math">n_{rand} \\simeq n \\cdot p_{rand}</span>  where</p>

    <p class="text-gray-300"><span class="math">$p_{AES} \\simeq 2^{-12} - 1048575 \\cdot 2^{-45} + \\underbrace{46\\,884\\,625\\,075 \\cdot 2^{-76}}_{\\approx 2.73 \\cdot 2^{-42}} + \\dots</span>$</p>

    <p class="text-gray-300"><span class="math">$p_{rand} \\simeq 2^{-12} - 1048575 \\cdot 2^{-45} + \\underbrace{183\\,251\\,413\\,675 \\cdot 2^{-76}}_{\\approx 10.667 \\cdot 2^{-42}} + \\dots</span>$</p>

    <p class="text-gray-300">Even if the difference between the two probabilities is small, it is possible to distinguish the two cases with probability higher than 95% if  <span class="math">n \\ge 2^{68.243}</span> .</p>

    <p class="text-gray-300">In the following, we prove this result (which has been practically tested on a small scale AES) and we give all the details about the data and the computational cost.</p>

      <h4 id="app-c.2.2" class="text-lg font-semibold mt-6">C.2.2 Proof</h4>

    <h4 id="sec-misc-12" class="text-lg font-semibold mt-6">Proof - 5-round AES</h4>

    <p class="text-gray-300">As first thing, we prove the results just given, starting with the 5-round AES case.</p>

    <p class="text-gray-300">Initial Considerations - 5-round AES. Our 5-round distinguisher is based on Theorem 5. Given plaintexts in the same coset of  <span class="math">C_0</span>  and for a fixed  <span class="math">J \\subseteq \\{0, 1, 2, 3\\}</span> , each set  <span class="math">\\mathcal{T}_{(\\mathbf{x}, \\mathbf{y})}</span>  just defined has the following property after 4 rounds:</p>

    <ul class="list-disc list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li><ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li>for each couple, the two texts after 4-round belong to the same coset of  <span class="math">\\mathcal{M}_I</span> ;</li>
    </ol></li>
      <li><ol class="list-decimal list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li>for each couple, the two texts after 4-round don't belong to the same coset of  <span class="math">\\mathcal{M}_I</span> .</li>
    </ol></li>
    </ul>

    <p class="text-gray-300">In other words, for a given set  <span class="math">\\mathcal{T}_{(\\mathbf{x},\\mathbf{y})}</span> , it is not possible that the two texts of only somenot all - couples belong to the same coset of  <span class="math">\\mathcal{M}_J</span>  after 4-round, while this can happen for a random permutation.</p>

    <p class="text-gray-300">What is the probability of the two previous events for an AES permutation? As showed in Sect. 7.1.2, given a set  <span class="math">\\mathcal{T}_{(\\mathbf{x},\\mathbf{y})}</span> , the probability that the two texts of each couple belong to the same coset of  <span class="math">\\mathcal{M}_J</span>  after 4-round is approximately  <span class="math">p_3 \\simeq 2^{-30}</span> .</p>

    <p class="text-gray-300">Using these initial considerations as starting point, we analyze in details our proposed 5-round distinguisher.</p>

    <p class="text-gray-300"><strong>Proof - AES.</strong> Using the same computation as before, given a set  <span class="math">\\mathcal{T}</span> , the probability that two ciphertexts of at least one couple satisfy the required property is given by</p>

    <p class="text-gray-300"><span class="math">$\\begin{split} p_{AES} = &amp; \\left[ 1 - Prob(\\overline{\\mathcal{E}_{1}^{5}} \\wedge \\overline{\\mathcal{E}_{2}^{5}} \\wedge \\dots \\wedge \\overline{\\mathcal{E}_{2^{18}}^{5}} \\,|\\, \\mathcal{E}_{i}^{4}) \\right] \\cdot Prob(\\mathcal{E}_{i}^{4}) + \\\\ &amp; + \\left[ 1 - Prob(\\overline{\\mathcal{E}_{1}^{5}} \\wedge \\overline{\\mathcal{E}_{2}^{5}} \\wedge \\dots \\wedge \\overline{\\mathcal{E}_{2^{18}}^{5}} \\,|\\, \\overline{\\mathcal{E}_{i}^{4}}) \\right] \\cdot Prob(\\overline{\\mathcal{E}_{i}^{4}}) = \\\\ = &amp; (1 - p_{3}) \\cdot \\left[ 1 - \\left( 1 - \\frac{p_{3} \\cdot (1 - p_{3,3})}{1 - p_{3}} \\right)^{2^{18}} \\right] + p_{3} \\cdot \\left[ 1 - \\left( 1 - p_{3,3} \\right)^{2^{18}} \\right] = \\\\ = &amp; 2^{-12} - 1048575 \\cdot 2^{-45} + \\underbrace{46\\,884\\,625\\,075 \\cdot 2^{-76}}_{\\approx 2.73 \\cdot 2^{-42}} + \\dots \\end{split}</span>$</p>

    <p class="text-gray-300">for a certain  <span class="math">i \\in \\{1, ..., 2^{18}\\}</span> . Note that  <span class="math">Prob(\\mathcal{E}_i^5 \\wedge \\mathcal{E}_j^5) = Prob(\\mathcal{E}_i^5) \\times Prob(\\mathcal{E}_j^5)</span>  since the events  <span class="math">\\mathcal{E}_i^5</span>  and  <span class="math">\\mathcal{E}_i^5</span>  are independent for  <span class="math">i \\neq j</span> .</p>

    <h4 id="sec-misc-13" class="text-lg font-semibold mt-6">Proof - Random Permutation</h4>

    <p class="text-gray-300">For a random permutation, what is the probability that two ciphertexts (generated by a random permutation) of at least one couple satisfy the required property? By simple computation, such event occurs with (approximately) probability</p>

    <p class="text-gray-300"><span class="math">$p_{rand} = 1 - (1 - p_3)^{2^{18}} = 1 - \\left[1 - (2^{-30} - 3 \\cdot 2^{-63} + 2^{-94})\\right]^{2^{18}} =</span>$</p>

    <p class="text-gray-300"><span class="math">$= 2^{-12} - 1048575 \\cdot 2^{-45} + \\underbrace{183251413675 \\cdot 2^{-76}}_{\\approx 10.667 \\cdot 2^{-42}} + \\dots</span>$
(19)</p>

      <h4 id="app-c.2.3" class="text-lg font-semibold mt-6">C.2.3 Data and Computational Costs</h4>

    <p class="text-gray-300"><strong>Data Cost.</strong> In order to compute the data cost, we use the same argumentation of Sect. 7.2.1. Since  <span class="math">|p_{AES} - p_{rand}| \\simeq 2^{-39.011}</span>  and  <span class="math">p_{AES} \\simeq p_{rand} \\simeq 2^{-12}</span> , it follows that n must satisfy  <span class="math">n &gt; 2^{68.243}</span>  for a probability of success of approximately 95%. Since a single coset of  <span class="math">C_I</span>  for |I| = 2 contains approximately  <span class="math">2^{95}</span>  different sets  <span class="math">\\mathcal{T}</span> , less than a single coset is sufficient to implement the distinguisher. In particular, a set of the form</p>

    <p class="text-gray-300"><span class="math">$\\left\\{a \\oplus \\begin{bmatrix} x_0 &amp; y_1 &amp; 0 &amp; 0 \\\\ z_0 &amp; x_1 &amp; 0 &amp; 0 \\\\ w_0 &amp; z_1 &amp; 0 &amp; 0 \\\\ y_0 &amp; w_1 &amp; 0 &amp; 0 \\end{bmatrix} \\middle| \\forall x_0, x_1, y_0, y_1, z_0, z_1 \\in \\mathbb{F}^2_{2^8}, \\forall w_0, w_1 \\in \\{0x00, 0x01, 0x02, 0x03\\} \\right\\}</span>$</p>

    <p class="text-gray-300">for a certain constant a is sufficient to set up the distinguisher (note that this is a subset of the coset  <span class="math">C_{0,1} \\oplus a</span> ). Indeed, for such a set it is possible to construct approximately  <span class="math">\\frac{1}{2^{18}} \\cdot 3 \\cdot (2^{48} \\cdot 4^2) \\cdot [(2^{16} - 1)^2 \\cdot (16 - 1)] \\simeq 2^{71.5}</span>  different sets  <span class="math">\\mathcal{T}</span>  (remember that we are</p>

    <p class="text-gray-300">working with variables in  <span class="math">\\mathbb{F}_{2^8}^2</span> ), for a total of  <span class="math">(2^8)^6 \\cdot 4^2 \\simeq 2^{52}</span>  chosen plaintexts.</p>

    <p class="text-gray-300">Computational Cost. About the computational cost, the idea is to exploit Algorithm 3 opportunely modified as proposed in App. E and adapted to the sets  <span class="math">\\mathcal{T}</span>  in order to implement the distinguisher, where the plaintexts and the ciphertexts are re-order w.r.t. the partial order  <span class="math">\\sqsubseteq</span>  defined in Def. 11. Using  <span class="math">2^{52}</span>  chosen plaintexts in the same coset of  <span class="math">\\mathcal{C}_I</span>  for |I|=2, the cost to count the number of sets  <span class="math">\\mathcal{T}</span>  for which two ciphertexts of at least one pair of plaintexts belong to the same coset of  <span class="math">\\mathcal{M}_J</span>  is</p>

    <p class="text-gray-300"><span class="math">$4^2 \\cdot \\left[ 2^{52} \\cdot \\log(2^{52}) \\text{ (re-ordering process) } + \\left( 2^{52} + 2^{57} \\right) \\text{ (access to } (p^i, c^i) \\text{ and to } A[\\cdot] \\text{ - increment number of collisions) } \\right] + 2^{71.5} \\text{ (final &quot;for&quot;)} \\simeq 2^{71.5}</span>$</p>

    <p class="text-gray-300">table look-ups, where  <span class="math">\\binom{2^{52}}{2} \\cdot 2^{-32} \\cdot (4 \\cdot 2^{-16}) \\simeq 2^{57}</span>  is the average number of couples such that the two ciphertexts belong to the same coset of  <span class="math">\\mathcal{M}_J</span>  for a fixed J with |J|=3 and the two plaintexts are in the same coset of  <span class="math">\\mathcal{C}_{0,1} \\cap \\mathcal{D}_I</span>  for a certain I with |I|=3 (by definition of  <span class="math">\\mathcal{T}</span> ). Equivalently, the total cost is well approximated by  <span class="math">2^{64.86}</span>  five-round encryptions.</p>

    <p class="text-gray-300">About the computational cost, the idea is to exploit the re-ordering Algorithm 3 as defined in Sect. 7.2.2 and adapted to the sets  <span class="math">\\mathcal{T}</span></p>

    <p class="text-gray-300">Referring to the key-recovery attack on 6-round AES of Sect. 8, here we explain why it is not possible to use cosets of  <span class="math">\\mathcal{D}_I</span>  with |I|=2 for a key-recovery attack, focusing on the set  <span class="math">\\mathcal{T}</span>  just defined. As we have already said in Sect. 8, the problem regards the computational cost (which is higher than the one of a brute force attack).</p>

    <p class="text-gray-300">In this case and using the same strategy proposed in Sect. 8, since  <span class="math">2^{64}</span>  different combinations of 8 bytes of the key (i.e. 2 diagonals) must be tested, one has to use the 5-round distinguisher with a probability higher  <span class="math">(0.95)^{2^{-64}}</span> . This requires approximately  <span class="math">2^{118.9}</span>  sets  <span class="math">\\mathcal{T}</span>  for each guessed combination of the key. Since each coset of  <span class="math">\\mathcal{D}_I</span>  with |I| = 2 contains approximately  <span class="math">2^{95}</span>  sets  <span class="math">\\mathcal{T}</span> , one needs approximately  <span class="math">2^{118.9} \\cdot 2^{-95} = 2^{24.1}</span>  different cosets of  <span class="math">\\mathcal{D}_I</span>  with |I| = 2, for a total cost of  <span class="math">2^{24.1} \\cdot 2^{64} = 2^{88.1}</span>  chosen plaintexts.</p>

    <p class="text-gray-300">On the other hand, using the algorithm described in Sect. 7.2.2 opportunely modified as proposed in App. E (as just seen for the distinguisher), the cost to count the number of sets  <span class="math">\\mathcal T</span>  that satisfy the required property is</p>

    <p class="text-gray-300"><span class="math">$4^2 \\cdot \\left[2^{64} \\cdot \\log(2^{64}) \\text{ (re-ordering process) } + \\left(2^{64} + 2^{81}\\right) \\text{ (access to } (p^i, c^i) \\text{ and to } A[\\cdot] \\text{ - increment number of collisions) } \\right] + 2^{95} \\text{ (final &quot;for&quot;)} \\simeq 2^{95}</span>$</p>

    <p class="text-gray-300">table look-ups for each guessed key, where  <span class="math">\\binom{2^{64}}{2} \\cdot 2^{-32} \\cdot (4 \\cdot 2^{-16}) \\simeq 2^{81}</span>  is the average number of couples such that the two ciphertexts belong to the same coset of  <span class="math">\\mathcal{M}_J</span>  for a fixed J with |J|=3 and the two plaintexts are in the same coset of  <span class="math">\\mathcal{C}_{0,1} \\cap \\mathcal{D}_I</span>  for a certain I with |I|=3 (by definition of  <span class="math">\\mathcal{T}</span> ). Since one has to repeat this process for  <span class="math">2^{24.1}</span>  initial cosets and since one has to partially encrypt each one of them, the total cost for each guessed key is of  <span class="math">2^{119.1}</span>  table look-ups and  <span class="math">2^{91.1}</span>  S-Box look-ups, that is  <span class="math">2^{112.2}</span>  six-round encryptions. The total cost to find two diagonals of the key is  <span class="math">2^{64} \\cdot 2^{112.2} = 2^{176.2}</span>  six-round encryptions. If the last two diagonals are found by brute force, the total cost is well approximated by  <span class="math">2^{64} + 2^{176.2} \\simeq 2^{176.2}</span>  six-round encryptions, which is much higher than the brute force attack.</p>

    <p class="text-gray-300">In this section, we propose a variant of the 5-round secret-key distinguisher proposed in Sect. 7. Such a variant is competitive as the other distinguishers just presented, and exploited the result of [GRR17a] recalled in Lemma 2.</p>

    <p class="text-gray-300">Consider  <span class="math">2^{32}</span>  chosen plaintexts with one active column (4 active bytes), e.g. a coset of  <span class="math">C_0</span> , and the corresponding ciphertexts after 5-round. For each  <span class="math">(x_0, x_1, x_2, x_3), (y_0, y_1, y_2, y_3) \\in \\mathbb{F}^8_{2^8}</span>  such that  <span class="math">x_i \\neq y_i</span>  for each i = 0, 1, 2, 3, let the set  <span class="math">\\mathcal{T}^{(y_0, y_1, y_2, y_3)}_{(x_0, x_1, x_2, x_4)}</span>  of pairs of plaintexts be defined as follows</p>

    <p class="text-gray-300"><span class="math">$\\mathcal{T}_{(x_0,x_1,x_2,x_4)}^{(y_0,y_1,y_2,y_3)} = \\left\\{ (p,q) \\in \\mathbb{F}_{2^8}^{4\\times 4} \\times \\mathbb{F}_{2^8}^{4\\times 4} \\,\\middle|\\, p \\equiv (x_0,x_1,x_2,x_3), q \\equiv (y_0,y_1,y_2,y_3) \\right.</span>$
or  <span class="math">p \\equiv (y_0,x_1,x_2,x_3), \\equiv (x_0,y_1,y_2,y_3)</span>  or  <span class="math">p \\equiv (x_0,y_1,x_2,x_3), \\equiv (y_0,x_1,y_2,y_3)</span>
or... or  <span class="math">p \\equiv (y_0,x_1,x_2,y_3), q \\equiv (x_0,y_1,y_2,x_3) \\right\\}.</span></p>

    <p class="text-gray-300">In other words, the pair of plaintexts  <span class="math">p, q \\in \\mathcal{C}_0 \\oplus a</span>  can be of the form</p>

    <p class="text-gray-300"><span class="math">$p \\equiv a \\oplus \\begin{bmatrix} x_0 &amp; 0 &amp; 0 &amp; 0 \\\\ x_1 &amp; 0 &amp; 0 &amp; 0 \\\\ x_2 &amp; 0 &amp; 0 &amp; 0 \\\\ x_3 &amp; 0 &amp; 0 &amp; 0 \\end{bmatrix} \\qquad q \\equiv a \\oplus \\begin{bmatrix} y_0 &amp; 0 &amp; 0 &amp; 0 \\\\ y_1 &amp; 0 &amp; 0 &amp; 0 \\\\ y_2 &amp; 0 &amp; 0 &amp; 0 \\\\ y_3 &amp; 0 &amp; 0 &amp; 0 \\end{bmatrix},</span>$</p>

    <p class="text-gray-300">or</p>

    <p class="text-gray-300"><span class="math">$p \\equiv a \\oplus \\begin{bmatrix} y_0 &amp; 0 &amp; 0 &amp; 0 \\\\ x_1 &amp; 0 &amp; 0 &amp; 0 \\\\ x_2 &amp; 0 &amp; 0 &amp; 0 \\\\ x_3 &amp; 0 &amp; 0 &amp; 0 \\end{bmatrix} \\qquad q \\equiv a \\oplus \\begin{bmatrix} x_0 &amp; 0 &amp; 0 &amp; 0 \\\\ y_1 &amp; 0 &amp; 0 &amp; 0 \\\\ y_2 &amp; 0 &amp; 0 &amp; 0 \\\\ y_3 &amp; 0 &amp; 0 &amp; 0 \\end{bmatrix}</span>$</p>

    <p class="text-gray-300">and so on. Given  <span class="math">2^{32}</span>  plaintexts as before, it is possible to construct  <span class="math">\\frac{1}{8} \\cdot 2^{31} \\cdot (2^8 - 1)^4 \\simeq 2^{59.978}</span>  different sets (using formula (10) to count the number of pairs of texts with no equal generating variables), where each set contains exactly 8 different pairs of plaintexts (we emphasize that these pairs of plaintexts are not independent, in the sense that a particular relationships among the generating variable holds).</p>

    <p class="text-gray-300">Consider  <span class="math">n \\gg 1</span>  random sets, and count the number of sets for which two ciphertexts (generated by 5-round AES or by a random permutation) of at least one couple belong to the same coset of a subspace  <span class="math">\\mathcal{M}_J</span>  for  <span class="math">J \\subseteq \\{0,1,2,3\\}</span>  and |J|=3. As we are going to prove, this number is on average lower for AES than for a random permutation, independently of the secret key, of the details of the S-Box and of the MixColumns matrix. In more details, the numbers of sets for 5-round AES  <span class="math">n_{AES}</span>  and for a random permutation  <span class="math">n_{rand}</span>  are well approximated by  <span class="math">n_{AES} \\simeq n \\cdot p_{AES}</span>  and  <span class="math">n_{rand} \\simeq n \\cdot p_{rand}</span>  where</p>

    <p class="text-gray-300"><span class="math">$p_{AES} \\simeq 2^{-27} - 31 \\cdot 2^{-60} - \\underbrace{3641245 \\cdot 2^{-91}}_{\\approx 3.475 \\cdot 2^{-71}} + \\underbrace{20628528753 \\cdot 2^{-124}}_{\\approx 2.4 \\cdot 2^{-91}} + \\dots</span>$</p>

    <p class="text-gray-300"><span class="math">$p_{rand} \\simeq 2^{-27} - 31 \\cdot 2^{-60} + 155 \\cdot 2^{-91} + \\dots</span>$</p>

    <p class="text-gray-300">Even if the difference between the two probabilities is small, it is possible to distinguish the two cases with probability higher than 95% if  <span class="math">n \\ge 2^{113.84}</span> .</p>

    <p class="text-gray-300">In the following, we prove this result (which has been practically tested on a small scale AES) and we give all the details about the data and the computational cost.</p>

      <h4 id="app-d.1.2" class="text-lg font-semibold mt-6">D.1.2 Proof</h4>

    <p class="text-gray-300">As first thing, we prove the results just given. Since the proof is very similar to the ones just given, we limit to give the final results.</p>

    <p class="text-gray-300"><strong>Proof - 5-round AES.</strong> Using the same computation as before, given a set  <span class="math">\\mathcal{T}</span> , the probability that two ciphertexts of at least one couple satisfy the required property is given by</p>

    <p class="text-gray-300"><span class="math">$\\begin{split} p_{AES} = &amp; \\left[ 1 - Prob(\\overline{\\mathcal{E}_{1}^{5}} \\wedge \\overline{\\mathcal{E}_{2}^{5}} \\wedge \\dots \\wedge \\overline{\\mathcal{E}_{8}^{5}} \\, | \\, \\mathcal{E}_{i}^{4}) \\right] \\cdot Prob(\\mathcal{E}_{i}^{4}) + \\\\ &amp; + \\left[ 1 - Prob(\\overline{\\mathcal{E}_{1}^{5}} \\wedge \\overline{\\mathcal{E}_{2}^{5}} \\wedge \\dots \\wedge \\overline{\\mathcal{E}_{8}^{5}} \\, | \\, \\overline{\\mathcal{E}_{i}^{4}}) \\right] \\cdot Prob(\\overline{\\mathcal{E}_{i}^{4}}) = \\\\ = &amp; (1 - p_{3}) \\cdot \\left[ 1 - \\left( 1 - \\frac{p_{3} \\cdot (1 - p_{3,3})}{1 - p_{3}} \\right)^{8} \\right] + p_{3} \\cdot \\left[ 1 - \\left( 1 - p_{3,3} \\right)^{8} \\right] = \\\\ = &amp; 2^{-27} - 31 \\cdot 2^{-60} - \\underbrace{3641245 \\cdot 2^{-91}}_{\\approx 3.475 \\cdot 2^{-71}} + \\underbrace{20628528753 \\cdot 2^{-124}}_{\\approx 2.4 \\cdot 2^{-91}} + \\dots \\end{split}</span>$</p>

    <p class="text-gray-300">for a certain  <span class="math">i \\in \\{1, ..., 8\\}</span> .</p>

    <p class="text-gray-300"><strong>Proof -</strong> Random Permutation. For a random permutation, what is the probability that two ciphertexts (generated by a random permutation) of at least one couple satisfy the required property? By simple computation, such event occurs with (approximately) probability</p>

    <p class="text-gray-300"><span class="math">$p_{rand} = 1 - (1 - p_3^8) = 1 - [1 - (2^{-30} - 3 \\cdot 2^{-63} + 2^{-94})]^8 = 2^{-27} - 31 \\cdot 2^{-60} + 155 \\cdot 2^{-91} + \\dots</span>$</p>

      <h4 id="app-d.1.3" class="text-lg font-semibold mt-6">D.1.3 Data and Computational Costs</h4>

    <p class="text-gray-300"><strong>Data Cost.</strong> In order to compute the data cost, we use the same argumentation of Sect. 7.2.1. Note that  <span class="math">|p_{AES} - p_{rand}| \\simeq 2^{-69.204}</span>  and  <span class="math">p_{AES} \\simeq p_{rand} \\simeq 2^{-27}</span> . Using (15), it follows that n must satisfy  <span class="math">n &gt; 2^{113.84}</span>  for a prob. of success higher than 95%. Since a single coset of  <span class="math">C_I</span>  for |I| = 1 contains approximately  <span class="math">2^{31} \\cdot (2^8 - 1)^4 \\cdot 2^{-3} \\simeq 2^{59.978}</span>  different sets  <span class="math">\\mathcal{T}</span>  of eight couples, one needs approximately  <span class="math">2^{113.84} \\cdot 2^{-60} \\simeq 2^{53.84}</span>  different initial cosets of  <span class="math">C_I</span> , that is approximately  <span class="math">2^{85.84}</span>  chosen plaintexts.</p>

    <p class="text-gray-300">Equivalently, it is possible also possible to use cosets of  <span class="math">C_I</span>  for |I| = 2. In this case, a single coset of  <span class="math">C_I</span>  for |I| = 2 contains approximately  <span class="math">2^{63} \\cdot (2^{16} - 1)^4 \\cdot 2^{-3} \\simeq 2^{124}</span>  different sets  <span class="math">\\mathcal{T}</span>  of eight couples. Thus, using a single coset of  <span class="math">C_I</span>  for |I| = 2, it is possible to construct approximately  <span class="math">2^{124}</span>  different sets  <span class="math">\\mathcal{S}</span>  of eight couples, which is more than one needs to set up the distinguisher. It follows that  <span class="math">2^{59}</span>  chosen plaintexts in the same coset of  <span class="math">C_I</span>  with |I| = 2 (e.g. equivalent to the case of set  <span class="math">\\mathcal{T}</span>  studied in details in Sect. C.2) are sufficient to implement the distinguisher.</p>

    <p class="text-gray-300">Computational Cost. About the computational cost, the idea is to exploit Algorithm 3 as defined in Sect. 7.2.2 and adapted to the sets  <span class="math">\\mathcal{T}</span>  (observe that  <span class="math">p \\oplus q \\in \\mathcal{T}</span>  iff  <span class="math">p \\oplus q \\notin \\mathcal{D}_I</span>  for each I s.t.  <span class="math">|I| \\leq 3</span> ). Working with coset of  <span class="math">\\mathcal{C}_I</span>  for |I| = 1, the cost to count the number of set  <span class="math">\\mathcal{T}</span>  with the required property is</p>

    <p class="text-gray-300"><span class="math">$\\begin{aligned} &amp;4 \\cdot \\left[ 2^{32} \\cdot \\log(2^{32}) \\text{ (re-ordering process) } + \\left( 2^{32} + 2^{31} \\right) \\text{ (access to } (p^i, c^i) \\text{ and to } A[\\cdot] \\text{ - increment number of collisions) } \\right] + 2^{59.978} \\text{ (final &quot;for&quot;)} &amp;\\simeq 2^{59.98} \\end{aligned}</span>$</p>

    <p class="text-gray-300">table look-ups. Since the attacker must repeat this algorithm for each initial coset, the total computational cost is of  <span class="math">2^{53.84} \\cdot 2^{59.98} = 2^{113.82}</span>  table look-ups, or equivalently  <span class="math">2^{107.18}</span> five-round encryptions.</p>

    <p class="text-gray-300">Instead, using  <span class="math">2^{59}</span>  chosen plaintexts in the same coset of  <span class="math">C_I</span>  for |I|=2, the cost to count the number of sets  <span class="math">\\mathcal{T}</span>  for which two ciphertexts of at least one pair of plaintexts belong to the same coset of  <span class="math">\\mathcal{M}_I</span>  is</p>

    <p class="text-gray-300"><span class="math">$\\begin{aligned} &amp;4 \\cdot \\left[ 2^{59} \\cdot \\log(2^{59}) \\text{ (re-ordering process) } + \\left( 2^{59} + 2^{85} \\right) \\text{ (access to } (p^i, c^i) \\text{ and to } A[\\cdot] \\text{ - increment number of collisions) } \\right] + 2^{113.84} \\text{ (final &quot;for&quot;)} &amp;\\simeq 2^{113.84} \\end{aligned}</span>$</p>

    <p class="text-gray-300">table look-ups (where the average number of collisions is  <span class="math">\\binom{2^{59}}{2} \\cdot 2^{-32} = 2^{85}</span> ), or equivalently  <span class="math">2^{107.2}</span>  five-round encryptions.</p>

    <p class="text-gray-300">For completeness, we show that also this distinguisher can be used to set up a key-recovery</p>

    <p class="text-gray-300">attack on 6-round, as the one proposed in Sect. 8. For this reason, we give the probability  <span class="math">p_{AES}^{WrongKey}</span>  that for a set  <span class="math">\\mathcal{T}</span>  two texts of at least one couple belong to the same coset of  <span class="math">\\mathcal{M}_K</span>  for a certain |K|=3 after six rounds, - when the quessed key is wrong. Such probability is equal to</p>

    <p class="text-gray-300"><span class="math">$p_{AES}^{WrongKey} = \\sum_{n=0}^{8} \\binom{8}{n} \\cdot p_3^n \\cdot (1-p_3)^{8-n} \\cdot \\left[1 - \\left(1-p_{3,3}\\right)^n \\cdot \\left(1 - \\frac{p_3 \\cdot (1-p_{3,3})}{1-p_3}\\right)^{8-n}\\right],</span>$</p>

    <p class="text-gray-300">which is well approximated by</p>

    <p class="text-gray-300"><span class="math">$p_{AES}^{WrongKey} = 2^{-27} - 31 \\cdot 2^{-60} - 3\\,989 \\cdot 2^{-91} + \\dots</span>$</p>

    <p class="text-gray-300">Note that this probability is similar but not equal to the one of the random case (which is  <span class="math">p_{rand} = 2^{-27} - 31 \\cdot 2^{-60} + 155 \\cdot 2^{-91} + \\ldots), \\text{ while we remember that the probability for &quot;AES with the right key&quot; is } p_{AES} = 2^{-27} - 31 \\cdot 2^{-60} - 3641245 \\cdot 2^{-91} + \\ldots, \\text{ where the difference between these two probabilities is approximately } |p_{AES}^{WrongKey} - p_{AES}| \\simeq 2^{-69.2053}.</span></p>

    <h2 id="sec-misc-14" class="text-2xl font-bold">Practical Verification on small scale AES</h2>

    <p class="text-gray-300">In order to have a practical verification of the proposed distinguisher (and of the following key-recovery attack), we have practically verified the probabilities  <span class="math">p_{AES}</span>  and  <span class="math">p_{rand}</span>  given above. In particular, we verified them using a small scale AES, proposed in [CMR05]. We emphasize that our verification on the small scale variant of AES is strong evidence for it to hold for the real AES, since the strategy used to theoretically compute such probabilities is independent of the fact that each word of AES is of 4 or 8 bits.</p>

    <p class="text-gray-300">Thus, in order to compare the practical values with the theoretical ones, we compute the theoretical probabilities  <span class="math">p_{AES}</span>  and  <span class="math">p_{rand}</span>  for the small scale case. First of all, for small scale AES the probabilities  <span class="math">p_3</span>  and  <span class="math">p_{3,3}</span>  are respectively equal to  <span class="math">p_3 = 2^{-14} - 3 \\cdot 2^{-31} + 2^{-46}</span> and  <span class="math">p_{3,3} = 2^{-10} - 3 \\cdot 2^{-23} + 2^{-34}</span> .</p>

    <p class="text-gray-300"><strong>Practical Results.</strong> W.l.o.g. we used cosets of  <span class="math">\\mathcal{C}_0</span>  to practically test the two probabilities. Using the previous procedure and formula, the (approximately) probabilities that a set T satisfies the required property for 5-round AES and the random case are respectively</p>

    <p class="text-gray-300"><span class="math">$p_{AES} = 2^{-11} - 31 \\cdot 2^{-28} - \\underbrace{12445 \\cdot 2^{-43}}_{\\approx 3.05 \\cdot 2^{-31}} + \\underbrace{4848753 \\cdot 2^{-60}}_{\\approx 37 \\cdot 2^{-43}} + \\dots</span>$
<span class="math">$p_{rand} = 2^{-11} - 31 \\cdot 2^{-28} + 155 \\cdot 2^{-43} + \\dots</span>$</p>

    <p class="text-gray-300">As a result, using formula (15) for  <span class="math">p_{rand} \\simeq p_{AES} \\simeq 2^{-11}</span>  and  <span class="math">|p_{rand} - p_{AES}| \\simeq 2^{-29.379}</span> , it follows that  <span class="math">n \\geq 2^{50.194}</span>  different sets  <span class="math">\\mathcal{S}^{\\mathcal{C}_0 \\oplus a}</span>  are sufficient to set up the distinguisher with probability higher than 95%.</p>

    <p class="text-gray-300">Since we work with small scale AES, a single coset of  <span class="math">\\mathcal{C}_0</span>  contains  <span class="math">2^{16}</span>  (plaintexts, ciphertexts) pairs, or approximately  <span class="math">2^{15} \\cdot (2^{16}-1) \\simeq 2^{31}</span>  different couples. Since the number of couples with different generating variables is given by  <span class="math">2^{16} \\cdot (2^4-1)^4</span>  (also tested by computer test), it is possible to construct  <span class="math">8^{-1} \\cdot 2^{16} \\cdot (2^4-1)^4 = 207\\,360\\,000 \\simeq 2^{27.628}</span>  sets  <span class="math">\\mathcal{T}</span>  such that all the generating variables of the couples of each of these sets are different. As a result, it follows that  <span class="math">2^{50.194} \\cdot 2^{-27.628} = 2^{22.566}</span>  different initial cosets of  <span class="math">\\mathcal{C}_0</span>  must be used, for a cost of  <span class="math">2^{38.566}</span>  chosen plaintexts.</p>

    <p class="text-gray-300">For our tests, we used  <span class="math">2^{23}</span>  different initial cosets of  <span class="math">C_0</span>  (keys used to encrypt the plaintexts in the AES case are randomly chosen and different for each coset - the key is not fixed). For each coset we exploited Algorithm 3 to count the number of sets  <span class="math">\\mathcal{T}</span>  that satisfy the required property (i.e. the number of sets for which two ciphertexts of at least one couple are in the same coset of  <span class="math">\\mathcal{M}_J</span>  for certain J with |J|=3). As a result, for each initial coset  <span class="math">C_0</span>  the (average) theoretical numbers of sets  <span class="math">\\mathcal{T}</span>  that satisfy the required property for the random and the AES cases - given by  <span class="math">n_X^T=207\\ 360\\ 000 \\cdot p_X</span>  - and the (average) practical ones found in our experiments - denoted by  <span class="math">n_X^P</span>  - are given are:</p>

    <p class="text-gray-300"><span class="math">$n_{rand}^T \\simeq 101\\,226.057</span>$
<span class="math">n_{AES}^T \\simeq 101\\,225.76</span>   <span class="math">n_{rand}^P \\simeq 101\\,226.105</span>   <span class="math">n_{AES}^P \\simeq 101\\,225.68</span></p>

    <p class="text-gray-300">Note that these two numbers are close to the theoretical ones, and that the average number of sets for AES case is lower than for the random one, as predicted.</p>

    <p class="text-gray-300">As we have already mention in Sect. 7.2.2, in some cases it is possible to improve the implementation of the distinguisher (and so the total computational cost) by considering a partial order  <span class="math">\\sqsubseteq</span>  that involves both the plaintexts and the ciphertexts.</p>

    <p class="text-gray-300">Let  <span class="math">I, J \\subseteq \\{0, 1, 2, 3\\}</span>  be fixed in advance, and assume for simplicity |J| = 3 (analogous for the other cases). The idea is to set up a partial order  <span class="math">\\sqsubseteq</span>  that involves both the plaintexts and the ciphertexts in order to achieve the following order: if ciphertexts belong to the same coset of  <span class="math">\\mathcal{M}_J</span>  and the corresponding plaintexts belong to the same coset of  <span class="math">\\mathcal{C}_0 \\cap \\mathcal{D}_I</span>  for a certain |I| (which is a necessary condition to belong to a set  <span class="math">\\mathcal{S}/\\mathcal{Z}/\\mathcal{T}</span>  as defined respectively in Sect. 7/Sect. 9.1/App. C.2), then they must be consecutive. The following partial order  <span class="math">\\sqsubseteq</span>  - for simplicity, we define  <span class="math">\\sqsubseteq</span>  over the space  <span class="math">\\mathcal{I}\\mathcal{D}_J</span>  (equivalent to  <span class="math">\\mathcal{M}_J</span>  but without the final MixColumns) - satisfies these requests.</p>

    <p class="text-gray-300"><strong>Definition 11.</strong> Consider a subspace  <span class="math">\\mathcal{ID}_J</span>  for  <span class="math">J \\subseteq \\{0,1,2,3\\}</span>  for |J|=3 s.t.  <span class="math">l=\\{0,1,2,3\\}\\setminus J</span> , and a subspace  <span class="math">\\mathcal{D}_I</span>  for |I|=2. Given two pairs of plaintexts/ciphertexts  <span class="math">(p^1,c^1)</span>  and  <span class="math">(p^2,c^2)</span>  s.t.  <span class="math">p^1\\oplus p^2\\in \\mathcal{C}_i</span>  for a certain  <span class="math">i\\in\\{0,1,2,3\\}</span> , we say that</p>

    <p class="text-gray-300"><span class="math">$(p^1,c^1) \\sqsubseteq (p^2,c^2)</span>$</p>

    <p class="text-gray-300">if the following conditions hold:</p>

    <ul class="list-disc list-inside space-y-1 text-gray-300 my-2 ml-4">
      <li>if  <span class="math">c^1 \\oplus c^2 \\notin \\mathcal{ID}_J</span> , then there exists  <span class="math">j \\in \\{0, 1, 2, 3\\}</span>  s.t.  <span class="math">c^1_{h, l-h} = c^2_{h, l-h}</span>  for all h &lt; j and  <span class="math">c^1_{j, l-j} &lt; c^2_{j, l-j}</span> ;</li>
      <li>if  <span class="math">c^1 \\oplus c^2 \\in \\mathcal{ID}_J</span>  (i.e.  <span class="math">c^1_{i,l-i} = c^2_{i,l-i}</span>  for each  <span class="math">i \\in \\{0,1,2,3\\}</span> ) and  <span class="math">p^1 \\oplus p^2 \\notin \\mathcal{D}_I</span>  (which implies  <span class="math">p^1</span>  and  <span class="math">p^2</span>  don't belong to the same set  <span class="math">\\mathcal{S}/\\mathcal{Z}/\\mathcal{T}</span> ), then there exists  <span class="math">j \\in \\{0,1,2,3\\}</span>  s.t.  <span class="math">p^1_{h,i} = p^2_{h,i}</span>  for all h &lt; j and  <span class="math">p^1_{j,i} &lt; p^2_{j,i}</span>  (remember that  <span class="math">p^1 \\oplus p^2 \\in \\mathcal{C}_i</span> );</li>
    </ul>

    <pre><code class="language-text">Data: Two pairs of texts (p^1, c^1) \\neq (p^2, c^2) where p^1 \\oplus p^2 \\in \\mathcal{C}_i
   Result: (p^1, c^1) \\sqsubseteq (p^2, c^2) or (p^2, c^2) \\sqsubseteq (p^1, c^1) w.r.t. \\mathcal{D}_I (for the plaintexts - I
                      fixed) and \\mathcal{ID}_{\\{0,1,2,3\\}\\setminus l} (for the ciphertexts - l fixed)
   if c^1 \\oplus c^2 \\notin \\mathcal{ID}_J \\equiv \\mathcal{ID}_{\\{0,1,2,3\\} \\setminus l} then
          for each j from 0 to 3 do
                 \\begin{array}{l} \\text{if } c_{j,l-j}^1 &lt; c_{j,l-j}^2 \\text{ then} \\\\ \\mid \\text{ return } (p^1,c^1) \\sqsubseteq (p^2,c^2) \\end{array}
                 \\begin{array}{l} \\mathbf{end} \\\\ \\mathbf{if} \\ \\ c_{j,l-j}^2 &lt; c_{j,l-j}^1 \\ \\mathbf{then} \\\\ \\mid \\ \\mathbf{return} \\ \\ (p^2,c^2) \\sqsubseteq (p^1,c^1) \\end{array}
   end
   if p^1 \\oplus p^2 \\notin \\mathcal{D}_I
                                                                                                         // remember that p^1 \\oplus p^2 \\in \\mathcal{C}_i then
          for each j \\notin I from 0 to 3 (I \\subseteq \\{0, 1, 2, 3\\}) do
                 \\begin{array}{c} \\textbf{if} \\ p_{j,i}^1 &lt; p_{j,i}^2 \\ \\textbf{then} \\\\ \\mid \\ \\textbf{return} \\ (p^1,c^1) \\sqsubseteq (p^2,c^2) \\end{array}
                \\begin{array}{c} \\mathbf{end} \\\\ \\mathbf{if} \\ \\ p_{j,i}^2 &lt; p_{j,i}^1 \\ \\mathbf{then} \\\\ \\mid \\ \\mathbf{return} \\ (p^2,c^2) \\sqsubseteq (p^1,c^1) \\end{array}
         end
   if c^1 \\leq c^2 w.r.t. \\leq defined in Def. 6 then
    return (p^1, c^1) \\sqsubseteq (p^2, c^2)
   else
    return (p^2, c^2) \\sqsubseteq (p^1, c^1)
Algorithm 5: Given two pairs of texts (p^1, c^1) \\neq (p^2, c^2), this algorithm returns (p^1, c^1) \\sqsubseteq
(p^2,c^2) or (p^2,c^2) \\sqsubseteq (p^1,c^1), where \\sqsubseteq is defined in Def. 11.
</code></pre>

    <p class="text-gray-300">&bull; if  <span class="math">c^1 \\oplus c^2 \\in \\mathcal{ID}_I</span>  and  <span class="math">p^1 \\oplus p^2 \\in \\mathcal{D}_I</span> , then  <span class="math">c^1 \\leq c^2</span>  with respect to the partial order  <span class="math">\\leq</span>  defined in Def. 6.</p>

    <p class="text-gray-300">Pseudo-code provided in Algorithm 5 implements this partial order  <span class="math">\\sqsubseteq</span> .</p>

    <p class="text-gray-300">Algorithm 6 is the modified version of Algorithm 3 proposed in Sect. 7.2.2, where we exploit the partial order  <span class="math">\\sqsubseteq</span>  just defined. To understand the main difference, consider for simplicity the cases |J|=3 and |I|=2. For each J,I, the idea is to re-order (plaintext, ciphertext) pairs with respect the partial order  <span class="math">\\sqsubseteq</span>  just defined. As a result, consider a set of ordered texts for which ciphertexts  <span class="math">c^i, c^{i+1}, ..., c^j</span>  s.t.  <span class="math">c^l \\oplus c^k \\in \\mathcal{M}_J</span>  for each  <span class="math">i \\leq k, l \\leq j</span> . Given the corresponding plaintexts, every pairs of them belong to the same coset of  <span class="math">\\mathcal{D}_I</span> , and so to a particular set  <span class="math">\\mathcal{S}</span> . As a result, given a set of ordered ciphertexts  <span class="math">c^i, c^{i+1}, ..., c^j</span>  as before, it is not necessary to check that the corresponding pairs of plaintexts belongs to the same coset of  <span class="math">\\mathcal{D}_I</span>  or not.</p>

    <p class="text-gray-300">On the other hand, we emphasize that this modified version doesn't improve the total cost of the distinguisher proposed in Sect. 7, but it is useful e.g. for the distinguishers proposed in Sect. 9.1 and in App. C.2.</p>

    <pre><code class="language-text">Data: 2^{32} plaintexts in 1 coset of C_0 (e.g. C_0 \\oplus a) and corresponding ciphertexts
          after 5 rounds
Result: Number of sets S such that two ciphertexts of at least one couple of
            plaintexts belong to the same coset of \\mathcal{M}_J for a certain J with |J|=3
Let A[0,...,N-1] be an array initialized to zero, where N=3\\cdot 2^{15}\\cdot (2^8-1)^2//A[i]
 refers to the i-th set S
for each I \\subseteq \\{0, 1, 2, 3\\} with |I| = 2 do
    for each j from 0 to 3 let J = \\{0, 1, 2, 3\\} \\setminus j (|J| = 3) do | let (p^i, c^i) for i = 0, ..., 2^{32} - 1 be the (plaintexts, ciphertexts) in \\mathcal{C}_0 \\oplus a;
         re-order this set of elements w.r.t. the partial order \\sqsubseteq defined in Def. 11;// \\sqsubseteq
           depends on I and on J
         while i &lt; 2^{32} - 1 do
              while c^j \\oplus c^{j+1} \\in \\mathcal{M}_J and p^j \\oplus p^{j+1} \\in D_I for a certain |I| = 2 (p^j \\text{ and }
               p^{j+1} have two equal generating variables) // necessary condition s.t.
               p^j \\oplus p^{j+1} \\in \\mathcal{S}^{x,y} for x, y \\in \\{0, 1, 2, 3\\} with x \\neq y do
               j \\leftarrow j + 1;
              end
              for each k from i to j do
                   for each l from k+1 to j do
                      A[\\varphi(p^k,p^l)] \\leftarrow 1; //\\varphi(p^k,p^l) defined in (16) returns the index of the set \\mathcal{S}^{x,y} s.t. p^k \\oplus p^l \\in \\mathcal{S}^{x,y}
                  \\mathbf{end}
</code></pre>

    <p class="text-gray-300"><strong>return</strong> n. <strong>Algorithm 6:</strong> This pseudo-code is a modified version of the one proposed in Algorithm 3 and exploits the partial order  <span class="math">\\sqsubseteq</span>  defined in Def. 11. Given (plaintexts, ciphertexts) pairs in the same coset of  <span class="math">C_0</span> , this algorithm counts the number of sets S for which two ciphertext of at least one couple belong in the same coset of  <span class="math">\\mathcal{M}_J</span>  for |J| = 3.</p>

    <p class="text-gray-300">Here we recall a strategy that allows to improve the computational cost of an integral attack on 5-round AES. Such a strategy has been proposed by an anonymous reviewer <span class="math">^{35}</span> .</p>

    <p class="text-gray-300">Integral Attack [DR02] on 5-round AES. It is well known that given  <span class="math">2^{32}</span>  chosen plaintexts with one active diagonal (i.e. a coset of a diagonal space  <span class="math">\\mathcal{D}_I \\oplus a</span> ), then the XOR-sum of the corresponding texts after four encryption is equal 0 independently of the value of the secret key, that is</p>

    <p class="text-gray-300"><span class="math">$\\bigoplus_{p^i \\in \\mathcal{D}_I \\oplus a} R^4(p^i) = 0</span>$</p>

    <p class="text-gray-300">for each  <span class="math">I \\in \\{0, 1, 2, 3\\}</span> .</p>

    <p class="text-gray-300">end</p>

    <p class="text-gray-300">end</p>

    <p class="text-gray-300"> <span class="math">n \\leftarrow \\sum_{i} A[i];</span></p>

    <p class="text-gray-300">Such a property can be used to set up an integral attack on 5-round AES, by guessing - byte per byte - the final key and checking that the XOR-sum is equal to zero one round</p>

    <p class="text-gray-300"> <span class="math">&lt;sup&gt;^{35}&lt;/sup&gt;</span> A similar strategy has also been exploited e.g. in [GR17] in order to set up a &quot;known-key&quot; distinguisher for 12-round AES.</p>

    <pre><code class="language-text">Data: 2^{32} texts p^i \\in \\mathcal{D}_I \\oplus a for i=0,...,2^{32}-1 and for I \\in \\{0,1,2,3\\}, and the corresponding ciphertexts c^i \\equiv R^5(p^i)

Result: One byte of k - e.g. k_{0,0} - s.t. \\bigoplus_i \\text{S-Box}^{-1}(c^i_{0,0} \\oplus k_{0,0}) = 0

Let A[0,...,2^8-1] an array initialized to zero; for i from 0 to 2^{32}-1 do

A[c^i_{0,0}] \\leftarrow (A[c^i_{0,0}]+1) \\text{ mod } 2; // A[x] \\text{ denotes the value stored in the } x\\text{-th address of the array } A\\nend

for k from 0x00 to 0xff do

x \\leftarrow 0;
for i from 0 to 255 do

x \\leftarrow x \\oplus A[i] \\cdot \\text{S-Box}^{-1}(i \\oplus k);
x \\leftarrow 0\\nif x = 0 then

\\text{identify } k \\text{ as candidate for } k_{0,0};\\nend\\nend
</code></pre>

    <p class="text-gray-300">return candidates for  <span class="math">k_{0,0}</span> .</p>

    <p class="text-gray-300"><strong>Algorithm 7:</strong> Integral attack on 5-round AES: working on each byte of the key independently of the others, filter wrong key candidates using zero-sum property. Other bytes of the key can be found in a similar way.</p>

    <p class="text-gray-300">before. In particular, assume the final Mix Columns is omitted, and let  <span class="math">k_{j,l}</span>  be the guessed byte in row j and column l of the final subkey. Due to the previous property, such guessed byte of the key is certainly  <span class="math">wrong\\ if</span></p>

    <p class="text-gray-300">
<span class="math">$\\bigoplus_{p^i \\in \\mathcal{D}_I \\oplus a} \\text{S-Box}^{-1}(c^i_{j,l} \\oplus k_{j,l}) \\neq 0</span>$
(20)</p>

    <p class="text-gray-300">where  <span class="math">c^i \\equiv R^5(p^i)</span>  and  <span class="math">I \\in \\{0,1,2,3\\}</span> . By simple computation, the attack requires  <span class="math">2^{32}</span>  chosen plaintexts and  <span class="math">16 \\cdot 2^8 \\cdot 2^{32} = 2^{44}</span>  S-Box operations, that is approximately  <span class="math">2^{37.36}</span>  5-round encryptions (assuming 20 S-Box  <span class="math">\\equiv</span>  1-round encryption).</p>

    <p class="text-gray-300">Note that the probability that a wrong byte key satisfies the zero-sum property is  <span class="math">2^{-8}</span> . As a result, if a wrong key survives the test, then it can simply filtered using a brute force attack. Finally, if the final MixColumns is not omitted, one can simply repeat the previous attack by swapping the final MixColumns operation and the final subkey (we refer to [DR02] for more details) - remember that the MixColumns operation is linear.</p>

    <p class="text-gray-300">Improved Integral Attack on 5-round AES. Here a way to improve the previous attack is proposed. The crucial point is the following. Working at byte level, note that Eq. (20) is the sum of  <span class="math">2^{32}</span>  bytes. Since each byte can take &quot;only&quot;  <span class="math">2^8</span>  different values, it turns out that many bytes of the form S-Box<sup>-1</sup> <span class="math">(c_{j,l}^i \\oplus k_{j,l})</span>  in (20) are equal. Thus, the total computational cost can be reduced using a precomputation process, as showed in the following.</p>

    <p class="text-gray-300">The pseudo-code of the attack is given in Algorithm 7. Given 16 tables (one for each byte of the state) of size  <span class="math">2^8</span>  bits, for each ciphertext the idea is to record in each hash table the value of the corresponding byte. The crucial point is that in order to compute the XOR-sum (20), we are interested only in the parity of the number of times each value appears. As a result, given a guessed byte of the key, the cost to check if the XOR-sum (20) is zero or not is of  <span class="math">2^8</span>  S-Box operations instead of  <span class="math">2^{32}</span> . It follows that the overall cost is dominated by the cost to prepare the array  <span class="math">A[\\cdot]</span> . It turns out that the attack requires  <span class="math">2^{32}</span>  chosen plaintexts,  <span class="math">2^{32}</span>  memory look-ups, that is approximately  <span class="math">2^{25.4}</span>  5-round encryptions (assuming 20 memory look-ups  <span class="math">\\equiv</span>  1-round encryption) and  <span class="math">16 \\cdot 2^8 = 2^{12}</span>  bits of memory.</p>

`;
---

<BaseLayout title="Mixture Differential Cryptanalysis and Structural Truncated ... (2017/832)">
  <article class="max-w-4xl mx-auto article-prose">
    <nav class="mb-8">
      <a href="/papers" class="text-blue-400 hover:text-blue-300">
        &larr; Back to Papers
      </a>
    </nav>

    <header class="mb-12">
      <h1 class="text-3xl font-bold mb-4"
        set:html={TITLE_HTML} />
      <p class="text-gray-400 mb-2"
        set:html={AUTHORS_HTML} />
      <p class="text-gray-500 text-sm mb-4">
        2017 &middot; eprint 2017/832
      </p>
      <div class="flex gap-4 text-sm">
        <a
          href={EPRINT_URL}
          target="_blank"
          rel="noopener noreferrer"
          class="text-blue-400 hover:text-blue-300"
        >
          Paper (eprint) &rarr;
        </a>
      </div>
      <PaperDisclaimer eprintUrl={EPRINT_URL} />
      <p class="mt-1 text-xs text-gray-600">
        Converted with: {CRAWLER} &middot; {CONVERTED_DATE}
      </p>
    </header>

    <nav id="toc" class="mb-10 p-6 rounded-lg" style="background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.06);">
      <h2 class="text-lg font-bold mb-4">Table of Contents</h2>
      <ol class="space-y-1 text-sm text-gray-300
        list-decimal list-inside">
        <li><a href="#sec-1" class="hover:text-white">Introduction</a></li>
        <li><a href="#sec-2" class="hover:text-white">Preliminary - Description of AES</a></li>
        <li>
          <a href="#sec-3" class="hover:text-white">Subspace Trails</a>
          <ol class="ml-6 mt-1 space-y-1 list-decimal
            list-inside text-gray-400">
            <li><a href="#sec-3.1" class="hover:text-white">Subspace Trails of AES</a></li>
            <li><a href="#sec-3.2" class="hover:text-white">Intersections of Subspaces and Useful Probabilities</a></li>
          </ol>
        </li>
        <li>
          <a href="#sec-5" class="hover:text-white">New 4-round Secret-Key Distinguisher for AES</a>
          <ol class="ml-6 mt-1 space-y-1 list-decimal
            list-inside text-gray-400">
            <li><a href="#sec-5.1" class="hover:text-white">Mixture Differential Distinguisher for 4-round AES</a></li>
            <li><a href="#sec-5.1.1" class="hover:text-white">Proof using the &quot;super-Sbox&quot; Notation</a></li>
            <li><a href="#sec-5.1.2" class="hover:text-white">Data and Computational Cost</a></li>
            <li><a href="#sec-5.1.3" class="hover:text-white">Practical Verification</a></li>
            <li><a href="#sec-5.2" class="hover:text-white">Generic Mixture Differential Distinguishers for 4-round AES</a></li>
            <li><a href="#sec-5.3" class="hover:text-white">Comparison with Other 4-round Secret-Key Distinguishers</a></li>
          </ol>
        </li>
        <li>
          <a href="#sec-6" class="hover:text-white">New Key-Recovery Attack on 5-round AES</a>
          <ol class="ml-6 mt-1 space-y-1 list-decimal
            list-inside text-gray-400">
            <li><a href="#sec-6.1" class="hover:text-white">Data and Computational Costs</a></li>
            <li><a href="#sec-6.2" class="hover:text-white">Practical Verification</a></li>
          </ol>
        </li>
        <li>
          <a href="#sec-7" class="hover:text-white">A new 5-round Secret-Key Distinguisher for AES</a>
          <ol class="ml-6 mt-1 space-y-1 list-decimal
            list-inside text-gray-400">
            <li><a href="#sec-7.1" class="hover:text-white">5-round Probabilistic Mixture Differential Secret-Key Distinguisher</a></li>
            <li><a href="#sec-7.1.1" class="hover:text-white">Details of the 5-round &quot;Probabilistic Mixture Diff.&quot; Distinguisher</a></li>
            <li><a href="#sec-7.1.2" class="hover:text-white">Proof</a></li>
            <li><a href="#sec-7.2" class="hover:text-white">Data and Computational Complexity</a></li>
            <li><a href="#sec-7.2.1" class="hover:text-white">Data Complexity</a></li>
            <li><a href="#sec-7.2.2" class="hover:text-white">Computational Complexity</a></li>
            <li><a href="#sec-7.3" class="hover:text-white">Practical Verification on small scale AES</a></li>
          </ol>
        </li>
        <li><a href="#sec-8" class="hover:text-white">Key-Recovery Attack on 6 rounds of AES-128</a></li>
        <li>
          <a href="#sec-9" class="hover:text-white">Other Secret-Key Distinguishers for 5-round AES</a>
          <ol class="ml-6 mt-1 space-y-1 list-decimal
            list-inside text-gray-400">
            <li><a href="#sec-9.1" class="hover:text-white">Threshold Mixture Differential Secret-Key Distinguisher</a></li>
            <li><a href="#sec-9.1.1" class="hover:text-white">Details and Proof</a></li>
            <li><a href="#sec-9.1.2" class="hover:text-white">Data and Computational Costs</a></li>
            <li><a href="#sec-9.2" class="hover:text-white">Impossible Mixture Differential Secret-Key Distinguisher</a></li>
            <li><a href="#sec-9.2.1" class="hover:text-white">Details and Proof</a></li>
            <li><a href="#sec-9.2.2" class="hover:text-white">Data and Computational Costs</a></li>
          </ol>
        </li>
      </ol>
      <p class="text-xs text-gray-500 mt-4 mb-1 font-semibold">
        Appendices
      </p>
      <ol class="space-y-1 text-sm text-gray-400
        list-[upper-alpha] list-inside">
        <li>
          <a href="#app-a" class="hover:text-white">Proof - Probabilities of Sect. 3.2</a>
          <ol class="ml-6 mt-1 space-y-1 list-decimal
            list-inside text-gray-400">
            <li><a href="#app-a.1" class="hover:text-white">How to Compute the Number of Pairs with n Equal Generating Variables</a></li>
            <li><a href="#app-a.2" class="hover:text-white">Discussion about the Given Approximations</a></li>
          </ol>
        </li>
        <li><a href="#app-b" class="hover:text-white">4-round Secret-Key Distinguisher for AES - Details</a></li>
        <li>
          <a href="#app-c" class="hover:text-white">Variants of the 5-round AES Secret-Key Distinguisher of Sect. 7</a>
          <ol class="ml-6 mt-1 space-y-1 list-decimal
            list-inside text-gray-400">
            <li><a href="#app-c.1" class="hover:text-white">First Variant of the 5-round Distinguisher of Sect. 7</a></li>
            <li><a href="#app-c.1.1" class="hover:text-white">Details of the Distinguisher</a></li>
            <li><a href="#app-c.1.2" class="hover:text-white">Proof</a></li>
            <li><a href="#app-c.1.3" class="hover:text-white">Data and Computational Costs</a></li>
            <li><a href="#app-c.1.4" class="hover:text-white">Practical Verification on small scale AES</a></li>
            <li><a href="#app-c.2" class="hover:text-white">Second Variant of the 5-round Distinguisher of Sect. 7</a></li>
            <li><a href="#app-c.2.1" class="hover:text-white">Details of the Distinguisher</a></li>
            <li><a href="#app-c.2.2" class="hover:text-white">Proof</a></li>
            <li><a href="#app-c.2.3" class="hover:text-white">Data and Computational Costs</a></li>
            <li><a href="#app-c.3" class="hover:text-white">Key-Recovery Attack on 6-round AES of Sect. 8 - Chosen Plaintexts in Cosets of \mathcal&#123;D&#125;_I with |I|=2</a></li>
          </ol>
        </li>
        <li>
          <a href="#app-d" class="hover:text-white">Other Variants of the 5-round AES Secret-Key Distinguisher of Sect. 7</a>
          <ol class="ml-6 mt-1 space-y-1 list-decimal
            list-inside text-gray-400">
            <li><a href="#app-d.1" class="hover:text-white">Variant of the 5-round Distinguisher of Sect. 7</a></li>
            <li><a href="#app-d.1.1" class="hover:text-white">Details of the Used Property</a></li>
            <li><a href="#app-d.1.2" class="hover:text-white">Proof</a></li>
            <li><a href="#app-d.1.3" class="hover:text-white">Data and Computational Costs</a></li>
          </ol>
        </li>
        <li><a href="#app-e" class="hover:text-white">Different Implementation of the 5-round Distinguisher proposed in Sect. 7.2.2</a></li>
        <li><a href="#app-f" class="hover:text-white">Integral Attack on 5-round AES</a></li>
      </ol>
      <p class="text-xs text-gray-500 mt-4 mb-1 font-semibold">
        Additional
      </p>
      <ul class="space-y-1 text-sm text-gray-400
        list-disc list-inside">
        <li><a href="#references" class="hover:text-white">References</a></li>
      </ul>
    </nav>


    <Fragment set:html={CONTENT} />

    <PaperHistory slug="mixture-differential-cryptanalysis-and-structural-truncated-2017" />
  </article>
</BaseLayout>
