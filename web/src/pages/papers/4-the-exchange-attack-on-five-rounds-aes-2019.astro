---
import BaseLayout from '../../layouts/BaseLayout.astro';
import PaperDisclaimer from '../../components/PaperDisclaimer.astro';
import PaperHistory from '../../components/PaperHistory.astro';

const EPRINT_URL = 'https://eprint.iacr.org/2019/652';
const CRAWLER = 'marker';
const CONVERTED_DATE = '2026-02-16';
const TITLE_HTML = 'The Exchange Attack: How to Distinguish Six Rounds of AES with $2^{88.2}$ chosen plaintexts';
const AUTHORS_HTML = 'Navid Ghaedi Bardeh, Sondre R&oslash;njom';

const CONTENT = `    <section id="abstract" class="mb-10">
      <h2 class="text-2xl font-bold">Abstract</h2>
      <p class="text-gray-300">In this paper we present exchange-equivalence attacks which is a new cryptanalytic attack technique suitable for SPN-like block cipher designs. Our new technique results in the first secret-key chosen plaintext distinguisher for 6-round AES. The complexity of the distinguisher is about $2^{88.2}$ in terms of data, memory and computational complexity. The distinguishing attack for AES reduced to six rounds is a straight-forward extension of an exchange attack for 5-round AES that requires $2^{30}$ in terms of chosen plaintexts and computation. This is also a new record for AES reduced to five rounds. The main result of this paper is that AES up to at least six rounds is biased when restricted to exchange-invariant sets of plaintexts.</p>
      <p class="text-gray-300"><strong>Keywords:</strong> SPN &middot; AES &middot; Exchange Equivalence Attacks &middot; Exchange Invariant Sets &middot; Exchange Equivalence Class &middot; Secret-Key model &middot; Differential Cryptanalysis</p>
    </section>

    <section id="sec-1" class="mb-10">
      <h2 class="text-2xl font-bold">1 Introduction</h2>

    <p class="text-gray-300">Block ciphers are typically designed by iterating an efficiently computable round function many times in the hope that the resulting composition behaves like a randomly drawn permutation. The designer is typically constrained by various practical criterion, e.g. security target, implementation boundaries, and specialized applications, that might lead the designer to introduce symmetries and structures into the round function as a compromise between efficiency and security. In the compromise, a round function is iterated enough times to make sure that any symmetries and structural properties that might exist in the round function vanish. Thus, a round function is typically designed to increasingly decorrelate with structure and symmetries after several rounds. However, what actually constitutes structure is an open question which requires continuous investigation as long as using randomly drawn codebooks is out of reach.</p>

    <p class="text-gray-300">Low data- and computational-complexity distinguishers and key-recovery attacks on round-reduced block ciphers have recently gained renewed interest in the literature. There are several reasons for this. In one direction cryptanalysis of block ciphers has focused on maximizing the number of rounds that can be broken without exhausting the full codebook and key space. This often leads to attacks marginally close to that of pure brute-force. These are attacks that typically have been improved over time based on many years of cryptanalysis. The most successful attacks often become de-facto standard methods of cryptanalysis for a particular block cipher and might discourage anyone from pursuing new directions in cryptanalysis that do not reach the same number of rounds. This in itself might hinder new breakthroughs, thus it can be important to investigate new promising ideas that might not have reached its full potential yet. New methods of cryptanalysis that break or distinguish fewer rounds faster but with lower complexity than established cryptanalysis is therefore interesting in this process. Many constructions employ reduced round AES as part of their design. On the other hand, reduced versions of AES have nice and well-studied properties that can be favorable as components of larger designs (see for instance Simpira[10]).</p>

    <p class="text-gray-300">The security of Rijndael-type block cipher designs is believed to be a wellstudied topic and has been in the focus of a large group of cryptanalysts during the last 20 years (e.g. see [13, 1, 12, 5, 3, 2, 6, 8]). Thus, it is rather surprising that new and quite fundamental results continuously appear for 2-4 rounds of AES that enables completely new types of more efficient attacks for an increasing number of rounds of AES. At Crypto 2016, the authors of [15] presented the very first secret-key 5-round distinguisher for AES. Secret-key (or key-independent) means that the attack does not care about the particular round keys (e.g. in contrast to related-key attacks). They extend a 4-round integral property to 5 rounds by exploiting properties of the AES MixColumn matrix. Although their distinguisher requires the whole codebook, it spawned a series of new fundamental results for AES. It was later improved to 298.<sup>2</sup> chosen plaintexts with 2 <sup>107</sup> computations by extending a 4-round impossible differential property to a 5-round property. Then, at Eurocrypt 2017, the authors of [9] proposed the first 5-round secret-key chosen plaintext distinguisher which requires 2<sup>32</sup> chosen texts with a computational cost of 235.<sup>6</sup> look-ups into memory of size 2<sup>36</sup> bytes. They showed that by encrypting cosets of certain subspaces of the plaintext space the number of times the difference of ciphertext pairs lie in a particular subspace of the state space always is a multiple of 8.</p>

    <p class="text-gray-300">Later, at Asiacrypt 2017, the authors of [14] presented new fundamental properties for Rijndael-type block cipher designs leading to new types of 3- to 6-round secret-key distinguishers for AES that beats all previous records. The authors introduced a new deterministic 4-round property in AES, which states that sets of pairs of plaintexts that are equivalent by exchange of any subset of diagonals encrypts to a set of pairs of ciphertexts after four rounds that all have a difference of zero in exactly the same columns before the final linear layer. This was further explored in [7] under the name &quot;mixture cryptanalysis&quot;.</p>

      <h3 id="sec-1.1" class="text-xl font-semibold mt-8">1.1 Our Contribution</h3>

    <p class="text-gray-300">The first 5-round secret-key chosen-plaintext distinguisher for AES was introduced at Crypto 2016, almost 20 years after Rinjdael was first proposed as a candidate in the AES-competition, and required the whole codebook. In this paper, only three years later, we introduce the first 6-round secret-key distinguisher for AES that has complexity of about  <span class="math">2^{88.2}</span>  computations and ciphertexts. This is a giant leap for cryptanalysis of AES. Our distinguishers are based on simple techniques which are easy to verify theoretically and in practice. Moreover, we prove that AES up to at least 6 rounds is biased on exchange-invariant sets. The 5-round distinguisher has been practically verified on a scaled down version in C/C++ on a standard laptop<sup>1</sup>.</p>

      <h3 id="sec-1.2" class="text-xl font-semibold mt-8">1.2 Overview of This Paper and Main Results</h3>

    <p class="text-gray-300">In Section 2 we briefly describe results and notation that makes up the machinery for the rest of this paper. In particular, we describe what we call exchange operators, exchange-invariant sets and exchange-equivalence classes, and their relations to AES. In Section 3, we prove that five full rounds of AES is biased on exchange-invariant sets and in Section 4 and Section 5 we turn this result into simple distinguishers for AES reduced to five and six rounds.</p>

    <p class="text-gray-300">The currently best secret-key distinguishers for 5- and 6-round AES are given in Table 1. We adopt that data complexity is measured in a minimum number of chosen plaintexts/ciphertexts CP/CC or adaptively chosen plaintexts/ciphertexts ACP/ACC. Time complexity is measured in equivalent number of AES encryptions (E), memory accesses (M) and/or XOR operations (XOR) - adopting that  <span class="math">20M \\approx 1</span>  round of AES.</p>

    <div class="overflow-x-auto my-4">
      <table class="min-w-full text-sm text-gray-300">
        <thead>
            <th class="px-3 py-2 border-b border-gray-600 font-semibold text-left">Table 1: Secret-Key Distinguishers for ALS</th>
            <th class="px-3 py-2 border-b border-gray-600 font-semibold text-left"></th>
            <th class="px-3 py-2 border-b border-gray-600 font-semibold text-left"></th>
            <th class="px-3 py-2 border-b border-gray-600 font-semibold text-left"></th>
            <th class="px-3 py-2 border-b border-gray-600 font-semibold text-left"></th>
        </thead>
        <tbody>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">Property</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">Rounds</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left"></td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">Cost</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">Ref.</td>
          </tr>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">Impossible Diff</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">5</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left"></td>
            <td class="px-3 py-2 border-b border-gray-700 text-left"><span class="math">2^{129.6}</span> XORs</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">[15]</td>
          </tr>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">Multiple-8</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">5</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left"><span class="math">2^{32}</span> CP</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left"><span class="math">2^{35.6} M</span></td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">[9]</td>
          </tr>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">Exchange Attack</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left"></td>
            <td class="px-3 py-2 border-b border-gray-700 text-left"><span class="math">2^{30} \\text{ CP}</span></td>
            <td class="px-3 py-2 border-b border-gray-700 text-left"><span class="math">2^{30}{\\rm E}</span></td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">Sect. 4</td>
          </tr>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">Zero difference</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">6</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left"><span class="math">2^{122.8} \\text{ ACC}</span></td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">2 11010</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">[14]</td>
          </tr>
          <tr>
            <td class="px-3 py-2 border-b border-gray-700 text-left">Exchange Attack</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">6</td>
            <td class="px-3 py-2 border-b border-gray-700 text-left"><span class="math">2^{88.2} \\text{ CP}</span></td>
            <td class="px-3 py-2 border-b border-gray-700 text-left"><span class="math">2^{88.2}E</span></td>
            <td class="px-3 py-2 border-b border-gray-700 text-left">Sect. 5</td>
          </tr>
        </tbody>
      </table>
    </div>

    <p class="text-gray-300">Table 1: Secret-Key Distinguishers for AES</p>

    </section>

    <section id="sec-2" class="mb-10">
      <h2 class="text-2xl font-bold">2 Preliminaries</h2>

    <p class="text-gray-300">The Advanced Encryption Standard (AES)[4] is the most widely adopted block cipher in the world today and is a critical component in protecting information in both commercial and high-assurance communication. The AES internal state is typically represented by a 4 by 4 matrix in  <span class="math">\\mathbb{F}_{2^8}^{4\\times4}</span> . The matrix representation is for the most part purely representational as the actual properties of the matrix (e.g. rank, order etc.) are not actually exploited for anything. One full round</p>

    <p class="text-gray-300"><sup>&amp;</sup>lt;sup&gt;1</sup> https://github.com/Symmetric-crypto/ExchangeAttack.git</p>

    <p class="text-gray-300">of AES consists of SubBytes (SB), ShiftRows (SR), MixColumns (MC) and AddKey (AK). The SB-layer applies a fixed permutation over  <span class="math">\\mathbb{F}_{2^8}</span>  independently to each byte of the state, the SR-layer cyclically shifts the <em>i</em>-th row by <em>i</em> positions, while the MC-layer applies a fixed linear transformation to each column. The key addition adds a secret round-dependent value to the state. One full round is composed as  <span class="math">R = AK \\circ MC \\circ SR \\circ SB</span> . We follow standard convention and simplify notation by writing  <span class="math">R^t(x)</span>  to mean t rounds of AES where each round key is fixed to some random value.</p>

    <p class="text-gray-300">In this section we recall some basic results and introduce necessary notation. We begin by defining what we call <em>column exchange differences</em>.</p>

    <p class="text-gray-300"><strong>Definition 1.</strong> For a vector  <span class="math">v \\in \\mathbb{F}_2^4</span>  and a pair of states  <span class="math">\\alpha, \\beta \\in \\mathbb{F}_{2^8}^{4 \\times 4}</span>  define the column exchange difference  <span class="math">\\Delta_v^{\\alpha,\\beta} \\in \\mathbb{F}_{2^8}^{4 \\times 4}</span>  where the i-th column is defined by</p>

    <p class="text-gray-300"><span class="math">$(\\Delta_v^{\\alpha,\\beta})_i = (\\alpha_i \\oplus \\beta_i)v_i</span>$</p>

    <p class="text-gray-300">where  <span class="math">\\alpha_i</span>  and  <span class="math">\\beta_i</span>  are the i-th columns of  <span class="math">\\alpha</span>  and  <span class="math">\\beta</span> .</p>

    <p class="text-gray-300">A pair of states define a set of  <span class="math">2^{wt_c(\\alpha \\oplus \\beta)}</span>  possible column exchange differences where  <span class="math">wt_c(x)</span>  denotes the number of non-zero columns of x. We can now define three related operators that exchange diagonal, column and mixed values between a pair of AES states.</p>

    <p class="text-gray-300"><strong>Definition 2</strong> (<em>Column exchange</em>). For a vector  <span class="math">v \\in \\mathbb{F}_2^4</span>  and a pair of states  <span class="math">\\alpha, \\beta \\in \\mathbb{F}_{2^8}^{4 \\times 4}</span> , define column exchange according to v as</p>

    <p class="text-gray-300"><span class="math">$\\rho_c^v(\\alpha,\\beta) = \\alpha \\oplus \\Delta_v^{\\alpha,\\beta}.</span>$</p>

    <p class="text-gray-300">It is easy to see that the pair of states  <span class="math">(\\rho_c^v(\\alpha, \\beta), \\rho_c^v(\\beta, \\alpha)) = (\\alpha \\oplus \\Delta_v^{\\alpha, \\beta}, \\beta \\oplus \\Delta_v^{\\alpha, \\beta})</span>  are formed by exchanging individual columns between  <span class="math">\\alpha</span>  and  <span class="math">\\beta</span>  according to the binary coefficients of v. Thus, for any v it is easy to see that</p>

    <p class="text-gray-300"><span class="math">$\\alpha \\oplus \\beta = \\rho_c^v(\\alpha, \\beta) \\oplus \\rho_c^v(\\beta, \\alpha).</span>$</p>

    <p class="text-gray-300">From the definition of column exchange, we may define diagonal exchange as follows.</p>

    <p class="text-gray-300"><strong>Definition 3 (Diagonal exchange).</strong> For a vector  <span class="math">v \\in \\mathbb{F}_2^4</span>  and a pair of states  <span class="math">\\alpha, \\beta \\in \\mathbb{F}_{2^8}^{4 \\times 4}</span> , define diagonal exchange according to v as</p>

    <p class="text-gray-300"><span class="math">$\\rho_d^v(\\alpha,\\beta) = \\alpha \\oplus SR^{-1}(\\Delta_v^{SR(\\alpha),SR(\\beta)}).</span>$</p>

    <p class="text-gray-300">The new pair  <span class="math">(\\rho_d^v(\\alpha, \\beta), \\rho_d^v(\\beta, \\alpha))</span>  is formed by exchanging individual diagonals between  <span class="math">\\alpha</span>  and  <span class="math">\\beta</span>  according to the binary coefficients of v. The relationship between exchange of diagonals and exchange of columns is intuitively straightforward.</p>

    <p class="text-gray-300"><strong>Lemma 1.</strong> From the definition of  <span class="math">\\rho_d^v</span>  and  <span class="math">\\rho_c^v</span>  it follows that</p>

    <p class="text-gray-300"><span class="math">$R(\\rho_d^v(\\alpha, \\beta)) = \\rho_c^v(R(\\alpha), R(\\beta)).</span>$</p>

    <p class="text-gray-300"><em>Proof.</em> By definition of diagonal exchange, it follows that</p>

    <p class="text-gray-300"><span class="math">$MC \\circ SR(\\rho_d^v(\\alpha,\\beta)) = \\rho_c^v(MC \\circ SR(\\alpha), MC \\circ SR(\\beta))</span>$</p>

    <p class="text-gray-300">and since both  <span class="math">\\rho_d</span>  and  <span class="math">\\rho_c</span>  commute with SB, it follows that</p>

    <p class="text-gray-300"><span class="math">$R(\\rho_d^v(\\alpha,\\beta)) = \\rho_c^v(R(\\alpha),R(\\beta)).\\square</span>$</p>

    <p class="text-gray-300">The last exchange operation involves exchanging more general looking subspace components belonging to the subspaces formed by applying SR and MC to single columns.</p>

    <p class="text-gray-300"><strong>Definition 4</strong> (<em>Mixed exchange</em>). For a vector  <span class="math">v \\in \\mathbb{F}_2^4</span>  and a pair of states  <span class="math">\\alpha, \\beta \\in \\mathbb{F}_{2^8}^{4 \\times 4}</span>  define mixed exchange according to v as</p>

    <p class="text-gray-300"><span class="math">$\\rho_m^v(\\alpha,\\beta) = a \\oplus L(\\Delta_v^{L^{-1}(\\alpha),L^{-1}(\\beta)})</span>$</p>

    <p class="text-gray-300">where  <span class="math">L = MC \\circ SR</span> .</p>

    <p class="text-gray-300"><strong>Lemma 2.</strong> From the definition of  <span class="math">\\rho_c^v</span>  and  <span class="math">\\rho_m^v</span>  it follows that</p>

    <p class="text-gray-300"><span class="math">$R(\\rho_c^v(\\alpha, \\beta)) = \\rho_m^v(R(\\alpha), R(\\beta)).</span>$</p>

    <p class="text-gray-300"><em>Proof.</em> By definition of  <span class="math">\\rho_m^v</span> , let  <span class="math">L = MC \\circ SR</span> , we have that</p>

    <p class="text-gray-300"><span class="math">$\\begin{split} \\rho_m^v(R(\\alpha),R(\\beta)) = &amp; R(a) \\oplus L(\\Delta_v^{L^{-1}(R(\\alpha)),L^{-1}(R(\\beta))}) \\\\ = &amp; L \\circ (SB(\\alpha) \\oplus \\Delta_v^{SB(\\alpha),SB(\\beta)}) \\\\ = &amp; L \\circ SB(\\alpha \\oplus \\Delta_v^{\\alpha,\\beta}) \\\\ = &amp; R(\\rho_v^c(\\alpha,\\beta)). \\Box \\end{split}</span>$</p>

    <p class="text-gray-300">Although the following trivial two-round property in AES is straight-forward, we add it as a simple theorem to summarise the exchange operators.</p>

    <p class="text-gray-300"><strong>Theorem 1.</strong> For two random states  <span class="math">\\alpha, \\beta</span>  and some non-zero vector  <span class="math">v \\in \\mathbb{F}_2^4</span> , we have that</p>

    <p class="text-gray-300"><span class="math">$R^2(\\rho_d^v(\\alpha,\\beta)) = \\rho_m^v(R^2(\\alpha),R^2(\\beta)).</span>$</p>

    <p class="text-gray-300"><em>Proof.</em> Follows by combining Lemma 1 and Lemma 2.</p>

    <p class="text-gray-300">The exchange operators are related to a type of sets called exchange-invariant sets.</p>

    <p class="text-gray-300"><strong>Definition 5.</strong> A set  <span class="math">A \\subset \\mathbb{F}_{2^8}^{4 \\times 4}</span>  is called exchange-invariant if it satisfies</p>

    <p class="text-gray-300"><span class="math">$A=\\{\\rho^v(a,b)\\,|\\,a,b\\in A,\\,v\\in\\mathbb{F}_2^4\\}</span>$</p>

    <p class="text-gray-300">where  <span class="math">\\rho</span>  is either of the three exchange operators.</p>

    <p class="text-gray-300">Diagonal exchange-invariant sets have the following form. Let  <span class="math">A=A_0\\oplus A_1\\oplus A_2\\oplus A_3</span>  where  <span class="math">A_i</span>  corresponds to a subset of  <span class="math">\\mathbb{F}_{2^8}^{4\\times 4}</span>  of matrix states where only the <em>i</em>-th diagonal is non-zero. It then follows from the definition of the diagonal exchange operator that</p>

    <p class="text-gray-300"><span class="math">$A = \\{ \\rho_d^v(a, b) \\mid a, b \\in A, v \\in \\mathbb{F}_2^4 \\}.</span>$</p>

    <p class="text-gray-300">Similarly, we have that a column exchange-invariant set B has the form</p>

    <p class="text-gray-300"><span class="math">$B = SR(A)</span>$</p>

    <p class="text-gray-300"><span class="math">$= SR(A_0) \\oplus SR(A_1) \\oplus SR(A_2) \\oplus SR(A_3)</span>$</p>

    <p class="text-gray-300"><span class="math">$= B_0 \\oplus B_1 \\oplus B_2 \\oplus B_3</span>$</p>

    <p class="text-gray-300">and similarly, a mixed exchange-invariant set has the form</p>

    <p class="text-gray-300"><span class="math">$C = SR \\circ MC(B)</span>$</p>

    <p class="text-gray-300">=  <span class="math">SR \\circ MC(B_0) \\oplus SR \\circ MC(B_1) \\oplus SR \\circ MC(B_2) \\oplus SR \\circ MC(B_3)</span>
=  <span class="math">C_0 \\oplus C_1 \\oplus C_2 \\oplus C_3</span> .</p>

    <p class="text-gray-300">Then from the definition of exchange-invariant sets and the definition of the exchange operator, it follows that two rounds of AES maps a diagonal exchange-invariant set  <span class="math">A = A_0 \\oplus A_1 \\oplus A_2 \\oplus A_3</span>  to a mixed exchange-invariant set  <span class="math">C = C_0 \\oplus C_1 \\oplus C_2 \\oplus C_3</span>  where  <span class="math">|C_i| = |A_i|</span> . The adversary may predict the exact size of each set  <span class="math">C_i</span>  (since they are equal to the size of  <span class="math">A_i</span> 's), but he may even predict new plaintext/ciphertext pairs over two rounds. For instance, let  <span class="math">A = A_0 \\oplus A_1</span>  with  <span class="math">A_0 = \\{a_0, a_1\\}</span>  and  <span class="math">A_1 = \\{b_0, b_1\\}</span>  (i.e. |A| = 4). Then the adversary may encrypt two out of four plaintexts from the set A, say  <span class="math">a_0 \\oplus b_0</span>  and  <span class="math">a_1 \\oplus b_1</span> , for two rounds to a pair of ciphertexts  <span class="math">c^0</span>  and  <span class="math">c^1</span>  that provides him with a minimal set of generators (relative to the mixed exchange operator) which allows him to predict the remaining ciphertexts corresponding to the remaining two plaintexts in A, i.e.</p>

    <p class="text-gray-300"><span class="math">$C = \\{ \\rho_m^v(c^0, c^1) \\, | \\, v \\in \\mathbb{F}_2^4 \\}.</span>$</p>

    <p class="text-gray-300">For a state  <span class="math">s \\in \\mathbb{F}_{2^8}^{4 \\times 4}</span> , define  <span class="math">L^{-1}(s) = SR^{-1} \\circ MC^{-1}(s)</span>  and let  <span class="math">\\nu(s)</span>  denote the binary indicator vector which is 1 in position i if the i-th column of  <span class="math">L^{-1}(s)</span>  is non-zero and 0 otherwise. We use this notation to simplify the results and to avoid working with more complicated state spaces. Thus,  <span class="math">\\nu(s)</span>  simply indicates the non-zero columns of the state before the last linear layer. For a subset  <span class="math">I \\subset \\{0,1,2,3\\}</span> , we write  <span class="math">v^I \\in \\mathbb{F}_2^4</span>  to mean the indicator vector which has value  <span class="math">v^I_i = 1</span>  if  <span class="math">i \\in I</span>  and 0 otherwise.</p>

    <p class="text-gray-300"><strong>Definition 6.</strong> Let  <span class="math">\\alpha, \\beta</span>  be a pair of states that are different in diagonals indicated by  <span class="math">H \\subset \\{0,1,2,3\\}</span>  and let  <span class="math">H^* \\subset H</span>  denote the set formed by removing one element from H. Then we define the exchange-equivalence class relative to  <span class="math">(\\alpha, \\beta)</span>  as</p>

    <p class="text-gray-300"><span class="math">$S_{\\alpha,\\beta} = \\{ (\\rho_d^{v^I}(\\alpha,\\beta), \\rho_d^{v^I}(\\beta,\\alpha)) \\mid I \\subseteq H^*. \\}</span>$</p>

    <p class="text-gray-300">All pairs in  <span class="math">S_{\\alpha,\\beta}</span>  are exchange-equivalent to each other. Since  <span class="math">2^{t-1}</span>  of the  <span class="math">2^t</span>  possible exchange-equivalent pairs are unique (e.g.  <span class="math">\\rho_d^{v^I+(1,1,1,1)}(\\alpha,\\beta)=\\rho_d^{v^I}(\\beta,\\alpha)</span>  when |H|=4), we fix one index in H in all pairs (i.e. we do not exchange it) and call it  <span class="math">H^*</span> .</p>

    <p class="text-gray-300"><strong>Theorem 2.</strong> Let  <span class="math">A = A_0 \\oplus A_1 \\oplus A_2 \\oplus A_3</span>  be a diagonal exchange-invariant set and assume  <span class="math">|A_i| = m_i</span>  such that  <span class="math">|A_i| = m_0 \\cdot m_1 \\cdot m_2 \\cdot m_3</span> . Then there are exactly</p>

    <p class="text-gray-300"><span class="math">$L_t(m_0, m_1, m_2, m_3) = \\sum_{\\substack{I \\subset \\{0, 1, 2, 3\\} \\\\ wt(I) = t}} \\prod_{i \\in I} {m_i \\choose 2} \\prod_{j \\in \\{0, 1, 2, 3\\} \\setminus I} m_j</span>$</p>

    <p class="text-gray-300">representative pairs  <span class="math">\\alpha, \\beta \\in A</span>  which are different in exactly t diagonals and where each define a unique exchange-equivalence class  <span class="math">S_{\\alpha,\\beta}</span>  of size  <span class="math">2^{t-1}</span> . It follows that</p>

    <p class="text-gray-300"><span class="math">$\\sum_{t=1}^{4} L_t(m_0, m_1, m_2, m_3) 2^{t-1} = \\begin{pmatrix} \\prod_{i=0}^{3} m_i \\\\ 2 \\end{pmatrix}</span>$</p>

    <p class="text-gray-300">is the total number of pairs in A and</p>

    <p class="text-gray-300"><span class="math">$\\sum_{t=1}^{4} L_t(m_0, m_1, m_2, m_3)</span>$</p>

    <p class="text-gray-300">is the number of distinct exchange-equivalence classes in A.</p>

    <p class="text-gray-300"><em>Proof.</em> The number of pairs in A that are different in t diagonals I and equal in the remaining (4-t) diagonals J, is given by  <span class="math">\\prod_{i\\in I}\\binom{m_i}{2}\\prod_{j\\in J}m_j</span> . Each such combination corresponds to one unique exchange-equivalence class  <span class="math">S_{a,b}</span>  of size  <span class="math">2^{t-1}</span> . By inspecting the terms in the sums over the  <span class="math">L_t</span> , it can also easily be seen that it is equivalent to  <span class="math">\\binom{m_0 \\cdot m_1 \\cdot m_2 \\cdot m_3}{2}</span> .</p>

    <p class="text-gray-300">Thus, the space of  <span class="math">\\binom{|A|}{2}</span>  pairs can be grouped into  <span class="math">\\sum_{t=1}^{4} L_t(m_0, m_1, m_2, m_3)</span>  exchange-equivalence classes, which provides us with a fine grained view of the exchange-equivalence structure of the sets.</p>

    <p class="text-gray-300">We may write a pair in terms of their exchange indicators v, e.g.  <span class="math">a_v = (\\rho_d^v(\\alpha,\\beta),\\rho_d^v(\\beta,\\alpha))</span>  where v is drawn from a (t-1)-dimensional vector space (to ensure that we generate only unique pairs) defined by fixing one of the active diagonals in all exchanged pairs. Taking the  <span class="math">\\binom{2^{t-1}}{2}</span>  combinations of all possible pairs  <span class="math">a_v, a_u</span>  can be viewed as combining (t-1)-dimensional vectors u and v. We are interested in determining the number of combinations of pairs from a set  <span class="math">S_{\\alpha,\\beta}</span>  in which the first pair can be derived from the other by exchanging exactly t diagonals. Thus we will need the following.</p>

    <p class="text-gray-300"><strong>Lemma 3.</strong> The number of distinct pairs of vectors in  <span class="math">\\mathbb{F}_2^n</span>  whose difference has Hamming weight t, is given by</p>

    <p class="text-gray-300"><span class="math">$c(n,t) = \\binom{n}{t} 2^{n-1}.</span>$</p>

    <p class="text-gray-300"><em>Proof.</em> There are  <span class="math">\\binom{n}{t}</span>  vectors of weight t. For each such vector, we need to identify the unique pairs that sum to this vector. For the t positions where the vector is 1, the two vectors can be set to  <span class="math">2^{t-1}</span>  unique combinations such that those positions sum one. The remaining positions in the two vectors must be identical, thus there are  <span class="math">2^{n-t}</span>  choices for this part. The proof follows.</p>

    <p class="text-gray-300">We can generate  <span class="math">\\binom{2^{t-1}}{2}</span>  unique combinations of pairs  <span class="math">(a_v, a_u)</span>  from  <span class="math">S_{a,b}</span>  where c(t-1,j) counts the number of combinations of pairs  <span class="math">(a_u, a_v)</span>  in  <span class="math">S_{a,b}</span>  which are exchange-equivalent if one pair can be obtained from the other by exchanging exactly j diagonals. In other words, c(t-1,j) of the combinations of pairs in  <span class="math">S_t(\\alpha,\\beta)</span>  are equivalent if exactly j diagonals are exchanged between them. Moreover, it follows that</p>

    <p class="text-gray-300"><span class="math">$\\sum_{j=1}^{t-1} c(t-1,j) = \\sum_{i=1}^{t-1} {t-1 \\choose j} 2^{t-2}</span>$</p>

    <p class="text-gray-300"><span class="math">$= 2^{t-2} \\cdot (2^{t-1} - 1)</span>$</p>

    <p class="text-gray-300"><span class="math">$= \\frac{2^{t-1} \\cdot (2^{t-1} - 1)}{2}</span>$</p>

    <p class="text-gray-300"><span class="math">$= {2^{t-1} \\choose 2}.</span>$</p>

    <p class="text-gray-300">We will need the following modified theorem from [14], which states an exchange-difference relation over 4 rounds of AES. Let  <span class="math">\\mathbb{R}^4</span>  denotes 4 full rounds of AES with randomly fixed round keys. Then Theorem 1 of [14] is equal to the following (slightly re-formulated) theorem.</p>

    <p class="text-gray-300"><strong>Theorem 3 (4-round exchange-difference relation).</strong> Let  <span class="math">\\alpha, \\beta \\in \\mathbb{F}_{2^8}^{4 \\times 4}</span>  and  <span class="math">\\alpha&#x27; = \\rho_d^v(\\alpha, \\beta), \\beta&#x27; = \\rho_d^v(\\beta, \\alpha)</span>  for any  <span class="math">v \\in \\mathbb{F}_2^4</span> , then</p>

    <p class="text-gray-300"><span class="math">$\\nu(R^4(\\alpha) \\oplus R^4(\\beta)) = \\nu(R^4(\\alpha&#x27;) \\oplus R^4(\\beta&#x27;)).</span>$</p>

    <p class="text-gray-300">In other words, the pattern of non-zero and zero columns in the difference  <span class="math">L^{-1}(R^4(\\alpha) \\oplus R^4(\\beta))</span>  is preserved by diagonal exchange of plaintext pairs  <span class="math">\\alpha</span>  and  <span class="math">\\beta</span> , i.e. on exchange-equivalence classes  <span class="math">S_{\\alpha,\\beta}</span> . Figure 1 depicts this relation for the case when the exchanged pair of plaintexts is formed by exchanging the first diagonal and the first pair is zero in the last column before the last linear layer. If we let  <span class="math">\\operatorname{wt}(x)</span>  denote the ordinary Hamming weight of a binary vector, then one last property of AES will be important in this paper.</p>

    <p class="text-gray-300"><strong>Theorem 4.</strong> Assume a pair of states  <span class="math">\\alpha</span>  and  <span class="math">\\beta</span>  with  <span class="math">\\operatorname{wt}(\\nu(\\alpha \\oplus \\beta)) = w_1</span> . Then</p>

    <p class="text-gray-300"><span class="math">$P(\\text{wt}(\\nu(R(\\alpha) \\oplus R(\\beta))) = w_2) = {4 \\choose 4 - w_2} (2^{-8})^{w_1(4 - w_2)}.</span>$</p>

    <p class="text-gray-300"><em>Proof.</em> If  <span class="math">SR^{-1} \\circ MC^{-1}(\\alpha) \\oplus SR^{-1} \\circ MC^{-1}(\\beta)</span>  has  <span class="math">w_1</span>  active columns, then each column of  <span class="math">\\alpha \\oplus \\beta</span>  can be written as a linear function of  <span class="math">w_1</span>  independent bytes. E.g.</p>

    <p class="text-gray-300">    <img src="_page_8_Figure_2.jpeg" alt="" class="my-4 max-w-full" />
</p>

    <p class="text-gray-300">Fig. 1: 4-round exchange trail.</p>

    <p class="text-gray-300">the probability that one column is zero, is thus exactly  <span class="math">(2^8)^{-w_1}</span> . Moreover, the probability that exactly  <span class="math">w_2</span>  of the columns are non-zero (i.e.  <span class="math">4-w_2</span>  of the columns are zero) is thus exactly  <span class="math">\\binom{4}{4-w_2}(2^8)^{-w_1(4-w_2)}</span> . Since the s-box layer preserves zero differences in bytes (and thus columns), it follows that  <span class="math">\\nu(R(\\alpha) \\oplus R(\\beta))</span>  has the desired probability.</p>

      <h3 id="sec-2.1" class="text-xl font-semibold mt-8">2.1 Collision and Multicollision in a Set</h3>

    <p class="text-gray-300">The expected number of collision and multicollision in a set are computed in [11]. Suppose m objects taken uniformly at random from a given set (with replacement), of size N. Then by using a heuristic method, the expected number of collision is:</p>

    <p class="text-gray-300"><span class="math">$\\frac{m \\cdot (m-1)}{2N}</span>$</p>

    <p class="text-gray-300">assuming independence between pairs of objects. In general, the expected number of collisions in two subsets, of cardinality  <span class="math">m_0</span>  and  <span class="math">m_1</span> , which obtained by drawing at random without replacement from a large set of size N is:</p>

    <p class="text-gray-300"><span class="math">$\\frac{m_0 \\cdot m_1}{N}</span>$</p>

    <p class="text-gray-300">Multicollision can be considered in a set as have l different elements with the same value or in l different sets and search for an element common to all. Using the same heuristic method, the expected number of multicollisions in a subset of size m drawn from a set of size N is:</p>

    <p class="text-gray-300"><span class="math">$s(m, N, l) = \\frac{\\prod_{i=1}^{l} m + 1 - i}{l! N^{l-1}}.</span>$
(1)</p>

    </section>

    <section id="sec-3" class="mb-10">
      <h2 class="text-2xl font-bold">3 When Column Exchange Equals Diagonal Exchange</h2>

    <p class="text-gray-300">In the previous section we showed that exchanging diagonals between plaintexts is the same as exchanging column values after one round. In this section we describe the intersection of column exchange and diagonal exchange, i.e. the probabilistic case when exchange of some diagonals between a pair of plaintexts is equal to exchange of (possibly some other) diagonals after one round. We then</p>

    <p class="text-gray-300">combine this with Theorem 3 to form a probabilistic version of Theorem 3 that instructs us how to construct a chosen-plaintext distinguisher for five rounds of AES. For this we will need to count the number of bytes that are simultaneously active in both a fixed set of diagonals and a fixed set of columns. Thus, we define sets of indices related to diagonals and columns.</p>

    <p class="text-gray-300"><strong>Definition 7.</strong> For a set  <span class="math">I \\subset \\{0,1,2,3\\}</span> , let  <span class="math">D_I</span>  denote the set of indices  <span class="math">D_I = \\{(k,k+i) \\mod 4 \\mid 0 \\le k &lt; 4, i \\in I\\}</span>  where  <span class="math">(i,j) \\in D_I</span>  if the byte at index (i,j) is activated by any of the diagonals indicated by I.</p>

    <p class="text-gray-300"><strong>Definition 8.</strong> For a  <span class="math">J \\subset \\{0,1,2,3\\}</span> , let  <span class="math">C_J = \\{(k,i) | 0 \\le k &lt; 4, i \\in J\\}</span>  denote the set of indices (i,j), where the byte at position (i,j) is activated by any of the columns indicated by J.</p>

    <p class="text-gray-300">It is easy to see that the number of bytes that are simultaneously in a set of diagonals I and set of columns J is equal to  <span class="math">|D_I \\cap C_J| = |I| \\cdot |J|</span> . Thus, it follows that  <span class="math">|D_I \\cup C_J| = 4(|I| + |J|) - |I| \\cdot |J|</span>  bytes are activated in total by the diagonals I and by the columns J.</p>

    <p class="text-gray-300">Assume we have a pair of plaintexts  <span class="math">(p^0, p^1)</span>  that we encrypt one round to a pair of ciphertexts  <span class="math">(c^0, c^1)</span> . Then assume that we make a new pair of plaintexts</p>

    <p class="text-gray-300"><span class="math">$(p&#x27;^0,p&#x27;^1)=(\\rho_d^{(1000)}(p^0,p^1),\\rho_d^{(1000)}(p^1,p^0)),</span>$</p>

    <p class="text-gray-300">by exchanging the first diagonal such that the new pair of ciphertexts satisfy</p>

    <p class="text-gray-300"><span class="math">$\\begin{split} (R(p&#x27;^0), R(p&#x27;^1)) = &amp; (\\rho_c^{(1000)}(c^0, c^1), \\rho_c^{(1000)}(c^1, c^0)) \\\\ = &amp; (c&#x27;^0, c&#x27;^1). \\end{split}</span>$</p>

    <p class="text-gray-300">We have a new pair of ciphertexts  <span class="math">(c&#x27;^0, c&#x27;^1)</span>  formed by exchanging the first column between  <span class="math">c^0</span>  and  <span class="math">c^1</span> . Now let  <span class="math">I = \\{0\\}</span>  such that  <span class="math">C_I</span>  contains the indices of the first column and imagine that there exists a set J such that the difference  <span class="math">c^0 \\oplus c^1</span>  is zero in all indices in  <span class="math">C_I \\cup D_J</span>  except exactly the indices in the intersection  <span class="math">C_I \\cap D_J</span> , where it can be random. Then, certainly, if the column bytes indicated by  <span class="math">C_I</span>  were exchanged between the ciphertexts  <span class="math">(c^0, c^1)</span>  to get  <span class="math">(c&#x27;^0, c&#x27;^1)</span> , then certainly we must also have had that diagonal bytes indicated by  <span class="math">D_J</span> , and thus the diagonals indicated by J, were exchanged too. Hence, the pair of states are in a configuration where exchanging columns and diagonals means the same thing. The following theorem summarizes the probability of this event.</p>

    <p class="text-gray-300"><strong>Theorem 5.</strong> Let  <span class="math">I, J, K \\subset \\{0, 1, 2, 3\\}</span>  and  <span class="math">\\alpha, \\beta \\in \\mathbb{F}_{28}^{4 \\times 4}</span>  be two random states. Then the probability that a set of diagonals J are exchanged, given that a set of columns I are exchanged when the difference  <span class="math">\\alpha \\oplus \\beta</span>  is zero in columns indicated by K, i.e.</p>

    <p class="text-gray-300"><span class="math">$P((\\rho_d^{v^J}(\\alpha,\\beta),\\rho_d^{v^J}(\\beta,\\alpha)) = (\\rho_c^{v^I}(\\alpha,\\beta),\\rho_c^{v^I}(\\beta,\\alpha)))</span>$</p>

    <p class="text-gray-300">is given by</p>

    <p class="text-gray-300"><span class="math">$P(|I|, |J|, |K|) = (2^{-8})^{4(|I|+|J|)-|K||J|-2|I|\\cdot|J|}</span>$
.</p>

    <p class="text-gray-300"><em>Proof.</em> We restrict the state difference  <span class="math">\\alpha \\oplus \\beta</span>  to bytes indicated by indices  <span class="math">C_I \\cup D_J</span>  and require that all byte differences in this restriction is zero except for the bytes in the intersection  <span class="math">C_I \\cap D_J</span> . Since  <span class="math">|C_I \\cap D_J| = |I| \\cdot |J|</span>  and  <span class="math">|C_I \\cup D_J| = 4(|I| + |J|) - |I| \\cdot |J|</span> , and since the bytes take on  <span class="math">2^8</span>  values, it follows that with a probability</p>

    <p class="text-gray-300"><span class="math">$(2^8)^{|I|\\cdot|J|}/(2^8)^{4(|I|+|J|)-|I|\\cdot|J|} = (2^{-8})^{4(|I|+|J|)-2|I|\\cdot|J|}</span>$</p>

    <p class="text-gray-300">we have that exchanging columns I is equivalent to exchanging diagonals J (and vice versa). If columns K are equal this means that I can not take on values from K (else the relation become trivial), but only take on values  <span class="math">I \\subset \\{0,1,2,3\\} \\setminus K</span>  not in K such that |I| &lt; 4 - |K|. Thus, if the states are equal in K columns, then since the restriction of  <span class="math">C_K</span>  to  <span class="math">C_I \\cup D_J</span>  is equal to  <span class="math">C_K \\cap D_J = |K| \\cdot |J|</span>  bytes, the probability is increased by a factor of  <span class="math">(2^8)^{|K| \\cdot |J|}</span>  to  <span class="math">(2^{-8})^{4(|I|+|J|)-|K||J|-2|I||J|}</span> .</p>

    <p class="text-gray-300">(a) |K| = 0 (b) |K| = 1 (c) |K| = 2</p>

    <p class="text-gray-300">Fig. 2: Example conditions for column/diagonal exchange equivalence.</p>

    <p class="text-gray-300">In other words we have that with some fixed probability, exchanging diagonals between plaintexts is the same as exchanging (possibly some other) diagonals between the intermediate states after one round. And if some diagonals are exchanged after one round, then with probability 1 we also have that Theorem 3 applies. For instance, suppose two random plaintexts verify the differential characteristic of one of the examples in Figure 2. Then if we exchange the first diagonal between these two plaintexts, then after one round encryption only the first byte is exchanged between the intermediate states. As a consequence, both the first column and the first diagonal are exchanged between the intermediate pair after one round, and thus Theorem 3 can be extended to 5 rounds. This is summarized as follows.</p>

    <p class="text-gray-300"><strong>Theorem 6.</strong> Let  <span class="math">\\alpha, \\beta \\in \\mathbb{F}_{28}^{4 \\times 4}</span>  denote two plaintexts equal in |K| diagonals indicated by  <span class="math">K \\subset \\{0, 1, 2, 3\\}</span>  and assume  <span class="math">0 &lt; \\operatorname{wt}(\\nu(R^5(\\alpha) \\oplus R^5(\\beta))) &lt; 4</span> . Then for a non-trivial choice of  <span class="math">I \\subset \\{0, 1, 2, 3\\} \\setminus K</span>  the relation</p>

    <p class="text-gray-300"><span class="math">$\\nu(R^5(\\alpha) \\oplus R^5(\\beta))) = \\nu(R^5(\\rho_d^{v^I}(\\alpha, \\beta)) \\oplus R^5(\\rho_d^{v^I}(\\beta, \\alpha)))</span>$</p>

    <p class="text-gray-300">&#1075;</p>

    <p class="text-gray-300">holds with probability</p>

    <p class="text-gray-300"><span class="math">$P_5(|I|, |K|) = \\sum_{d=1}^{3} {4 \\choose d} P(|I|, d, |K|)</span>$</p>

    <p class="text-gray-300"><span class="math">{\\it Proof.}</span>  The relation follows trivially by combining Theorem 3 and Theorem 5. Theorem 3 states that</p>

    <p class="text-gray-300"><span class="math">$\\nu(R^4(\\rho_d^v(R(\\alpha),R(\\beta))) \\oplus R^4(\\rho_d^v(R(\\beta),R(\\alpha)))) = \\nu(R^5(\\alpha) \\oplus R^5(\\beta))</span>$</p>

    <p class="text-gray-300">for any non-zero  <span class="math">v \\in \\mathbb{F}_2^4</span> . Theorem 5 states that, if diagonals indicated by I are exchanged between the plaintexts  <span class="math">\\alpha</span>  and  <span class="math">\\beta</span> , then there is a probability  <span class="math">P(|I|, |J|, |K|) = (2^{-8})^{4(|I|+|J|)-|K||J|-2|I|\\cdot|J|}</span>  that this equals exchanging diagonals J after one round, i.e.</p>

    <p class="text-gray-300"><span class="math">$(\\rho_d^{v^J}(R(\\alpha),R(\\beta)),\\rho_d^{v^J}(R(\\beta),R(\\alpha))) = (R(\\rho_d^{v^l}(\\alpha,\\beta)),R(\\rho_d^{v^l}(\\beta,\\alpha))).</span>$</p>

    <p class="text-gray-300">Then by summing over the probabilities for each possible choice of J, for a fixed I and K, gives the desired expression.</p>

    <p class="text-gray-300">For instance, if |K| = 2 and |I| = 1, the relation holds with probability  <span class="math">P_5(1,2) = 2^{-28.19}</span> . Note that we could set  <span class="math">\\geq</span>  in front of the probabilities in Theorem 5 and Theorem 6 instead of equality, since the case when exchange of columns does not equal an exchange of diagonals contributes a tiny fraction to the total probability of the event. However, for our applications this contribution is vanishingly small, thus we may think of it as equality. This will in the worst case mean that our attack analysis is pessimistic since a higher probability will only decrease the complexity of all of our attacks.</p>

    <p class="text-gray-300">Assume an diagonal exchange-invariant set  <span class="math">A = A_0 \\oplus A_1 \\oplus A_2 \\oplus A_3</span> . We then have the following result.</p>

    <p class="text-gray-300"><strong>Theorem 7.</strong> For a diagonal exchange-invariant set  <span class="math">A = A_0 \\oplus A_1 \\oplus A_2 \\oplus A_3</span>  where  <span class="math">|A_i| = m_i</span> , the expected number of combinations of pairs  <span class="math">(a,b),(c,d) = (\\rho_d^v(a,b),\\rho_d^v(b,a))</span>  that satisfy</p>

    <p class="text-gray-300"><span class="math">$(\\rho_d^u(R(a), R(b)), \\rho_d^u(R(b), R(a))) = (R(c), R(d))</span>$</p>

    <p class="text-gray-300">for any u and v is expected to be</p>

    <p class="text-gray-300"><span class="math">$G(m_1, m_2, m_3, m_4) = \\sum_{t=1}^{4} L_t(m_1, m_2, m_3, m_4) \\cdot \\sum_{j=1}^{t-1} c(t-1, j) \\cdot P_5(j, 4-t).</span>$
(2)</p>

    <p class="text-gray-300"><em>Proof.</em> Let  <span class="math">S_{\\alpha,\\beta}</span>  denotes one of the exchange-equivalence classes in A of size  <span class="math">2^{t-1}</span> . Then there are c(t-1,j) combinations of two pairs  <span class="math">a_u, a_v</span>  from  <span class="math">S_{\\alpha,\\beta}</span>  such that  <span class="math">\\rho_d^z(a_u) = a_v</span>  for a vector z of weight j. For each of those combinations, the probability is  <span class="math">P_5(j, 4-t)</span>  that the relation holds, and thus</p>

    <p class="text-gray-300"><span class="math">$\\sum_{j=1}^{t-1} c(t-1,j) \\cdot P_5(j,4-t)</span>$</p>

    <p class="text-gray-300">    <img src="_page_12_Figure_2.jpeg" alt="" class="my-4 max-w-full" />
</p>

    <p class="text-gray-300">Fig. 3: 5-round exchange trail.</p>

    <p class="text-gray-300">is the expected number of combinations of pairs from one such set  <span class="math">S_{\\alpha,\\beta}</span>  of size  <span class="math">2^{t-1}</span>  that satisfy the condition. Then since there are  <span class="math">L_t(m_1, m_2, m_3, m_4)</span>  exchange-equivalence classes of size  <span class="math">2^{t-1}</span> , the expression follows.</p>

    <p class="text-gray-300">Theorem 6 can be used directly to show that AES limited to five full rounds is biased when plaintexts are closed under the action of diagonal exchange operations, i.e. diagonal invariant sets. We show this using the following approach. Assume f(x) is a random permutation acting on the same state space as AES and two random plaintexts  <span class="math">p^i, p^j</span>  together with the exchanged plaintexts  <span class="math">p&#x27;^i = \\rho_d^v(p^i, p^j), p&#x27;^j = \\rho_d^v(p^j, p^i)</span> . We assume that  <span class="math">p^i</span>  and  <span class="math">p^j</span>  are different in at least two diagonal positions or else the exchanged pair will be equivalent to the original pair. Then let  <span class="math">c^i = f(p^i), c^j = f(p^j), c&#x27;^i = f(p&#x27;^i)</span>  and  <span class="math">c&#x27;^j = f(p&#x27;^j)</span> . Then we ask the question; what is the probability that</p>

    <p class="text-gray-300"><span class="math">$0 &lt; \\operatorname{wt}(\\nu(c^i \\oplus c^j)) = d &lt; 4</span>$</p>

    <p class="text-gray-300">and simultaneously</p>

    <p class="text-gray-300"><span class="math">$\\nu(c^i \\oplus c^j) = \\nu(c&#x27;^i \\oplus c&#x27;^j)?</span>$</p>

    <p class="text-gray-300">In other words, what is the probability that  <span class="math">SR^{-1} \\circ MC^{-1}(c^i \\oplus c^j)</span>  is zero in 4-d columns and that  <span class="math">SR^{-1} \\circ MC^{-1}(c&#x27;^i \\oplus c&#x27;^j)</span>  is zero in exactly the same columns?</p>

    <p class="text-gray-300">For a single combination of pairs, the probability that  <span class="math">c^i</span>  and  <span class="math">c^j</span>  satisfy  <span class="math">\\operatorname{wt}(\\nu(c^i\\oplus c^j))=d</span>  (i.e.  <span class="math">SR^{-1}\\circ MC^{-1}(c^i)</span>  and  <span class="math">SR^{-1}\\circ MC^{-1}(c^j)</span>  collide in 4-d columns) is given by</p>

    <p class="text-gray-300"><span class="math">$P_{first} = \\binom{4}{4-d} (2^{32})^{-(4-d)}.</span>$</p>

    <p class="text-gray-300">For instance, the probability that two ciphertexts satisfy  <span class="math">\\operatorname{wt}(\\nu(c^i \\oplus c^j)) = 3</span>  is given by  <span class="math">\\binom{4}{1} \\cdot (2^{32})^{-1} = 2^{-30}</span> , and the probability that the pair has  <span class="math">\\operatorname{wt}(\\nu(c^i \\oplus c^j)) = 2</span>  is given by  <span class="math">\\binom{4}{2} \\cdot (2^{32})^{-2} = 6 \\cdot 2^{-64}</span> , and so on. The probability that the second pair is zero in the exact same columns as the first is then in general</p>

    <p class="text-gray-300"><span class="math">$P_{second} = (2^{32})^{-(4-d)}</span>$
.</p>

    <p class="text-gray-300">Thus, in the random case the probability of the two events is given by</p>

    <p class="text-gray-300"><span class="math">$P_{rand} = P_{first} \\cdot P_{second} \\tag{3}</span>$</p>

    <p class="text-gray-300"><span class="math">$= \\binom{4}{d} (2^{32})^{-(4-d)} \\cdot (2^{32})^{-(4-d)}. \\tag{4}</span>$</p>

    <p class="text-gray-300">But for AES, Theorem 6 states that the probability is P5(|I|, |K|) for the second event, where I is the set of exchanged diagonals while K is the set of diagonals that are equal in the initial plaintext pair. Thus, the total probability for AES becomes instead</p>

    <p class="text-gray-300"><span class="math">$P_{AES} = P_{first} \\cdot P_5(|I|, |K|). \\tag{5}</span>$</p>

    <p class="text-gray-300">For instance, if we set |I| = 1 (i.e. one diagonal is exchanged) and |K| = 2 (i.e. the difference of the plaintexts is zero in two diagonals), we get that P5(1, 2) &gt; 2 &minus;28.2 , while it is 2<sup>&minus;</sup><sup>32</sup> for random, the probability that second pair is zero in the exact same columns as the first one is. Notice that the second term of Prand, Psecond, is a function of the ciphertext collision event while the second term of PAES, P5(|I|, |K|), is fixed and independent of this ciphertext collision condition. Thus, while the second term in the probability for the random case depends on the size of the space that the difference c <sup>0</sup><sup>i</sup> &oplus; c 0j is required to collide in (e.g. has probability 2<sup>&minus;</sup><sup>96</sup> for the second event), the second term of PAES is fixed and independent of this (e.g. has always probability 2<sup>&minus;</sup>28.<sup>2</sup> for the second event). Thus, since the probability of the exchange-equivalence condition of Theorem 5 can easily be made higher than the random collision condition for the second pair, a distinguishing condition follows.</p>

    <p class="text-gray-300">For five rounds, the adversary bases the distinguisher more concretely on the following question with respect to a larger subset of plaintexts:</p>

    <p class="text-gray-300">For a subset of plaintexts A, what is the probability that there exist two distinct pairs au, a<sup>v</sup> from any of the exchange-equivalence classes Sa,b in A that satisfy</p>

    <p class="text-gray-300"><span class="math">$\\nu(R^5(a) \\oplus R^5(b)) = \\nu(R^5(c) \\oplus R^5(d))</span>$</p>

    <p class="text-gray-300">and</p>

    <p class="text-gray-300"><span class="math">$0 &lt; \\operatorname{wt}(\\nu(R^5(a) \\oplus R^5(b))) = d &lt; 4.</span>$</p>

    <p class="text-gray-300">Theorem 6 and Theorem 7 in the previous section can be used directly to set up a straight-forward 5-round chosen plaintext distinguisher for AES. If the adversary observes a pair of plaintexts (p 0 , p<sup>1</sup> ) corresponding to a pair of ciphertexts that satisfy 0 &lt; wt(&nu;(c 0 , c<sup>1</sup> )) &lt; 4, then Theorem 6 states that for any other pair (p 00 , p<sup>0</sup><sup>1</sup> ) &isin; Sp0,p<sup>1</sup> , the probability of the event &nu;(c <sup>0</sup><sup>0</sup> &oplus; c 01 ) = &nu;(c <sup>0</sup> &oplus; c 1 ) is significantly higher than for the random case. In Theorem 7 we showed that the expected number of combinations of diagonal exchange-equivalent pairs (a, b),(c, d) from the diagonal exchange-invariant set A = A<sup>0</sup> &oplus; A<sup>1</sup> &oplus; A<sup>2</sup> &oplus; A<sup>3</sup> that are also diagonal exchange equivalent after one round, is given by G(m1, m2, m3, m4) where m<sup>i</sup> = |A<sup>i</sup> |. In this case, the combination of pairs also obey the additional 4 round exchange difference relation of Theorem 3, thus  <span class="math">G(m_1, m_2, m_3, m_4)</span>  is also the expected number of combinations of exchange equivalent plaintext pairs that enjoy the 4-round exchange-difference relation for five rounds. Since  <span class="math">G(m_1, m_2, m_3, m_4)</span>  is the expected number of combinations of exchange-equivalent pairs  <span class="math">a_u, a_v</span>  that satisfy Theorem 6, it follows that</p>

    <p class="text-gray-300"><span class="math">$E_{AES} = G(m_1, m_2, m_3, m_4) \\cdot \\binom{4}{d} (2^{-32})^{(4-d)}</span>$</p>

    <p class="text-gray-300">is the expected number of combinations of pairs from the exchange-equivalence classes whose ciphertexts satisfy</p>

    <p class="text-gray-300"><span class="math">$\\nu(c&#x27;^0 \\oplus c&#x27;^1) = \\nu(c^0 \\oplus c^1)</span>$</p>

    <p class="text-gray-300">when  <span class="math">\\operatorname{wt}(\\nu(c^0\\oplus c^1))=d.</span>  For the random case, the same probability becomes</p>

    <p class="text-gray-300"><span class="math">$E_{rand} = H(m_1, m_2, m_3, m_4) \\cdot \\binom{4}{d} (2^{-32})^{(4-d)} \\cdot (2^{-32})^{(4-d)}</span>$</p>

    <p class="text-gray-300">where</p>

    <p class="text-gray-300"><span class="math">$H(m_1, m_2, m_3, m_4) = \\sum_{t=1}^{4} L_t(m_1, m_2, m_3, m_4) \\binom{2^{t-1}}{2}</span>$</p>

    <p class="text-gray-300">follows from Theorem 7 and is the total number of combinations of two pairs from each possible exchange-equivalence class  <span class="math">S_{a,b}</span> .</p>

    <p class="text-gray-300">An algorithm for the 5-round distinguisher is presented in Algorithm 1. In our distinguisher for five rounds, we pick two random subsets  <span class="math">A_0</span>  and  <span class="math">A_1</span>  of  <span class="math">\\mathbb{F}^4_{28}</span> , each of size m, and encrypt the resulting diagonal exchange-invariant set of  <span class="math">m^2</span>  plaintexts A formed by spanning the first diagonal with the possible elements from  <span class="math">A_0</span>  and the second diagonal with elements from  <span class="math">A_1</span> , while setting the remaining bytes to random constants. The structure of the plaintext subset is determined by optimizing  <span class="math">E_{AES}</span>  relative to  <span class="math">E_{rand}</span>  with the condition that d=3, i.e. the two pairs of ciphertexts must collide in the same column before the last linear layer.</p>

    <p class="text-gray-300">In this particular case, when only two diagonals are active in the plaintexts, the set of plaintexts contains exchange-equivalence classes of size 1 and 2 (note that we can not draw pairs from an exchange-equivalence class of size 1). If we set  <span class="math">m=2^{15}</span> , we get that</p>

    <p class="text-gray-300"><span class="math">$E_{AES} = G(m, m, 1, 1) \\cdot 2^{-30}</span>$</p>

    <p class="text-gray-300"><span class="math">\\approx 1</span></p>

    <p class="text-gray-300">while</p>

    <p class="text-gray-300"><span class="math">$E_{rand} = H(m, m, 1, 1) \\cdot 2^{-62}</span>$</p>

    <p class="text-gray-300"><span class="math">\\approx 2^{-4}</span> .</p>

    <p class="text-gray-300">Thus, by encrypting a plaintext set  <span class="math">A = A_0 \\oplus A_1 \\oplus A_2 \\oplus A_3</span>  where  <span class="math">|A_0| = |A_1| = m</span>  and  <span class="math">|A_2| = |A_3| = 1</span>  (i.e.  <span class="math">|A| \\approx 2^{30}</span> ), we are able to distinguish AES. An unoptimized algorithm for the distinguisher is presented in Algorithm 1.</p>

    <p class="text-gray-300">Algorithm 1: Pseudo-code for 5-round distinguisher.</p>

    <pre><code class="language-text">Input: m = 2^{15}, D = 2^{30}
Result: 1 if AES, -1 otherwise.
L^{-1} \\leftarrow SR^{-1} \\circ MC^{-1}
Choose m random values A = \\{a_0, a_1, \\dots, a_{m-1}\\} \\subset \\mathbb{F}_{2^8}^4
Choose m random values B = \\{b_0, b_1, \\dots, b_{m-1}\\} \\subset \\mathbb{F}_{28}^4
Choose random constants z_2, z_3 \\in \\mathbb{F}_{28}^4
C \\leftarrow \\{\\}
T_0, T_1, T_2, T_3 = \\{\\} // empty hash tables containing unordered sets(e.g.
 unordered multisets)
/* Encrypt and order 2^{30} plaintexts
                                                                                             */
for i from 0 to m-1 do
    for j from 0 to m-1 do
        l \\leftarrow i \\cdot m + j
         p^l \\leftarrow (a_i, b_j, z_2, z_3) // a_i is the first diagonal value and b_j is
             the second diagonal value and so forth.
         c^l \\leftarrow E_K(p^l)
         /* Add (i,j) to T_k[z] according to value z of column k of
             L^{-1}(c^l)
         for k from 0 to 3 do
             z \\leftarrow |L^{-1}(c^l)_k| // |L^{-1}(c^l)_k| is integer value of k-th column
             T_k[z] \\leftarrow T_k[z] \\cup \\{(i,j)\\}
         end
         C \\leftarrow C \\cup \\{c^l\\}
    \\mathbf{end}
end
/* Search for double collisions
                                                                                             */
for each c^i in C do
    /* coeffs(i) returns coefficients a,b s.t. a \\cdot m + b = i
    i_1, j_1 \\leftarrow coeffs(i)
    for j from 0 to 3 do
        for i_2, j_2 \\in T_j[|c_j^i|] do
             if i_1 \\neq i_2 and j_1 \\neq j_2 then
                 if L^{-1}(c^{(i_2 \\cdot m + j_1)} \\oplus c^{(i_1 \\cdot m + j_2)})_k equals 0 then
                      /* Two pairs forming double collision found
                                                                                            */
                      return 1
                 end
             end
        end
    end
end
return -1
</code></pre>

      <h3 id="sec-4.1" class="text-xl font-semibold mt-8">4.1 Complexity of Distinguisher</h3>

    <p class="text-gray-300">The algorithm consists of two parts. In the first part, the adversary encrypts  <span class="math">D=m^2=2^{30}</span>  plaintexts and inserts the index (i,j) into each of the four tables</p>

    <p class="text-gray-300"><span class="math">T_k</span>  according to the integer column values of  <span class="math">L^{-1}(c^{i \\cdot m+j})</span> , i.e. the index (i,j) is inserted into  <span class="math">T_k[|L^{-1}(c^{i \\cdot m+j})_k|]</span>  where  <span class="math">|L^{-1}(c^{i \\cdot m+j})_k|</span>  is the integer value of the k-th column of  <span class="math">L^{-1}(c^{i \\cdot m+j})</span> . The complexity of this part is roughly D encryptions plus D ciphertext-lookups times four insertions to the hash tables  <span class="math">T_k</span> , which is roughly about</p>

    <p class="text-gray-300"><span class="math">$C_{part_1} = D + \\frac{(4 \\cdot D)}{80}</span>$</p>

    <p class="text-gray-300"><span class="math">$\\approx D</span>$</p>

    <p class="text-gray-300">if we use the convention that one encryption (i.e.  <span class="math">5 \\cdot 16 = 80</span>  s-box lookups) corresponds to one unit of computation. To determine the complexity of the second part, we need to estimate approximately the expected number of entries that contains 0 values, 1 values, 2 values etc. using the formula for the expected number of multicollisions.</p>

    <p class="text-gray-300">For  <span class="math">D=2^{30}</span>  and  <span class="math">N=2^{32}</span> , by using the formula 1, we do not expect any multicollisions involving more than seven ciphertexts (i.e.  <span class="math">s(D,N,8)\\approx 0.7</span> ) and thus  <span class="math">T_k[r]</span>  contains at most seven values such that the complexity of testing each combination of ciphertexts related to an index entry of  <span class="math">T_k[r]</span>  takes at most  <span class="math">\\binom{7}{2}=21</span> . But to get a more accurate complexity estimate, we may iteratively compute the expected number of sets  <span class="math">T_k[r]</span>  which contains l=7 elements (i.e. correspond to a 7-multicollision), which contains l=6 elements, and so forth. To do this, we let  <span class="math">s_7=s(D,N,7)</span> . Then the number of 6-multicollisions not already inside a 7-multicollision is given by</p>

    <p class="text-gray-300"><span class="math">$s_6 = s(D, N, 6) - s_7 \\cdot \\binom{7}{6}.</span>$</p>

    <p class="text-gray-300">Then the number of 5-multicollisions that are not already inside a 6-multicollision, is given by</p>

    <p class="text-gray-300"><span class="math">$s_5 = s(D, N, 5) - s_6 \\cdot \\binom{6}{5}</span>$</p>

    <p class="text-gray-300">and so forth, obeying the recurrence</p>

    <p class="text-gray-300"><span class="math">$s_t = s(D, N, t) - s_{t+1} \\cdot \\binom{t+1}{t}</span>$</p>

    <p class="text-gray-300">until we arrive at  <span class="math">s_1</span> , which is the expected number of entries which contains only one element. Moreover, we should have that  <span class="math">\\sum_{t=1}^{7} s_t \\cdot t \\approx D</span> , and indeed we get that</p>

    <p class="text-gray-300"><span class="math">$\\sum_{t=1}^{7} s_t \\cdot t \\approx 2^{30}</span>$</p>

    <p class="text-gray-300">as expected. From this, we can compute the complexity corresponding to finding collisions in one of the tables T<sup>k</sup> in part 2 as</p>

    <p class="text-gray-300"><span class="math">$C&#x27;_{part_2} = s_1 + \\sum_{t=2}^{7} s_t t^2</span>$</p>

    <p class="text-gray-300"><span class="math">$\\approx (2^{29.7} + 2^{29}) \\cdot C</span>$</p>

    <p class="text-gray-300"><span class="math">$\\approx 2^{30} \\cdot C</span>$</p>

    <p class="text-gray-300">such that the total complexity of part 2 roughly becomes</p>

    <p class="text-gray-300"><span class="math">$C_{part_2} = \\frac{4 \\cdot C&#x27;_{part_2}}{80}</span>$
<span class="math">$\\approx 2^{25.7}</span>$</p>

    <p class="text-gray-300">if we adopt the convention that one operation equals one encryption, which can be viewed as 16 &middot; 5 = 80 s-box lookups, where C is the number of ciphertextlookups we do for each combinations of pairs. Hence, five rounds of AES can be distinguished using a chosen plaintext distinguisher with D = 2<sup>30</sup> data and about the same computational complexity. In the next section, we show that with a change of parameters the same distinguisher can be used to distinguish fix rounds of AES.</p>

    <p class="text-gray-300">In this section we present the first 6-round secret-key chosen plaintext distinguisher for AES, which follows from a straight-forward extension of Theorem 6. Imagine a setup similar to the 5-round distinguisher, but where we encrypt two random plaintexts p <sup>i</sup> and p <sup>j</sup> which are non-zero in all bytes except the last diagonal. As before, let p <sup>0</sup><sup>i</sup> = &rho; v d (p i , p<sup>j</sup> ) and p <sup>0</sup><sup>j</sup> = &rho; v d (p j , p<sup>i</sup> ).</p>

    <p class="text-gray-300">Now assume the following two conditions, where the first one is given by</p>

    <p class="text-gray-300"><span class="math">$\\operatorname{wt}(\\nu(R^5(p^i) \\oplus R^5(p^j))) = 1 \\tag{6}</span>$</p>

    <p class="text-gray-300">and second one is given by</p>

    <p class="text-gray-300"><span class="math">$\\operatorname{wt}(\\nu(R^6(p^i) \\oplus R^6(p^j))) = 1. \\tag{7}</span>$</p>

    <p class="text-gray-300">At random, the first condition happens with probability 2<sup>&minus;</sup><sup>94</sup> and thus the second condition happens with probability 4 3 (2<sup>&minus;</sup><sup>8</sup> ) <sup>3</sup> = 2<sup>&minus;</sup><sup>22</sup> by Theorem 4 conditioned on the first event. By symmetry of Theorem 4, the same condition applies in the reverse direction. If we observe that the second condition (7) holds, which happens with probability 2<sup>&minus;</sup><sup>94</sup> at random, then the first condition (6) holds with probability 2<sup>&minus;</sup><sup>22</sup> by Theorem 4. So assume that we observe a pair of ciphertexts c <sup>i</sup> = R<sup>6</sup> (p i ) and c <sup>j</sup> = R<sup>6</sup> (p j ) that happens to satisfy the second condition (7), i.e. SR&minus;<sup>1</sup> &#9702; MC&minus;<sup>1</sup> (c <sup>i</sup> &oplus; c j ) contains exactly one active column. Such an event happens at random with probability</p>

    <p class="text-gray-300"><span class="math">$P_{R6} = 2^{-94}.</span>$</p>

    <p class="text-gray-300">Then by Theorem 4 applied in the reverse direction, the probability of the first condition (6) conditioned on the event (7) is given by</p>

    <p class="text-gray-300"><span class="math">$P_{R5} = 2^{-22},</span>$</p>

    <p class="text-gray-300">i.e. SR&minus;<sup>1</sup> &#9702;MC&minus;<sup>1</sup> (R<sup>5</sup> (p i )&oplus;R<sup>5</sup> (p j )) contains exactly one active column too. But if the first event (6) occurs, then by Theorem 6 we also have that the event</p>

    <p class="text-gray-300"><span class="math">$\\nu(R^5(p&#x27;^i) \\oplus R^5(p&#x27;^j)) = \\nu(R^5(p^i) \\oplus R^5(p^j))</span>$</p>

    <p class="text-gray-300">happens with probability probability PR<sup>1</sup> = P5(3, 1) &asymp; 2 <sup>&minus;</sup><sup>38</sup> for the exchanged pair. Hence, both pairs satisfy</p>

    <p class="text-gray-300"><span class="math">$wt(\\nu(R^{5}(p&#x27;^{i}) \\oplus R^{5}(p&#x27;^{j}))) = wt(\\nu(R^{5}(p^{i}) \\oplus R^{5}(p^{j})))</span>$
=1</p>

    <p class="text-gray-300">and thus it follows from Theorem 4 applied to the exchanged pair in the fifth round that the probability of the two simultaneous events (conditioned on the previous events)</p>

    <p class="text-gray-300"><span class="math">$\\operatorname{wt}(\\nu(R^{6}(p^{i}) \\oplus R^{6}(p^{j}))) = \\operatorname{wt}(\\nu(R^{6}(p^{i}) \\oplus R^{6}(p^{j}))) = 1</span>$</p>

    <p class="text-gray-300">is given by PR<sup>6</sup> <sup>0</sup> = 2<sup>&minus;</sup>22. Hence, if the adversary observes a pair of ciphertexts that satisfy (7), then the probability that the event wt(&nu;(R<sup>6</sup> (p 0i )&oplus;R<sup>6</sup> (p 0j ))) = 1 occur (i.e. the same event happens for the exchanged pair too) is given by</p>

    <p class="text-gray-300"><span class="math">$P_{second} = P_{R5} \\cdot P_5(3,1) \\cdot P_{R6&#x27;}</span>$</p>

    <p class="text-gray-300"><span class="math">\\approx 2^{-44} \\cdot 2^{-38}</span>
<span class="math">= 2^{-82}</span> .</p>

    <p class="text-gray-300">In the random case, however, the probability that the second ciphertext pair satisfies the last condition (7) is 2<sup>&minus;</sup><sup>94</sup> for both pairs of ciphertexts. Thus, for a random plaintext/ciphertext pair (p i , p<sup>j</sup> ) &rarr; (c i , c<sup>j</sup> ) and an exchanged pair (p 0i , p<sup>0</sup><sup>j</sup> ) &rarr; (c 0i , c<sup>0</sup><sup>j</sup> ), the probability that</p>

    <p class="text-gray-300"><span class="math">$\\operatorname{wt}(\\nu(c^i \\oplus c^j)) = \\operatorname{wt}(\\nu(c&#x27;^i \\oplus c&#x27;^j)) = 1</span>$</p>

    <p class="text-gray-300">is for a random permutation given by</p>

    <p class="text-gray-300"><span class="math">$P_{rand} = 2^{-94} \\cdot 2^{-94}</span>$
<span class="math">$= 2^{-188}</span>$</p>

    <p class="text-gray-300">while it is equal to</p>

    <p class="text-gray-300"><span class="math">$P_{AES} = 2^{-94} \\cdot 2^{-82}</span>$
<span class="math">$= 2^{-176}</span>$</p>

    <p class="text-gray-300">for AES. We may summarize the result as follows.</p>

    <p class="text-gray-300">Theorem 8. Let A = A<sup>0</sup> &oplus; A<sup>1</sup> &oplus; A<sup>2</sup> &oplus; A<sup>3</sup> with |A0| = |A1| = |A2| = 229.<sup>4</sup> and |A3| = 1 such that |A| = 288.<sup>2</sup> , then the expected number of combinations of pairs (a, b),(c, d) from the exchange-equivalence classes in A whose ciphertexts satisfy</p>

    <p class="text-gray-300"><span class="math">$\\Pr(\\text{wt}(\\nu(R^6(a) \\oplus R^6(b))) = \\text{wt}(\\nu(R^6(c) \\oplus R^6(d))) = 1)</span>$</p>

    <p class="text-gray-300">is given by</p>

    <p class="text-gray-300"><span class="math">$E_{AES} = G(m, m, m, 1) \\cdot 2^{-44} \\cdot 2^{-94}</span>$</p>

    <p class="text-gray-300"><span class="math">$\\approx 1</span>$</p>

    <p class="text-gray-300">while</p>

    <p class="text-gray-300"><span class="math">$E_{rand} = H(m, m, m, 1) \\cdot 2^{-94} \\cdot 2^{-94}</span>$</p>

    <p class="text-gray-300"><span class="math">\\approx 2^{-11}</span></p>

    <p class="text-gray-300">for random.</p>

    <p class="text-gray-300">Proof. Proof follows straight forwardly by combining Theorem 6, Theorem 7 and Theorem 4. Assume that two exchange-equivalent pairs satisfy the 5 round exchange relation and assume that one of them satisfy relation 6. Then the other pair must satisfy this relation. The probability that both pairs satisfy this condition is therefore 2<sup>&minus;</sup><sup>94</sup> (in comparison to 2<sup>&minus;</sup>94&minus;<sup>94</sup> for random). Then due to Theorem 4, it follows that the probability that both pairs of ciphertexts obey relation 7, is 2<sup>&minus;</sup><sup>22</sup> &middot; 2 <sup>&minus;</sup><sup>22</sup> = 2<sup>&minus;</sup><sup>44</sup> . ut</p>

    <p class="text-gray-300">Hence, if the adversary encrypts a set of D = (229.<sup>4</sup> ) <sup>3</sup> = 288.<sup>2</sup> plaintexts, we expect to find a combination of pairs that satisfy our condition, while we expect to find 2<sup>&minus;</sup><sup>10</sup> double collisions for a random permutation. Thus, we have the basis for a distinguisher which can distinguish 6 full rounds of AES that requires 288.<sup>2</sup> chosen plaintexts.</p>

      <h3 id="sec-5.1" class="text-xl font-semibold mt-8">5.1 Distinguishing Attack Algorithm for Six Rounds</h3>

    <p class="text-gray-300">Similar to the 5-round distinguisher, we pick three sets A0, A<sup>1</sup> and A2, each of size &asymp; 2 29.4 such that we may generate a diagonal exchange-invariant set of D = 288.<sup>2</sup> plaintexts in such a way that the i-th diagonal of each plaintext is spanned by the possible elements of A<sup>i</sup> while the last diagonal is set to a random constant. In fact, the algorithm is exactly the same as the 5-round distinguisher, except for a change of parameters and collision condition. Moreover, this time each of our hash-tables may in the worst case contain up to 2<sup>88</sup>.<sup>2</sup> values. The algorithm for six rounds AES is presented in Algorithm 2 and it can be readily seen that ciphertexts are essentially the same as for five rounds. However, if we observe a pair of ciperhtexts c <sup>i</sup> and c j that have our desired collision property and which stems from a plaintext pair p <sup>i</sup> and p <sup>j</sup> which differ in all three diagonals, then we need to generate the remaining three possible exchanges of those to test the secondary condition. Due to our use of indices for locating ciphertexts in the algorithm, exchanging a pair of plaintexts corresponds to exchanging indices between the corresponding ciphertexts. However, in the algorithm we are more explicit for ease of understanding.</p>

    <p class="text-gray-300">    <img src="_page_20_Figure_2.jpeg" alt="" class="my-4 max-w-full" />
</p>

    <p class="text-gray-300">Fig. 4: 6-round exchange trail.</p>

      <h3 id="sec-5.2" class="text-xl font-semibold mt-8">5.2 Complexity of Distinguisher</h3>

    <p class="text-gray-300">The analysis of the 6-round distinguisher pretty much follows the same line as the 5-round distinguisher. The distinguisher consists of two parts; first the adversary populates the tables T<sup>k</sup> followed by a collision search. The first part is estimated in the same way as for the five rounds, i.e. we get roughly</p>

    <p class="text-gray-300"><span class="math">$\\begin{aligned} C_{part_1} = &amp; D + \\frac{(4 \\cdot D)}{96} \\\\ \\approx &amp; D. \\end{aligned}</span>$</p>

    <p class="text-gray-300">where we adopt the convention that one unit equals one encryption, where one encryption equals 96 s-box look-ups for six full rounds. For part 2, searching for collisions, the analysis is the same as for five rounds. Again, by using the recurrence (1) for multicollisions, we find that more than 10 collisions in the same entry Tk[r] is unlikely (i.e. s(288.<sup>2</sup> , 2 96 , 10) &asymp; 2 &minus;4 ). Thus, again we may apply the recursion</p>

    <p class="text-gray-300"><span class="math">$s_t = s(D, N, t) - s_{t+1} \\cdot \\binom{t+1}{t}</span>$</p>

    <p class="text-gray-300">to compute s<sup>8</sup> down to s<sup>1</sup> given that s<sup>9</sup> is expected to be s(D, N, 9). This way, we find the expected number of entries in each table which has nine elements, eight elements, and so on. If the computation is correct, we should have that</p>

    <p class="text-gray-300"><span class="math">$\\sum_{t=1}^{9} s_t \\cdot t \\approx 2^{88.2}</span>$</p>

    <p class="text-gray-300">which we indeed get. From this, we can compute the complexity corresponding to finding collisions in one of the tables T<sup>k</sup> in part 2 as</p>

    <p class="text-gray-300"><span class="math">$C&#x27;_{part_2} = (s_1 + \\sum_{t=2}^{9} s_t t^2) \\cdot C</span>$
<span class="math">$\\approx (2^{88.19} + 2^{81.4}) \\cdot C</span>$
<span class="math">$\\approx 2^{88.2} \\cdot C</span>$</p>

    <p class="text-gray-300">where C is the number of ciphertext-lookups we do for each combinations of pairs. Note that the algorithm will spend most of the time detecting entries with no collision. In the second term above, each table index of size t is visited t times (once for each ciphertext in it, which is not optimal). We can do at most three additional exchanges between the observed pairs, or else we can do one or zero exchanges, depending on the size of the exchange-equivalence class these pairs belong to (either size one, two or four). In any case, this last term does not contribute to the final complexity  <span class="math">C&#x27;_{part_2}</span> . Thus, the expected complexity of evaluating the four tables then roughly becomes</p>

    <p class="text-gray-300"><span class="math">$C_{part_2} = \\frac{4 \\cdot C&#x27;_{part_2}}{96}</span>$
<span class="math">$\\approx 2^{83.6}</span>$</p>

    <p class="text-gray-300">where we adopt the convention that one unit equals one encryption, where one encryption equals 96 s-box look-ups for six full rounds. Thus, the total complexity of the algorithm is dominated by the number of required ciphertexts,  <span class="math">D=2^{88.2}</span> , in terms of data, memory and computation.</p>

    </section>

    <section id="sec-6" class="mb-10">
      <h2 class="text-2xl font-bold">6 Conclusion</h2>

    <p class="text-gray-300">In this paper we have introduced the first 6-round secret-key chosen-plaintext distinguisher for AES using a new type of attack called exchange-equivalence attacks (or simply, exchange attacks). The distinguisher has data and computational complexity of only  <span class="math">2^{88.2}</span>  and can thus be viewed as a giant leap in the cryptanalysis of AES when one considers that the first 5-round secret-key distinguisher for AES appeared nearly 20 years after the publication of Rijndael. All of our attacks can easily be turned into chosen ciphertext attacks on the inverted block cipher due to the inherent symmetry of the properties we are using. Our results are easily generalized to any SPN-like cipher, and in particular, we note that the theory in this paper can be generalized to extend the attacks for more rounds for ciphers with slower diffusion (e.g. lightweight designs). We are confident that our results lead the way to further breakthroughs on ciphers such as AES.</p>

    </section>

    <section id="sec-7" class="mb-10">
      <h2 class="text-2xl font-bold">7 Acknowledgments</h2>

    <p class="text-gray-300">We thank the anonymous reviewers for their valuable comments and suggestions. This research was supported by the Norwegian Research Council.</p>

    </section>

    <section id="references" class="mb-10">
      <h2 class="text-2xl font-bold">References</h2>

    <ul class="space-y-2 text-gray-400 text-sm list-none">
      <li><ul class="space-y-2 text-gray-400 text-sm list-none">
      <li>Biham, E., Keller, N.: Cryptanalysis of reduced variants of rijndael. In: 3rd AES Conference. vol. 230 (2000)</li>
    </ul></li>
      <li><ul class="space-y-2 text-gray-400 text-sm list-none">
      <li>Bouillaguet, C., Derbez, P., Dunkelman, O., Fouque, P.A., Keller, N., Rijmen, V.: Low-data complexity attacks on aes. IEEE Transactions on Information Theory 58(11), 7002&ndash;7017 (2012)</li>
    </ul></li>
      <li><ul class="space-y-2 text-gray-400 text-sm list-none">
      <li>Daemen, J., Rijmen, V.: Plateau characteristics. IET Information Security 1, 11&ndash;17 (2007)</li>
    </ul></li>
      <li><ul class="space-y-2 text-gray-400 text-sm list-none">
      <li>Daemen, J., Rijmen, V.: The design of rijndael: Aes the advanced encryption standard. In: Springer (2002)</li>
    </ul></li>
      <li><ul class="space-y-2 text-gray-400 text-sm list-none">
      <li>Daemen, J., Rijmen, V.: Understanding two-round differentials in aes. In: Security and Cryptography for Networks: 5th International Conference, SCN 2006, Maiori, Italy, September 6-8, 2006. Proceedings. pp. 78&ndash;94. Springer Berlin Heidelberg, Berlin, Heidelberg (2006)</li>
    </ul></li>
      <li><ul class="space-y-2 text-gray-400 text-sm list-none">
      <li>Derbez, P., Fouque, P.A.: Automatic search of meet-in-the-middle and impossible differential attacks. In: Advances in Cryptology &ndash; CRYPTO 2016: 36th Annual International Cryptology Conference, Santa Barbara, CA, USA, August 14-18, 2016, Proceedings, Part II. pp. 157&ndash;184. Springer Berlin Heidelberg, Berlin, Heidelberg (2016)</li>
    </ul></li>
      <li><ul class="space-y-2 text-gray-400 text-sm list-none">
      <li>Grassi, L.: Mixture differential cryptanalysis: a new approach to distinguishers and attacks on round-reduced AES. IACR Transactions on Symmetric Cryptology 2018(2), 133&ndash;160 (Jun 2018)</li>
    </ul></li>
      <li><ul class="space-y-2 text-gray-400 text-sm list-none">
      <li>Grassi, L., Rechberger, C., R&oslash;njom, S.: Subspace trail cryptanalysis and its applications to AES. IACR Trans. Symmetric Cryptol. 2016(2), 192&ndash;225 (2016)</li>
    </ul></li>
      <li><ul class="space-y-2 text-gray-400 text-sm list-none">
      <li>Grassi, L., Rechberger, C., R&oslash;njom, S.: A new structural-differential property of 5-round aes. In: Advances in Cryptology &ndash; EUROCRYPT 2017: 36th Annual International Conference on the Theory and Applications of Cryptographic Techniques, Paris, France, April 30 &ndash; May 4, 2017, Proceedings, Part II. pp. 289&ndash;317. Springer International Publishing, Cham (2017)</li>
    </ul></li>
      <li><ul class="space-y-2 text-gray-400 text-sm list-none">
      <li>Gueron, S., Mouha, N.: Simpira v2: A family of efficient permutations using the aes round function. In: Cheon, J.H., Takagi, T. (eds.) Advances in Cryptology &ndash; ASIACRYPT 2016: 22nd International Conference on the Theory and Application of Cryptology and Information Security, Hanoi, Vietnam, December 4-8, 2016, Proceedings, Part I. pp. 95&ndash;125. Springer Berlin Heidelberg, Berlin, Heidelberg (2016)</li>
    </ul></li>
      <li><ul class="space-y-2 text-gray-400 text-sm list-none">
      <li>Joux, A.: Algorithmic Cryptanalysis. Chapman &amp; Hall/CRC, 1st edn. (2009)</li>
    </ul></li>
      <li><ul class="space-y-2 text-gray-400 text-sm list-none">
      <li>Knudsen, L.R., Wagner, D.: Integral cryptanalysis. In: Fast Software Encryption, 9th International Workshop, FSE 2002, Leuven, Belgium, February 4-6, 2002, Revised Papers. pp. 112&ndash;127 (2002)</li>
    </ul></li>
      <li><ul class="space-y-2 text-gray-400 text-sm list-none">
      <li>Rijmen, V.: Cryptanalysis and design of iterated block ciphers. Doctoral Dissertation, K.U.Leuven (1997)</li>
    </ul></li>
      <li><ul class="space-y-2 text-gray-400 text-sm list-none">
      <li>R&oslash;njom, S., Bardeh, N.G., Helleseth, T.: Yoyo tricks with AES. In: Advances in Cryptology - ASIACRYPT 2017 - 23rd International Conference on the Theory and Applications of Cryptology and Information Security, Hong Kong, China, December 3-7, 2017, Proceedings, Part I. pp. 217&ndash;243 (2017)</li>
    </ul></li>
      <li><ul class="space-y-2 text-gray-400 text-sm list-none">
      <li>Sun, B., Liu, M., Guo, J., Qu, L., Rijmen, V.: New insights on aes-like spn ciphers. In: Robshaw, M., Katz, J. (eds.) Advances in Cryptology &ndash; CRYPTO 2016: 36th Annual International Cryptology Conference, Santa Barbara, CA, USA, August 14-18, 2016, Proceedings, Part I. pp. 605&ndash;624. Springer Berlin Heidelberg (2016)</li>
    </ul></li>
    </ul>

    <h4 id="sec-misc-1" class="text-lg font-semibold mt-6"><strong>Algorithm 2:</strong> Pseudo-code for 6-round distinguisher.</h4>

    <pre><code class="language-text">Input: m = 2^{29.4}, D = 2^{88.2}
Result: 1 if AES, -1 otherwise.
L^{-1} \\leftarrow SR^{-1} \\circ MC^{-1}
Choose m random values A = \\{a_0, a_1, \\dots, a_{m-1}\\} \\subset \\mathbb{F}_{2^8}^4
Choose m random values B = \\{b_0, b_1, \\dots, b_{m-1}\\} \\subset \\mathbb{F}_{28}^4
Choose m random values C = \\{c_0, c_1, \\dots, c_{m-1}\\} \\subset \\mathbb{F}_{28}^{4}
Choose random constants z_3 \\in \\mathbb{F}_{28}^4
C \\leftarrow \\{\\}
T_0, T_1, T_2, T_3 = \\{\\} // empty hash tables containing unordered sets(e.g.
    unordered multisets)
/* Encrypt 2^{88.2} plaintexts
                                                                                           */
for i from 0 to m-1 do
    for j from 0 to m-1 do
        for k from 0 to m-1 do
             l \\leftarrow i \\cdot m^2 + j \\cdot m + k
             p^l \\leftarrow (a_i, b_j, c_k, z_3) // a_i is the first diagonal value and b_j
                 is the second diagonal value and so forth.
             c^l \\leftarrow E_K(p^l)
             /* T_r[z] contains indices (i,j,k) for ciphertext c^{i\\cdot m^2+j\\cdot m+k}
                 with value z in the r-th column of L^{-1}(c^{i\\cdot m^2+j\\cdot m+k}) */
             for r from 0 to 3 do
                 z \\leftarrow |L^{-1}(c^l)_r| // |L^{-1}(c^l)_r| is integer value of r-th
                 T_r[z] \\leftarrow T_r[z] \\cup \\{(i,j,k)\\}
             end
             C \\leftarrow C \\cup \\{c^l\\}
        \\mathbf{end}
    end
end
/* Search for double collisions
                                                                                            */
for each c^i in C do
    /* coeffs(i) returns coefficients a,b,c s.t. a\\cdot m^2+b\\cdot m+c=i */
    i_1, j_1, k_1 \\leftarrow coeffs(i)
    for j from 0 to 3 do
        for i_2, j_2, k_2 \\in T_j[|c_i^i|] do
             /* G_{i,j} is the set of ciphertexts corresponding to
                 exchange-equivalence class S_{p^i,p^j}
                                                                                           */
             S \\leftarrow G_{(i_1,j_1,k_1),(i_2,j_2,k_2)} //|G| \\le 4
             for each pair (a,b) \\in S do
                 if wt(\\nu(R^6(a)) \\oplus R^6(b)) equals 1 then
                     /* Two pairs forming double collision found
                                                                                          */
                 return 1 end
             end
        end
    end
end
return -1
</code></pre>

    </section>
`;
---

<BaseLayout title="The Exchange Attack: How to Distinguish Six Rounds of AES wi... (2019/652)">
  <article class="max-w-4xl mx-auto article-prose">
    <nav class="mb-8">
      <a href="/papers" class="text-blue-400 hover:text-blue-300">
        &larr; Back to Papers
      </a>
    </nav>

    <header class="mb-12">
      <h1 class="text-3xl font-bold mb-4"
        set:html={TITLE_HTML} />
      <p class="text-gray-400 mb-2"
        set:html={AUTHORS_HTML} />
      <p class="text-gray-500 text-sm mb-4">
        2019 &middot; eprint 2019/652
      </p>
      <div class="flex gap-4 text-sm">
        <a
          href={EPRINT_URL}
          target="_blank"
          rel="noopener noreferrer"
          class="text-blue-400 hover:text-blue-300"
        >
          Paper (eprint) &rarr;
        </a>
      </div>
      <PaperDisclaimer eprintUrl={EPRINT_URL} />
      <p class="mt-1 text-xs text-gray-600">
        Converted with: {CRAWLER} &middot; {CONVERTED_DATE}
      </p>
    </header>

    <nav id="toc" class="mb-10 p-6 rounded-lg" style="background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.06);">
      <h2 class="text-lg font-bold mb-4">Table of Contents</h2>
      <ol class="space-y-1 text-sm text-gray-300
        list-decimal list-inside">
        <li>
          <a href="#sec-1" class="hover:text-white">Introduction</a>
          <ol class="ml-6 mt-1 space-y-1 list-decimal
            list-inside text-gray-400">
            <li><a href="#sec-1.1" class="hover:text-white">Our Contribution</a></li>
            <li><a href="#sec-1.2" class="hover:text-white">Overview of This Paper and Main Results</a></li>
          </ol>
        </li>
        <li>
          <a href="#sec-2" class="hover:text-white">Preliminaries</a>
          <ol class="ml-6 mt-1 space-y-1 list-decimal
            list-inside text-gray-400">
            <li><a href="#sec-2.1" class="hover:text-white">Collision and Multicollision in a Set</a></li>
          </ol>
        </li>
        <li><a href="#sec-3" class="hover:text-white">When Column Exchange Equals Diagonal Exchange</a></li>
        <li>
          <a href="#sec-4" class="hover:text-white">The Exchange Attack on Five Rounds AES</a>
          <ol class="ml-6 mt-1 space-y-1 list-decimal
            list-inside text-gray-400">
            <li><a href="#sec-4.1" class="hover:text-white">Complexity of Distinguisher</a></li>
          </ol>
        </li>
        <li>
          <a href="#sec-5" class="hover:text-white">The Exchange Attack on Six Rounds AES</a>
          <ol class="ml-6 mt-1 space-y-1 list-decimal
            list-inside text-gray-400">
            <li><a href="#sec-5.1" class="hover:text-white">Distinguishing Attack Algorithm for Six Rounds</a></li>
            <li><a href="#sec-5.2" class="hover:text-white">Complexity of Distinguisher</a></li>
          </ol>
        </li>
        <li><a href="#sec-6" class="hover:text-white">Conclusion</a></li>
        <li><a href="#sec-7" class="hover:text-white">Acknowledgments</a></li>
      </ol>
      <p class="text-xs text-gray-500 mt-4 mb-1 font-semibold">
        Additional
      </p>
      <ul class="space-y-1 text-sm text-gray-400
        list-disc list-inside">
        <li><a href="#references" class="hover:text-white">References</a></li>
      </ul>
    </nav>


    <Fragment set:html={CONTENT} />

    <PaperHistory slug="4-the-exchange-attack-on-five-rounds-aes-2019" />
  </article>
</BaseLayout>
