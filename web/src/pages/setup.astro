---
import BaseLayout from '../layouts/BaseLayout.astro';
---

<BaseLayout title="Setup">
  <div class="max-w-4xl mx-auto">
    <header class="mb-12">
      <h1 class="text-4xl font-bold mb-4">Development Setup</h1>
      <p class="text-xl text-gray-300">
        Get your environment ready to explore and contribute to Cryptography
        Academy.
      </p>
    </header>

    <section class="mb-12">
      <h2 class="text-2xl font-bold mb-6">Prerequisites</h2>
      <ul class="list-disc list-inside space-y-2 text-gray-300">
        <li>macOS, Linux, or WSL on Windows</li>
        <li>Node.js 24+ (for the website)</li>
        <li>Git</li>
      </ul>
    </section>

    <section class="mb-12">
      <h2 class="text-2xl font-bold mb-6">1. Clone the Repository</h2>
      <pre
        class="bg-gray-800 p-4 rounded-lg overflow-x-auto mb-4"><code>git clone https://github.com/cryptographyacademy/cryptographyacademy.github.io.git
cd cryptographyacademy.github.io</code></pre>
    </section>

    <section class="mb-12">
      <h2 class="text-2xl font-bold mb-6">2. Run Setup Script</h2>
      <p class="text-gray-300 mb-4">The quickest way to set up everything:</p>
      <pre
        class="bg-gray-800 p-4 rounded-lg overflow-x-auto mb-4"><code>./scripts/setup-all.sh</code></pre>

      <p class="text-gray-300 mb-4">This script will:</p>
      <ul class="list-disc list-inside space-y-2 text-gray-300 mb-6">
        <li>Install <strong class="text-white">elan</strong> (Lean version manager)</li>
        <li>Download the Lean toolchain</li>
        <li>Download Mathlib4 cache</li>
        <li>Build the Lean project</li>
        <li>Install npm dependencies</li>
        <li>Build the website</li>
      </ul>

      <p class="text-gray-300 mb-4">Or run individual setup scripts:</p>
      <pre
        class="bg-gray-800 p-4 rounded-lg overflow-x-auto"><code># Lean only
./scripts/setup-lean.sh

# Web only
./scripts/setup-web.sh</code></pre>
    </section>

    <section class="mb-12">
      <h2 class="text-2xl font-bold mb-6">3. Verify Installation</h2>
      <pre
        class="bg-gray-800 p-4 rounded-lg overflow-x-auto"><code>./scripts/verify-setup.sh</code></pre>
    </section>

    <section class="mb-12">
      <h2 class="text-2xl font-bold mb-6">4. Start Development Server</h2>
      <pre
        class="bg-gray-800 p-4 rounded-lg overflow-x-auto mb-4"><code>make serve</code></pre>
      <p class="text-gray-300">
        Open <a href="http://localhost:4321" class="text-blue-400 hover:text-blue-300">http://localhost:4321</a> in your browser.
      </p>
    </section>

    <section class="mb-12">
      <h2 class="text-2xl font-bold mb-6">Editor Setup</h2>

      <div class="space-y-8">
        <div>
          <h3 class="text-xl font-semibold mb-4">VS Code (Recommended)</h3>
          <ol class="list-decimal list-inside space-y-2 text-gray-300">
            <li>Install the <strong class="text-white">lean4</strong> extension (ID: <code class="bg-gray-800 px-2 py-1 rounded">leanprover.lean4</code>)</li>
            <li>Open the <code class="bg-gray-800 px-2 py-1 rounded">lean/</code> folder in VS Code</li>
            <li>Wait for the Lean server to start</li>
          </ol>
        </div>

        <div>
          <h3 class="text-xl font-semibold mb-4">Neovim</h3>
          <p class="text-gray-300 mb-4">
            Use <a href="https://github.com/neovim/nvim-lspconfig" class="text-blue-400 hover:text-blue-300">nvim-lspconfig</a> with the Lean 4 LSP:
          </p>
          <pre
            class="bg-gray-800 p-4 rounded-lg overflow-x-auto"><code>-- In your init.lua
require('lspconfig').lean4.setup{}</code></pre>
        </div>

        <div>
          <h3 class="text-xl font-semibold mb-4">Emacs</h3>
          <p class="text-gray-300 mb-4">
            Install <a href="https://github.com/leanprover-community/lean4-mode" class="text-blue-400 hover:text-blue-300">lean4-mode</a>:
          </p>
          <pre
            class="bg-gray-800 p-4 rounded-lg overflow-x-auto"><code>;; In your init.el
(use-package lean4-mode
  :straight (lean4-mode
             :type git
             :host github
             :repo "leanprover-community/lean4-mode"))</code></pre>
        </div>
      </div>
    </section>

    <section class="mb-12">
      <h2 class="text-2xl font-bold mb-6">Available Commands</h2>
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead>
            <tr class="border-b border-gray-700">
              <th class="text-left py-3 pr-4">Command</th>
              <th class="text-left py-3">Description</th>
            </tr>
          </thead>
          <tbody class="text-gray-300">
            <tr class="border-b border-gray-800">
              <td class="py-3 pr-4"><code class="bg-gray-800 px-2 py-1 rounded">make help</code></td>
              <td class="py-3">Show all available commands</td>
            </tr>
            <tr class="border-b border-gray-800">
              <td class="py-3 pr-4"><code class="bg-gray-800 px-2 py-1 rounded">make build</code></td>
              <td class="py-3">Build Lean proofs and website</td>
            </tr>
            <tr class="border-b border-gray-800">
              <td class="py-3 pr-4"><code class="bg-gray-800 px-2 py-1 rounded">make serve</code></td>
              <td class="py-3">Start development server</td>
            </tr>
            <tr class="border-b border-gray-800">
              <td class="py-3 pr-4"><code class="bg-gray-800 px-2 py-1 rounded">make test</code></td>
              <td class="py-3">Run all tests</td>
            </tr>
            <tr class="border-b border-gray-800">
              <td class="py-3 pr-4"><code class="bg-gray-800 px-2 py-1 rounded">make lint</code></td>
              <td class="py-3">Run linters</td>
            </tr>
            <tr class="border-b border-gray-800">
              <td class="py-3 pr-4"><code class="bg-gray-800 px-2 py-1 rounded">make format</code></td>
              <td class="py-3">Format code</td>
            </tr>
            <tr>
              <td class="py-3 pr-4"><code class="bg-gray-800 px-2 py-1 rounded">make clean</code></td>
              <td class="py-3">Clean build artifacts</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section class="mb-12">
      <h2 class="text-2xl font-bold mb-6">Troubleshooting</h2>

      <div class="space-y-6">
        <div>
          <h3 class="text-xl font-semibold mb-2">Mathlib cache download is slow</h3>
          <p class="text-gray-300">
            The initial Mathlib download can take time. The cache is stored in <code class="bg-gray-800 px-2 py-1 rounded">lean/.lake/</code>.
          </p>
        </div>

        <div>
          <h3 class="text-xl font-semibold mb-2">Lean server not starting</h3>
          <p class="text-gray-300">
            Make sure you're opening the <code class="bg-gray-800 px-2 py-1 rounded">lean/</code> directory, not the project root.
            The <code class="bg-gray-800 px-2 py-1 rounded">lakefile.toml</code> must be in the root of the opened folder.
          </p>
        </div>

        <div>
          <h3 class="text-xl font-semibold mb-2">Need more help?</h3>
          <p class="text-gray-300">
            <a
              href="https://github.com/cryptographyacademy/cryptographyacademy.github.io/issues"
              class="text-blue-400 hover:text-blue-300"
            >
              Open an issue on GitHub
            </a>
          </p>
        </div>
      </div>
    </section>
  </div>
</BaseLayout>
