---
import BaseLayout from '../../layouts/BaseLayout.astro';
---

<BaseLayout title="Proofs and Tactics">
  <div class="max-w-4xl mx-auto">
    <nav class="mb-8">
      <a href="/learn" class="text-blue-400 hover:text-blue-300"
        >← Back to Learn</a
      >
    </nav>

    <header class="mb-12">
      <h1 class="text-4xl font-bold mb-4">Proofs and Tactics</h1>
      <p class="text-xl text-gray-300">
        Learn how proofs work in Lean 4. Understand common tactics and how to
        read tactic-based proofs.
      </p>
      <p class="text-sm text-gray-500 mt-4">
        <a
          href="https://github.com/badaas/cryptography.academy/blob/main/lean/CryptoAcademy/Tutorials/Tactics.lean"
          target="_blank"
          rel="noopener noreferrer"
          class="hover:text-gray-400"
        >
          View verified source →
        </a>
      </p>
    </header>

    <article class="prose-custom">
      <section class="mb-12">
        <h2 class="text-2xl font-bold mb-6">Proofs Are Programs</h2>

        <p class="text-gray-300 mb-6 leading-relaxed">
          In Lean, a proof of a proposition <code
            class="bg-gray-800 px-1 rounded">P</code
          >
          is a term of type <code class="bg-gray-800 px-1 rounded">P</code>.
          This is the Curry-Howard correspondence: propositions are types,
          proofs are programs.
        </p>

        <pre
          class="bg-gray-800 p-4 rounded-lg overflow-x-auto mb-6"><code class="text-sm"><span class="text-gray-500">-- The proposition "2 + 2 = 4" is a type</span>
<span class="text-purple-400">#check</span> (<span class="text-green-400">2</span> + <span class="text-green-400">2</span> = <span class="text-green-400">4</span>)  <span class="text-gray-500">-- : Prop</span>

<span class="text-gray-500">-- A proof is a term of that type</span>
<span class="text-purple-400">example</span> : <span class="text-green-400">2</span> + <span class="text-green-400">2</span> = <span class="text-green-400">4</span> := rfl  <span class="text-gray-500">-- rfl proves equality by computation</span></code></pre>

        <div class="bg-blue-900/30 border border-blue-700 p-4 rounded-lg mb-6">
          <p class="text-blue-200">
            <strong>Key insight:</strong> When you see
            <code class="bg-gray-800 px-1 rounded"
              >theorem foo : P := proof</code
            >, read it as "foo is a proof of P".
          </p>
        </div>
      </section>

      <section class="mb-12">
        <h2 class="text-2xl font-bold mb-6">Tactic Mode</h2>

        <p class="text-gray-300 mb-6 leading-relaxed">
          Writing proofs directly as terms is possible but tedious. <em
            >Tactics</em
          >
          let you build proofs interactively, step by step. Enter tactic mode with
          <code class="bg-gray-800 px-1 rounded">by</code>:
        </p>

        <pre
          class="bg-gray-800 p-4 rounded-lg overflow-x-auto mb-6"><code class="text-sm"><span class="text-purple-400">theorem</span> <span class="text-blue-300">add_comm_example</span> (a b : <span class="text-yellow-300">Nat</span>) : a + b = b + a := <span class="text-purple-400">by</span>
  <span class="text-gray-500">-- Goal: a + b = b + a</span>
  apply Nat.add_comm
  <span class="text-gray-500">-- No more goals!</span></code></pre>

        <p class="text-gray-300 mb-6 leading-relaxed">
          Each tactic transforms the current <em>goal</em> (what we need to prove)
          into simpler subgoals, until no goals remain.
        </p>
      </section>

      <section class="mb-12">
        <h2 class="text-2xl font-bold mb-6">Essential Tactics</h2>

        <p class="text-gray-300 mb-6 leading-relaxed">
          These tactics appear frequently in cryptographic proofs:
        </p>

        <div class="space-y-6">
          <div class="bg-gray-800 p-6 rounded-lg">
            <h3 class="text-xl font-semibold mb-3 text-blue-300">intro</h3>
            <p class="text-gray-300 mb-4">
              Introduces hypotheses. When the goal is <code
                class="bg-gray-700 px-1 rounded">∀ x, P x</code
              >
              or <code class="bg-gray-700 px-1 rounded">A → B</code>, intro
              brings the variable or assumption into scope.
            </p>
            <pre
              class="bg-gray-900 p-3 rounded overflow-x-auto"><code class="text-sm"><span class="text-purple-400">example</span> : <span class="text-purple-400">∀</span> n : <span class="text-yellow-300">Nat</span>, n = n := <span class="text-purple-400">by</span>
  intro n      <span class="text-gray-500">-- introduces n, goal becomes: n = n</span>
  rfl</code></pre>
          </div>

          <div class="bg-gray-800 p-6 rounded-lg">
            <h3 class="text-xl font-semibold mb-3 text-blue-300">apply</h3>
            <p class="text-gray-300 mb-4">
              Uses a theorem or hypothesis. If we have <code
                class="bg-gray-700 px-1 rounded">h : A → B</code
              >
              and goal <code class="bg-gray-700 px-1 rounded">B</code>, then
              <code class="bg-gray-700 px-1 rounded">apply h</code> changes the goal
              to
              <code class="bg-gray-700 px-1 rounded">A</code>.
            </p>
            <pre
              class="bg-gray-900 p-3 rounded overflow-x-auto"><code class="text-sm"><span class="text-purple-400">example</span> (h : <span class="text-purple-400">∀</span> n, n + <span class="text-green-400">0</span> = n) : <span class="text-green-400">5</span> + <span class="text-green-400">0</span> = <span class="text-green-400">5</span> := <span class="text-purple-400">by</span>
  apply h     <span class="text-gray-500">-- uses h with n = 5</span></code></pre>
          </div>

          <div class="bg-gray-800 p-6 rounded-lg">
            <h3 class="text-xl font-semibold mb-3 text-blue-300">exact</h3>
            <p class="text-gray-300 mb-4">
              Provides exactly the term needed to close the goal.
            </p>
            <pre
              class="bg-gray-900 p-3 rounded overflow-x-auto"><code class="text-sm"><span class="text-purple-400">example</span> (h : <span class="text-green-400">2</span> + <span class="text-green-400">2</span> = <span class="text-green-400">4</span>) : <span class="text-green-400">2</span> + <span class="text-green-400">2</span> = <span class="text-green-400">4</span> := <span class="text-purple-400">by</span>
  exact h     <span class="text-gray-500">-- h is exactly what we need</span></code></pre>
          </div>

          <div class="bg-gray-800 p-6 rounded-lg">
            <h3 class="text-xl font-semibold mb-3 text-blue-300">
              rw (rewrite)
            </h3>
            <p class="text-gray-300 mb-4">
              Substitutes equals for equals. If <code
                class="bg-gray-700 px-1 rounded">h : a = b</code
              >, then <code class="bg-gray-700 px-1 rounded">rw [h]</code> replaces
              <code class="bg-gray-700 px-1 rounded">a</code> with
              <code class="bg-gray-700 px-1 rounded">b</code> in the goal.
            </p>
            <pre
              class="bg-gray-900 p-3 rounded overflow-x-auto"><code class="text-sm"><span class="text-purple-400">example</span> (a b : <span class="text-yellow-300">Nat</span>) (h : a = b) : a + <span class="text-green-400">1</span> = b + <span class="text-green-400">1</span> := <span class="text-purple-400">by</span>
  rw [h]      <span class="text-gray-500">-- substitutes a with b, closes by rfl automatically</span></code></pre>
          </div>

          <div class="bg-gray-800 p-6 rounded-lg">
            <h3 class="text-xl font-semibold mb-3 text-blue-300">
              native_decide
            </h3>
            <p class="text-gray-300 mb-4">
              Proves decidable propositions by computation. Useful for
              numeric equalities.
            </p>
            <pre
              class="bg-gray-900 p-3 rounded overflow-x-auto"><code class="text-sm"><span class="text-purple-400">example</span> : (<span class="text-green-400">1</span> + <span class="text-green-400">2</span>) * <span class="text-green-400">3</span> = <span class="text-green-400">9</span> := <span class="text-purple-400">by</span>
  native_decide  <span class="text-gray-500">-- computes and verifies</span></code></pre>
          </div>

          <div class="bg-gray-800 p-6 rounded-lg">
            <h3 class="text-xl font-semibold mb-3 text-blue-300">
              constructor / cases
            </h3>
            <p class="text-gray-300 mb-4">
              <code class="bg-gray-700 px-1 rounded">constructor</code> builds a structure
              or And/Exists. <code class="bg-gray-700 px-1 rounded">cases</code> destructs
              a hypothesis into its components.
            </p>
            <pre
              class="bg-gray-900 p-3 rounded overflow-x-auto"><code class="text-sm"><span class="text-gray-500">-- Proving an And</span>
<span class="text-purple-400">example</span> : <span class="text-green-400">1</span> = <span class="text-green-400">1</span> <span class="text-purple-400">∧</span> <span class="text-green-400">2</span> = <span class="text-green-400">2</span> := <span class="text-purple-400">by</span>
  constructor    <span class="text-gray-500">-- splits into two goals</span>
  · rfl          <span class="text-gray-500">-- proves 1 = 1</span>
  · rfl          <span class="text-gray-500">-- proves 2 = 2</span>

<span class="text-gray-500">-- Using an And hypothesis</span>
<span class="text-purple-400">example</span> (h : <span class="text-green-400">1</span> = <span class="text-green-400">1</span> <span class="text-purple-400">∧</span> <span class="text-green-400">2</span> = <span class="text-green-400">2</span>) : <span class="text-green-400">1</span> = <span class="text-green-400">1</span> := <span class="text-purple-400">by</span>
  cases h with   <span class="text-gray-500">-- splits h into left and right</span>
  | intro left right => exact left</code></pre>
          </div>
        </div>
      </section>

      <section class="mb-12">
        <h2 class="text-2xl font-bold mb-6">Reading a Proof</h2>

        <p class="text-gray-300 mb-6 leading-relaxed">
          Here's a complete proof you might see in cryptographic formalization:
        </p>

        <pre
          class="bg-gray-800 p-4 rounded-lg overflow-x-auto mb-6"><code class="text-sm"><span class="text-gray-500">-- Binding property: can't open a commitment two ways</span>
<span class="text-purple-400">theorem</span> <span class="text-blue-300">binding</span> (scheme : CommitmentScheme M R C)
    (h : scheme.commit m₁ r₁ = scheme.commit m₂ r₂)
    (hbind : scheme.isBinding) : m₁ = m₂ := <span class="text-purple-400">by</span>
  <span class="text-gray-500">-- Apply the binding property</span>
  apply hbind
  <span class="text-gray-500">-- Provide the witness: same commitment</span>
  exact h</code></pre>

        <p class="text-gray-300 mb-6 leading-relaxed">Reading this proof:</p>

        <ol class="list-decimal list-inside space-y-2 text-gray-300 mb-6">
          <li>
            We have a commitment scheme and know two commit outputs are equal
          </li>
          <li>
            <code class="bg-gray-800 px-1 rounded">apply hbind</code> uses the binding
            property, which says equal commitments imply equal messages
          </li>
          <li>
            <code class="bg-gray-800 px-1 rounded">exact h</code> provides the proof
            that the commitments are equal
          </li>
        </ol>
      </section>

      <section class="mb-12">
        <h2 class="text-2xl font-bold mb-6">The sorry Escape Hatch</h2>

        <p class="text-gray-300 mb-6 leading-relaxed">
          <code class="bg-gray-800 px-1 rounded">sorry</code> is a placeholder that
          "proves" anything. It's used for incomplete proofs:
        </p>

        <pre
          class="bg-gray-800 p-4 rounded-lg overflow-x-auto mb-6"><code class="text-sm"><span class="text-purple-400">theorem</span> <span class="text-blue-300">incomplete</span> : <span class="text-green-400">1</span> = <span class="text-green-400">2</span> := <span class="text-purple-400">by</span>
  sorry  <span class="text-gray-500">-- This "proves" the false statement!</span></code></pre>

        <div
          class="bg-yellow-900/30 border border-yellow-700 p-4 rounded-lg mb-6"
        >
          <p class="text-yellow-200">
            <strong>Warning:</strong> Any theorem using <code
              class="bg-gray-800 px-1 rounded">sorry</code
            >
            is not actually proven. Lean will warn you, and the theorem cannot be
            trusted. On this site, we clearly mark which proofs are complete.
          </p>
        </div>
      </section>

      <section class="mb-12">
        <h2 class="text-2xl font-bold mb-6">Proof Patterns in Cryptography</h2>

        <p class="text-gray-300 mb-6 leading-relaxed">
          Cryptographic proofs often follow these patterns:
        </p>

        <div class="space-y-4">
          <div class="bg-gray-800 p-4 rounded-lg">
            <h3 class="font-semibold text-white mb-2">Reduction proofs</h3>
            <p class="text-gray-400">
              "If adversary A breaks scheme S, then adversary B breaks
              assumption H." These use <code class="bg-gray-700 px-1 rounded"
                >intro</code
              > to assume A exists, then construct B.
            </p>
          </div>

          <div class="bg-gray-800 p-4 rounded-lg">
            <h3 class="font-semibold text-white mb-2">Game-hopping</h3>
            <p class="text-gray-400">
              Transform a security game through a sequence of indistinguishable
              steps. Each hop uses <code class="bg-gray-700 px-1 rounded"
                >calc</code
              > or
              <code class="bg-gray-700 px-1 rounded">trans</code> to chain inequalities.
            </p>
          </div>

          <div class="bg-gray-800 p-4 rounded-lg">
            <h3 class="font-semibold text-white mb-2">
              Algebraic manipulation
            </h3>
            <p class="text-gray-400">
              Working in groups or rings. Use <code
                class="bg-gray-700 px-1 rounded">ring</code
              >
              tactic for polynomial arithmetic,
              <code class="bg-gray-700 px-1 rounded">group</code> for group theory.
            </p>
          </div>
        </div>
      </section>

      <section class="mb-12">
        <h2 class="text-2xl font-bold mb-6">Next Steps</h2>

        <p class="text-gray-300 mb-6 leading-relaxed">
          You can now follow tactic proofs. Next, learn how to use Mathlib's
          algebraic structures:
        </p>

        <a
          href="/learn/mathlib-basics"
          class="inline-block bg-blue-600 hover:bg-blue-500 text-white px-6 py-3 rounded font-semibold"
        >
          Next: Using Mathlib →
        </a>
      </section>
    </article>
  </div>
</BaseLayout>
