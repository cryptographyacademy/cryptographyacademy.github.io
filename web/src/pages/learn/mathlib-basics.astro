---
import BaseLayout from '../../layouts/BaseLayout.astro';
---

<BaseLayout title="Using Mathlib">
  <div class="max-w-4xl mx-auto">
    <nav class="mb-8">
      <a href="/learn" class="text-blue-400 hover:text-blue-300"
        >← Back to Learn</a
      >
    </nav>

    <header class="mb-12">
      <h1 class="text-4xl font-bold mb-4">Using Mathlib</h1>
      <p class="text-xl text-gray-300">
        Mathlib is Lean's mathematics library. Learn to navigate its algebraic
        structures and use existing theorems in cryptographic proofs.
      </p>
      <p class="text-sm text-gray-500 mt-4">
        <a
          href="https://github.com/badaas/cryptography.academy/blob/main/lean/CryptoAcademy/Tutorials/Mathlib.lean"
          target="_blank"
          rel="noopener noreferrer"
          class="hover:text-gray-400"
        >
          View verified source →
        </a>
      </p>
    </header>

    <article class="prose-custom">
      <section class="mb-12">
        <h2 class="text-2xl font-bold mb-6">What Is Mathlib?</h2>

        <p class="text-gray-300 mb-6 leading-relaxed">
          Mathlib is a community-maintained library containing thousands of
          mathematical definitions and theorems. For cryptography, we rely
          heavily on its algebraic structures: groups, rings, and fields.
        </p>

        <div class="bg-blue-900/30 border border-blue-700 p-4 rounded-lg mb-6">
          <p class="text-blue-200">
            <strong>Why Mathlib matters:</strong> Instead of defining groups from
            scratch, we use Mathlib's battle-tested definitions. This gives us access
            to thousands of proven lemmas for free.
          </p>
        </div>
      </section>

      <section class="mb-12">
        <h2 class="text-2xl font-bold mb-6">Algebraic Structures</h2>

        <p class="text-gray-300 mb-6 leading-relaxed">
          Mathlib organizes algebra using <em>typeclasses</em>. Here are the key
          structures for cryptography:
        </p>

        <div class="space-y-6">
          <div class="bg-gray-800 p-6 rounded-lg">
            <h3 class="text-xl font-semibold mb-3 text-blue-300">Group</h3>
            <p class="text-gray-300 mb-4">
              A set with an associative operation, identity, and inverses.
              Cryptographic groups (elliptic curves, multiplicative groups) are
              modeled this way.
            </p>
            <pre
              class="bg-gray-900 p-3 rounded overflow-x-auto"><code class="text-sm"><span class="text-gray-500">-- G is a group means we have:</span>
<span class="text-gray-500">-- * : G → G → G      (multiplication)</span>
<span class="text-gray-500">-- 1 : G              (identity)</span>
<span class="text-gray-500">-- ⁻¹ : G → G         (inverse)</span>

<span class="text-purple-400">variable</span> [Group G]

<span class="text-gray-500">-- These theorems are available:</span>
<span class="text-purple-400">#check</span> @mul_assoc G _        <span class="text-gray-500">-- (a * b) * c = a * (b * c)</span>
<span class="text-purple-400">#check</span> @one_mul G _          <span class="text-gray-500">-- 1 * a = a</span>
<span class="text-purple-400">#check</span> @inv_mul_cancel G _   <span class="text-gray-500">-- a⁻¹ * a = 1</span></code></pre>
          </div>

          <div class="bg-gray-800 p-6 rounded-lg">
            <h3 class="text-xl font-semibold mb-3 text-blue-300">CommGroup</h3>
            <p class="text-gray-300 mb-4">
              A commutative (abelian) group. Most cryptographic groups are
              commutative.
            </p>
            <pre
              class="bg-gray-900 p-3 rounded overflow-x-auto"><code class="text-sm"><span class="text-purple-400">variable</span> [CommGroup G]

<span class="text-purple-400">#check</span> @mul_comm G _   <span class="text-gray-500">-- a * b = b * a</span></code></pre>
          </div>

          <div class="bg-gray-800 p-6 rounded-lg">
            <h3 class="text-xl font-semibold mb-3 text-blue-300">
              Ring and Field
            </h3>
            <p class="text-gray-300 mb-4">
              Rings have addition and multiplication. Fields additionally have
              division (multiplicative inverses for nonzero elements).
            </p>
            <pre
              class="bg-gray-900 p-3 rounded overflow-x-auto"><code class="text-sm"><span class="text-purple-400">variable</span> [Field F]

<span class="text-gray-500">-- We get both additive and multiplicative structure:</span>
<span class="text-purple-400">#check</span> @add_comm F _        <span class="text-gray-500">-- a + b = b + a</span>
<span class="text-purple-400">#check</span> @mul_add F _         <span class="text-gray-500">-- a * (b + c) = a*b + a*c</span>
<span class="text-purple-400">#check</span> @mul_inv_cancel F _  <span class="text-gray-500">-- a ≠ 0 → a * a⁻¹ = 1</span></code></pre>
          </div>

          <div class="bg-gray-800 p-6 rounded-lg">
            <h3 class="text-xl font-semibold mb-3 text-blue-300">ZMod n</h3>
            <p class="text-gray-300 mb-4">
              Integers modulo n. When n is prime, <code
                class="bg-gray-700 px-1 rounded">ZMod n</code
              >
              is a field.
            </p>
            <pre
              class="bg-gray-900 p-3 rounded overflow-x-auto"><code class="text-sm"><span class="text-gray-500">-- Arithmetic in ZMod works as expected</span>
<span class="text-purple-400">example</span> : (<span class="text-green-400">3</span> : ZMod <span class="text-green-400">7</span>) + <span class="text-green-400">5</span> = <span class="text-green-400">1</span> := rfl  <span class="text-gray-500">-- 3 + 5 = 8 ≡ 1 (mod 7)</span></code></pre>
          </div>
        </div>
      </section>

      <section class="mb-12">
        <h2 class="text-2xl font-bold mb-6">Type Classes in Action</h2>

        <p class="text-gray-300 mb-6 leading-relaxed">
          The bracket notation <code class="bg-gray-800 px-1 rounded"
            >[Group G]</code
          >
          means "G has a Group structure." Lean finds the right instance automatically:
        </p>

        <pre
          class="bg-gray-800 p-4 rounded-lg overflow-x-auto mb-6"><code class="text-sm"><span class="text-gray-500">-- A theorem that works for ANY group</span>
<span class="text-purple-400">theorem</span> <span class="text-blue-300">my_inv_inv</span> [Group G] (a : G) : a⁻¹⁻¹ = a := <span class="text-purple-400">by</span>
  <span class="text-gray-500">-- Mathlib already has this!</span>
  exact inv_inv a</code></pre>

        <p class="text-gray-300 mb-6 leading-relaxed">
          The power of polymorphism: prove once, use for any group.
        </p>
      </section>

      <section class="mb-12">
        <h2 class="text-2xl font-bold mb-6">Finding Theorems</h2>

        <p class="text-gray-300 mb-6 leading-relaxed">
          Mathlib has thousands of lemmas. Here's how to find them:
        </p>

        <div class="space-y-4">
          <div class="bg-gray-800 p-4 rounded-lg">
            <h3 class="font-semibold text-white mb-2">Naming conventions</h3>
            <p class="text-gray-400">
              Lemma names describe what they do:
              <code class="bg-gray-700 px-1 rounded">mul_comm</code> (multiplication
              commutes),
              <code class="bg-gray-700 px-1 rounded">add_assoc</code> (addition associates),
              <code class="bg-gray-700 px-1 rounded">inv_mul_cancel</code> (inverse
              times element is identity).
            </p>
          </div>

          <div class="bg-gray-800 p-4 rounded-lg">
            <h3 class="font-semibold text-white mb-2">exact?</h3>
            <p class="text-gray-400 mb-2">
              The <code class="bg-gray-700 px-1 rounded">exact?</code> tactic searches
              for a lemma that closes the current goal:
            </p>
            <pre
              class="bg-gray-900 p-3 rounded overflow-x-auto"><code class="text-sm"><span class="text-purple-400">example</span> [Group G] (a b : G) : a * b * b⁻¹ = a := <span class="text-purple-400">by</span>
  exact?  <span class="text-gray-500">-- suggests: exact mul_inv_cancel_right a b</span></code></pre>
          </div>

          <div class="bg-gray-800 p-4 rounded-lg">
            <h3 class="font-semibold text-white mb-2">Online documentation</h3>
            <p class="text-gray-400">
              Browse the <a
                href="https://leanprover-community.github.io/mathlib4_docs/"
                class="text-blue-400 hover:text-blue-300"
                target="_blank"
                rel="noopener"
              >
                Mathlib4 docs</a
              > to explore available definitions and theorems.
            </p>
          </div>
        </div>
      </section>

      <section class="mb-12">
        <h2 class="text-2xl font-bold mb-6">Cryptographic Example</h2>

        <p class="text-gray-300 mb-6 leading-relaxed">
          Here's how Mathlib structures appear in cryptographic code:
        </p>

        <pre
          class="bg-gray-800 p-4 rounded-lg overflow-x-auto mb-6"><code class="text-sm"><span class="text-gray-500">-- A Schnorr-like discrete log setting</span>
<span class="text-purple-400">structure</span> <span class="text-blue-300">DLSetting</span> <span class="text-purple-400">where</span>
  G : <span class="text-yellow-300">Type*</span>              <span class="text-gray-500">-- The group</span>
  [grp : CommGroup G]     <span class="text-gray-500">-- It's a commutative group</span>
  g : G                   <span class="text-gray-500">-- Generator</span>
  q : <span class="text-yellow-300">ℕ</span>                   <span class="text-gray-500">-- Order of g</span>
  g_order : g ^ q = <span class="text-green-400">1</span>      <span class="text-gray-500">-- g^q = identity</span>

<span class="text-gray-500">-- With this structure, we inherit all group lemmas:</span>
<span class="text-purple-400">example</span> (s : DLSetting) : s.g * s.g⁻¹ = <span class="text-green-400">1</span> := <span class="text-purple-400">by</span>
  exact mul_inv_cancel s.g</code></pre>

        <p class="text-gray-300 mb-6 leading-relaxed">
          The <code class="bg-gray-800 px-1 rounded">[grp : CommGroup G]</code> annotation
          makes G a commutative group, giving us access to all of Mathlib's group
          theory.
        </p>
      </section>

      <section class="mb-12">
        <h2 class="text-2xl font-bold mb-6">Common Mathlib Imports</h2>

        <p class="text-gray-300 mb-6 leading-relaxed">
          You'll often see these imports in cryptographic code:
        </p>

        <pre
          class="bg-gray-800 p-4 rounded-lg overflow-x-auto mb-6"><code class="text-sm"><span class="text-purple-400">import</span> Mathlib.Algebra.Group.Basic       <span class="text-gray-500">-- Group theory</span>
<span class="text-purple-400">import</span> Mathlib.Algebra.Field.Basic       <span class="text-gray-500">-- Field theory</span>
<span class="text-purple-400">import</span> Mathlib.Data.ZMod.Basic           <span class="text-gray-500">-- Integers mod n</span>
<span class="text-purple-400">import</span> Mathlib.NumberTheory.Divisors     <span class="text-gray-500">-- Divisibility</span>
<span class="text-purple-400">import</span> Mathlib.Data.Polynomial.Basic    <span class="text-gray-500">-- Polynomials</span></code></pre>
      </section>

      <section class="mb-12">
        <h2 class="text-2xl font-bold mb-6">Next Steps</h2>

        <p class="text-gray-300 mb-6 leading-relaxed">
          You now understand how Mathlib provides algebraic foundations. Next,
          learn the patterns specific to cryptographic formalizations:
        </p>

        <a
          href="/learn/crypto-patterns"
          class="inline-block bg-blue-600 hover:bg-blue-500 text-white px-6 py-3 rounded font-semibold"
        >
          Next: Cryptographic Patterns →
        </a>
      </section>
    </article>
  </div>
</BaseLayout>
