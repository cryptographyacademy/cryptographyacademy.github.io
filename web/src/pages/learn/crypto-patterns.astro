---
import BaseLayout from '../../layouts/BaseLayout.astro';
---

<BaseLayout title="Cryptographic Patterns">
  <div class="max-w-4xl mx-auto">
    <nav class="mb-8">
      <a href="/learn" class="text-blue-400 hover:text-blue-300"
        >← Back to Learn</a
      >
    </nav>

    <header class="mb-12">
      <h1 class="text-4xl font-bold mb-4">Cryptographic Patterns</h1>
      <p class="text-xl text-gray-300">
        Learn the common patterns used to formalize cryptographic primitives,
        security definitions, and proofs on this site.
      </p>
      <p class="text-sm text-gray-500 mt-4">
        <a
          href="https://github.com/badaas/cryptography.academy/blob/main/lean/CryptoAcademy/Tutorials/CryptoPatterns.lean"
          target="_blank"
          rel="noopener noreferrer"
          class="hover:text-gray-400"
        >
          View verified source →
        </a>
      </p>
    </header>

    <article class="prose-custom">
      <section class="mb-12">
        <h2 class="text-2xl font-bold mb-6">
          Cryptographic Schemes as Structures
        </h2>

        <p class="text-gray-300 mb-6 leading-relaxed">
          We model cryptographic schemes as Lean structures that bundle
          algorithms with their required properties:
        </p>

        <pre
          class="bg-gray-800 p-4 rounded-lg overflow-x-auto mb-6"><code class="text-sm"><span class="text-gray-500">-- A commitment scheme bundles commit/reveal with correctness</span>
<span class="text-purple-400">structure</span> <span class="text-blue-300">CommitmentScheme</span> (M R C : <span class="text-yellow-300">Type*</span>) <span class="text-purple-400">where</span>
  <span class="text-gray-500">-- Algorithms</span>
  commit : M → R → C
  reveal : C → R → M

  <span class="text-gray-500">-- Correctness property</span>
  correct : <span class="text-purple-400">∀</span> m r, reveal (commit m r) r = m</code></pre>

        <p class="text-gray-300 mb-6 leading-relaxed">
          This pattern appears throughout the site:
        </p>

        <ul class="list-disc list-inside space-y-2 text-gray-300 mb-6">
          <li>Encryption schemes: KeyGen, Encrypt, Decrypt + correctness</li>
          <li>Signature schemes: KeyGen, Sign, Verify + correctness</li>
          <li>Hash functions: Hash + collision resistance definition</li>
        </ul>
      </section>

      <section class="mb-12">
        <h2 class="text-2xl font-bold mb-6">Security Properties</h2>

        <p class="text-gray-300 mb-6 leading-relaxed">
          Security properties are expressed as propositions. A scheme satisfies
          a property if we can prove the proposition:
        </p>

        <pre
          class="bg-gray-800 p-4 rounded-lg overflow-x-auto mb-6"><code class="text-sm"><span class="text-gray-500">-- Hiding: commitment reveals nothing about the message</span>
<span class="text-purple-400">def</span> <span class="text-blue-300">isHiding</span> (scheme : CommitmentScheme M R C) : <span class="text-yellow-300">Prop</span> :=
  <span class="text-purple-400">∀</span> m₁ m₂ : M, <span class="text-purple-400">∀</span> r₁ r₂ : R,
    <span class="text-gray-500">-- Commitments are indistinguishable</span>
    Indistinguishable (scheme.commit m₁ r₁) (scheme.commit m₂ r₂)

<span class="text-gray-500">-- Binding: can't reveal to two different messages</span>
<span class="text-purple-400">def</span> <span class="text-blue-300">isBinding</span> (scheme : CommitmentScheme M R C) : <span class="text-yellow-300">Prop</span> :=
  <span class="text-purple-400">∀</span> c : C, <span class="text-purple-400">∀</span> m₁ m₂ : M, <span class="text-purple-400">∀</span> r₁ r₂ : R,
    scheme.commit m₁ r₁ = c →
    scheme.commit m₂ r₂ = c →
    m₁ = m₂</code></pre>

        <div class="bg-blue-900/30 border border-blue-700 p-4 rounded-lg mb-6">
          <p class="text-blue-200">
            <strong>Pattern:</strong> Security definitions use universal quantifiers
            (<code class="bg-gray-800 px-1 rounded">∀</code>) to say "for all
            possible inputs" and implications (<code
              class="bg-gray-800 px-1 rounded">→</code
            >) to express "if... then...".
          </p>
        </div>
      </section>

      <section class="mb-12">
        <h2 class="text-2xl font-bold mb-6">Computational Assumptions</h2>

        <p class="text-gray-300 mb-6 leading-relaxed">
          Many cryptographic proofs rely on hardness assumptions. We express
          these as axioms or unproven propositions:
        </p>

        <pre
          class="bg-gray-800 p-4 rounded-lg overflow-x-auto mb-6"><code class="text-sm"><span class="text-gray-500">-- The Discrete Logarithm assumption</span>
<span class="text-purple-400">def</span> <span class="text-blue-300">DLog_Hard</span> (s : DLSetting) : <span class="text-yellow-300">Prop</span> :=
  <span class="text-purple-400">∀</span> A : Adversary,           <span class="text-gray-500">-- For any adversary</span>
    Pr[A wins DLog game] ≤ negl  <span class="text-gray-500">-- Winning probability is negligible</span>

<span class="text-gray-500">-- A theorem that assumes DLog hardness</span>
<span class="text-purple-400">theorem</span> <span class="text-blue-300">schnorr_secure</span>
    (s : DLSetting)
    (hdlog : DLog_Hard s)        <span class="text-gray-500">-- Assumption!</span>
    : Secure (SchnorrScheme s) := <span class="text-purple-400">by</span>
  <span class="text-gray-500">-- Proof uses hdlog...</span>
  sorry</code></pre>

        <p class="text-gray-300 mb-6 leading-relaxed">
          When you see <code class="bg-gray-800 px-1 rounded"
            >(h : Assumption)</code
          >
          as a theorem parameter, the proof <em>relies on</em> that assumption being
          true.
        </p>
      </section>

      <section class="mb-12">
        <h2 class="text-2xl font-bold mb-6">Game-Based Security</h2>

        <p class="text-gray-300 mb-6 leading-relaxed">
          Security is often defined through games between a challenger and
          adversary:
        </p>

        <pre
          class="bg-gray-800 p-4 rounded-lg overflow-x-auto mb-6"><code class="text-sm"><span class="text-gray-500">-- A security game structure</span>
<span class="text-purple-400">structure</span> <span class="text-blue-300">SecurityGame</span> (A : <span class="text-yellow-300">Type*</span>) <span class="text-purple-400">where</span>
  <span class="text-gray-500">-- The game procedure</span>
  play : A → Bool              <span class="text-gray-500">-- Adversary plays, wins or loses</span>

  <span class="text-gray-500">-- Advantage is distance from random guessing</span>
  advantage : A → <span class="text-yellow-300">ℝ</span>

<span class="text-gray-500">-- Scheme is secure if no adversary has significant advantage</span>
<span class="text-purple-400">def</span> <span class="text-blue-300">Secure</span> (game : SecurityGame A) : <span class="text-yellow-300">Prop</span> :=
  <span class="text-purple-400">∀</span> adv : A, game.advantage adv ≤ negligible</code></pre>

        <div class="bg-gray-800 p-6 rounded-lg mb-6">
          <h3 class="font-semibold text-white mb-3">Example: IND-CPA Game</h3>
          <ol class="list-decimal list-inside space-y-2 text-gray-300">
            <li>Challenger generates a keypair</li>
            <li>Adversary submits two messages m₀, m₁</li>
            <li>Challenger encrypts m_b for random bit b</li>
            <li>Adversary guesses b'</li>
            <li>Adversary wins if b' = b</li>
          </ol>
          <p class="text-gray-400 mt-3">
            Security means: advantage = |Pr[b' = b] - 1/2| is negligible
          </p>
        </div>
      </section>

      <section class="mb-12">
        <h2 class="text-2xl font-bold mb-6">Reduction Proofs</h2>

        <p class="text-gray-300 mb-6 leading-relaxed">
          The most common proof technique: reduce breaking the scheme to
          breaking a hard problem.
        </p>

        <pre
          class="bg-gray-800 p-4 rounded-lg overflow-x-auto mb-6"><code class="text-sm"><span class="text-gray-500">-- "If you can break Schnorr, you can solve DLog"</span>
<span class="text-purple-400">theorem</span> <span class="text-blue-300">schnorr_reduction</span>
    (A : SchnorrAdversary)           <span class="text-gray-500">-- Adversary against Schnorr</span>
    (hA : A.advantage > ε)           <span class="text-gray-500">-- With significant advantage</span>
    : <span class="text-purple-400">∃</span> B : DLogAdversary,             <span class="text-gray-500">-- We can build DLog solver</span>
        B.advantage ≥ f(ε) := <span class="text-purple-400">by</span>
  <span class="text-gray-500">-- Construct B using A as a subroutine</span>
  use constructReduction A
  <span class="text-gray-500">-- Show B has related advantage</span>
  sorry</code></pre>

        <p class="text-gray-300 mb-6 leading-relaxed">
          The structure is always: assume adversary A exists, construct
          adversary B that uses A, show B's success relates to A's success.
        </p>
      </section>

      <section class="mb-12">
        <h2 class="text-2xl font-bold mb-6">Concrete vs Asymptotic Security</h2>

        <p class="text-gray-300 mb-6 leading-relaxed">
          We formalize both styles:
        </p>

        <div class="grid md:grid-cols-2 gap-6 mb-6">
          <div class="bg-gray-800 p-4 rounded-lg">
            <h3 class="font-semibold text-white mb-2">Asymptotic</h3>
            <p class="text-gray-400 text-sm">
              Advantage is <code class="bg-gray-700 px-1 rounded"
                >negligible(λ)</code
              >
              as security parameter λ grows. Good for theoretical understanding.
            </p>
          </div>
          <div class="bg-gray-800 p-4 rounded-lg">
            <h3 class="font-semibold text-white mb-2">Concrete</h3>
            <p class="text-gray-400 text-sm">
              Advantage is ≤ <code class="bg-gray-700 px-1 rounded">ε</code> for specific
              ε. Better for implementation guidance.
            </p>
          </div>
        </div>

        <pre
          class="bg-gray-800 p-4 rounded-lg overflow-x-auto mb-6"><code class="text-sm"><span class="text-gray-500">-- Concrete security bound</span>
<span class="text-purple-400">theorem</span> <span class="text-blue-300">elgamal_security</span>
    (hddh : DDH_Advantage ≤ ε_ddh)
    : IND_CPA_Advantage ElGamal ≤ ε_ddh := <span class="text-purple-400">by</span>
  <span class="text-gray-500">-- Tight reduction!</span>
  sorry</code></pre>
      </section>

      <section class="mb-12">
        <h2 class="text-2xl font-bold mb-6">Reading Site Formalizations</h2>

        <p class="text-gray-300 mb-6 leading-relaxed">
          When you explore the proofs on this site, look for:
        </p>

        <div class="space-y-4">
          <div>
            <h3 class="font-semibold text-white">Structure definitions</h3>
            <p class="text-gray-400">
              What algorithms and properties make up the scheme?
            </p>
          </div>
          <div>
            <h3 class="font-semibold text-white">Security definitions</h3>
            <p class="text-gray-400">
              What game or property defines security?
            </p>
          </div>
          <div>
            <h3 class="font-semibold text-white">Assumptions</h3>
            <p class="text-gray-400">
              What computational hardness is required?
            </p>
          </div>
          <div>
            <h3 class="font-semibold text-white">Reductions</h3>
            <p class="text-gray-400">
              How does breaking the scheme break the assumption?
            </p>
          </div>
        </div>
      </section>

      <section class="mb-12">
        <h2 class="text-2xl font-bold mb-6">You're Ready!</h2>

        <p class="text-gray-300 mb-6 leading-relaxed">
          You now have the Lean knowledge needed to explore the formalizations
          on this site. Start with the foundations:
        </p>

        <div class="flex flex-wrap gap-4">
          <a
            href="/foundations"
            class="inline-block bg-blue-600 hover:bg-blue-500 text-white px-6 py-3 rounded font-semibold"
          >
            Explore Foundations →
          </a>
          <a
            href="/primitives"
            class="inline-block bg-gray-700 hover:bg-gray-600 text-white px-6 py-3 rounded font-semibold"
          >
            Browse Primitives →
          </a>
        </div>
      </section>
    </article>
  </div>
</BaseLayout>
